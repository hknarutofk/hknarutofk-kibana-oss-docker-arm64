{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/data/public/index_patterns/index_patterns/index_pattern.js","dependencies":[{"path":"src/legacy/core_plugins/data/public/index_patterns/index_patterns/index_pattern.js","mtime":1572296409480},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkluZGV4UGF0dGVybiA9IHZvaWQgMDsKCnZhciBfbG9kYXNoID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgibG9kYXNoIikpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX3JlYWN0ID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9jaHJvbWUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInVpL2Nocm9tZSIpKTsKCnZhciBfZXJyb3JzID0gcmVxdWlyZSgidWkvZXJyb3JzIik7Cgp2YXIgX2ZpZWxkX2Zvcm1hdHMgPSByZXF1aXJlKCJ1aS9yZWdpc3RyeS9maWVsZF9mb3JtYXRzIik7Cgp2YXIgX21hcHBpbmdfc2V0dXAgPSByZXF1aXJlKCJ1aS91dGlscy9tYXBwaW5nX3NldHVwIik7Cgp2YXIgX25vdGlmeSA9IHJlcXVpcmUoInVpL25vdGlmeSIpOwoKdmFyIF9zYXZlZF9vYmplY3RzID0gcmVxdWlyZSgidWkvc2F2ZWRfb2JqZWN0cyIpOwoKdmFyIF9lcnJvcnMyID0gcmVxdWlyZSgiLi4vZXJyb3JzIik7Cgp2YXIgX2ZpZWxkcyA9IHJlcXVpcmUoIi4uL2ZpZWxkcyIpOwoKdmFyIF9maWVsZHNfZmV0Y2hlciA9IHJlcXVpcmUoIi4vX2ZpZWxkc19mZXRjaGVyIik7Cgp2YXIgX3V0aWxzID0gcmVxdWlyZSgiLi4vdXRpbHMiKTsKCnZhciBfZm9ybWF0X2hpdCA9IHJlcXVpcmUoIi4vZm9ybWF0X2hpdCIpOwoKdmFyIF9mbGF0dGVuX2hpdCA9IHJlcXVpcmUoIi4vZmxhdHRlbl9oaXQiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7CiAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsKICAgIGRlZmF1bHQ6IG9iagogIH07Cn0KCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgewogIGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKICAgIHJldHVybiBvYmo7CiAgfSBlbHNlIHsKICAgIHZhciBuZXdPYmogPSB7fTsKCiAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsKCiAgICAgICAgICBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld09ialtrZXldID0gb2JqW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgbmV3T2JqLmRlZmF1bHQgPSBvYmo7CiAgICByZXR1cm4gbmV3T2JqOwogIH0KfQoKZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgewogIHRyeSB7CiAgICB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7CiAgICB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICByZWplY3QoZXJyb3IpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKGluZm8uZG9uZSkgewogICAgcmVzb2x2ZSh2YWx1ZSk7CiAgfSBlbHNlIHsKICAgIFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsKICB9Cn0KCmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOwoKICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBfdGhyb3coZXJyKSB7CiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOwogICAgICB9CgogICAgICBfbmV4dCh1bmRlZmluZWQpOwogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICB9Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgfQp9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogIHJldHVybiBDb25zdHJ1Y3RvcjsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBNQVhfQVRURU1QVFNfVE9fUkVTT0xWRV9DT05GTElDVFMgPSAzOwp2YXIgdHlwZSA9ICdpbmRleC1wYXR0ZXJuJzsKCnZhciBJbmRleFBhdHRlcm4gPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBJbmRleFBhdHRlcm4oaWQsIGdldENvbmZpZywgc2F2ZWRPYmplY3RzQ2xpZW50LCBhcGlDbGllbnQsIHBhdHRlcm5DYWNoZSkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSW5kZXhQYXR0ZXJuKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImlkIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInRpdGxlIiwgJycpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAidHlwZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJmaWVsZEZvcm1hdE1hcCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJ0eXBlTWV0YSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJmaWVsZHMiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAidGltZUZpZWxkTmFtZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJpbnRlcnZhbE5hbWUiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiZm9ybWF0SGl0Iiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImZvcm1hdEZpZWxkIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImZsYXR0ZW5IaXQiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAibWV0YUZpZWxkcyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJ2ZXJzaW9uIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInNhdmVkT2JqZWN0c0NsaWVudCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJwYXR0ZXJuQ2FjaGUiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiZ2V0Q29uZmlnIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInNvdXJjZUZpbHRlcnMiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAib3JpZ2luYWxCb2R5Iiwge30pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiZmllbGRzRmV0Y2hlciIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJzaG9ydERvdHNFbmFibGUiLCBmYWxzZSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJtYXBwaW5nIiwgKDAsIF9tYXBwaW5nX3NldHVwLmV4cGFuZFNob3J0aGFuZCkoewogICAgICB0aXRsZTogJ3RleHQnLAogICAgICB0aW1lRmllbGROYW1lOiAna2V5d29yZCcsCiAgICAgIGludGVydmFsTmFtZTogJ2tleXdvcmQnLAogICAgICBmaWVsZHM6ICdqc29uJywKICAgICAgc291cmNlRmlsdGVyczogJ2pzb24nLAogICAgICBmaWVsZEZvcm1hdE1hcDogewogICAgICAgIHR5cGU6ICd0ZXh0JywKICAgICAgICBfc2VyaWFsaXplOiBmdW5jdGlvbiBfc2VyaWFsaXplKCkgewogICAgICAgICAgdmFyIG1hcCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgogICAgICAgICAgdmFyIHNlcmlhbGl6ZWQgPSBfbG9kYXNoLmRlZmF1bHQudHJhbnNmb3JtKG1hcCwgX3RoaXMuc2VyaWFsaXplRmllbGRGb3JtYXRNYXApOwoKICAgICAgICAgIHJldHVybiBfbG9kYXNoLmRlZmF1bHQuaXNFbXB0eShzZXJpYWxpemVkKSA/IHVuZGVmaW5lZCA6IEpTT04uc3RyaW5naWZ5KHNlcmlhbGl6ZWQpOwogICAgICAgIH0sCiAgICAgICAgX2Rlc2VyaWFsaXplOiBmdW5jdGlvbiBfZGVzZXJpYWxpemUoKSB7CiAgICAgICAgICB2YXIgbWFwID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAne30nOwogICAgICAgICAgcmV0dXJuIF9sb2Rhc2guZGVmYXVsdC5tYXBWYWx1ZXMoSlNPTi5wYXJzZShtYXApLCBmdW5jdGlvbiAobWFwcGluZykgewogICAgICAgICAgICByZXR1cm4gX3RoaXMuZGVzZXJpYWxpemVGaWVsZEZvcm1hdE1hcChtYXBwaW5nKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgdHlwZTogJ2tleXdvcmQnLAogICAgICB0eXBlTWV0YTogJ2pzb24nCiAgICB9KSk7CgogICAgdGhpcy5pZCA9IGlkOwogICAgdGhpcy5zYXZlZE9iamVjdHNDbGllbnQgPSBzYXZlZE9iamVjdHNDbGllbnQ7CiAgICB0aGlzLnBhdHRlcm5DYWNoZSA9IHBhdHRlcm5DYWNoZTsgLy8gaW5zdGVhZCBvZiBzdG9yaW5nIGNvbmZpZyB3ZSByYXRoZXIgc3RvcmUgdGhlIGdldHRlciBvbmx5IGFzIG5wIHVpU2V0dGluZ3NDbGllbnQgaGFzIGNpcmN1bGFyIHJlZmVyZW5jZXMKICAgIC8vIHdoaWNoIGNhdXNlIHByb2JsZW1zIHdoZW4gYmVpbmcgY29uc3VtZWQgZnJvbSBhbmd1bGFyCgogICAgdGhpcy5nZXRDb25maWcgPSBnZXRDb25maWc7CiAgICB0aGlzLnNob3J0RG90c0VuYWJsZSA9IHRoaXMuZ2V0Q29uZmlnKCdzaG9ydERvdHM6ZW5hYmxlJyk7CiAgICB0aGlzLm1ldGFGaWVsZHMgPSB0aGlzLmdldENvbmZpZygnbWV0YUZpZWxkcycpOwogICAgdGhpcy5maWVsZHMgPSBuZXcgX2ZpZWxkcy5GaWVsZExpc3QodGhpcywgW10sIHRoaXMuc2hvcnREb3RzRW5hYmxlKTsKICAgIHRoaXMuZmllbGRzRmV0Y2hlciA9ICgwLCBfZmllbGRzX2ZldGNoZXIuY3JlYXRlRmllbGRzRmV0Y2hlcikodGhpcywgYXBpQ2xpZW50LCB0aGlzLmdldENvbmZpZygnbWV0YUZpZWxkcycpKTsKICAgIHRoaXMuZmxhdHRlbkhpdCA9ICgwLCBfZmxhdHRlbl9oaXQuZmxhdHRlbkhpdFdyYXBwZXIpKHRoaXMsIHRoaXMuZ2V0Q29uZmlnKCdtZXRhRmllbGRzJykpOwogICAgdGhpcy5mb3JtYXRIaXQgPSAoMCwgX2Zvcm1hdF9oaXQuZm9ybWF0SGl0UHJvdmlkZXIpKHRoaXMsIF9maWVsZF9mb3JtYXRzLmZpZWxkRm9ybWF0cy5nZXREZWZhdWx0SW5zdGFuY2UoJ3N0cmluZycpKTsKICAgIHRoaXMuZm9ybWF0RmllbGQgPSB0aGlzLmZvcm1hdEhpdC5mb3JtYXRGaWVsZDsKICB9CgogIF9jcmVhdGVDbGFzcyhJbmRleFBhdHRlcm4sIFt7CiAgICBrZXk6ICJzZXJpYWxpemVGaWVsZEZvcm1hdE1hcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VyaWFsaXplRmllbGRGb3JtYXRNYXAoZmxhdCwgZm9ybWF0LCBmaWVsZCkgewogICAgICBpZiAoZm9ybWF0ICYmIGZpZWxkKSB7CiAgICAgICAgZmxhdFtmaWVsZF0gPSBmb3JtYXQ7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZXNlcmlhbGl6ZUZpZWxkRm9ybWF0TWFwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXNlcmlhbGl6ZUZpZWxkRm9ybWF0TWFwKG1hcHBpbmcpIHsKICAgICAgdmFyIEZpZWxkRm9ybWF0ID0gX2ZpZWxkX2Zvcm1hdHMuZmllbGRGb3JtYXRzLmJ5SWRbbWFwcGluZy5pZF07CiAgICAgIHJldHVybiBGaWVsZEZvcm1hdCAmJiBuZXcgRmllbGRGb3JtYXQobWFwcGluZy5wYXJhbXMsIHRoaXMuZ2V0Q29uZmlnKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpbml0RmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0RmllbGRzKGlucHV0KSB7CiAgICAgIHZhciBuZXdWYWx1ZSA9IGlucHV0IHx8IHRoaXMuZmllbGRzOwogICAgICB0aGlzLmZpZWxkcyA9IG5ldyBfZmllbGRzLkZpZWxkTGlzdCh0aGlzLCBuZXdWYWx1ZSwgdGhpcy5zaG9ydERvdHNFbmFibGUpOwogICAgfQogIH0sIHsKICAgIGtleTogImlzRmllbGRSZWZyZXNoUmVxdWlyZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzRmllbGRSZWZyZXNoUmVxdWlyZWQoKSB7CiAgICAgIGlmICghdGhpcy5maWVsZHMpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuZmllbGRzLmV2ZXJ5KGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZWxhc3RpYy9raWJhbmEvcHVsbC84NDIxCiAgICAgICAgdmFyIGhhc0ZpZWxkQ2FwcyA9ICdhZ2dyZWdhdGFibGUnIGluIGZpZWxkICYmICdzZWFyY2hhYmxlJyBpbiBmaWVsZDsgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGFzdGljL2tpYmFuYS9wdWxsLzExOTY5CgogICAgICAgIHZhciBoYXNEb2NWYWx1ZXNGbGFnID0gJ3JlYWRGcm9tRG9jVmFsdWVzJyBpbiBmaWVsZDsKICAgICAgICByZXR1cm4gIWhhc0ZpZWxkQ2FwcyB8fCAhaGFzRG9jVmFsdWVzRmxhZzsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaW5kZXhGaWVsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9pbmRleEZpZWxkcyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIGZvcmNlRmllbGRSZWZyZXNoLAogICAgICAgICAgICBfYXJncyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBmb3JjZUZpZWxkUmVmcmVzaCA9IF9hcmdzLmxlbmd0aCA+IDAgJiYgX2FyZ3NbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzWzBdIDogZmFsc2U7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuaWQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBpZiAoIShmb3JjZUZpZWxkUmVmcmVzaCB8fCB0aGlzLmlzRmllbGRSZWZyZXNoUmVxdWlyZWQoKSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVmcmVzaEZpZWxkcygpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICB0aGlzLmluaXRGaWVsZHMoKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGluZGV4RmllbGRzKCkgewogICAgICAgIHJldHVybiBfaW5kZXhGaWVsZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGluZGV4RmllbGRzOwogICAgfSgpCiAgfSwgewogICAga2V5OiAidXBkYXRlRnJvbUVsYXN0aWNTZWFyY2giLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF91cGRhdGVGcm9tRWxhc3RpY1NlYXJjaCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKHJlc3BvbnNlKSB7CiAgICAgICAgdmFyIGZvcmNlRmllbGRSZWZyZXNoLAogICAgICAgICAgICB3YXJuaW5nVGl0bGUsCiAgICAgICAgICAgIHdhcm5pbmdUZXh0LAogICAgICAgICAgICAkaW5qZWN0b3IsCiAgICAgICAgICAgIGtiblVybCwKICAgICAgICAgICAgX2FyZ3MyID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBmb3JjZUZpZWxkUmVmcmVzaCA9IF9hcmdzMi5sZW5ndGggPiAxICYmIF9hcmdzMlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyWzFdIDogZmFsc2U7CgogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmZvdW5kKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF9lcnJvcnMuU2F2ZWRPYmplY3ROb3RGb3VuZCh0eXBlLCB0aGlzLmlkLCAnIy9tYW5hZ2VtZW50L2tpYmFuYS9pbmRleF9wYXR0ZXJuJyk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF9sb2Rhc2guZGVmYXVsdC5mb3JPd24odGhpcy5tYXBwaW5nLCBmdW5jdGlvbiAoZmllbGRNYXBwaW5nLCBuYW1lKSB7CiAgICAgICAgICAgICAgICAgIGlmICghZmllbGRNYXBwaW5nLl9kZXNlcmlhbGl6ZSB8fCAhbmFtZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuX3NvdXJjZVtuYW1lXSA9IGZpZWxkTWFwcGluZy5fZGVzZXJpYWxpemUocmVzcG9uc2UuX3NvdXJjZVtuYW1lXSk7CiAgICAgICAgICAgICAgICB9KTsgLy8gZ2l2ZSBpbmRleCBwYXR0ZXJuIGFsbCBvZiB0aGUgdmFsdWVzIGluIF9zb3VyY2UKCgogICAgICAgICAgICAgICAgX2xvZGFzaC5kZWZhdWx0LmFzc2lnbih0aGlzLCByZXNwb25zZS5fc291cmNlKTsKCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMudGl0bGUgJiYgdGhpcy5pZCkgewogICAgICAgICAgICAgICAgICB0aGlzLnRpdGxlID0gdGhpcy5pZDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNVbnN1cHBvcnRlZFRpbWVQYXR0ZXJuKCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgd2FybmluZ1RpdGxlID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2RhdGEuaW5kZXhQYXR0ZXJucy53YXJuaW5nVGl0bGUnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU3VwcG9ydCBmb3IgdGltZSBpbnRlcnZhbCBpbmRleCBwYXR0ZXJucyByZW1vdmVkJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB3YXJuaW5nVGV4dCA9IF9pMThuLmkxOG4udHJhbnNsYXRlKCdkYXRhLmluZGV4UGF0dGVybnMud2FybmluZ1RleHQnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQ3VycmVudGx5IHF1ZXJ5aW5nIGFsbCBpbmRpY2VzIG1hdGNoaW5nIHtpbmRleH0uIHt0aXRsZX0gc2hvdWxkIGJlIG1pZ3JhdGVkIHRvIGEgd2lsZGNhcmQtYmFzZWQgaW5kZXggcGF0dGVybi4nLAogICAgICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy50aXRsZSwKICAgICAgICAgICAgICAgICAgICBpbmRleDogdGhpcy5nZXRJbmRleCgpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOyAvLyBrYm5Vcmwgd2FzIGFkZGVkIHRvIHRoaXMgc2VydmljZSBpbiAjMzUyNjIgYmVmb3JlIGl0IHdhcyBkZS1hbmd1bGFyaXplZCwgYW5kIG1lcmdlZCBpbiBhIFBSCiAgICAgICAgICAgICAgICAvLyBkaXJlY3RseSBhZ2FpbnN0IHRoZSA3LnggYnJhbmNoLiBJbmRleCBwYXR0ZXJucyB3ZXJlIGRlLWFuZ3VsYXJpemVkIGluICMzOTI0NywgYW5kIGluIG9yZGVyCiAgICAgICAgICAgICAgICAvLyB0byBwcmVzZXJ2ZSB0aGUgZnVuY3Rpb25hbGl0eSBmcm9tICMzNTI2MiB3ZSBuZWVkIHRvIGdldCB0aGUgaW5qZWN0b3IgaGVyZSBqdXN0IGZvciBrYm5VcmwuCiAgICAgICAgICAgICAgICAvLyBUaGlzIGhhcyBhbGwgYmVlbiByZW1vdmVkIGFzIG9mIDguMC4KCiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDExOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jaHJvbWUuZGVmYXVsdC5kYW5nZXJvdXNseUdldEFjdGl2ZUluamVjdG9yKCk7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAkaW5qZWN0b3IgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIGtiblVybCA9ICRpbmplY3Rvci5nZXQoJ2tiblVybCcpOyAvLyBgYW55YCBiZWNhdXNlIEtiblVybCBpbnRlcmZhY2UgZG9lc24ndCBoYXZlIGBnZXRSb3V0ZUhyZWZgCgogICAgICAgICAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkV2FybmluZyh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiB3YXJuaW5nVGl0bGUsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsIHdhcm5pbmdUZXh0KSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICAgICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogImZsZXhFbmQiLAogICAgICAgICAgICAgICAgICAgIGd1dHRlclNpemU6ICJzIgogICAgICAgICAgICAgICAgICB9LCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgICAgICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICAgICAgICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b24sIHsKICAgICAgICAgICAgICAgICAgICBzaXplOiAicyIsCiAgICAgICAgICAgICAgICAgICAgaHJlZjoga2JuVXJsLmdldFJvdXRlSHJlZih0aGlzLCAnZWRpdCcpCiAgICAgICAgICAgICAgICAgIH0sIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgICAgICAgICAgaWQ6ICJkYXRhLmluZGV4UGF0dGVybnMuZWRpdEluZGV4UGF0dGVybiIsCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJFZGl0IGluZGV4IHBhdHRlcm4iCiAgICAgICAgICAgICAgICAgIH0pKSkpKQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgdGhpcy5pbmRleEZpZWxkcyhmb3JjZUZpZWxkUmVmcmVzaCkpOwoKICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gdXBkYXRlRnJvbUVsYXN0aWNTZWFyY2goX3gpIHsKICAgICAgICByZXR1cm4gX3VwZGF0ZUZyb21FbGFzdGljU2VhcmNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB1cGRhdGVGcm9tRWxhc3RpY1NlYXJjaDsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImdldENvbXB1dGVkRmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb21wdXRlZEZpZWxkcygpIHsKICAgICAgdmFyIHNjcmlwdEZpZWxkcyA9IHt9OwoKICAgICAgaWYgKCF0aGlzLmZpZWxkcykgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBzdG9yZWRGaWVsZHM6IFsnKiddLAogICAgICAgICAgc2NyaXB0RmllbGRzOiBzY3JpcHRGaWVsZHMsCiAgICAgICAgICBkb2N2YWx1ZUZpZWxkczogW10KICAgICAgICB9OwogICAgICB9IC8vIERhdGUgdmFsdWUgcmV0dXJuZWQgaW4gIl9zb3VyY2UiIGNvdWxkIGJlIGluIGFueSBudW1iZXIgb2YgZm9ybWF0cwogICAgICAvLyBVc2UgYSBkb2N2YWx1ZSBmb3IgZWFjaCBkYXRlIGZpZWxkIHRvIGVuc3VyZSBzdGFuZGFyZGl6ZWQgZm9ybWF0cyB3aGVuIHdvcmtpbmcgd2l0aCBkYXRlIGZpZWxkcwogICAgICAvLyBpbmRleFBhdHRlcm4uZmxhdHRlbkhpdCB3aWxsIG92ZXJyaWRlICJfc291cmNlIiB2YWx1ZXMgd2hlbiB0aGUgc2FtZSBmaWVsZCBpcyBhbHNvIGRlZmluZWQgaW4gImZpZWxkcyIKCgogICAgICB2YXIgZG9jdmFsdWVGaWVsZHMgPSAoMCwgX2xvZGFzaC5yZWplY3QpKHRoaXMuZmllbGRzLmJ5VHlwZS5kYXRlLCAnc2NyaXB0ZWQnKS5tYXAoZnVuY3Rpb24gKGRhdGVGaWVsZCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBmaWVsZDogZGF0ZUZpZWxkLm5hbWUsCiAgICAgICAgICBmb3JtYXQ6IGRhdGVGaWVsZC5lc1R5cGVzICYmIGRhdGVGaWVsZC5lc1R5cGVzLmluZGV4T2YoJ2RhdGVfbmFub3MnKSAhPT0gLTEgPyAnc3RyaWN0X2RhdGVfdGltZScgOiAnZGF0ZV90aW1lJwogICAgICAgIH07CiAgICAgIH0pOwogICAgICAoMCwgX2xvZGFzaC5lYWNoKSh0aGlzLmdldFNjcmlwdGVkRmllbGRzKCksIGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgIHNjcmlwdEZpZWxkc1tmaWVsZC5uYW1lXSA9IHsKICAgICAgICAgIHNjcmlwdDogewogICAgICAgICAgICBzb3VyY2U6IGZpZWxkLnNjcmlwdCwKICAgICAgICAgICAgbGFuZzogZmllbGQubGFuZwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0pOwogICAgICByZXR1cm4gewogICAgICAgIHN0b3JlZEZpZWxkczogWycqJ10sCiAgICAgICAgc2NyaXB0RmllbGRzOiBzY3JpcHRGaWVsZHMsCiAgICAgICAgZG9jdmFsdWVGaWVsZHM6IGRvY3ZhbHVlRmllbGRzCiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAiaW5pdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2luaXQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICB2YXIgZm9yY2VGaWVsZFJlZnJlc2gsCiAgICAgICAgICAgIHNhdmVkT2JqZWN0LAogICAgICAgICAgICByZXNwb25zZSwKICAgICAgICAgICAgX2FyZ3MzID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBmb3JjZUZpZWxkUmVmcmVzaCA9IF9hcmdzMy5sZW5ndGggPiAwICYmIF9hcmdzM1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MzWzBdIDogZmFsc2U7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuaWQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgdGhpcyk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNhdmVkT2JqZWN0c0NsaWVudC5nZXQodHlwZSwgdGhpcy5pZCk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHNhdmVkT2JqZWN0ID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICB0aGlzLnZlcnNpb24gPSBzYXZlZE9iamVjdC5fdmVyc2lvbjsKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gewogICAgICAgICAgICAgICAgICBfaWQ6IHNhdmVkT2JqZWN0LmlkLAogICAgICAgICAgICAgICAgICBfdHlwZTogc2F2ZWRPYmplY3QudHlwZSwKICAgICAgICAgICAgICAgICAgX3NvdXJjZTogX2xvZGFzaC5kZWZhdWx0LmNsb25lRGVlcChzYXZlZE9iamVjdC5hdHRyaWJ1dGVzKSwKICAgICAgICAgICAgICAgICAgZm91bmQ6IHNhdmVkT2JqZWN0Ll92ZXJzaW9uID8gdHJ1ZSA6IGZhbHNlCiAgICAgICAgICAgICAgICB9OyAvLyBEbyB0aGlzIGJlZm9yZSB3ZSBhdHRlbXB0IHRvIHVwZGF0ZSBmcm9tIEVTIHNpbmNlIHRoYXQgY2FsbCBjYW4gcG90ZW50aWFsbHkgcGVyZm9ybSBhIHNhdmUKCiAgICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsQm9keSA9IHRoaXMucHJlcEJvZHkoKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy51cGRhdGVGcm9tRWxhc3RpY1NlYXJjaChyZXNwb25zZSwgZm9yY2VGaWVsZFJlZnJlc2gpOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgLy8gRG8gaXQgYWZ0ZXIgdG8gZW5zdXJlIHdlIGhhdmUgdGhlIG1vc3QgdXAgdG8gZGF0ZSBpbmZvcm1hdGlvbgogICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbEJvZHkgPSB0aGlzLnByZXBCb2R5KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgdGhpcyk7CgogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHJldHVybiBfaW5pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gaW5pdDsKICAgIH0oKQogIH0sIHsKICAgIGtleTogIm1pZ3JhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG1pZ3JhdGUobmV3VGl0bGUpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICByZXR1cm4gdGhpcy5zYXZlZE9iamVjdHNDbGllbnQudXBkYXRlKHR5cGUsIHRoaXMuaWQsIHsKICAgICAgICB0aXRsZTogbmV3VGl0bGUsCiAgICAgICAgaW50ZXJ2YWxOYW1lOiBudWxsCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICB2YXIgX3JlZiRhdHRyaWJ1dGVzID0gX3JlZi5hdHRyaWJ1dGVzLAogICAgICAgICAgICB0aXRsZSA9IF9yZWYkYXR0cmlidXRlcy50aXRsZSwKICAgICAgICAgICAgaW50ZXJ2YWxOYW1lID0gX3JlZiRhdHRyaWJ1dGVzLmludGVydmFsTmFtZTsKICAgICAgICBfdGhpczIudGl0bGUgPSB0aXRsZTsKICAgICAgICBfdGhpczIuaW50ZXJ2YWxOYW1lID0gaW50ZXJ2YWxOYW1lOwogICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX3RoaXMyOwogICAgICB9KTsKICAgIH0gLy8gR2V0IHRoZSBzb3VyY2UgZmlsdGVyaW5nIGNvbmZpZ3VyYXRpb24gZm9yIHRoYXQgaW5kZXguCgogIH0sIHsKICAgIGtleTogImdldFNvdXJjZUZpbHRlcmluZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U291cmNlRmlsdGVyaW5nKCkgewogICAgICByZXR1cm4gewogICAgICAgIGV4Y2x1ZGVzOiB0aGlzLnNvdXJjZUZpbHRlcnMgJiYgdGhpcy5zb3VyY2VGaWx0ZXJzLm1hcChmdW5jdGlvbiAoZmlsdGVyKSB7CiAgICAgICAgICByZXR1cm4gZmlsdGVyLnZhbHVlOwogICAgICAgIH0pIHx8IFtdCiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAiYWRkU2NyaXB0ZWRGaWVsZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2FkZFNjcmlwdGVkRmllbGQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNChuYW1lLCBzY3JpcHQpIHsKICAgICAgICB2YXIgZmllbGRUeXBlLAogICAgICAgICAgICBsYW5nLAogICAgICAgICAgICBzY3JpcHRlZEZpZWxkcywKICAgICAgICAgICAgbmFtZXMsCiAgICAgICAgICAgIF9hcmdzNCA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZmllbGRUeXBlID0gX2FyZ3M0Lmxlbmd0aCA+IDIgJiYgX2FyZ3M0WzJdICE9PSB1bmRlZmluZWQgPyBfYXJnczRbMl0gOiAnc3RyaW5nJzsKICAgICAgICAgICAgICAgIGxhbmcgPSBfYXJnczQubGVuZ3RoID4gMyA/IF9hcmdzNFszXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHNjcmlwdGVkRmllbGRzID0gdGhpcy5nZXRTY3JpcHRlZEZpZWxkcygpOwogICAgICAgICAgICAgICAgbmFtZXMgPSBfbG9kYXNoLmRlZmF1bHQucGx1Y2soc2NyaXB0ZWRGaWVsZHMsICduYW1lJyk7CgogICAgICAgICAgICAgICAgaWYgKCFfbG9kYXNoLmRlZmF1bHQuY29udGFpbnMobmFtZXMsIG5hbWUpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF9lcnJvcnMuRHVwbGljYXRlRmllbGQobmFtZSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHRoaXMuZmllbGRzLnB1c2gobmV3IF9maWVsZHMuRmllbGQodGhpcywgewogICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICAgICAgICBzY3JpcHQ6IHNjcmlwdCwKICAgICAgICAgICAgICAgICAgZmllbGRUeXBlOiBmaWVsZFR5cGUsCiAgICAgICAgICAgICAgICAgIHNjcmlwdGVkOiB0cnVlLAogICAgICAgICAgICAgICAgICBsYW5nOiBsYW5nLAogICAgICAgICAgICAgICAgICBhZ2dyZWdhdGFibGU6IHRydWUsCiAgICAgICAgICAgICAgICAgIGZpbHRlcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICAgIHNlYXJjaGFibGU6IHRydWUKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNhdmUoKTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gYWRkU2NyaXB0ZWRGaWVsZChfeDIsIF94MykgewogICAgICAgIHJldHVybiBfYWRkU2NyaXB0ZWRGaWVsZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gYWRkU2NyaXB0ZWRGaWVsZDsKICAgIH0oKQogIH0sIHsKICAgIGtleTogInJlbW92ZVNjcmlwdGVkRmllbGQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZVNjcmlwdGVkRmllbGQobmFtZSkgewogICAgICB2YXIgZmllbGRJbmRleCA9IF9sb2Rhc2guZGVmYXVsdC5maW5kSW5kZXgodGhpcy5maWVsZHMsIHsKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIHNjcmlwdGVkOiB0cnVlCiAgICAgIH0pOwoKICAgICAgaWYgKGZpZWxkSW5kZXggPiAtMSkgewogICAgICAgIHRoaXMuZmllbGRzLnNwbGljZShmaWVsZEluZGV4LCAxKTsKICAgICAgICBkZWxldGUgdGhpcy5maWVsZEZvcm1hdE1hcFtuYW1lXTsKICAgICAgICByZXR1cm4gdGhpcy5zYXZlKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJwb3B1bGFyaXplRmllbGQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wb3B1bGFyaXplRmllbGQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNShmaWVsZE5hbWUpIHsKICAgICAgICB2YXIgdW5pdCwKICAgICAgICAgICAgZmllbGQsCiAgICAgICAgICAgIGNvdW50LAogICAgICAgICAgICBfYXJnczUgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHVuaXQgPSBfYXJnczUubGVuZ3RoID4gMSAmJiBfYXJnczVbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNVsxXSA6IDE7CiAgICAgICAgICAgICAgICBmaWVsZCA9IHRoaXMuZmllbGRzLmJ5TmFtZVtmaWVsZE5hbWVdOwoKICAgICAgICAgICAgICAgIGlmIChmaWVsZCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgY291bnQgPSBNYXRoLm1heCgoZmllbGQuY291bnQgfHwgMCkgKyB1bml0LCAwKTsKCiAgICAgICAgICAgICAgICBpZiAoIShmaWVsZC5jb3VudCA9PT0gY291bnQpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBmaWVsZC5jb3VudCA9IGNvdW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNhdmUoKTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHBvcHVsYXJpemVGaWVsZChfeDQpIHsKICAgICAgICByZXR1cm4gX3BvcHVsYXJpemVGaWVsZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcG9wdWxhcml6ZUZpZWxkOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiZ2V0Tm9uU2NyaXB0ZWRGaWVsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldE5vblNjcmlwdGVkRmllbGRzKCkgewogICAgICByZXR1cm4gX2xvZGFzaC5kZWZhdWx0LndoZXJlKHRoaXMuZmllbGRzLCB7CiAgICAgICAgc2NyaXB0ZWQ6IGZhbHNlCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFNjcmlwdGVkRmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTY3JpcHRlZEZpZWxkcygpIHsKICAgICAgcmV0dXJuIF9sb2Rhc2guZGVmYXVsdC53aGVyZSh0aGlzLmZpZWxkcywgewogICAgICAgIHNjcmlwdGVkOiB0cnVlCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEluZGV4IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJbmRleCgpIHsKICAgICAgaWYgKCF0aGlzLmlzVW5zdXBwb3J0ZWRUaW1lUGF0dGVybigpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudGl0bGU7CiAgICAgIH0gLy8gVGFrZSBhIHRpbWUtYmFzZWQgaW50ZXJ2YWwgaW5kZXggcGF0dGVybiB0aXRsZSAobGlrZSBbZm9vLV1ZWVlZLk1NLkREWy1iYXJdKSBhbmQgdHVybiBpdAogICAgICAvLyBpbnRvIHRoZSBhY3R1YWwgaW5kZXggKGxpa2UgZm9vLSotYmFyKSBieSByZXBsYWNpbmcgYW55dGhpbmcgbm90IGluc2lkZSBzcXVhcmUgYnJhY2tldHMKICAgICAgLy8gd2l0aCBhICouCgoKICAgICAgdmFyIHJlZ2V4ID0gL1xbW15cXV0qXS9nOyAvLyBNYXRjaGVzIHRleHQgaW5zaWRlIGJyYWNrZXRzCgogICAgICB2YXIgc3BsaXRzID0gdGhpcy50aXRsZS5zcGxpdChyZWdleCk7IC8vIGUuZy4gWycnLCAnWVlZWS5NTS5ERCcsICcnXSBmcm9tIHRoZSBhYm92ZSBleGFtcGxlCgogICAgICB2YXIgbWF0Y2hlcyA9IHRoaXMudGl0bGUubWF0Y2gocmVnZXgpIHx8IFtdOyAvLyBlLmcuIFsnW2Zvby1dJywgJ1stYmFyXSddIGZyb20gdGhlIGFib3ZlIGV4YW1wbGUKCiAgICAgIHJldHVybiBzcGxpdHMubWFwKGZ1bmN0aW9uIChzcGxpdCwgaSkgewogICAgICAgIHZhciBtYXRjaCA9IGkgPj0gbWF0Y2hlcy5sZW5ndGggPyAnJyA6IG1hdGNoZXNbaV0ucmVwbGFjZSgvW1xbXF1dL2csICcnKTsKICAgICAgICByZXR1cm4gIiIuY29uY2F0KHNwbGl0Lmxlbmd0aCA/ICcqJyA6ICcnKS5jb25jYXQobWF0Y2gpOwogICAgICB9KS5qb2luKCcnKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc1Vuc3VwcG9ydGVkVGltZVBhdHRlcm4iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzVW5zdXBwb3J0ZWRUaW1lUGF0dGVybigpIHsKICAgICAgcmV0dXJuICEhdGhpcy5pbnRlcnZhbE5hbWU7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNUaW1lQmFzZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzVGltZUJhc2VkKCkgewogICAgICByZXR1cm4gISF0aGlzLnRpbWVGaWVsZE5hbWUgJiYgKCF0aGlzLmZpZWxkcyB8fCAhIXRoaXMuZ2V0VGltZUZpZWxkKCkpOwogICAgfQogIH0sIHsKICAgIGtleTogImlzVGltZU5hbm9zQmFzZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzVGltZU5hbm9zQmFzZWQoKSB7CiAgICAgIHZhciB0aW1lRmllbGQgPSB0aGlzLmdldFRpbWVGaWVsZCgpOwogICAgICByZXR1cm4gdGltZUZpZWxkICYmIHRpbWVGaWVsZC5lc1R5cGVzICYmIHRpbWVGaWVsZC5lc1R5cGVzLmluZGV4T2YoJ2RhdGVfbmFub3MnKSAhPT0gLTE7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNUaW1lQmFzZWRXaWxkY2FyZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNUaW1lQmFzZWRXaWxkY2FyZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNUaW1lQmFzZWQoKSAmJiB0aGlzLmlzV2lsZGNhcmQoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRUaW1lRmllbGQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFRpbWVGaWVsZCgpIHsKICAgICAgaWYgKCF0aGlzLnRpbWVGaWVsZE5hbWUgfHwgIXRoaXMuZmllbGRzIHx8ICF0aGlzLmZpZWxkcy5ieU5hbWUpIHJldHVybjsKICAgICAgcmV0dXJuIHRoaXMuZmllbGRzLmJ5TmFtZVt0aGlzLnRpbWVGaWVsZE5hbWVdOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEZpZWxkQnlOYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGaWVsZEJ5TmFtZShuYW1lKSB7CiAgICAgIGlmICghdGhpcy5maWVsZHMgfHwgIXRoaXMuZmllbGRzLmJ5TmFtZSkgcmV0dXJuOwogICAgICByZXR1cm4gdGhpcy5maWVsZHMuYnlOYW1lW25hbWVdOwogICAgfQogIH0sIHsKICAgIGtleTogImlzV2lsZGNhcmQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzV2lsZGNhcmQoKSB7CiAgICAgIHJldHVybiBfbG9kYXNoLmRlZmF1bHQuaW5jbHVkZXModGhpcy50aXRsZSwgJyonKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJwcmVwQm9keSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJlcEJvZHkoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdmFyIGJvZHkgPSB7fTsgLy8gc2VyaWFsaXplIGpzb24gZmllbGRzCgogICAgICBfbG9kYXNoLmRlZmF1bHQuZm9yT3duKHRoaXMubWFwcGluZywgZnVuY3Rpb24gKGZpZWxkTWFwcGluZywgZmllbGROYW1lKSB7CiAgICAgICAgaWYgKCFmaWVsZE5hbWUgfHwgX3RoaXMzW2ZpZWxkTmFtZV0gPT0gbnVsbCkgcmV0dXJuOwogICAgICAgIGJvZHlbZmllbGROYW1lXSA9IGZpZWxkTWFwcGluZy5fc2VyaWFsaXplID8gZmllbGRNYXBwaW5nLl9zZXJpYWxpemUoX3RoaXMzW2ZpZWxkTmFtZV0pIDogX3RoaXMzW2ZpZWxkTmFtZV07CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIGJvZHk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY3JlYXRlMiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KCkgewogICAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgICB2YXIgYWxsb3dPdmVycmlkZSwKICAgICAgICAgICAgX2NyZWF0ZSwKICAgICAgICAgICAgcG90ZW50aWFsRHVwbGljYXRlQnlUaXRsZSwKICAgICAgICAgICAgX2FyZ3M3ID0gYXJndW1lbnRzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0NykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWxsb3dPdmVycmlkZSA9IF9hcmdzNy5sZW5ndGggPiAwICYmIF9hcmdzN1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M3WzBdIDogZmFsc2U7CgogICAgICAgICAgICAgICAgX2NyZWF0ZSA9CiAgICAgICAgICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfcmVmMiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAgICAgICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KGR1cGxpY2F0ZUlkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGR1cGxpY2F0ZVBhdHRlcm4sIGJvZHksIHJlc3BvbnNlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWR1cGxpY2F0ZUlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVwbGljYXRlUGF0dGVybiA9IG5ldyBJbmRleFBhdHRlcm4oZHVwbGljYXRlSWQsIF90aGlzNC5nZXRDb25maWcsIF90aGlzNC5zYXZlZE9iamVjdHNDbGllbnQsIF90aGlzNC5wYXR0ZXJuQ2FjaGUsIF90aGlzNC5maWVsZHNGZXRjaGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkdXBsaWNhdGVQYXR0ZXJuLmRlc3Ryb3koKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keSA9IF90aGlzNC5wcmVwQm9keSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNC5zYXZlZE9iamVjdHNDbGllbnQuY3JlYXRlKHR5cGUsIGJvZHksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IF90aGlzNC5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczQuaWQgPSByZXNwb25zZS5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCByZXNwb25zZS5pZCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTYpOwogICAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZShfeDUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0oKTsKCiAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF9zYXZlZF9vYmplY3RzLmZpbmRPYmplY3RCeVRpdGxlKSh0aGlzLnNhdmVkT2JqZWN0c0NsaWVudCwgdHlwZSwgdGhpcy50aXRsZSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIHBvdGVudGlhbER1cGxpY2F0ZUJ5VGl0bGUgPSBfY29udGV4dDcuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAocG90ZW50aWFsRHVwbGljYXRlQnlUaXRsZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gODsKICAgICAgICAgICAgICAgIHJldHVybiBfY3JlYXRlKCk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDcuc2VudCk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIGlmIChhbGxvd092ZXJyaWRlKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCBmYWxzZSk7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jcmVhdGUocG90ZW50aWFsRHVwbGljYXRlQnlUaXRsZS5pZCk7CgogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQ3LnNlbnQpOwoKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU3LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gY3JlYXRlKCkgewogICAgICAgIHJldHVybiBfY3JlYXRlMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gY3JlYXRlOwogICAgfSgpCiAgfSwgewogICAga2V5OiAic2F2ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3NhdmUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOCgpIHsKICAgICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgICAgdmFyIHNhdmVBdHRlbXB0cywKICAgICAgICAgICAgYm9keSwKICAgICAgICAgICAgb3JpZ2luYWxDaGFuZ2VkS2V5cywKICAgICAgICAgICAgX2FyZ3M4ID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQ4KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBzYXZlQXR0ZW1wdHMgPSBfYXJnczgubGVuZ3RoID4gMCAmJiBfYXJnczhbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzOFswXSA6IDA7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuaWQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGJvZHkgPSB0aGlzLnByZXBCb2R5KCk7IC8vIFdoYXQga2V5cyBjaGFuZ2VkIHNpbmNlIHRoZXkgbGFzdCBwdWxsZWQgdGhlIGluZGV4IHBhdHRlcm4KCiAgICAgICAgICAgICAgICBvcmlnaW5hbENoYW5nZWRLZXlzID0gT2JqZWN0LmtleXMoYm9keSkuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGJvZHlba2V5XSAhPT0gX3RoaXM1Lm9yaWdpbmFsQm9keVtrZXldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIiwgdGhpcy5zYXZlZE9iamVjdHNDbGllbnQudXBkYXRlKHR5cGUsIHRoaXMuaWQsIGJvZHksIHsKICAgICAgICAgICAgICAgICAgdmVyc2lvbjogdGhpcy52ZXJzaW9uCiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNS5pZCA9IHJlc3AuaWQ7CiAgICAgICAgICAgICAgICAgIF90aGlzNS52ZXJzaW9uID0gcmVzcC5fdmVyc2lvbjsKICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgICAgICAgaWYgKF9sb2Rhc2guZGVmYXVsdC5nZXQoZXJyLCAncmVzLnN0YXR1cycpID09PSA0MDkgJiYgc2F2ZUF0dGVtcHRzKysgPCBNQVhfQVRURU1QVFNfVE9fUkVTT0xWRV9DT05GTElDVFMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc2FtZVBhdHRlcm4gPSBuZXcgSW5kZXhQYXR0ZXJuKF90aGlzNS5pZCwgX3RoaXM1LmdldENvbmZpZywgX3RoaXM1LnNhdmVkT2JqZWN0c0NsaWVudCwgX3RoaXM1LnBhdHRlcm5DYWNoZSwgX3RoaXM1LmZpZWxkc0ZldGNoZXIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBzYW1lUGF0dGVybi5pbml0KCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyBXaGF0IGtleXMgY2hhbmdlZCBmcm9tIG5vdyBhbmQgd2hhdCB0aGUgc2VydmVyIHJldHVybmVkCiAgICAgICAgICAgICAgICAgICAgICB2YXIgdXBkYXRlZEJvZHkgPSBzYW1lUGF0dGVybi5wcmVwQm9keSgpOyAvLyBCdWlsZCBhIGxpc3Qgb2YgY2hhbmdlZCBrZXlzIGZyb20gdGhlIHNlcnZlciByZXNwb25zZQogICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIGVuc3VyZSB3ZSBpZ25vcmUgdGhlIGtleSBpZiB0aGUgc2VydmVyIHJlc3BvbnNlCiAgICAgICAgICAgICAgICAgICAgICAvLyBpcyB0aGUgc2FtZSBhcyB0aGUgb3JpZ2luYWwgcmVzcG9uc2UgKHNpbmNlIHRoYXQgaXMgZXhwZWN0ZWQKICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHdlIG1hZGUgYSBjaGFuZ2UgaW4gdGhhdCBrZXkpCgogICAgICAgICAgICAgICAgICAgICAgdmFyIHNlcnZlckNoYW5nZWRLZXlzID0gT2JqZWN0LmtleXModXBkYXRlZEJvZHkpLmZpbHRlcihmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGVkQm9keVtrZXldICE9PSBib2R5W2tleV0gJiYgX3RoaXM1Lm9yaWdpbmFsQm9keVtrZXldICE9PSB1cGRhdGVkQm9keVtrZXldOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgdW5yZXNvbHZlZENvbGxpc2lvbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gb3JpZ2luYWxDaGFuZ2VkS2V5c1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSAoX3N0ZXAgPSBfaXRlcmF0b3IubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3JpZ2luYWxLZXkgPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvcjIgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IyID0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yMiA9IHNlcnZlckNoYW5nZWRLZXlzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXAyOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gKF9zdGVwMiA9IF9pdGVyYXRvcjIubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZXJ2ZXJLZXkgPSBfc3RlcDIudmFsdWU7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3JpZ2luYWxLZXkgPT09IHNlcnZlcktleSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVucmVzb2x2ZWRDb2xsaXNpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IyID0gZXJyOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yICYmIF9pdGVyYXRvcjIucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3IyLnJldHVybigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IGVycjsKICAgICAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvci5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yLnJldHVybigpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGlmICh1bnJlc29sdmVkQ29sbGlzaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2RhdGEuaW5kZXhQYXR0ZXJucy51bmFibGVXcml0ZUxhYmVsJywgewogICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVW5hYmxlIHRvIHdyaXRlIGluZGV4IHBhdHRlcm4hIFJlZnJlc2ggdGhlIHBhZ2UgdG8gZ2V0IHRoZSBtb3N0IHVwIHRvIGRhdGUgY2hhbmdlcyBmb3IgdGhpcyBpbmRleCBwYXR0ZXJuLicgLy8gZXNsaW50LWRpc2FibGUtbGluZSBtYXgtbGVuCgogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZERhbmdlcihtZXNzYWdlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgICAgICAgICAgIH0gLy8gU2V0IHRoZSB1cGRhdGVkIHJlc3BvbnNlIG9uIHRoaXMgb2JqZWN0CgoKICAgICAgICAgICAgICAgICAgICAgIHNlcnZlckNoYW5nZWRLZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczVba2V5XSA9IHNhbWVQYXR0ZXJuW2tleV07CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIF90aGlzNS52ZXJzaW9uID0gc2FtZVBhdHRlcm4udmVyc2lvbjsgLy8gQ2xlYXIgY2FjaGUKCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczUucGF0dGVybkNhY2hlLmNsZWFyKF90aGlzNS5pZCk7IC8vIFRyeSB0aGUgc2F2ZSBhZ2FpbgoKCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM1LnNhdmUoc2F2ZUF0dGVtcHRzKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTgsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBzYXZlKCkgewogICAgICAgIHJldHVybiBfc2F2ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gc2F2ZTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogIl9mZXRjaEZpZWxkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2ZldGNoRmllbGRzMiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KCkgewogICAgICAgIHZhciBmaWVsZHMsIHNjcmlwdGVkLCBhbGw7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpZWxkc0ZldGNoZXIuZmV0Y2godGhpcyk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGZpZWxkcyA9IF9jb250ZXh0OS5zZW50OwogICAgICAgICAgICAgICAgc2NyaXB0ZWQgPSB0aGlzLmdldFNjcmlwdGVkRmllbGRzKCk7CiAgICAgICAgICAgICAgICBhbGwgPSBmaWVsZHMuY29uY2F0KHNjcmlwdGVkKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmluaXRGaWVsZHMoYWxsKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU5LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gX2ZldGNoRmllbGRzKCkgewogICAgICAgIHJldHVybiBfZmV0Y2hGaWVsZHMyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBfZmV0Y2hGaWVsZHM7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJyZWZyZXNoRmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWZyZXNoRmllbGRzKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHJldHVybiB0aGlzLl9mZXRjaEZpZWxkcygpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczYuc2F2ZSgpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2VsYXN0aWMva2liYW5hL2lzc3Vlcy85MjI0CiAgICAgICAgLy8gVGhpcyBjYWxsIHdpbGwgYXR0ZW1wdCB0byByZW1hcCBmaWVsZHMgZnJvbSB0aGUgbWF0Y2hpbmcKICAgICAgICAvLyBFUyBpbmRleCB3aGljaCBtYXkgbm90IGFjdHVhbGx5IGV4aXN0LiBJbiB0aGF0IHNjZW5hcmlvLAogICAgICAgIC8vIHdlIHN0aWxsIHdhbnQgdG8gbm90aWZ5IHRoZSB1c2VyIHRoYXQgdGhlcmUgaXMgYSBwcm9ibGVtCiAgICAgICAgLy8gYnV0IHdlIGRvIG5vdCB3YW50IHRvIHBvdGVudGlhbGx5IG1ha2UgYW55IHBhZ2VzIHVudXNhYmxlCiAgICAgICAgLy8gc28gZG8gbm90IHJldGhyb3cgdGhlIGVycm9yIGhlcmUKICAgICAgICBpZiAoZXJyIGluc3RhbmNlb2YgX2Vycm9yczIuSW5kZXhQYXR0ZXJuTWlzc2luZ0luZGljZXMpIHsKICAgICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZERhbmdlcihlcnIubWVzc2FnZSk7CgogICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH0KCiAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkRXJyb3IoZXJyLCB7CiAgICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2RhdGEuaW5kZXhQYXR0ZXJucy5mZXRjaEZpZWxkRXJyb3JUaXRsZScsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdFcnJvciBmZXRjaGluZyBmaWVsZHMnCiAgICAgICAgICB9KQogICAgICAgIH0pOwoKICAgICAgICB0aHJvdyBlcnI7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInRvSlNPTiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9KU09OKCkgewogICAgICByZXR1cm4gdGhpcy5pZDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ0b1N0cmluZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiAnJyArIHRoaXMudG9KU09OKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgdGhpcy5wYXR0ZXJuQ2FjaGUuY2xlYXIodGhpcy5pZCk7CgogICAgICBpZiAodGhpcy5pZCkgewogICAgICAgIHJldHVybiB0aGlzLnNhdmVkT2JqZWN0c0NsaWVudC5kZWxldGUodHlwZSwgdGhpcy5pZCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyb3V0ZXMiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiAoMCwgX3V0aWxzLmdldFJvdXRlcykoKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBJbmRleFBhdHRlcm47Cn0oKTsKCmV4cG9ydHMuSW5kZXhQYXR0ZXJuID0gSW5kZXhQYXR0ZXJuOw=="},null]}