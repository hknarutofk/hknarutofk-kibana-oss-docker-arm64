{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/console/public/src/sense_editor/editor.js","dependencies":[{"path":"src/legacy/core_plugins/console/public/src/sense_editor/editor.js","mtime":1572296409264},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmRlZmF1bHQgPSBTZW5zZUVkaXRvcjsKCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07IH0gcmV0dXJuIF90eXBlb2Yob2JqKTsgfQoKLyoKICogTGljZW5zZWQgdG8gRWxhc3RpY3NlYXJjaCBCLlYuIHVuZGVyIG9uZSBvciBtb3JlIGNvbnRyaWJ1dG9yCiAqIGxpY2Vuc2UgYWdyZWVtZW50cy4gU2VlIHRoZSBOT1RJQ0UgZmlsZSBkaXN0cmlidXRlZCB3aXRoCiAqIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiByZWdhcmRpbmcgY29weXJpZ2h0CiAqIG93bmVyc2hpcC4gRWxhc3RpY3NlYXJjaCBCLlYuIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byB5b3UgdW5kZXIKICogdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkKICogbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqCiAqICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICovCnZhciBfID0gcmVxdWlyZSgnbG9kYXNoJyk7Cgp2YXIgYWNlID0gcmVxdWlyZSgnYnJhY2UnKTsKCnZhciAkID0gcmVxdWlyZSgnanF1ZXJ5Jyk7Cgp2YXIgY3VybCA9IHJlcXVpcmUoJy4uL2N1cmwnKTsKCnZhciBSb3dQYXJzZXIgPSByZXF1aXJlKCcuL3Jvd19wYXJzZXInKTsKCnZhciBJbnB1dE1vZGUgPSByZXF1aXJlKCcuL21vZGUvaW5wdXQnKTsKCnZhciB1dGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzJyk7Cgp2YXIgZXMgPSByZXF1aXJlKCcuLi9lcycpOwoKdmFyIGNocm9tZSA9IHJlcXVpcmUoJ3VpL2Nocm9tZScpOwoKdmFyIHNtYXJ0UmVzaXplID0gcmVxdWlyZSgnLi4vc21hcnRfcmVzaXplJyk7CgpmdW5jdGlvbiBjcmVhdGVJbnN0YW5jZSgkZWwpIHsKICB2YXIgYWNlRWRpdG9yID0gYWNlLmVkaXQoJGVsWzBdKTsgLy8gd2UgbXVzdCBjcmVhdGUgYSBjdXN0b20gY2xhc3MgZm9yIGVhY2ggaW5zdGFuY2UsIHNvIHRoYXQgdGhlIHByb3RvdHlwZQogIC8vIGNhbiBiZSB0aGUgdW5pcXVlIGFjZUVkaXRvciBpdCBleHRlbmRzCgogIHZhciBDdXN0b21TZW5zZUVkaXRvciA9IGZ1bmN0aW9uIEN1c3RvbVNlbnNlRWRpdG9yKCkge307CgogIEN1c3RvbVNlbnNlRWRpdG9yLnByb3RvdHlwZSA9IHt9OwoKICBmdW5jdGlvbiBiaW5kUHJvcChrZXkpIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDdXN0b21TZW5zZUVkaXRvci5wcm90b3R5cGUsIGtleSwgewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gYWNlRWRpdG9yW2tleV07CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbCkgewogICAgICAgIGFjZUVkaXRvcltrZXldID0gdmFsOwogICAgICB9CiAgICB9KTsKICB9IC8vIGl0ZXJhdGUgYWxsIG9mIHRoZSBhY2Nlc3NpYmxlIHByb3BlcnRpZXMvbWV0aG9kLCBvbiB0aGUgcHJvdG90eXBlIGFuZCBiZXlvbmQKICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZ3VhcmQtZm9yLWluCgoKICBmb3IgKHZhciBrZXkgaW4gYWNlRWRpdG9yKSB7CiAgICBzd2l0Y2ggKF90eXBlb2YoYWNlRWRpdG9yW2tleV0pKSB7CiAgICAgIGNhc2UgJ2Z1bmN0aW9uJzoKICAgICAgICBDdXN0b21TZW5zZUVkaXRvci5wcm90b3R5cGVba2V5XSA9IF8uYmluZEtleShhY2VFZGl0b3IsIGtleSk7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIGJpbmRQcm9wKGtleSk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICB2YXIgZWRpdG9yID0gbmV3IEN1c3RvbVNlbnNlRWRpdG9yKCk7CiAgZWRpdG9yLl9fYWNlID0gYWNlRWRpdG9yOwogIHJldHVybiBlZGl0b3I7Cn0KCmZ1bmN0aW9uIFNlbnNlRWRpdG9yKCRlbCkgewogIHZhciBlZGl0b3IgPSBjcmVhdGVJbnN0YW5jZSgkZWwpOwogIHZhciBDVVJSRU5UX1JFUV9SQU5HRSA9IG51bGw7CiAgZWRpdG9yLiRlbCA9ICRlbDsgLy8gcGxhY2UgaG9sZGVyIGZvciBhbiBhY3Rpb24gYmFyLCBuZWVkcyB0byBiZSBzZXQgZXh0ZXJuYWxseS4KCiAgZWRpdG9yLiRhY3Rpb25zID0gbnVsbDsgLy8gbWl4aW4gdGhlIFJvd1BhcnNlcgoKICBlZGl0b3IucGFyc2VyID0gbmV3IFJvd1BhcnNlcihlZGl0b3IpOwogIGVkaXRvci5yZXNpemUgPSBzbWFydFJlc2l6ZShlZGl0b3IpOyAvLyBkaXJ0eSBjaGVjayBmb3IgdG9rZW5pemVyIHN0YXRlLCB1c2VzIGEgbG90IGxlc3MgY3ljbGVzCiAgLy8gdGhhbiBsaXN0ZW5pbmcgZm9yIHRva2VuaXplclVwZGF0ZQoKICB2YXIgb25jZURvbmVUb2tlbml6aW5nID0gZnVuY3Rpb24gb25jZURvbmVUb2tlbml6aW5nKGNhbGxiYWNrLCBjYW5jZWxBbHJlYWR5U2NoZWR1bGVkQ2FsbHMpIHsKICAgIHZhciBzZXNzaW9uID0gZWRpdG9yLmdldFNlc3Npb24oKTsKICAgIHZhciB0aW1lciA9IGZhbHNlOwogICAgdmFyIGNoZWNrSW50ZXJ2YWwgPSAyNTsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7CgogICAgICBpZiAoY2FuY2VsQWxyZWFkeVNjaGVkdWxlZENhbGxzKSB7CiAgICAgICAgdGltZXIgPSBjbGVhclRpbWVvdXQodGltZXIpOwogICAgICB9CgogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uIGNoZWNrKCkgewogICAgICAgIC8vIElmIHRoZSBiZ1Rva2VuaXplciBkb2Vzbid0IGV4aXN0LCB3ZSBjYW4gYXNzdW1lIHRoYXQgdGhlIHVuZGVybHlpbmcgZWRpdG9yIGhhcyBiZWVuCiAgICAgICAgLy8gdG9ybiBkb3duLCBlLmcuIGJ5IGNsb3NpbmcgdGhlIEhpc3RvcnkgdGFiLCBhbmQgd2UgZG9uJ3QgbmVlZCB0byBkbyBhbnl0aGluZyBmdXJ0aGVyLgogICAgICAgIGlmIChzZXNzaW9uLmJnVG9rZW5pemVyKSB7CiAgICAgICAgICAvLyBXYWl0IHVudGlsIHRoZSBiZ1Rva2VuaXplciBpcyBkb25lIHJ1bm5pbmcgYmVmb3JlIGV4ZWN1dGluZyB0aGUgY2FsbGJhY2suCiAgICAgICAgICBpZiAoc2Vzc2lvbi5iZ1Rva2VuaXplci5ydW5uaW5nKSB7CiAgICAgICAgICAgIHRpbWVyID0gc2V0VGltZW91dChjaGVjaywgY2hlY2tJbnRlcnZhbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjYWxsYmFjay5hcHBseShzZWxmLCBhcmdzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKICB9OwoKICBlZGl0b3Iuc2V0U2hvd1ByaW50TWFyZ2luKGZhbHNlKTsKCiAgKGZ1bmN0aW9uIChzZXNzaW9uKSB7CiAgICBzZXNzaW9uLnNldE1vZGUobmV3IElucHV0TW9kZS5Nb2RlKCkpOwogICAgc2Vzc2lvbi5zZXRGb2xkU3R5bGUoJ21hcmtiZWdpbmVuZCcpOwogICAgc2Vzc2lvbi5zZXRUYWJTaXplKDIpOwogICAgc2Vzc2lvbi5zZXRVc2VXcmFwTW9kZSh0cnVlKTsKICB9KShlZGl0b3IuZ2V0U2Vzc2lvbigpKTsKCiAgZWRpdG9yLnByZXZSZXF1ZXN0U3RhcnQgPSBmdW5jdGlvbiAocm93T3JQb3MpIHsKICAgIHJvd09yUG9zID0gXy5pc1VuZGVmaW5lZChyb3dPclBvcykgfHwgcm93T3JQb3MgPT09IG51bGwgPyBlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKSA6IHJvd09yUG9zOwogICAgdmFyIGN1clJvdyA9IF8uaXNPYmplY3Qocm93T3JQb3MpID8gcm93T3JQb3Mucm93IDogcm93T3JQb3M7CgogICAgd2hpbGUgKGN1clJvdyA+IDAgJiYgIWVkaXRvci5wYXJzZXIuaXNTdGFydFJlcXVlc3RSb3coY3VyUm93LCBlZGl0b3IpKSB7CiAgICAgIGN1clJvdy0tOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIHJvdzogY3VyUm93LAogICAgICBjb2x1bW46IDAKICAgIH07CiAgfTsKCiAgZWRpdG9yLm5leHRSZXF1ZXN0U3RhcnQgPSBmdW5jdGlvbiAocm93T3JQb3MpIHsKICAgIHJvd09yUG9zID0gXy5pc1VuZGVmaW5lZChyb3dPclBvcykgfHwgcm93T3JQb3MgPT09IG51bGwgPyBlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKSA6IHJvd09yUG9zOwogICAgdmFyIHNlc3Npb24gPSBlZGl0b3IuZ2V0U2Vzc2lvbigpOwogICAgdmFyIGN1clJvdyA9IF8uaXNPYmplY3Qocm93T3JQb3MpID8gcm93T3JQb3Mucm93IDogcm93T3JQb3M7CiAgICB2YXIgbWF4TGluZXMgPSBzZXNzaW9uLmdldExlbmd0aCgpOwoKICAgIGZvciAoOyBjdXJSb3cgPCBtYXhMaW5lcyAtIDE7IGN1clJvdysrKSB7CiAgICAgIGlmIChlZGl0b3IucGFyc2VyLmlzU3RhcnRSZXF1ZXN0Um93KGN1clJvdywgZWRpdG9yKSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgcm93OiBjdXJSb3csCiAgICAgIGNvbHVtbjogMAogICAgfTsKICB9OwoKICBlZGl0b3IuYXV0b0luZGVudCA9IG9uY2VEb25lVG9rZW5pemluZyhmdW5jdGlvbiAoKSB7CiAgICBlZGl0b3IuZ2V0UmVxdWVzdFJhbmdlKGZ1bmN0aW9uIChyZXFSYW5nZSkgewogICAgICBpZiAoIXJlcVJhbmdlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBlZGl0b3IuZ2V0UmVxdWVzdChmdW5jdGlvbiAocGFyc2VkUmVxKSB7CiAgICAgICAgaWYgKHBhcnNlZFJlcS5kYXRhICYmIHBhcnNlZFJlcS5kYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHZhciBpbmRlbnQgPSBwYXJzZWRSZXEuZGF0YS5sZW5ndGggPT09IDE7IC8vIHVuaW5kZW50IG11bHRpIGRvY3MgYnkgZGVmYXVsdAoKICAgICAgICAgIHZhciBmb3JtYXR0ZWREYXRhID0gdXRpbHMucmVmb3JtYXREYXRhKHBhcnNlZFJlcS5kYXRhLCBpbmRlbnQpOwoKICAgICAgICAgIGlmICghZm9ybWF0dGVkRGF0YS5jaGFuZ2VkKSB7CiAgICAgICAgICAgIC8vIHRvZ2dsZS4KICAgICAgICAgICAgaW5kZW50ID0gIWluZGVudDsKICAgICAgICAgICAgZm9ybWF0dGVkRGF0YSA9IHV0aWxzLnJlZm9ybWF0RGF0YShwYXJzZWRSZXEuZGF0YSwgaW5kZW50KTsKICAgICAgICAgIH0KCiAgICAgICAgICBwYXJzZWRSZXEuZGF0YSA9IGZvcm1hdHRlZERhdGEuZGF0YTsKICAgICAgICAgIGVkaXRvci5yZXBsYWNlUmVxdWVzdFJhbmdlKHBhcnNlZFJlcSwgcmVxUmFuZ2UpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICB9LCB0cnVlKTsKCiAgZWRpdG9yLnVwZGF0ZSA9IGZ1bmN0aW9uIChkYXRhLCBjYWxsYmFjaykgewogICAgY2FsbGJhY2sgPSB0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicgPyBjYWxsYmFjayA6IG51bGw7CiAgICB2YXIgc2Vzc2lvbiA9IGVkaXRvci5nZXRTZXNzaW9uKCk7CiAgICBzZXNzaW9uLnNldFZhbHVlKGRhdGEpOwoKICAgIGlmIChjYWxsYmFjaykgewogICAgICAvLyBmb3JjZSB1cGRhdGUgb2YgdG9rZW5zLCBidXQgbm90IG9uIHRoaXMgdGhyZWFkIHRvIGFsbG93IGZvciBhY2UgcmVuZGVyaW5nLgogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgaTsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHNlc3Npb24uZ2V0TGVuZ3RoKCk7IGkrKykgewogICAgICAgICAgc2Vzc2lvbi5nZXRUb2tlbnMoaSk7CiAgICAgICAgfQoKICAgICAgICBjYWxsYmFjaygpOwogICAgICB9KTsKICAgIH0KICB9OwoKICBlZGl0b3IucmVwbGFjZVJlcXVlc3RSYW5nZSA9IGZ1bmN0aW9uIChuZXdSZXF1ZXN0LCByZXF1ZXN0UmFuZ2UpIHsKICAgIHZhciB0ZXh0ID0gdXRpbHMudGV4dEZyb21SZXF1ZXN0KG5ld1JlcXVlc3QpOwoKICAgIGlmIChyZXF1ZXN0UmFuZ2UpIHsKICAgICAgdmFyIHBvcyA9IGVkaXRvci5nZXRDdXJzb3JQb3NpdGlvbigpOwogICAgICBlZGl0b3IuZ2V0U2Vzc2lvbigpLnJlcGxhY2UocmVxdWVzdFJhbmdlLCB0ZXh0KTsKICAgICAgdmFyIG1heFJvdyA9IE1hdGgubWF4KHJlcXVlc3RSYW5nZS5zdGFydC5yb3cgKyB0ZXh0LnNwbGl0KCdcbicpLmxlbmd0aCAtIDEsIDApOwogICAgICBwb3Mucm93ID0gTWF0aC5taW4ocG9zLnJvdywgbWF4Um93KTsKICAgICAgZWRpdG9yLm1vdmVDdXJzb3JUb1Bvc2l0aW9uKHBvcyk7IC8vIEFDRSBVUEdSQURFIC0gY2hlY2sgaWYgbmVlZGVkIC0gYXQgdGhlIG1vbWVudCB0aGUgYWJvdmUgbWF5IHRyaWdnZXIgYSBzZWxlY3Rpb24uCgogICAgICBlZGl0b3IuY2xlYXJTZWxlY3Rpb24oKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIGp1c3QgaW5zZXJ0IHdoZXJlIHdlIGFyZQogICAgICBlZGl0b3IuaW5zZXJ0KHRleHQpOwogICAgfQogIH07CgogIGVkaXRvci5pdGVyRm9yQ3VycmVudExvYyA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBwb3MgPSBlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKTsKICAgIHJldHVybiBlZGl0b3IuaXRlckZvclBvc2l0aW9uKHBvcy5yb3csIHBvcy5jb2x1bW4sIGVkaXRvcik7CiAgfTsKCiAgZWRpdG9yLml0ZXJGb3JQb3NpdGlvbiA9IGZ1bmN0aW9uIChyb3csIGNvbHVtbikgewogICAgcmV0dXJuIG5ldyAoYWNlLmFjZXF1aXJlKCdhY2UvdG9rZW5faXRlcmF0b3InKS5Ub2tlbkl0ZXJhdG9yKShlZGl0b3IuZ2V0U2Vzc2lvbigpLCByb3csIGNvbHVtbik7CiAgfTsKCiAgZWRpdG9yLmdldFJlcXVlc3RSYW5nZSA9IG9uY2VEb25lVG9rZW5pemluZyhmdW5jdGlvbiAocm93LCBjYikgewogICAgaWYgKF8uaXNVbmRlZmluZWQoY2IpKSB7CiAgICAgIGNiID0gcm93OwogICAgICByb3cgPSBudWxsOwogICAgfQoKICAgIGlmICh0eXBlb2YgY2IgIT09ICdmdW5jdGlvbicpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChlZGl0b3IucGFyc2VyLmlzSW5CZXR3ZWVuUmVxdWVzdHNSb3cocm93KSkgewogICAgICBjYihudWxsKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciByZXFTdGFydCA9IGVkaXRvci5wcmV2UmVxdWVzdFN0YXJ0KHJvdywgZWRpdG9yKTsKICAgIHZhciByZXFFbmQgPSBlZGl0b3IubmV4dFJlcXVlc3RFbmQocmVxU3RhcnQsIGVkaXRvcik7CiAgICBjYihuZXcgKGFjZS5hY2VxdWlyZSgnYWNlL3JhbmdlJykuUmFuZ2UpKHJlcVN0YXJ0LnJvdywgcmVxU3RhcnQuY29sdW1uLCByZXFFbmQucm93LCByZXFFbmQuY29sdW1uKSk7CiAgfSk7CiAgZWRpdG9yLmdldEVuZ3VsZmluZ1JlcXVlc3RzUmFuZ2UgPSBvbmNlRG9uZVRva2VuaXppbmcoZnVuY3Rpb24gKHJhbmdlLCBjYikgewogICAgaWYgKF8uaXNVbmRlZmluZWQoY2IpKSB7CiAgICAgIGNiID0gcmFuZ2U7CiAgICAgIHJhbmdlID0gbnVsbDsKICAgIH0KCiAgICByYW5nZSA9IHJhbmdlIHx8IGVkaXRvci5nZXRTZWxlY3Rpb25SYW5nZSgpOwogICAgdmFyIHNlc3Npb24gPSBlZGl0b3IuZ2V0U2Vzc2lvbigpOwogICAgdmFyIHN0YXJ0Um93ID0gcmFuZ2Uuc3RhcnQucm93OwogICAgdmFyIGVuZFJvdyA9IHJhbmdlLmVuZC5yb3c7CiAgICB2YXIgbWF4TGluZSA9IE1hdGgubWF4KDAsIHNlc3Npb24uZ2V0TGVuZ3RoKCkgLSAxKTsgLy8gbW92ZSBzdGFydCByb3cgdG8gdGhlIHByZXZpb3VzIHJlcXVlc3Qgc3RhcnQgaWYgaW4gYm9keSwgby53LiBmb3J3YXJkCgogICAgaWYgKGVkaXRvci5wYXJzZXIuaXNJbkJldHdlZW5SZXF1ZXN0c1JvdyhzdGFydFJvdykpIHsvL2ZvciAoOyBzdGFydFJvdyA8PSBlbmRSb3c7IHN0YXJ0Um93KyspIHsKICAgICAgLy8gIGlmIChlZGl0b3IucGFyc2VyLmlzU3RhcnRSZXF1ZXN0Um93KHN0YXJ0Um93KSkgewogICAgICAvLyAgICBicmVhazsKICAgICAgLy8gIH0KICAgICAgLy99CiAgICB9IGVsc2UgewogICAgICBmb3IgKDsgc3RhcnRSb3cgPj0gMDsgc3RhcnRSb3ctLSkgewogICAgICAgIGlmIChlZGl0b3IucGFyc2VyLmlzU3RhcnRSZXF1ZXN0Um93KHN0YXJ0Um93KSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKHN0YXJ0Um93IDwgMCB8fCBzdGFydFJvdyA+IGVuZFJvdykgewogICAgICBjYihudWxsKTsKICAgICAgcmV0dXJuOwogICAgfSAvLyBtb3ZlIGVuZCByb3cgdG8gdGhlIHByZXZpb3VzIHJlcXVlc3QgZW5kIGlmIGJldHdlZW4gcmVxdWVzdHMsIG8udy4gd2FsayBmb3J3YXJkCgoKICAgIGlmIChlZGl0b3IucGFyc2VyLmlzSW5CZXR3ZWVuUmVxdWVzdHNSb3coZW5kUm93KSkgewogICAgICBmb3IgKDsgZW5kUm93ID49IHN0YXJ0Um93OyBlbmRSb3ctLSkgewogICAgICAgIGlmIChlZGl0b3IucGFyc2VyLmlzRW5kUmVxdWVzdFJvdyhlbmRSb3cpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvciAoOyBlbmRSb3cgPD0gbWF4TGluZTsgZW5kUm93KyspIHsKICAgICAgICBpZiAoZWRpdG9yLnBhcnNlci5pc0VuZFJlcXVlc3RSb3coZW5kUm93KSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKGVuZFJvdyA8IHN0YXJ0Um93IHx8IGVuZFJvdyA+IG1heExpbmUpIHsKICAgICAgY2IobnVsbCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgZW5kQ29sdW1uID0gKHNlc3Npb24uZ2V0TGluZShlbmRSb3cpIHx8ICcnKS5yZXBsYWNlKC9ccyskLywgJycpLmxlbmd0aDsKICAgIGNiKG5ldyAoYWNlLmFjZXF1aXJlKCdhY2UvcmFuZ2UnKS5SYW5nZSkoc3RhcnRSb3csIDAsIGVuZFJvdywgZW5kQ29sdW1uKSk7CiAgfSk7CiAgZWRpdG9yLmdldFJlcXVlc3RJblJhbmdlID0gb25jZURvbmVUb2tlbml6aW5nKGZ1bmN0aW9uIChyYW5nZSwgY2IpIHsKICAgIGlmICghcmFuZ2UpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciByZXF1ZXN0ID0gewogICAgICBtZXRob2Q6ICcnLAogICAgICBkYXRhOiBbXSwKICAgICAgdXJsOiBudWxsLAogICAgICByYW5nZTogcmFuZ2UKICAgIH07CiAgICB2YXIgcG9zID0gcmFuZ2Uuc3RhcnQ7CiAgICB2YXIgdG9rZW5JdGVyID0gZWRpdG9yLml0ZXJGb3JQb3NpdGlvbihwb3Mucm93LCBwb3MuY29sdW1uLCBlZGl0b3IpOwogICAgdmFyIHQgPSB0b2tlbkl0ZXIuZ2V0Q3VycmVudFRva2VuKCk7CgogICAgaWYgKGVkaXRvci5wYXJzZXIuaXNFbXB0eVRva2VuKHQpKSB7CiAgICAgIC8vIGlmIHRoZSByb3cgc3RhcnRzIHdpdGggc29tZSBzcGFjZXMsIHNraXAgdGhlbS4KICAgICAgdCA9IGVkaXRvci5wYXJzZXIubmV4dE5vbkVtcHR5VG9rZW4odG9rZW5JdGVyKTsKICAgIH0KCiAgICByZXF1ZXN0Lm1ldGhvZCA9IHQudmFsdWU7CiAgICB0ID0gZWRpdG9yLnBhcnNlci5uZXh0Tm9uRW1wdHlUb2tlbih0b2tlbkl0ZXIpOwoKICAgIGlmICghdCB8fCB0LnR5cGUgPT09ICdtZXRob2QnKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHJlcXVlc3QudXJsID0gJyc7CgogICAgd2hpbGUgKHQgJiYgdC50eXBlICYmIHQudHlwZS5pbmRleE9mKCd1cmwnKSA9PT0gMCkgewogICAgICByZXF1ZXN0LnVybCArPSB0LnZhbHVlOwogICAgICB0ID0gdG9rZW5JdGVyLnN0ZXBGb3J3YXJkKCk7CiAgICB9CgogICAgaWYgKGVkaXRvci5wYXJzZXIuaXNFbXB0eVRva2VuKHQpKSB7CiAgICAgIC8vIGlmIHRoZSB1cmwgcm93IGVuZHMgd2l0aCBzb21lIHNwYWNlcywgc2tpcCB0aGVtLgogICAgICB0ID0gZWRpdG9yLnBhcnNlci5uZXh0Tm9uRW1wdHlUb2tlbih0b2tlbkl0ZXIpOwogICAgfQoKICAgIHZhciBib2R5U3RhcnRSb3cgPSAodCA/IDAgOiAxKSArIHRva2VuSXRlci5nZXRDdXJyZW50VG9rZW5Sb3coKTsgLy8gYXJ0aWZpY2lhbGx5IGluY3JlYXNlIGVuZCBvZiBkb2NzLgoKICAgIHZhciBkYXRhRW5kUG9zOwoKICAgIHdoaWxlIChib2R5U3RhcnRSb3cgPCByYW5nZS5lbmQucm93IHx8IGJvZHlTdGFydFJvdyA9PT0gcmFuZ2UuZW5kLnJvdyAmJiAwIDwgcmFuZ2UuZW5kLmNvbHVtbikgewogICAgICBkYXRhRW5kUG9zID0gZWRpdG9yLm5leHREYXRhRG9jRW5kKHsKICAgICAgICByb3c6IGJvZHlTdGFydFJvdywKICAgICAgICBjb2x1bW46IDAKICAgICAgfSk7CiAgICAgIHZhciBib2R5UmFuZ2UgPSBuZXcgKGFjZS5hY2VxdWlyZSgnYWNlL3JhbmdlJykuUmFuZ2UpKGJvZHlTdGFydFJvdywgMCwgZGF0YUVuZFBvcy5yb3csIGRhdGFFbmRQb3MuY29sdW1uKTsKICAgICAgdmFyIGRhdGEgPSBlZGl0b3IuZ2V0U2Vzc2lvbigpLmdldFRleHRSYW5nZShib2R5UmFuZ2UpOwogICAgICByZXF1ZXN0LmRhdGEucHVzaChkYXRhLnRyaW0oKSk7CiAgICAgIGJvZHlTdGFydFJvdyA9IGRhdGFFbmRQb3Mucm93ICsgMTsKICAgIH0KCiAgICBjYihyZXF1ZXN0KTsKICB9KTsKCiAgZWRpdG9yLmdldFJlcXVlc3RzSW5SYW5nZSA9IGZ1bmN0aW9uIChyYW5nZSwgaW5jbHVkZU5vblJlcXVlc3RCbG9ja3MsIGNiKSB7CiAgICBpZiAoXy5pc1VuZGVmaW5lZChpbmNsdWRlTm9uUmVxdWVzdEJsb2NrcykpIHsKICAgICAgaW5jbHVkZU5vblJlcXVlc3RCbG9ja3MgPSBmYWxzZTsKICAgICAgY2IgPSByYW5nZTsKICAgICAgcmFuZ2UgPSBudWxsOwogICAgfSBlbHNlIGlmIChfLmlzVW5kZWZpbmVkKGNiKSkgewogICAgICBjYiA9IGluY2x1ZGVOb25SZXF1ZXN0QmxvY2tzOwogICAgICBpbmNsdWRlTm9uUmVxdWVzdEJsb2NrcyA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGV4cGxpY2l0UmFuZ2VUb1JlcXVlc3RzKHJlcXVlc3RzUmFuZ2UsIHRlbXBDYikgewogICAgICBpZiAoIXJlcXVlc3RzUmFuZ2UpIHsKICAgICAgICB0ZW1wQ2IoW10pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHN0YXJ0Um93ID0gcmVxdWVzdHNSYW5nZS5zdGFydC5yb3c7CiAgICAgIHZhciBlbmRSb3cgPSByZXF1ZXN0c1JhbmdlLmVuZC5yb3c7IC8vIG1vdmUgdG8gdGhlIG5leHQgcmVxdWVzdCBzdGFydCAoZHVyaW5nIHRoZSBzZWNvbmQgaXRlcmF0aW9ucyB0aGlzIG1heSBub3QgYmUgZXhhY3RseSBvbiBhIHJlcXVlc3QKCiAgICAgIHZhciBjdXJyZW50Um93ID0gc3RhcnRSb3c7CgogICAgICBmb3IgKDsgY3VycmVudFJvdyA8PSBlbmRSb3c7IGN1cnJlbnRSb3crKykgewogICAgICAgIGlmIChlZGl0b3IucGFyc2VyLmlzU3RhcnRSZXF1ZXN0Um93KGN1cnJlbnRSb3cpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBub25SZXF1ZXN0UHJlZml4QmxvY2sgPSBudWxsOwoKICAgICAgaWYgKGluY2x1ZGVOb25SZXF1ZXN0QmxvY2tzICYmIGN1cnJlbnRSb3cgIT09IHN0YXJ0Um93KSB7CiAgICAgICAgbm9uUmVxdWVzdFByZWZpeEJsb2NrID0gZWRpdG9yLmdldFNlc3Npb24oKS5nZXRMaW5lcyhzdGFydFJvdywgY3VycmVudFJvdyAtIDEpLmpvaW4oJ1xuJyk7CiAgICAgIH0KCiAgICAgIGlmIChjdXJyZW50Um93ID4gZW5kUm93KSB7CiAgICAgICAgdGVtcENiKG5vblJlcXVlc3RQcmVmaXhCbG9jayA/IFtub25SZXF1ZXN0UHJlZml4QmxvY2tdIDogW10pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZWRpdG9yLmdldFJlcXVlc3QoY3VycmVudFJvdywgZnVuY3Rpb24gKHJlcXVlc3QpIHsKICAgICAgICBpZiAoIXJlcXVlc3QpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGV4cGxpY2l0UmFuZ2VUb1JlcXVlc3RzKHsKICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgIHJvdzogcmVxdWVzdC5yYW5nZS5lbmQucm93ICsgMQogICAgICAgICAgfSwKICAgICAgICAgIGVuZDogewogICAgICAgICAgICByb3c6IHJlcXVlc3RzUmFuZ2UuZW5kLnJvdwogICAgICAgICAgfQogICAgICAgIH0sIGZ1bmN0aW9uIChyZXN0T2ZSZXF1ZXN0cykgewogICAgICAgICAgcmVzdE9mUmVxdWVzdHMudW5zaGlmdChyZXF1ZXN0KTsKCiAgICAgICAgICBpZiAobm9uUmVxdWVzdFByZWZpeEJsb2NrICE9PSBudWxsKSB7CiAgICAgICAgICAgIHJlc3RPZlJlcXVlc3RzLnVuc2hpZnQobm9uUmVxdWVzdFByZWZpeEJsb2NrKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0ZW1wQ2IocmVzdE9mUmVxdWVzdHMpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICBlZGl0b3IuZ2V0RW5ndWxmaW5nUmVxdWVzdHNSYW5nZShyYW5nZSwgZnVuY3Rpb24gKHJlcXVlc3RSYW5nZSkgewogICAgICBleHBsaWNpdFJhbmdlVG9SZXF1ZXN0cyhyZXF1ZXN0UmFuZ2UsIGNiKTsKICAgIH0pOwogIH07CgogIGVkaXRvci5nZXRSZXF1ZXN0ID0gb25jZURvbmVUb2tlbml6aW5nKGZ1bmN0aW9uIChyb3csIGNiKSB7CiAgICBpZiAoXy5pc1VuZGVmaW5lZChjYikpIHsKICAgICAgY2IgPSByb3c7CiAgICAgIHJvdyA9IG51bGw7CiAgICB9CgogICAgaWYgKHR5cGVvZiBjYiAhPT0gJ2Z1bmN0aW9uJykgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKGVkaXRvci5wYXJzZXIuaXNJbkJldHdlZW5SZXF1ZXN0c1Jvdyhyb3cpKSB7CiAgICAgIGNiKG51bGwpOwogICAgICByZXR1cm47CiAgICB9CgogICAgZWRpdG9yLmdldFJlcXVlc3RSYW5nZShyb3csIGZ1bmN0aW9uIChyYW5nZSkgewogICAgICBlZGl0b3IuZ2V0UmVxdWVzdEluUmFuZ2UocmFuZ2UsIGNiKTsKICAgIH0pOwogIH0pOwogIGVkaXRvci5tb3ZlVG9QcmV2aW91c1JlcXVlc3RFZGdlID0gb25jZURvbmVUb2tlbml6aW5nKGZ1bmN0aW9uICgpIHsKICAgIHZhciBwb3MgPSBlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKTsKCiAgICBmb3IgKHBvcy5yb3ctLTsgcG9zLnJvdyA+IDAgJiYgIWVkaXRvci5wYXJzZXIuaXNSZXF1ZXN0RWRnZShwb3Mucm93KTsgcG9zLnJvdy0tKSB7Ly8gbG9vcCBmb3Igc2lkZSBlZmZlY3RzCiAgICB9CgogICAgZWRpdG9yLm1vdmVDdXJzb3JUbyhwb3Mucm93LCAwKTsKICB9KTsKICBlZGl0b3IubW92ZVRvTmV4dFJlcXVlc3RFZGdlID0gb25jZURvbmVUb2tlbml6aW5nKGZ1bmN0aW9uIChtb3ZlT25seUlmTm90T25FZGdlKSB7CiAgICB2YXIgcG9zID0gZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCk7CiAgICB2YXIgbWF4Um93ID0gZWRpdG9yLmdldFNlc3Npb24oKS5nZXRMZW5ndGgoKTsKCiAgICBpZiAoIW1vdmVPbmx5SWZOb3RPbkVkZ2UpIHsKICAgICAgcG9zLnJvdysrOwogICAgfQoKICAgIGZvciAoOyBwb3Mucm93IDwgbWF4Um93ICYmICFlZGl0b3IucGFyc2VyLmlzUmVxdWVzdEVkZ2UocG9zLnJvdyk7IHBvcy5yb3crKykgey8vIGxvb3AgZm9yIHNpZGUgZWZmZWN0cwogICAgfQoKICAgIGVkaXRvci5tb3ZlQ3Vyc29yVG8ocG9zLnJvdywgMCk7CiAgfSk7CgogIGVkaXRvci5uZXh0UmVxdWVzdEVuZCA9IGZ1bmN0aW9uIChwb3MpIHsKICAgIHBvcyA9IHBvcyB8fCBlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKTsKICAgIHZhciBzZXNzaW9uID0gZWRpdG9yLmdldFNlc3Npb24oKTsKICAgIHZhciBjdXJSb3cgPSBwb3Mucm93OwogICAgdmFyIG1heExpbmVzID0gc2Vzc2lvbi5nZXRMZW5ndGgoKTsKCiAgICBmb3IgKDsgY3VyUm93IDwgbWF4TGluZXMgLSAxOyBjdXJSb3crKykgewogICAgICB2YXIgY3VyUm93TW9kZSA9IGVkaXRvci5wYXJzZXIuZ2V0Um93UGFyc2VNb2RlKGN1clJvdywgZWRpdG9yKTsKCiAgICAgIGlmICgoY3VyUm93TW9kZSAmIGVkaXRvci5wYXJzZXIuTU9ERS5SRVFVRVNUX0VORCkgPiAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIGlmIChjdXJSb3cgIT09IHBvcy5yb3cgJiYgKGN1clJvd01vZGUgJiBlZGl0b3IucGFyc2VyLk1PREUuUkVRVUVTVF9TVEFSVCkgPiAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgY29sdW1uID0gKHNlc3Npb24uZ2V0TGluZShjdXJSb3cpIHx8ICcnKS5yZXBsYWNlKC9ccyskLywgJycpLmxlbmd0aDsKICAgIHJldHVybiB7CiAgICAgIHJvdzogY3VyUm93LAogICAgICBjb2x1bW46IGNvbHVtbgogICAgfTsKICB9OwoKICBlZGl0b3IubmV4dERhdGFEb2NFbmQgPSBmdW5jdGlvbiAocG9zKSB7CiAgICBwb3MgPSBwb3MgfHwgZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCk7CiAgICB2YXIgc2Vzc2lvbiA9IGVkaXRvci5nZXRTZXNzaW9uKCk7CiAgICB2YXIgY3VyUm93ID0gcG9zLnJvdzsKICAgIHZhciBtYXhMaW5lcyA9IHNlc3Npb24uZ2V0TGVuZ3RoKCk7CgogICAgZm9yICg7IGN1clJvdyA8IG1heExpbmVzIC0gMTsgY3VyUm93KyspIHsKICAgICAgdmFyIGN1clJvd01vZGUgPSBlZGl0b3IucGFyc2VyLmdldFJvd1BhcnNlTW9kZShjdXJSb3csIGVkaXRvcik7CgogICAgICBpZiAoKGN1clJvd01vZGUgJiBSb3dQYXJzZXIuUkVRVUVTVF9FTkQpID4gMCkgewogICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICBpZiAoKGN1clJvd01vZGUgJiBlZGl0b3IucGFyc2VyLk1PREUuTVVMVElfRE9DX0NVUl9ET0NfRU5EKSA+IDApIHsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgaWYgKGN1clJvdyAhPT0gcG9zLnJvdyAmJiAoY3VyUm93TW9kZSAmIGVkaXRvci5wYXJzZXIuTU9ERS5SRVFVRVNUX1NUQVJUKSA+IDApIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQoKICAgIHZhciBjb2x1bW4gPSAoc2Vzc2lvbi5nZXRMaW5lKGN1clJvdykgfHwgJycpLmxlbmd0aDsKICAgIHJldHVybiB7CiAgICAgIHJvdzogY3VyUm93LAogICAgICBjb2x1bW46IGNvbHVtbgogICAgfTsKICB9OyAvLyBvdmVyd3JpdGUgdGhlIGFjdHVhbCBhY2VFZGl0b3IncyBvblBhc3RlIG1ldGhvZAoKCiAgdmFyIG9yaWdPblBhc3RlID0gZWRpdG9yLl9fYWNlLm9uUGFzdGU7CgogIGVkaXRvci5fX2FjZS5vblBhc3RlID0gZnVuY3Rpb24gKHRleHQpIHsKICAgIGlmICh0ZXh0ICYmIGN1cmwuZGV0ZWN0Q1VSTCh0ZXh0KSkgewogICAgICBlZGl0b3IuaGFuZGxlQ1VSTFBhc3RlKHRleHQpOwogICAgICByZXR1cm47CiAgICB9CgogICAgb3JpZ09uUGFzdGUuY2FsbCh0aGlzLCB0ZXh0KTsKICB9OwoKICBlZGl0b3IuaGFuZGxlQ1VSTFBhc3RlID0gZnVuY3Rpb24gKHRleHQpIHsKICAgIHZhciBjdXJsSW5wdXQgPSBjdXJsLnBhcnNlQ1VSTCh0ZXh0KTsKICAgIGVkaXRvci5pbnNlcnQoY3VybElucHV0KTsKICB9OwoKICBlZGl0b3IuaGlnaGxpZ2h0Q3VycmVudFJlcXVlc3RzQW5kVXBkYXRlQWN0aW9uQmFyID0gb25jZURvbmVUb2tlbml6aW5nKGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZXNzaW9uID0gZWRpdG9yLmdldFNlc3Npb24oKTsKICAgIGVkaXRvci5nZXRFbmd1bGZpbmdSZXF1ZXN0c1JhbmdlKGZ1bmN0aW9uIChuZXdDdXJyZW50UmVxUmFuZ2UpIHsKICAgICAgaWYgKG5ld0N1cnJlbnRSZXFSYW5nZSA9PT0gbnVsbCAmJiBDVVJSRU5UX1JFUV9SQU5HRSA9PT0gbnVsbCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKG5ld0N1cnJlbnRSZXFSYW5nZSAhPT0gbnVsbCAmJiBDVVJSRU5UX1JFUV9SQU5HRSAhPT0gbnVsbCAmJiBuZXdDdXJyZW50UmVxUmFuZ2Uuc3RhcnQucm93ID09PSBDVVJSRU5UX1JFUV9SQU5HRS5zdGFydC5yb3cgJiYgbmV3Q3VycmVudFJlcVJhbmdlLmVuZC5yb3cgPT09IENVUlJFTlRfUkVRX1JBTkdFLmVuZC5yb3cpIHsKICAgICAgICAvLyBzYW1lIHJlcXVlc3QsIG5vdyBzZWUgaWYgd2UgYXJlIG9uIHRoZSBmaXJzdCBsaW5lIGFuZCB1cGRhdGUgdGhlIGFjdGlvbiBiYXIKICAgICAgICB2YXIgY3Vyc29yUm93ID0gZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCkucm93OwoKICAgICAgICBpZiAoY3Vyc29yUm93ID09PSBDVVJSRU5UX1JFUV9SQU5HRS5zdGFydC5yb3cpIHsKICAgICAgICAgIGVkaXRvci51cGRhdGVBY3Rpb25zQmFyKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm47IC8vIG5vdGhpbmcgdG8gZG8uLgogICAgICB9CgogICAgICBpZiAoQ1VSUkVOVF9SRVFfUkFOR0UpIHsKICAgICAgICBzZXNzaW9uLnJlbW92ZU1hcmtlcihDVVJSRU5UX1JFUV9SQU5HRS5tYXJrZXJfaWQpOwogICAgICB9CgogICAgICBDVVJSRU5UX1JFUV9SQU5HRSA9IG5ld0N1cnJlbnRSZXFSYW5nZTsKCiAgICAgIGlmIChDVVJSRU5UX1JFUV9SQU5HRSkgewogICAgICAgIENVUlJFTlRfUkVRX1JBTkdFLm1hcmtlcl9pZCA9IHNlc3Npb24uYWRkTWFya2VyKENVUlJFTlRfUkVRX1JBTkdFLCAnYWNlX3NuaXBwZXQtbWFya2VyJywgJ2Z1bGxMaW5lJyk7CiAgICAgIH0KCiAgICAgIGVkaXRvci51cGRhdGVBY3Rpb25zQmFyKCk7CiAgICB9KTsKICB9LCB0cnVlKTsKCiAgZWRpdG9yLmdldFJlcXVlc3RzQXNDVVJMID0gZnVuY3Rpb24gKHJhbmdlLCBjYikgewogICAgaWYgKF8uaXNVbmRlZmluZWQoY2IpKSB7CiAgICAgIGNiID0gcmFuZ2U7CiAgICAgIHJhbmdlID0gbnVsbDsKICAgIH0KCiAgICBpZiAoXy5pc1VuZGVmaW5lZChjYikpIHsKICAgICAgY2IgPSAkLm5vb3A7CiAgICB9CgogICAgZWRpdG9yLmdldFJlcXVlc3RzSW5SYW5nZShyYW5nZSwgdHJ1ZSwgZnVuY3Rpb24gKHJlcXVlc3RzKSB7CiAgICAgIHZhciByZXN1bHQgPSBfLm1hcChyZXF1ZXN0cywgZnVuY3Rpb24gcmVxdWVzdFRvQ3VybChyZXEpIHsKICAgICAgICBpZiAodHlwZW9mIHJlcSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIC8vIG5vIHJlcXVlc3QgYmxvY2sKICAgICAgICAgIHJldHVybiByZXE7CiAgICAgICAgfQoKICAgICAgICB2YXIgZXNQYXRoID0gcmVxLnVybDsKICAgICAgICB2YXIgZXNNZXRob2QgPSByZXEubWV0aG9kOwogICAgICAgIHZhciBlc0RhdGEgPSByZXEuZGF0YTsgLy8gdGhpcyBpcyB0aGUgZmlyc3QgdXJsIGRlZmluZWQgaW4gZWxhc3RpY3NlYXJjaC5ob3N0cwoKICAgICAgICB2YXIgZWxhc3RpY3NlYXJjaEJhc2VVcmwgPSBjaHJvbWUuZ2V0SW5qZWN0ZWQoJ2VsYXN0aWNzZWFyY2hVcmwnKTsKICAgICAgICB2YXIgdXJsID0gZXMuY29uc3RydWN0RVNVcmwoZWxhc3RpY3NlYXJjaEJhc2VVcmwsIGVzUGF0aCk7CiAgICAgICAgdmFyIHJldCA9ICdjdXJsIC1YJyArIGVzTWV0aG9kICsgJyAiJyArIHVybCArICciJzsKCiAgICAgICAgaWYgKGVzRGF0YSAmJiBlc0RhdGEubGVuZ3RoKSB7CiAgICAgICAgICByZXQgKz0gJyAtSCBcJ0NvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vanNvblwnIC1kXCdcbic7CiAgICAgICAgICB2YXIgZGF0YUFzU3RyaW5nID0gdXRpbHMuY29sbGFwc2VMaXRlcmFsU3RyaW5ncyhlc0RhdGEuam9pbignXG4nKSk7IC8vIHNpbmNlIFNlbnNlIGRvZXNuJ3QgYWxsb3cgc2luZ2xlIHF1b3RlIGpzb24gc3RyaW5nIGFueSBzaW5nbGUgcW91dGUgaXMgd2l0aGluIGEgc3RyaW5nLgoKICAgICAgICAgIHJldCArPSBkYXRhQXNTdHJpbmcucmVwbGFjZSgvJy9nLCAnXFwiJyk7CgogICAgICAgICAgaWYgKGVzRGF0YS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIHJldCArPSAnXG4nOwogICAgICAgICAgfSAvLyBlbmQgd2l0aCBhIG5ldyBsaW5lCgoKICAgICAgICAgIHJldCArPSAnXCcnOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJldDsKICAgICAgfSk7CgogICAgICBjYihyZXN1bHQuam9pbignXG4nKSk7CiAgICB9KTsKICB9OwoKICBlZGl0b3IuZ2V0U2Vzc2lvbigpLm9uKCd0b2tlbml6ZXJVcGRhdGUnLCBmdW5jdGlvbiAoKSB7CiAgICBlZGl0b3IuaGlnaGxpZ2h0Q3VycmVudFJlcXVlc3RzQW5kVXBkYXRlQWN0aW9uQmFyKCk7CiAgfSk7CiAgZWRpdG9yLmdldFNlc3Npb24oKS5zZWxlY3Rpb24ub24oJ2NoYW5nZUN1cnNvcicsIGZ1bmN0aW9uICgpIHsKICAgIGVkaXRvci5oaWdobGlnaHRDdXJyZW50UmVxdWVzdHNBbmRVcGRhdGVBY3Rpb25CYXIoKTsKICB9KTsKCiAgZWRpdG9yLnVwZGF0ZUFjdGlvbnNCYXIgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2V0ID0gZnVuY3Rpb24gc2V0KHRvcCkgewogICAgICBpZiAodG9wID09PSBudWxsKSB7CiAgICAgICAgZWRpdG9yLiRhY3Rpb25zLmNzcygndmlzaWJpbGl0eScsICdoaWRkZW4nKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBlZGl0b3IuJGFjdGlvbnMuY3NzKHsKICAgICAgICAgIHRvcDogdG9wLAogICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgdmFyIGhpZGUgPSBmdW5jdGlvbiBoaWRlKCkgewogICAgICBzZXQoKTsKICAgIH07CgogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCFlZGl0b3IuJGFjdGlvbnMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChDVVJSRU5UX1JFUV9SQU5HRSkgewogICAgICAgIC8vIGVsZW1lbnRzIGFyZSBwb3NpdGlvbmVkIHJlbGF0aXZlIHRvIHRoZSBlZGl0b3IncyBjb250YWluZXIKICAgICAgICAvLyBwYWdlWSBpcyByZWxhdGl2ZSB0byBwYWdlLCBzbyBzdWJ0cmFjdCB0aGUgb2Zmc2V0CiAgICAgICAgLy8gZnJvbSBwYWdlWSB0byBnZXQgdGhlIG5ldyB0b3AgdmFsdWUKICAgICAgICB2YXIgb2Zmc2V0RnJvbVBhZ2UgPSBlZGl0b3IuJGVsLm9mZnNldCgpLnRvcDsKICAgICAgICB2YXIgc3RhcnRSb3cgPSBDVVJSRU5UX1JFUV9SQU5HRS5zdGFydC5yb3c7CiAgICAgICAgdmFyIHN0YXJ0Q29sdW1uID0gQ1VSUkVOVF9SRVFfUkFOR0Uuc3RhcnQuY29sdW1uOwogICAgICAgIHZhciBzZXNzaW9uID0gZWRpdG9yLnNlc3Npb247CiAgICAgICAgdmFyIGZpcnN0TGluZSA9IHNlc3Npb24uZ2V0TGluZShzdGFydFJvdyk7CgogICAgICAgIGlmIChmaXJzdExpbmUubGVuZ3RoID4gc2Vzc2lvbi5nZXRXcmFwTGltaXQoKSAtIDUpIHsKICAgICAgICAgIC8vIG92ZXJsYXAgZmlyc3Qgcm93CiAgICAgICAgICBpZiAoc3RhcnRSb3cgPiAwKSB7CiAgICAgICAgICAgIHN0YXJ0Um93LS07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGFydFJvdysrOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHRvcE9mUmVxID0gZWRpdG9yLnJlbmRlcmVyLnRleHRUb1NjcmVlbkNvb3JkaW5hdGVzKHN0YXJ0Um93LCBzdGFydENvbHVtbikucGFnZVkgLSBvZmZzZXRGcm9tUGFnZTsKCiAgICAgICAgaWYgKHRvcE9mUmVxID49IDApIHsKICAgICAgICAgIHJldHVybiBzZXQodG9wT2ZSZXEpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGJvdHRvbU9mUmVxID0gZWRpdG9yLnJlbmRlcmVyLnRleHRUb1NjcmVlbkNvb3JkaW5hdGVzKENVUlJFTlRfUkVRX1JBTkdFLmVuZC5yb3csIENVUlJFTlRfUkVRX1JBTkdFLmVuZC5jb2x1bW4pLnBhZ2VZIC0gb2Zmc2V0RnJvbVBhZ2U7CgogICAgICAgIGlmIChib3R0b21PZlJlcSA+PSAwKSB7CiAgICAgICAgICByZXR1cm4gc2V0KDApOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaGlkZSgpOwogICAgfTsKICB9KCk7CgogIGVkaXRvci5nZXRTZXNzaW9uKCkub24oJ2NoYW5nZVNjcm9sbFRvcCcsIGVkaXRvci51cGRhdGVBY3Rpb25zQmFyKTsKICByZXR1cm4gZWRpdG9yOwp9Cgptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHMuZGVmYXVsdDs="},null]}