{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/visualize/embeddable/visualize_embeddable.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/visualize/embeddable/visualize_embeddable.js","mtime":1572296410820},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuVmlzdWFsaXplRW1iZWRkYWJsZSA9IHZvaWQgMDsKCnZhciBfbG9kYXNoID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJsb2Rhc2giKSk7Cgp2YXIgX3BlcnNpc3RlZF9zdGF0ZSA9IHJlcXVpcmUoInVpL3BlcnNpc3RlZF9zdGF0ZSIpOwoKdmFyIFJ4ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgicnhqcyIpKTsKCnZhciBfcHVibGljID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vZW1iZWRkYWJsZV9hcGkvcHVibGljL25wX3JlYWR5L3B1YmxpYyIpOwoKdmFyIF9wdWJsaWMyID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vZGF0YS9wdWJsaWMiKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi9jb25zdGFudHMiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgewogIGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKICAgIHJldHVybiBvYmo7CiAgfSBlbHNlIHsKICAgIHZhciBuZXdPYmogPSB7fTsKCiAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsKCiAgICAgICAgICBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld09ialtrZXldID0gb2JqW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgbmV3T2JqLmRlZmF1bHQgPSBvYmo7CiAgICByZXR1cm4gbmV3T2JqOwogIH0KfQoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID09PSAic3ltYm9sIikgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9IGVsc2UgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0KCiAgcmV0dXJuIF90eXBlb2Yob2JqKTsKfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgfSk7CiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgfQoKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgaWYgKGkgJSAyKSB7CiAgICAgIG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICB9IGVsc2UgewogICAgICBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICB9Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgfQp9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogIHJldHVybiBDb25zdHJ1Y3RvcjsKfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgewogIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgIHJldHVybiBjYWxsOwogIH0KCiAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7Cn0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgewogIGlmIChzZWxmID09PSB2b2lkIDApIHsKICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgfQoKICByZXR1cm4gc2VsZjsKfQoKZnVuY3Rpb24gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlcikgewogIGlmICh0eXBlb2YgUmVmbGVjdCAhPT0gInVuZGVmaW5lZCIgJiYgUmVmbGVjdC5nZXQpIHsKICAgIF9nZXQgPSBSZWZsZWN0LmdldDsKICB9IGVsc2UgewogICAgX2dldCA9IGZ1bmN0aW9uIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHsKICAgICAgdmFyIGJhc2UgPSBfc3VwZXJQcm9wQmFzZSh0YXJnZXQsIHByb3BlcnR5KTsKCiAgICAgIGlmICghYmFzZSkgcmV0dXJuOwogICAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYmFzZSwgcHJvcGVydHkpOwoKICAgICAgaWYgKGRlc2MuZ2V0KSB7CiAgICAgICAgcmV0dXJuIGRlc2MuZ2V0LmNhbGwocmVjZWl2ZXIpOwogICAgICB9CgogICAgICByZXR1cm4gZGVzYy52YWx1ZTsKICAgIH07CiAgfQoKICByZXR1cm4gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlciB8fCB0YXJnZXQpOwp9CgpmdW5jdGlvbiBfc3VwZXJQcm9wQmFzZShvYmplY3QsIHByb3BlcnR5KSB7CiAgd2hpbGUgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSkpIHsKICAgIG9iamVjdCA9IF9nZXRQcm90b3R5cGVPZihvYmplY3QpOwogICAgaWYgKG9iamVjdCA9PT0gbnVsbCkgYnJlYWs7CiAgfQoKICByZXR1cm4gb2JqZWN0Owp9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOwogIH07CiAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgfQoKICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfQogIH0pOwogIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwp9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgby5fX3Byb3RvX18gPSBwOwogICAgcmV0dXJuIG87CiAgfTsKCiAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBnZXRLZXlzID0gZnVuY3Rpb24gZ2V0S2V5cyhvKSB7CiAgcmV0dXJuIE9iamVjdC5rZXlzKG8pOwp9OwoKdmFyIFZpc3VhbGl6ZUVtYmVkZGFibGUgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfRW1iZWRkYWJsZSkgewogIF9pbmhlcml0cyhWaXN1YWxpemVFbWJlZGRhYmxlLCBfRW1iZWRkYWJsZSk7CgogIGZ1bmN0aW9uIFZpc3VhbGl6ZUVtYmVkZGFibGUoX3JlZiwgaW5pdGlhbElucHV0LCBwYXJlbnQpIHsKICAgIHZhciBfdGhpczsKCiAgICB2YXIgc2F2ZWRWaXN1YWxpemF0aW9uID0gX3JlZi5zYXZlZFZpc3VhbGl6YXRpb24sCiAgICAgICAgbG9hZGVyID0gX3JlZi5sb2FkZXIsCiAgICAgICAgZWRpdFVybCA9IF9yZWYuZWRpdFVybCwKICAgICAgICBpbmRleFBhdHRlcm5zID0gX3JlZi5pbmRleFBhdHRlcm5zLAogICAgICAgIGVkaXRhYmxlID0gX3JlZi5lZGl0YWJsZTsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVmlzdWFsaXplRW1iZWRkYWJsZSk7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoVmlzdWFsaXplRW1iZWRkYWJsZSkuY2FsbCh0aGlzLCBpbml0aWFsSW5wdXQsIHsKICAgICAgZGVmYXVsdFRpdGxlOiBzYXZlZFZpc3VhbGl6YXRpb24udGl0bGUsCiAgICAgIGVkaXRVcmw6IGVkaXRVcmwsCiAgICAgIGluZGV4UGF0dGVybnM6IGluZGV4UGF0dGVybnMsCiAgICAgIGVkaXRhYmxlOiBlZGl0YWJsZSwKICAgICAgc2F2ZWRPYmplY3RJZDogc2F2ZWRWaXN1YWxpemF0aW9uLmlkLAogICAgICB2aXNUeXBlTmFtZTogc2F2ZWRWaXN1YWxpemF0aW9uLnZpcy50eXBlLm5hbWUKICAgIH0sIHBhcmVudCkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNhdmVkVmlzdWFsaXphdGlvbiIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAibG9hZGVyIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ1aVN0YXRlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJoYW5kbGVyIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ0aW1lUmFuZ2UiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInF1ZXJ5Iiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ0aXRsZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZmlsdGVycyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAidmlzQ3VzdG9taXphdGlvbnMiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInN1YnNjcmlwdGlvbiIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAidHlwZSIsIF9jb25zdGFudHMuVklTVUFMSVpFX0VNQkVEREFCTEVfVFlQRSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAidWlTdGF0ZUNoYW5nZUhhbmRsZXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnVwZGF0ZUlucHV0KF9vYmplY3RTcHJlYWQoe30sIF90aGlzLnVpU3RhdGUudG9KU09OKCkpKTsKICAgIH0pOwoKICAgIF90aGlzLnNhdmVkVmlzdWFsaXphdGlvbiA9IHNhdmVkVmlzdWFsaXphdGlvbjsKICAgIF90aGlzLmxvYWRlciA9IGxvYWRlcjsKICAgIHZhciBwYXJzZWRVaVN0YXRlID0gc2F2ZWRWaXN1YWxpemF0aW9uLnVpU3RhdGVKU09OID8gSlNPTi5wYXJzZShzYXZlZFZpc3VhbGl6YXRpb24udWlTdGF0ZUpTT04pIDoge307CiAgICBfdGhpcy51aVN0YXRlID0gbmV3IF9wZXJzaXN0ZWRfc3RhdGUuUGVyc2lzdGVkU3RhdGUocGFyc2VkVWlTdGF0ZSk7CgogICAgX3RoaXMudWlTdGF0ZS5vbignY2hhbmdlJywgX3RoaXMudWlTdGF0ZUNoYW5nZUhhbmRsZXIpOwoKICAgIF90aGlzLnN1YnNjcmlwdGlvbiA9IFJ4Lm1lcmdlKF90aGlzLmdldE91dHB1dCQoKSwgX3RoaXMuZ2V0SW5wdXQkKCkpLnN1YnNjcmliZShmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmhhbmRsZUNoYW5nZXMoKTsKICAgIH0pOwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFZpc3VhbGl6ZUVtYmVkZGFibGUsIFt7CiAgICBrZXk6ICJnZXRJbnNwZWN0b3JBZGFwdGVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0SW5zcGVjdG9yQWRhcHRlcnMoKSB7CiAgICAgIGlmICghdGhpcy5oYW5kbGVyKSB7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlci5pbnNwZWN0b3JBZGFwdGVyczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzdXBwb3J0c1RyaWdnZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHN1cHBvcnRzVHJpZ2dlcih0cmlnZ2VyKSB7CiAgICAgIHJldHVybiB0cmlnZ2VyLmlkICE9PSBfcHVibGljLkFQUExZX0ZJTFRFUl9UUklHR0VSOwogICAgfQogICAgLyoqCiAgICAgKiBUcmFuc2ZlcnMgYWxsIGNoYW5nZXMgaW4gdGhlIGNvbnRhaW5lclN0YXRlLmN1c3RvbWl6YXRpb24gaW50bwogICAgICogdGhlIHVpU3RhdGUgb2YgdGhpcyB2aXN1YWxpemF0aW9uLgogICAgICovCgogIH0sIHsKICAgIGtleTogInRyYW5zZmVyQ3VzdG9taXphdGlvbnNUb1VpU3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRyYW5zZmVyQ3VzdG9taXphdGlvbnNUb1VpU3RhdGUoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOyAvLyBDaGVjayBmb3IgY2hhbmdlcyB0aGF0IG5lZWQgdG8gYmUgZm9yd2FyZGVkIHRvIHRoZSB1aVN0YXRlCiAgICAgIC8vIFNpbmNlIHRoZSB2aXMgaGFzIGFuIG93biBsaXN0ZW5lciBvbiB0aGUgdWlTdGF0ZSB3ZSBkb24ndCBuZWVkIHRvCiAgICAgIC8vIHBhc3MgYW55dGhpbmcgZnJvbSBoZXJlIHRvIHRoZSBoYW5kbGVyLnVwZGF0ZSBtZXRob2QKCgogICAgICB2YXIgdmlzQ3VzdG9taXphdGlvbnMgPSB0aGlzLmlucHV0LnZpczsKCiAgICAgIGlmICh2aXNDdXN0b21pemF0aW9ucykgewogICAgICAgIGlmICghX2xvZGFzaC5kZWZhdWx0LmlzRXF1YWwodmlzQ3VzdG9taXphdGlvbnMsIHRoaXMudmlzQ3VzdG9taXphdGlvbnMpKSB7CiAgICAgICAgICB0aGlzLnZpc0N1c3RvbWl6YXRpb25zID0gdmlzQ3VzdG9taXphdGlvbnM7IC8vIFR1cm4gdGhpcyBvZmYgb3IgdGhlIHVpU3RhdGVDaGFuZ2VIYW5kbGVyIHdpbGwgZmlyZSBmb3IgZXZlcnkgbW9kaWZpY2F0aW9uLgoKICAgICAgICAgIHRoaXMudWlTdGF0ZS5vZmYoJ2NoYW5nZScsIHRoaXMudWlTdGF0ZUNoYW5nZUhhbmRsZXIpOwogICAgICAgICAgdGhpcy51aVN0YXRlLmNsZWFyQWxsS2V5cygpOwogICAgICAgICAgdGhpcy51aVN0YXRlLnNldCgndmlzJywgdmlzQ3VzdG9taXphdGlvbnMpOwogICAgICAgICAgZ2V0S2V5cyh2aXNDdXN0b21pemF0aW9ucykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIF90aGlzMi51aVN0YXRlLnNldChrZXksIHZpc0N1c3RvbWl6YXRpb25zW2tleV0pOwogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLnVpU3RhdGUub24oJ2NoYW5nZScsIHRoaXMudWlTdGF0ZUNoYW5nZUhhbmRsZXIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnVpU3RhdGUuY2xlYXJBbGxLZXlzKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJoYW5kbGVDaGFuZ2VzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYW5kbGVDaGFuZ2VzKCkgewogICAgICB0aGlzLnRyYW5zZmVyQ3VzdG9taXphdGlvbnNUb1VpU3RhdGUoKTsKICAgICAgdmFyIHVwZGF0ZWRQYXJhbXMgPSB7fTsgLy8gQ2hlY2sgaWYgdGltZXJhbmdlIGhhcyBjaGFuZ2VkCgogICAgICBpZiAoIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKHRoaXMuaW5wdXQudGltZVJhbmdlLCB0aGlzLnRpbWVSYW5nZSkpIHsKICAgICAgICB0aGlzLnRpbWVSYW5nZSA9IF9sb2Rhc2guZGVmYXVsdC5jbG9uZURlZXAodGhpcy5pbnB1dC50aW1lUmFuZ2UpOwogICAgICAgIHVwZGF0ZWRQYXJhbXMudGltZVJhbmdlID0gdGhpcy50aW1lUmFuZ2U7CiAgICAgIH0gLy8gQ2hlY2sgaWYgZmlsdGVycyBoYXMgY2hhbmdlZAoKCiAgICAgIGlmICghKDAsIF9wdWJsaWMyLm9ubHlEaXNhYmxlZEZpbHRlcnNDaGFuZ2VkKSh0aGlzLmlucHV0LmZpbHRlcnMsIHRoaXMuZmlsdGVycykpIHsKICAgICAgICB1cGRhdGVkUGFyYW1zLmZpbHRlcnMgPSB0aGlzLmlucHV0LmZpbHRlcnM7CiAgICAgICAgdGhpcy5maWx0ZXJzID0gdGhpcy5pbnB1dC5maWx0ZXJzOwogICAgICB9IC8vIENoZWNrIGlmIHF1ZXJ5IGhhcyBjaGFuZ2VkCgoKICAgICAgaWYgKCFfbG9kYXNoLmRlZmF1bHQuaXNFcXVhbCh0aGlzLmlucHV0LnF1ZXJ5LCB0aGlzLnF1ZXJ5KSkgewogICAgICAgIHVwZGF0ZWRQYXJhbXMucXVlcnkgPSB0aGlzLmlucHV0LnF1ZXJ5OwogICAgICAgIHRoaXMucXVlcnkgPSB0aGlzLmlucHV0LnF1ZXJ5OwogICAgICB9CgogICAgICBpZiAodGhpcy5vdXRwdXQudGl0bGUgIT09IHRoaXMudGl0bGUpIHsKICAgICAgICB0aGlzLnRpdGxlID0gdGhpcy5vdXRwdXQudGl0bGU7CiAgICAgICAgdXBkYXRlZFBhcmFtcy5kYXRhQXR0cnMgPSB7CiAgICAgICAgICB0aXRsZTogdGhpcy50aXRsZSB8fCAnJwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmhhbmRsZXIgJiYgIV9sb2Rhc2guZGVmYXVsdC5pc0VtcHR5KHVwZGF0ZWRQYXJhbXMpKSB7CiAgICAgICAgdGhpcy5oYW5kbGVyLnVwZGF0ZSh1cGRhdGVkUGFyYW1zKTsKICAgICAgICB0aGlzLmhhbmRsZXIucmVsb2FkKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSB7RWxlbWVudH0gZG9tTm9kZQogICAgICogQHBhcmFtIHtDb250YWluZXJTdGF0ZX0gY29udGFpbmVyU3RhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcihkb21Ob2RlKSB7CiAgICAgIHRoaXMudGltZVJhbmdlID0gX2xvZGFzaC5kZWZhdWx0LmNsb25lRGVlcCh0aGlzLmlucHV0LnRpbWVSYW5nZSk7CiAgICAgIHRoaXMucXVlcnkgPSB0aGlzLmlucHV0LnF1ZXJ5OwogICAgICB0aGlzLmZpbHRlcnMgPSB0aGlzLmlucHV0LmZpbHRlcnM7CiAgICAgIHRoaXMudHJhbnNmZXJDdXN0b21pemF0aW9uc1RvVWlTdGF0ZSgpOwogICAgICB2YXIgZGF0YUF0dHJzID0gewogICAgICAgICdzaGFyZWQtaXRlbSc6ICcnLAogICAgICAgIHRpdGxlOiB0aGlzLm91dHB1dC50aXRsZSB8fCAnJwogICAgICB9OwoKICAgICAgaWYgKHRoaXMuc2F2ZWRWaXN1YWxpemF0aW9uLmRlc2NyaXB0aW9uKSB7CiAgICAgICAgZGF0YUF0dHJzLmRlc2NyaXB0aW9uID0gdGhpcy5zYXZlZFZpc3VhbGl6YXRpb24uZGVzY3JpcHRpb247CiAgICAgIH0KCiAgICAgIHZhciBoYW5kbGVyUGFyYW1zID0gewogICAgICAgIHVpU3RhdGU6IHRoaXMudWlTdGF0ZSwKICAgICAgICAvLyBBcHBlbmQgdmlzdWFsaXphdGlvbiB0byBjb250YWluZXIgaW5zdGVhZCBvZiByZXBsYWNpbmcgaXRzIGNvbnRlbnQKICAgICAgICBhcHBlbmQ6IHRydWUsCiAgICAgICAgdGltZVJhbmdlOiBfbG9kYXNoLmRlZmF1bHQuY2xvbmVEZWVwKHRoaXMuaW5wdXQudGltZVJhbmdlKSwKICAgICAgICBxdWVyeTogdGhpcy5xdWVyeSwKICAgICAgICBmaWx0ZXJzOiB0aGlzLmZpbHRlcnMsCiAgICAgICAgY3NzQ2xhc3M6ICJwYW5lbC1jb250ZW50IHBhbmVsLWNvbnRlbnQtLWZ1bGxXaWR0aCIsCiAgICAgICAgZGF0YUF0dHJzOiBkYXRhQXR0cnMKICAgICAgfTsKICAgICAgdGhpcy5oYW5kbGVyID0gdGhpcy5sb2FkZXIuZW1iZWRWaXN1YWxpemF0aW9uV2l0aFNhdmVkT2JqZWN0KGRvbU5vZGUsIHRoaXMuc2F2ZWRWaXN1YWxpemF0aW9uLCBoYW5kbGVyUGFyYW1zKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihWaXN1YWxpemVFbWJlZGRhYmxlLnByb3RvdHlwZSksICJkZXN0cm95IiwgdGhpcykuY2FsbCh0aGlzKTsKCiAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbikgewogICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMudWlTdGF0ZS5vZmYoJ2NoYW5nZScsIHRoaXMudWlTdGF0ZUNoYW5nZUhhbmRsZXIpOwogICAgICB0aGlzLnNhdmVkVmlzdWFsaXphdGlvbi5kZXN0cm95KCk7CgogICAgICBpZiAodGhpcy5oYW5kbGVyKSB7CiAgICAgICAgdGhpcy5oYW5kbGVyLmRlc3Ryb3koKTsKICAgICAgICB0aGlzLmhhbmRsZXIuZ2V0RWxlbWVudCgpLnJlbW92ZSgpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAicmVsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWxvYWQoKSB7CiAgICAgIGlmICh0aGlzLmhhbmRsZXIpIHsKICAgICAgICB0aGlzLmhhbmRsZXIucmVsb2FkKCk7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBWaXN1YWxpemVFbWJlZGRhYmxlOwp9KF9wdWJsaWMuRW1iZWRkYWJsZSk7CgpleHBvcnRzLlZpc3VhbGl6ZUVtYmVkZGFibGUgPSBWaXN1YWxpemVFbWJlZGRhYmxlOw=="},null]}