{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/ui/public/visualize/loader/embedded_visualize_handler.js","dependencies":[{"path":"src/legacy/ui/public/visualize/loader/embedded_visualize_handler.js","mtime":1572296413420},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkVtYmVkZGVkVmlzdWFsaXplSGFuZGxlciA9IHZvaWQgMDsKCnZhciBfZXZlbnRzID0gcmVxdWlyZSgiZXZlbnRzIik7Cgp2YXIgX2xvZGFzaCA9IHJlcXVpcmUoImxvZGFzaCIpOwoKdmFyIFJ4ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgicnhqcyIpKTsKCnZhciBfb3BlcmF0b3JzID0gcmVxdWlyZSgicnhqcy9vcGVyYXRvcnMiKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9ub3RpZnkgPSByZXF1aXJlKCJ1aS9ub3RpZnkiKTsKCnZhciBfcmVnaXN0cmllcyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2NvcmVfcGx1Z2lucy9pbnRlcnByZXRlci9wdWJsaWMvcmVnaXN0cmllcyIpOwoKdmFyIF9pbnNwZWN0b3IgPSByZXF1aXJlKCIuLi8uLi9pbnNwZWN0b3IiKTsKCnZhciBfcmVuZGVyX2NvbXBsZXRlID0gcmVxdWlyZSgiLi4vLi4vcmVuZGVyX2NvbXBsZXRlIik7Cgp2YXIgX3RpbWVmaWx0ZXIgPSByZXF1aXJlKCIuLi8uLi90aW1lZmlsdGVyIik7Cgp2YXIgX3Zpc19maWx0ZXJzID0gcmVxdWlyZSgiLi4vLi4vdmlzL3Zpc19maWx0ZXJzIik7Cgp2YXIgX3BpcGVsaW5lX2RhdGFfbG9hZGVyID0gcmVxdWlyZSgiLi9waXBlbGluZV9kYXRhX2xvYWRlciIpOwoKdmFyIF92aXN1YWxpemF0aW9uX2xvYWRlciA9IHJlcXVpcmUoIi4vdmlzdWFsaXphdGlvbl9sb2FkZXIiKTsKCnZhciBfdmlzdWFsaXplX2RhdGFfbG9hZGVyID0gcmVxdWlyZSgiLi92aXN1YWxpemVfZGF0YV9sb2FkZXIiKTsKCnZhciBfcHVibGljID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vY29yZV9wbHVnaW5zL2RhdGEvcHVibGljIik7Cgp2YXIgX2FkYXB0ZXJzID0gcmVxdWlyZSgiLi4vLi4vaW5zcGVjdG9yL2FkYXB0ZXJzIik7Cgp2YXIgX3V0aWxpdGllcyA9IHJlcXVpcmUoIi4vcGlwZWxpbmVfaGVscGVycy91dGlsaXRpZXMiKTsKCnZhciBfdXRpbHMgPSByZXF1aXJlKCIuL3V0aWxzIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsKICBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7CiAgICByZXR1cm4gb2JqOwogIH0gZWxzZSB7CiAgICB2YXIgbmV3T2JqID0ge307CgogICAgaWYgKG9iaiAhPSBudWxsKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgewogICAgICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307CgogICAgICAgICAgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdPYmpba2V5XSA9IG9ialtrZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIG5ld09iai5kZWZhdWx0ID0gb2JqOwogICAgcmV0dXJuIG5ld09iajsKICB9Cn0KCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsKICByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7CiAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7CiAgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBhcnIyW2ldID0gYXJyW2ldOwogICAgfQoKICAgIHJldHVybiBhcnIyOwogIH0KfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgfSk7CiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgfQoKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgaWYgKGkgJSAyKSB7CiAgICAgIG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICB9IGVsc2UgewogICAgICBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsKICB2YXIgX2FyciA9IFtdOwogIHZhciBfbiA9IHRydWU7CiAgdmFyIF9kID0gZmFsc2U7CiAgdmFyIF9lID0gdW5kZWZpbmVkOwoKICB0cnkgewogICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewogICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoKICAgICAgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOwogICAgfQogIH0gY2F0Y2ggKGVycikgewogICAgX2QgPSB0cnVlOwogICAgX2UgPSBlcnI7CiAgfSBmaW5hbGx5IHsKICAgIHRyeSB7CiAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgIH0KICB9CgogIHJldHVybiBfYXJyOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsKfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICB9Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgfQp9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogIHJldHVybiBDb25zdHJ1Y3RvcjsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBSRU5ERVJfQ09NUExFVEVfRVZFTlQgPSAncmVuZGVyX2NvbXBsZXRlJzsKdmFyIERBVEFfU0hBUkVEX0lURU0gPSAnZGF0YS1zaGFyZWQtaXRlbSc7CnZhciBMT0FESU5HX0FUVFJJQlVURSA9ICdkYXRhLWxvYWRpbmcnOwp2YXIgUkVOREVSSU5HX0NPVU5UX0FUVFJJQlVURSA9ICdkYXRhLXJlbmRlcmluZy1jb3VudCc7Ci8qKgogKiBBIGhhbmRsZXIgdG8gdGhlIGVtYmVkZGVkIHZpc3VhbGl6YXRpb24uIEl0IG9mZmVycyBzZXZlcmFsIG1ldGhvZHMgdG8gaW50ZXJhY3QKICogd2l0aCB0aGUgdmlzdWFsaXphdGlvbi4KICovCgp2YXIgRW1iZWRkZWRWaXN1YWxpemVIYW5kbGVyID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoKSB7CiAgLyoqCiAgICogVGhpcyBvYnNlcnZhYmxlIHdpbGwgZW1pdCBldmVyeSB0aW1lIG5ldyBkYXRhIGlzIGxvYWRlZCBmb3IgdGhlCiAgICogdmlzdWFsaXphdGlvbi4gVGhlIGVtaXR0ZWQgdmFsdWUgaXMgdGhlIGxvYWRlZCBkYXRhIGFmdGVyIGl0IGhhcwogICAqIGJlZW4gdHJhbnNmb3JtZWQgYnkgdGhlIHZpc3VhbGl6YXRpb24ncyByZXNwb25zZSBoYW5kbGVyLgogICAqIFRoaXMgc2hvdWxkIG5vdCBiZSB1c2VkIGJ5IGFueSBwbHVnaW4uCiAgICogQGlnbm9yZQogICAqLwogIGZ1bmN0aW9uIEVtYmVkZGVkVmlzdWFsaXplSGFuZGxlcihlbGVtZW50LCBzYXZlZE9iamVjdCwgcGFyYW1zKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFbWJlZGRlZFZpc3VhbGl6ZUhhbmRsZXIpOwoKICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJkYXRhJCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJpbnNwZWN0b3JBZGFwdGVycyIsIHt9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInZpcyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJoYW5kbGVycyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJsb2FkZWQiLCBmYWxzZSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJkZXN0cm95ZWQiLCBmYWxzZSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJwaXBlbGluZURhdGFMb2FkZXIiLCBmYWxzZSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJsaXN0ZW5lcnMiLCBuZXcgX2V2ZW50cy5FdmVudEVtaXR0ZXIoKSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJmaXJzdFJlbmRlckNvbXBsZXRlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInJlbmRlckNvbXBsZXRlSGVscGVyIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInNob3VsZEZvcmNlTmV4dEZldGNoIiwgZmFsc2UpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiZGVib3VuY2VkRmV0Y2hBbmRSZW5kZXIiLCAoMCwgX2xvZGFzaC5kZWJvdW5jZSkoZnVuY3Rpb24gKCkgewogICAgICBpZiAoX3RoaXMuZGVzdHJveWVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgZm9yY2VGZXRjaCA9IF90aGlzLnNob3VsZEZvcmNlTmV4dEZldGNoOwogICAgICBfdGhpcy5zaG91bGRGb3JjZU5leHRGZXRjaCA9IGZhbHNlOwoKICAgICAgX3RoaXMuZmV0Y2goZm9yY2VGZXRjaCkudGhlbihfdGhpcy5yZW5kZXIpOwogICAgfSwgMTAwKSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJkYXRhTG9hZGVyUGFyYW1zIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImFwcFN0YXRlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInVpU3RhdGUiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiZGF0YUxvYWRlciIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJkYXRhU3ViamVjdCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJhY3Rpb25zIiwge30pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiZXZlbnRzJCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJhdXRvRmV0Y2giLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiYWJvcnRDb250cm9sbGVyIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImF1dG9SZWZyZXNoRmV0Y2hTdWJzY3JpcHRpb24iLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAicmVuZGVyIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgcmVzcG9uc2UgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IG51bGw7CgogICAgICB2YXIgZXhlY3V0ZVJlbmRlcmVyID0gX3RoaXMucmVuZGVyZXJQcm92aWRlcihyZXNwb25zZSk7CgogICAgICBpZiAoIWV4ZWN1dGVSZW5kZXJlcikgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBUT0RPOiB3ZSBoYXZlIHRoaXMgd2VpcmQgc2l0dWF0aW9uIHdoZW4gd2UgbmVlZCB0byByZW5kZXIgZmlyc3QsCiAgICAgIC8vIGFuZCB0aGVuIHdlIGNhbGwgZmV0Y2ggYW5kIHJlbmRlci4uLiB3ZSBuZWVkIHRvIGdldCByaWQgb2YgdGhhdC4KCgogICAgICBleGVjdXRlUmVuZGVyZXIoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIV90aGlzLmxvYWRlZCkgewogICAgICAgICAgX3RoaXMubG9hZGVkID0gdHJ1ZTsKCiAgICAgICAgICBpZiAoX3RoaXMuYXV0b0ZldGNoKSB7CiAgICAgICAgICAgIF90aGlzLmZldGNoQW5kUmVuZGVyKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAib3Blbkluc3BlY3RvciIsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF9pbnNwZWN0b3IuSW5zcGVjdG9yLm9wZW4oX3RoaXMuaW5zcGVjdG9yQWRhcHRlcnMsIHsKICAgICAgICB0aXRsZTogX3RoaXMudmlzLnRpdGxlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJoYXNJbnNwZWN0b3IiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfaW5zcGVjdG9yLkluc3BlY3Rvci5pc0F2YWlsYWJsZShfdGhpcy5pbnNwZWN0b3JBZGFwdGVycyk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInJlbG9hZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuZmV0Y2hBbmRSZW5kZXIodHJ1ZSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImluY3JlbWVudFJlbmRlcmluZ0NvdW50IiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgcmVuZGVyaW5nQ291bnQgPSBOdW1iZXIoX3RoaXMuZWxlbWVudC5nZXRBdHRyaWJ1dGUoUkVOREVSSU5HX0NPVU5UX0FUVFJJQlVURSkgfHwgMCk7CgogICAgICBfdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZShSRU5ERVJJTkdfQ09VTlRfQVRUUklCVVRFLCAiIi5jb25jYXQocmVuZGVyaW5nQ291bnQgKyAxKSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgIm9uUmVuZGVyQ29tcGxldGVMaXN0ZW5lciIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMubGlzdGVuZXJzLmVtaXQoUkVOREVSX0NPTVBMRVRFX0VWRU5UKTsKCiAgICAgIF90aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKExPQURJTkdfQVRUUklCVVRFKTsKCiAgICAgIF90aGlzLmluY3JlbWVudFJlbmRlcmluZ0NvdW50KCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgIm9uVWlTdGF0ZUNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuZmV0Y2hBbmRSZW5kZXIoKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiZ2V0QWN0aXZlSW5zcGVjdG9yQWRhcHRlcnMiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBhZGFwdGVycyA9IHt9OwogICAgICB2YXIgdHlwZUFkYXB0ZXJzID0gX3RoaXMudmlzLnR5cGUuaW5zcGVjdG9yQWRhcHRlcnM7IC8vIEFkZCB0aGUgcmVxdWVzdHMgaW5zcGVjdG9yIGFkYXB0ZXJzIGlmIHRoZSB2aXMgdHlwZSBleHBsaWNpdGx5IHJlcXVlc3RlZCBpdCB2aWEKICAgICAgLy8gaW5zcGVjdG9yQWRhcHRlcnMucmVxdWVzdHM6IHRydWUgaW4gaXRzIGRlZmluaXRpb24gb3IgaWYgaXQncyB1c2luZyB0aGUgY291cmllcgogICAgICAvLyByZXF1ZXN0IGhhbmRsZXIsIHNpbmNlIHRoYXQgd2lsbCBhdXRvbWF0aWNhbGx5IGxvZyBpdHMgcmVxdWVzdHMuCgogICAgICBpZiAodHlwZUFkYXB0ZXJzICYmIHR5cGVBZGFwdGVycy5yZXF1ZXN0cyB8fCBfdGhpcy52aXMudHlwZS5yZXF1ZXN0SGFuZGxlciA9PT0gJ2NvdXJpZXInKSB7CiAgICAgICAgYWRhcHRlcnMucmVxdWVzdHMgPSBuZXcgX2FkYXB0ZXJzLlJlcXVlc3RBZGFwdGVyKCk7CiAgICAgIH0gLy8gQWRkIHRoZSBkYXRhIGluc3BlY3RvciBhZGFwdGVyIGlmIHRoZSB2aXMgdHlwZSByZXF1ZXN0ZWQgaXQgb3IgaWYgdGhlCiAgICAgIC8vIHZpcyBpcyB1c2luZyBjb3VyaWVyLCBzaW5jZSB3ZSBrbm93IHRoYXQgY291cmllciBzdXBwb3J0cyBsb2dnaW5nCiAgICAgIC8vIGl0cyBkYXRhLgoKCiAgICAgIGlmICh0eXBlQWRhcHRlcnMgJiYgdHlwZUFkYXB0ZXJzLmRhdGEgfHwgX3RoaXMudmlzLnR5cGUucmVxdWVzdEhhbmRsZXIgPT09ICdjb3VyaWVyJykgewogICAgICAgIGFkYXB0ZXJzLmRhdGEgPSBuZXcgX2FkYXB0ZXJzLkRhdGFBZGFwdGVyKCk7CiAgICAgIH0gLy8gQWRkIGFsbCBpbnNwZWN0b3JzLCB0aGF0IGFyZSBleHBsaWNpdGx5IHJlZ2lzdGVyZWQgd2l0aCB0aGlzIHZpcyB0eXBlCgoKICAgICAgaWYgKHR5cGVBZGFwdGVycyAmJiB0eXBlQWRhcHRlcnMuY3VzdG9tKSB7CiAgICAgICAgT2JqZWN0LmVudHJpZXModHlwZUFkYXB0ZXJzLmN1c3RvbSkuZm9yRWFjaChmdW5jdGlvbiAoX3JlZikgewogICAgICAgICAgdmFyIF9yZWYyID0gX3NsaWNlZFRvQXJyYXkoX3JlZiwgMiksCiAgICAgICAgICAgICAga2V5ID0gX3JlZjJbMF0sCiAgICAgICAgICAgICAgQWRhcHRlciA9IF9yZWYyWzFdOwoKICAgICAgICAgIGFkYXB0ZXJzW2tleV0gPSBuZXcgQWRhcHRlcigpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gYWRhcHRlcnM7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImZldGNoQW5kUmVuZGVyIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgZm9yY2VGZXRjaCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7CiAgICAgIF90aGlzLnNob3VsZEZvcmNlTmV4dEZldGNoID0gZm9yY2VGZXRjaCB8fCBfdGhpcy5zaG91bGRGb3JjZU5leHRGZXRjaDsKCiAgICAgIF90aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKExPQURJTkdfQVRUUklCVVRFLCAnJyk7CgogICAgICBfdGhpcy5kZWJvdW5jZWRGZXRjaEFuZFJlbmRlcigpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJoYW5kbGVWaXNVcGRhdGUiLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChfdGhpcy5hcHBTdGF0ZSkgewogICAgICAgIF90aGlzLmFwcFN0YXRlLnZpcyA9IF90aGlzLnZpcy5nZXRTdGF0ZSgpOwoKICAgICAgICBfdGhpcy5hcHBTdGF0ZS5zYXZlKCk7CiAgICAgIH0KCiAgICAgIF90aGlzLmZldGNoQW5kUmVuZGVyKCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKF90aGlzLmFib3J0Q29udHJvbGxlcikgX3RoaXMuYWJvcnRDb250cm9sbGVyLmFib3J0KCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImZldGNoIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgZm9yY2VGZXRjaCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7CgogICAgICBfdGhpcy5jYW5jZWwoKTsKCiAgICAgIF90aGlzLmFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgICAgX3RoaXMuZGF0YUxvYWRlclBhcmFtcy5hYm9ydFNpZ25hbCA9IF90aGlzLmFib3J0Q29udHJvbGxlci5zaWduYWw7CiAgICAgIF90aGlzLmRhdGFMb2FkZXJQYXJhbXMuYWdncyA9IF90aGlzLnZpcy5nZXRBZ2dDb25maWcoKTsKICAgICAgX3RoaXMuZGF0YUxvYWRlclBhcmFtcy5mb3JjZUZldGNoID0gZm9yY2VGZXRjaDsKICAgICAgX3RoaXMuZGF0YUxvYWRlclBhcmFtcy5pbnNwZWN0b3JBZGFwdGVycyA9IF90aGlzLmluc3BlY3RvckFkYXB0ZXJzOwogICAgICBfdGhpcy52aXMuZmlsdGVycyA9IHsKICAgICAgICB0aW1lUmFuZ2U6IF90aGlzLmRhdGFMb2FkZXJQYXJhbXMudGltZVJhbmdlCiAgICAgIH07CiAgICAgIF90aGlzLnZpcy5yZXF1ZXN0RXJyb3IgPSB1bmRlZmluZWQ7CiAgICAgIF90aGlzLnZpcy5zaG93UmVxdWVzdEVycm9yID0gZmFsc2U7CiAgICAgIHJldHVybiBfdGhpcy5kYXRhTG9hZGVyIC8vIERvbid0IHBhc3MgaW4gdGhpcy5kYXRhTG9hZGVyUGFyYW1zIGRpcmVjdGx5IGJlY2F1c2UgaXQgbWF5IGJlIG1vZGlmaWVkIGFzeW5jIGluIGFub3RoZXIKICAgICAgLy8gY2FsbCB0byBmZXRjaCBiZWZvcmUgdGhlIHByZXZpb3VzIG9uZSBoYXMgY29tcGxldGVkCiAgICAgIC5mZXRjaChfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy5kYXRhTG9hZGVyUGFyYW1zKSkudGhlbihmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIC8vIFBpcGVsaW5lIHJlc3BvbnNlcyBuZXZlciB0aHJvdyBlcnJvcnMsIHNvIHdlIG5lZWQgdG8gY2hlY2sgZm9yCiAgICAgICAgLy8gYHR5cGU6ICdlcnJvcidgLCBhbmQgdGhlbiB0aHJvdyBzbyBpdCBjYW4gYmUgY2F1Z2h0IGJlbG93LgogICAgICAgIC8vIFRPRE86IFdlIHNob3VsZCByZXZpc2l0IHRoaXMgYWZ0ZXIgd2UgaGF2ZSBmdWxseSBtaWdyYXRlZAogICAgICAgIC8vIHRvIHRoZSBuZXcgZXhwcmVzc2lvbiBwaXBlbGluZSBpbmZyYXN0cnVjdHVyZS4KICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLnR5cGUgPT09ICdlcnJvcicpIHsKICAgICAgICAgIHRocm93IGRhdGEuZXJyb3I7CiAgICAgICAgfQoKICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLnZhbHVlKSB7CiAgICAgICAgICBfdGhpcy5kYXRhU3ViamVjdC5uZXh0KGRhdGEudmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgIH0pLmNhdGNoKF90aGlzLmhhbmRsZURhdGFMb2FkZXJFcnJvcik7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImhhbmRsZURhdGFMb2FkZXJFcnJvciIsIGZ1bmN0aW9uIChlcnJvcikgewogICAgICAvLyBJZiB0aGUgZGF0YSBsb2FkZXIgd2FzIGFib3J0ZWQgdGhlbiBubyBuZWVkIHRvIHN1cmZhY2UgdGhpcyBlcnJvciBpbiB0aGUgVUkKICAgICAgaWYgKGVycm9yICYmIGVycm9yLm5hbWUgPT09ICdBYm9ydEVycm9yJykgcmV0dXJuOyAvLyBUT0RPOiBjb21lIHVwIHdpdGggYSBnZW5lcmFsIHdheSB0byBjYW5jZWwgZXhlY3V0aW9uIG9mIHBpcGVsaW5lIGV4cHJlc3Npb25zLgoKICAgICAgaWYgKF90aGlzLmRhdGFMb2FkZXJQYXJhbXMuc2VhcmNoU291cmNlICYmIF90aGlzLmRhdGFMb2FkZXJQYXJhbXMuc2VhcmNoU291cmNlLmNhbmNlbFF1ZXVlZCkgewogICAgICAgIF90aGlzLmRhdGFMb2FkZXJQYXJhbXMuc2VhcmNoU291cmNlLmNhbmNlbFF1ZXVlZCgpOwogICAgICB9CgogICAgICBfdGhpcy52aXMucmVxdWVzdEVycm9yID0gZXJyb3I7CiAgICAgIF90aGlzLnZpcy5zaG93UmVxdWVzdEVycm9yID0gZXJyb3IudHlwZSAmJiBbJ05PX09QX1NFQVJDSF9TVFJBVEVHWScsICdVTlNVUFBPUlRFRF9RVUVSWSddLmluY2x1ZGVzKGVycm9yLnR5cGUpOwoKICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkRGFuZ2VyKHsKICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS52aXN1YWxpemUuZGF0YUxvYWRlckVycm9yJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdFcnJvciBpbiB2aXN1YWxpemF0aW9uJwogICAgICAgIH0pLAogICAgICAgIHRleHQ6IGVycm9yLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInJlbmRlcmVyUHJvdmlkZXIiLCBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgdmFyIHJlbmRlcmVyID0gbnVsbDsKICAgICAgdmFyIGFyZ3MgPSBbXTsKCiAgICAgIGlmIChfdGhpcy5waXBlbGluZURhdGFMb2FkZXIpIHsKICAgICAgICByZW5kZXJlciA9IF9yZWdpc3RyaWVzLnJlZ2lzdHJpZXMucmVuZGVyZXJzLmdldCgoMCwgX2xvZGFzaC5nZXQpKHJlc3BvbnNlIHx8IHt9LCAnYXMnLCAndmlzdWFsaXphdGlvbicpKTsKICAgICAgICBhcmdzID0gW190aGlzLmVsZW1lbnQsICgwLCBfbG9kYXNoLmdldCkocmVzcG9uc2UsICd2YWx1ZScsIHsKICAgICAgICAgIHZpc1R5cGU6IF90aGlzLnZpcy50eXBlLm5hbWUKICAgICAgICB9KSwgX3RoaXMuaGFuZGxlcnNdOwogICAgICB9IGVsc2UgewogICAgICAgIHJlbmRlcmVyID0gX3Zpc3VhbGl6YXRpb25fbG9hZGVyLnZpc3VhbGl6YXRpb25Mb2FkZXI7CiAgICAgICAgYXJncyA9IFtfdGhpcy5lbGVtZW50LCBfdGhpcy52aXMsICgwLCBfbG9kYXNoLmdldCkocmVzcG9uc2UsICd2YWx1ZS52aXNEYXRhJywgbnVsbCksICgwLCBfbG9kYXNoLmdldCkocmVzcG9uc2UsICd2YWx1ZS52aXNDb25maWcnLCBfdGhpcy52aXMucGFyYW1zKSwgX3RoaXMudWlTdGF0ZSwgewogICAgICAgICAgbGlzdGVuT25DaGFuZ2U6IGZhbHNlCiAgICAgICAgfV07CiAgICAgIH0KCiAgICAgIGlmICghcmVuZGVyZXIpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX3JlbmRlcmVyOwoKICAgICAgICByZXR1cm4gKF9yZW5kZXJlciA9IHJlbmRlcmVyKS5yZW5kZXIuYXBwbHkoX3JlbmRlcmVyLCBfdG9Db25zdW1hYmxlQXJyYXkoYXJncykpOwogICAgICB9OwogICAgfSk7CgogICAgdmFyIHNlYXJjaFNvdXJjZSA9IHNhdmVkT2JqZWN0LnNlYXJjaFNvdXJjZSwKICAgICAgICB2aXMgPSBzYXZlZE9iamVjdC52aXM7CiAgICB2YXIgYXBwU3RhdGUgPSBwYXJhbXMuYXBwU3RhdGUsCiAgICAgICAgdWlTdGF0ZSA9IHBhcmFtcy51aVN0YXRlLAogICAgICAgIHF1ZXJ5RmlsdGVyID0gcGFyYW1zLnF1ZXJ5RmlsdGVyLAogICAgICAgIHRpbWVSYW5nZSA9IHBhcmFtcy50aW1lUmFuZ2UsCiAgICAgICAgZmlsdGVycyA9IHBhcmFtcy5maWx0ZXJzLAogICAgICAgIHF1ZXJ5ID0gcGFyYW1zLnF1ZXJ5LAogICAgICAgIF9wYXJhbXMkYXV0b0ZldGNoID0gcGFyYW1zLmF1dG9GZXRjaCwKICAgICAgICBhdXRvRmV0Y2ggPSBfcGFyYW1zJGF1dG9GZXRjaCA9PT0gdm9pZCAwID8gdHJ1ZSA6IF9wYXJhbXMkYXV0b0ZldGNoLAogICAgICAgIF9wYXJhbXMkcGlwZWxpbmVEYXRhTCA9IHBhcmFtcy5waXBlbGluZURhdGFMb2FkZXIsCiAgICAgICAgcGlwZWxpbmVEYXRhTG9hZGVyID0gX3BhcmFtcyRwaXBlbGluZURhdGFMID09PSB2b2lkIDAgPyBmYWxzZSA6IF9wYXJhbXMkcGlwZWxpbmVEYXRhTCwKICAgICAgICBQcml2YXRlID0gcGFyYW1zLlByaXZhdGU7CiAgICB0aGlzLmRhdGFMb2FkZXJQYXJhbXMgPSB7CiAgICAgIHNlYXJjaFNvdXJjZTogc2VhcmNoU291cmNlLAogICAgICB0aW1lUmFuZ2U6IHRpbWVSYW5nZSwKICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICBxdWVyeUZpbHRlcjogcXVlcnlGaWx0ZXIsCiAgICAgIGZpbHRlcnM6IGZpbHRlcnMsCiAgICAgIHVpU3RhdGU6IHVpU3RhdGUsCiAgICAgIGFnZ3M6IHZpcy5nZXRBZ2dDb25maWcoKSwKICAgICAgZm9yY2VGZXRjaDogZmFsc2UKICAgIH07CiAgICB0aGlzLnBpcGVsaW5lRGF0YUxvYWRlciA9IHBpcGVsaW5lRGF0YUxvYWRlcjsgLy8gTGlzdGVuIHRvIHRoZSBmaXJzdCBSRU5ERVJfQ09NUExFVEVfRVZFTlQgdG8gcmVzb2x2ZSB0aGlzIHByb21pc2UKCiAgICB0aGlzLmZpcnN0UmVuZGVyQ29tcGxldGUgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICBfdGhpcy5saXN0ZW5lcnMub25jZShSRU5ERVJfQ09NUExFVEVfRVZFTlQsIHJlc29sdmUpOwogICAgfSk7CiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZShMT0FESU5HX0FUVFJJQlVURSwgJycpOwogICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoREFUQV9TSEFSRURfSVRFTSwgJycpOwogICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoUkVOREVSSU5HX0NPVU5UX0FUVFJJQlVURSwgJzAnKTsKICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncmVuZGVyQ29tcGxldGUnLCB0aGlzLm9uUmVuZGVyQ29tcGxldGVMaXN0ZW5lcik7CiAgICB0aGlzLmF1dG9GZXRjaCA9IGF1dG9GZXRjaDsKICAgIHRoaXMuYXBwU3RhdGUgPSBhcHBTdGF0ZTsKICAgIHRoaXMudmlzID0gdmlzOwoKICAgIGlmICh1aVN0YXRlKSB7CiAgICAgIHZpcy5fc2V0VWlTdGF0ZSh1aVN0YXRlKTsKICAgIH0KCiAgICB0aGlzLnVpU3RhdGUgPSB0aGlzLnZpcy5nZXRVaVN0YXRlKCk7CiAgICB0aGlzLmhhbmRsZXJzID0gewogICAgICB2aXM6IHRoaXMudmlzLAogICAgICB1aVN0YXRlOiB0aGlzLnVpU3RhdGUsCiAgICAgIG9uRGVzdHJveTogZnVuY3Rpb24gb25EZXN0cm95KGZuKSB7CiAgICAgICAgcmV0dXJuIF90aGlzLmhhbmRsZXJzLmRlc3Ryb3lGbiA9IGZuOwogICAgICB9CiAgICB9OwogICAgdGhpcy52aXMub24oJ3VwZGF0ZScsIHRoaXMuaGFuZGxlVmlzVXBkYXRlKTsKICAgIHRoaXMudmlzLm9uKCdyZWxvYWQnLCB0aGlzLnJlbG9hZCk7CiAgICB0aGlzLnVpU3RhdGUub24oJ2NoYW5nZScsIHRoaXMub25VaVN0YXRlQ2hhbmdlKTsKCiAgICBpZiAoYXV0b0ZldGNoKSB7CiAgICAgIHRoaXMuYXV0b1JlZnJlc2hGZXRjaFN1YnNjcmlwdGlvbiA9IF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIuZ2V0QXV0b1JlZnJlc2hGZXRjaCQoKS5zdWJzY3JpYmUodGhpcy5yZWxvYWQpOwogICAgfSAvLyBUaGlzIGlzIGEgaGFjayB0byBnaXZlIG1hcHMgdmlzdWFsaXphdGlvbnMgYWNjZXNzIHRvIGRhdGEgaW4gdGhlCiAgICAvLyBnbG9iYWxTdGF0ZSwgc2luY2UgdGhleSBjYW4gbm8gbG9uZ2VyIGFjY2VzcyBpdCB2aWEgc2VhcmNoU291cmNlLgogICAgLy8gVE9ETzogUmVtb3ZlIHRoaXMgYXMgYSBwYXJ0IG9mIGVsYXN0aWMva2liYW5hIzMwNTkzCgoKICAgIHRoaXMudmlzLkFQSS5nZXRHZW9oYXNoQm91bmRzID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gKDAsIF91dGlscy5xdWVyeUdlb2hhc2hCb3VuZHMpKF90aGlzLnZpcywgewogICAgICAgIGZpbHRlcnM6IF90aGlzLmRhdGFMb2FkZXJQYXJhbXMuZmlsdGVycywKICAgICAgICBxdWVyeTogX3RoaXMuZGF0YUxvYWRlclBhcmFtcy5xdWVyeQogICAgICB9KTsKICAgIH07CgogICAgdGhpcy5kYXRhTG9hZGVyID0gcGlwZWxpbmVEYXRhTG9hZGVyID8gbmV3IF9waXBlbGluZV9kYXRhX2xvYWRlci5QaXBlbGluZURhdGFMb2FkZXIodmlzKSA6IG5ldyBfdmlzdWFsaXplX2RhdGFfbG9hZGVyLlZpc3VhbGl6ZURhdGFMb2FkZXIodmlzLCBQcml2YXRlKTsKICAgIHZhciB2aXNGaWx0ZXJzID0gUHJpdmF0ZShfdmlzX2ZpbHRlcnMuVmlzRmlsdGVyc1Byb3ZpZGVyKTsKICAgIHRoaXMucmVuZGVyQ29tcGxldGVIZWxwZXIgPSBuZXcgX3JlbmRlcl9jb21wbGV0ZS5SZW5kZXJDb21wbGV0ZUhlbHBlcihlbGVtZW50KTsKICAgIHRoaXMuaW5zcGVjdG9yQWRhcHRlcnMgPSB0aGlzLmdldEFjdGl2ZUluc3BlY3RvckFkYXB0ZXJzKCk7CiAgICB0aGlzLnZpcy5vcGVuSW5zcGVjdG9yID0gdGhpcy5vcGVuSW5zcGVjdG9yOwogICAgdGhpcy52aXMuaGFzSW5zcGVjdG9yID0gdGhpcy5oYXNJbnNwZWN0b3I7IC8vIGluaXQgZGVmYXVsdCBhY3Rpb25zCgogICAgKDAsIF9sb2Rhc2guZm9yRWFjaCkodGhpcy52aXMudHlwZS5ldmVudHMsIGZ1bmN0aW9uIChldmVudCwgZXZlbnROYW1lKSB7CiAgICAgIGlmIChldmVudC5kaXNhYmxlZCB8fCAhZXZlbnROYW1lKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgewogICAgICAgIF90aGlzLmFjdGlvbnNbZXZlbnROYW1lXSA9IGV2ZW50LmRlZmF1bHRBY3Rpb247CiAgICAgIH0KICAgIH0pOwogICAgdGhpcy5oYW5kbGVycy5ldmVudHNTdWJqZWN0ID0gbmV3IFJ4LlN1YmplY3QoKTsKICAgIHRoaXMudmlzLmV2ZW50c1N1YmplY3QgPSB0aGlzLmhhbmRsZXJzLmV2ZW50c1N1YmplY3Q7CiAgICB0aGlzLmV2ZW50cyQgPSB0aGlzLmhhbmRsZXJzLmV2ZW50c1N1YmplY3QuYXNPYnNlcnZhYmxlKCkucGlwZSgoMCwgX29wZXJhdG9ycy5zaGFyZSkoKSk7CiAgICB0aGlzLmV2ZW50cyQuc3Vic2NyaWJlKGZ1bmN0aW9uIChldmVudCkgewogICAgICBpZiAoX3RoaXMuYWN0aW9uc1tldmVudC5uYW1lXSkgewogICAgICAgIGV2ZW50LmRhdGEuYWdnQ29uZmlncyA9ICgwLCBfdXRpbGl0aWVzLmdldFRhYmxlQWdncykoX3RoaXMudmlzKTsKICAgICAgICB2YXIgbmV3RmlsdGVycyA9IF90aGlzLmFjdGlvbnNbZXZlbnQubmFtZV0oZXZlbnQuZGF0YSkgfHwgW107CiAgICAgICAgdmlzRmlsdGVycy5wdXNoRmlsdGVycyhuZXdGaWx0ZXJzKTsKICAgICAgfQogICAgfSk7CiAgICB0aGlzLmRhdGFTdWJqZWN0ID0gbmV3IFJ4LlN1YmplY3QoKTsKICAgIHRoaXMuZGF0YSQgPSB0aGlzLmRhdGFTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpLnBpcGUoKDAsIF9vcGVyYXRvcnMuc2hhcmUpKCkpOwogICAgdGhpcy5yZW5kZXIoKTsKICB9CiAgLyoqCiAgICogVXBkYXRlIHByb3BlcnRpZXMgb2YgdGhlIGVtYmVkZGVkIHZpc3VhbGl6YXRpb24uIFRoaXMgbWV0aG9kIGRvZXMgbm90IGFsbG93CiAgICogdXBkYXRpbmcgYWxsIGluaXRpYWwgcGFyYW1ldGVycywgYnV0IG9ubHkgYSBzdWJzZXQgb2YgdGhlIG9uZXMgYWxsb3dlZAogICAqIGluIHtAbGluayBWaXN1YWxpemVVcGRhdGVQYXJhbXN9LgogICAqCiAgICogQHBhcmFtIHBhcmFtcyBUaGUgcGFyYW1ldGVycyB0aGF0IHNob3VsZCBiZSB1cGRhdGVkLgogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKEVtYmVkZGVkVmlzdWFsaXplSGFuZGxlciwgW3sKICAgIGtleTogInVwZGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBwYXJhbXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OyAvLyBBcHBseSBkYXRhLSBhdHRyaWJ1dGVzIHRvIHRoZSBlbGVtZW50IGlmIHNwZWNpZmllZAoKICAgICAgdmFyIGRhdGFBdHRycyA9IHBhcmFtcy5kYXRhQXR0cnM7CgogICAgICBpZiAoZGF0YUF0dHJzKSB7CiAgICAgICAgT2JqZWN0LmtleXMoZGF0YUF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIGlmIChkYXRhQXR0cnNba2V5XSA9PT0gbnVsbCkgewogICAgICAgICAgICBfdGhpczIuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtIi5jb25jYXQoa2V5KSk7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMyLmVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLSIuY29uY2F0KGtleSksIGRhdGFBdHRyc1trZXldKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIGZldGNoUmVxdWlyZWQgPSBmYWxzZTsKCiAgICAgIGlmIChwYXJhbXMuaGFzT3duUHJvcGVydHkoJ3RpbWVSYW5nZScpICYmICEoMCwgX2xvZGFzaC5pc0VxdWFsKSh0aGlzLmRhdGFMb2FkZXJQYXJhbXMudGltZVJhbmdlLCBwYXJhbXMudGltZVJhbmdlKSkgewogICAgICAgIGZldGNoUmVxdWlyZWQgPSB0cnVlOwogICAgICAgIHRoaXMuZGF0YUxvYWRlclBhcmFtcy50aW1lUmFuZ2UgPSBwYXJhbXMudGltZVJhbmdlOwogICAgICB9CgogICAgICBpZiAocGFyYW1zLmhhc093blByb3BlcnR5KCdmaWx0ZXJzJykgJiYgISgwLCBfcHVibGljLm9ubHlEaXNhYmxlZEZpbHRlcnNDaGFuZ2VkKSh0aGlzLmRhdGFMb2FkZXJQYXJhbXMuZmlsdGVycywgcGFyYW1zLmZpbHRlcnMpKSB7CiAgICAgICAgZmV0Y2hSZXF1aXJlZCA9IHRydWU7CiAgICAgICAgdGhpcy5kYXRhTG9hZGVyUGFyYW1zLmZpbHRlcnMgPSBwYXJhbXMuZmlsdGVyczsKICAgICAgfQoKICAgICAgaWYgKHBhcmFtcy5oYXNPd25Qcm9wZXJ0eSgncXVlcnknKSAmJiAhKDAsIF9sb2Rhc2guaXNFcXVhbCkodGhpcy5kYXRhTG9hZGVyUGFyYW1zLnF1ZXJ5LCBwYXJhbXMucXVlcnkpKSB7CiAgICAgICAgZmV0Y2hSZXF1aXJlZCA9IHRydWU7CiAgICAgICAgdGhpcy5kYXRhTG9hZGVyUGFyYW1zLnF1ZXJ5ID0gcGFyYW1zLnF1ZXJ5OwogICAgICB9CgogICAgICBpZiAoZmV0Y2hSZXF1aXJlZCkgewogICAgICAgIHRoaXMuZmV0Y2hBbmRSZW5kZXIoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEZXN0cm95IHRoZSB1bmRlcmx5aW5nIEFuZ3VsYXIgc2NvcGUgb2YgdGhlIHZpc3VhbGl6YXRpb24uIFRoaXMgc2hvdWxkIGJlCiAgICAgKiBjYWxsZWQgd2hlbmV2ZXIgeW91IHJlbW92ZSB0aGUgdmlzdWFsaXphdGlvbi4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICB0aGlzLmRlc3Ryb3llZCA9IHRydWU7CiAgICAgIHRoaXMuY2FuY2VsKCk7CiAgICAgIHRoaXMuZGVib3VuY2VkRmV0Y2hBbmRSZW5kZXIuY2FuY2VsKCk7CgogICAgICBpZiAodGhpcy5hdXRvRmV0Y2gpIHsKICAgICAgICBpZiAodGhpcy5hdXRvUmVmcmVzaEZldGNoU3Vic2NyaXB0aW9uKSB0aGlzLmF1dG9SZWZyZXNoRmV0Y2hTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTsKICAgICAgfQoKICAgICAgdGhpcy52aXMucmVtb3ZlTGlzdGVuZXIoJ3JlbG9hZCcsIHRoaXMucmVsb2FkKTsKICAgICAgdGhpcy52aXMucmVtb3ZlTGlzdGVuZXIoJ3VwZGF0ZScsIHRoaXMuaGFuZGxlVmlzVXBkYXRlKTsKICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbmRlckNvbXBsZXRlJywgdGhpcy5vblJlbmRlckNvbXBsZXRlTGlzdGVuZXIpOwogICAgICB0aGlzLnVpU3RhdGUub2ZmKCdjaGFuZ2UnLCB0aGlzLm9uVWlTdGF0ZUNoYW5nZSk7CgogICAgICBfdmlzdWFsaXphdGlvbl9sb2FkZXIudmlzdWFsaXphdGlvbkxvYWRlci5kZXN0cm95KHRoaXMuZWxlbWVudCk7CgogICAgICB0aGlzLnJlbmRlckNvbXBsZXRlSGVscGVyLmRlc3Ryb3koKTsKCiAgICAgIGlmICh0aGlzLmhhbmRsZXJzLmRlc3Ryb3lGbikgewogICAgICAgIHRoaXMuaGFuZGxlcnMuZGVzdHJveUZuKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBhY3R1YWwgRE9NIGVsZW1lbnQgKHdyYXBwZWQgaW4galF1ZXJ5KSBvZiB0aGUgcmVuZGVyZWQgdmlzdWFsaXphdGlvbi4KICAgICAqIFRoaXMgaXMgZXNwZWNpYWxseSB1c2VmdWwgaWYgeW91IHVzZWQgYGFwcGVuZDogdHJ1ZWAgaW4gdGhlIHBhcmFtZXRlcnMgd2hlcmUKICAgICAqIHRoZSB2aXN1YWxpemF0aW9uIHdpbGwgYmUgYXBwZW5kZWQgdG8gdGhlIHNwZWNpZmllZCBjb250YWluZXIuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RWxlbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RWxlbWVudCgpIHsKICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDsKICAgIH0KICAgIC8qKgogICAgICogcmVuZGVycyB2aXN1YWxpemF0aW9uIHdpdGggcHJvdmlkZWQgZGF0YQogICAgICogQHBhcmFtIHJlc3BvbnNlOiB2aXN1YWxpemF0aW9uIGRhdGEKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ3aGVuRmlyc3RSZW5kZXJDb21wbGV0ZSIsCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZSwgdGhhdCB3aWxsIHJlc29sdmUgKHdpdGhvdXQgYSB2YWx1ZSkgb25jZSB0aGUgZmlyc3QgcmVuZGVyaW5nIG9mCiAgICAgKiB0aGUgdmlzdWFsaXphdGlvbiBoYXMgZmluaXNoZWQuIElmIHlvdSB3YW50IHRvIGxpc3RlbiB0byBjb25zZWN1dGl2ZSByZW5kZXJpbmcKICAgICAqIGV2ZW50cywgbG9vayBpbnRvIHRoZSBgYWRkUmVuZGVyQ29tcGxldGVMaXN0ZW5lcmAgbWV0aG9kLgogICAgICoKICAgICAqIEByZXR1cm5zIFByb21pc2UsIHRoYXQgcmVzb2x2ZXMgYXMgc29vbiBhcyB0aGUgdmlzdWFsaXphdGlvbiBpcyBkb25lIHJlbmRlcmluZwogICAgICogICAgZm9yIHRoZSBmaXJzdCB0aW1lLgogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gd2hlbkZpcnN0UmVuZGVyQ29tcGxldGUoKSB7CiAgICAgIHJldHVybiB0aGlzLmZpcnN0UmVuZGVyQ29tcGxldGU7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBsaXN0ZW5lciB0byBiZSBjYWxsZWQgd2hlbmV2ZXIgdGhlIHZpc3VhbGl6YXRpb24gZmluaXNoZWQgcmVuZGVyaW5nLgogICAgICogVGhpcyBjYW4gYmUgY2FsbGVkIG11bHRpcGxlIHRpbWVzLCB3aGVuIHRoZSB2aXN1YWxpemF0aW9uIHJlcmVuZGVycywgZS5nLiBkdWUKICAgICAqIHRvIG5ldyBkYXRhLgogICAgICoKICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGxpc3RlbmVyIFRoZSBsaXN0ZW5lciB0byBiZSBub3RpZmllZCBhYm91dCBjb21wbGV0ZSByZW5kZXJzLgogICAgICovCgogIH0sIHsKICAgIGtleTogImFkZFJlbmRlckNvbXBsZXRlTGlzdGVuZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZFJlbmRlckNvbXBsZXRlTGlzdGVuZXIobGlzdGVuZXIpIHsKICAgICAgdGhpcy5saXN0ZW5lcnMuYWRkTGlzdGVuZXIoUkVOREVSX0NPTVBMRVRFX0VWRU5ULCBsaXN0ZW5lcik7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBwcmV2aW91c2x5IHJlZ2lzdGVyZWQgcmVuZGVyIGNvbXBsZXRlIGxpc3RlbmVyIGZyb20gdGhpcyBoYW5kbGVyLgogICAgICogVGhpcyBsaXN0ZW5lciB3aWxsIG5vIGxvbmdlciBiZSBjYWxsZWQgd2hlbiB0aGUgdmlzdWFsaXphdGlvbiBmaW5pc2hlZCByZW5kZXJpbmcuCiAgICAgKgogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gbGlzdGVuZXIgVGhlIGxpc3RlbmVyIHRvIHJlbW92ZSBmcm9tIHRoaXMgaGFuZGxlci4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmVSZW5kZXJDb21wbGV0ZUxpc3RlbmVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVSZW5kZXJDb21wbGV0ZUxpc3RlbmVyKGxpc3RlbmVyKSB7CiAgICAgIHRoaXMubGlzdGVuZXJzLnJlbW92ZUxpc3RlbmVyKFJFTkRFUl9DT01QTEVURV9FVkVOVCwgbGlzdGVuZXIpOwogICAgfQogICAgLyoqCiAgICAgKiBGb3JjZSB0aGUgZmV0Y2ggb2YgbmV3IGRhdGEgYW5kIHJlbmRlcnMgdGhlIGNoYXJ0IGFnYWluLgogICAgICovCgogIH1dKTsKCiAgcmV0dXJuIEVtYmVkZGVkVmlzdWFsaXplSGFuZGxlcjsKfSgpOwoKZXhwb3J0cy5FbWJlZGRlZFZpc3VhbGl6ZUhhbmRsZXIgPSBFbWJlZGRlZFZpc3VhbGl6ZUhhbmRsZXI7"},null]}