{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/data/public/query/query_bar/components/query_bar_input.js","dependencies":[{"path":"src/legacy/core_plugins/data/public/query/query_bar/components/query_bar_input.js","mtime":1572296409484},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuUXVlcnlCYXJJbnB1dCA9IGV4cG9ydHMuUXVlcnlCYXJJbnB1dFVJID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfcmVhY3QyID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX2F1dG9jb21wbGV0ZV9wcm92aWRlcnMgPSByZXF1aXJlKCJ1aS9hdXRvY29tcGxldGVfcHJvdmlkZXJzIik7Cgp2YXIgX2xvZGFzaCA9IHJlcXVpcmUoImxvZGFzaCIpOwoKdmFyIF9rZmV0Y2ggPSByZXF1aXJlKCJ1aS9rZmV0Y2giKTsKCnZhciBfbGliID0gcmVxdWlyZSgiLi4vbGliIik7Cgp2YXIgX2xhbmd1YWdlX3N3aXRjaGVyID0gcmVxdWlyZSgiLi9sYW5ndWFnZV9zd2l0Y2hlciIpOwoKdmFyIF9zdWdnZXN0aW9uc19jb21wb25lbnQgPSByZXF1aXJlKCIuL3R5cGVhaGVhZC9zdWdnZXN0aW9uc19jb21wb25lbnQiKTsKCnZhciBfZ2V0X3F1ZXJ5X2xvZyA9IHJlcXVpcmUoIi4uL2xpYi9nZXRfcXVlcnlfbG9nIik7Cgp2YXIgX2ZldGNoX2luZGV4X3BhdHRlcm5zID0gcmVxdWlyZSgiLi4vbGliL2ZldGNoX2luZGV4X3BhdHRlcm5zIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsKICBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7CiAgICByZXR1cm4gb2JqOwogIH0gZWxzZSB7CiAgICB2YXIgbmV3T2JqID0ge307CgogICAgaWYgKG9iaiAhPSBudWxsKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgewogICAgICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307CgogICAgICAgICAgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdPYmpba2V5XSA9IG9ialtrZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIG5ld09iai5kZWZhdWx0ID0gb2JqOwogICAgcmV0dXJuIG5ld09iajsKICB9Cn0KCmZ1bmN0aW9uIF9leHRlbmRzKCkgewogIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOwoKICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7CiAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiB0YXJnZXQ7CiAgfTsKCiAgcmV0dXJuIF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewogIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsKCiAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgIHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOwogICAgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgewogICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsKICAgIH0pOwogICAga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwogIH0KCiAgcmV0dXJuIGtleXM7Cn0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7CiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OwoKICAgIGlmIChpICUgMikgewogICAgICBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOwogICAgfSBlbHNlIHsKICAgICAgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICB9KTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgX3R5cGVvZjIoU3ltYm9sLml0ZXJhdG9yKSA9PT0gInN5bWJvbCIpIHsKICAgIF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogICAgICByZXR1cm4gX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfSBlbHNlIHsKICAgIF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogICAgICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9CgogIHJldHVybiBfdHlwZW9mKG9iaik7Cn0KCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsKICByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7CiAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7CiAgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBhcnIyW2ldID0gYXJyW2ldOwogICAgfQoKICAgIHJldHVybiBhcnIyOwogIH0KfQoKZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgewogIHRyeSB7CiAgICB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7CiAgICB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICByZWplY3QoZXJyb3IpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKGluZm8uZG9uZSkgewogICAgcmVzb2x2ZSh2YWx1ZSk7CiAgfSBlbHNlIHsKICAgIFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsKICB9Cn0KCmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOwoKICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBfdGhyb3coZXJyKSB7CiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOwogICAgICB9CgogICAgICBfbmV4dCh1bmRlZmluZWQpOwogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICB9Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgfQp9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogIHJldHVybiBDb25zdHJ1Y3RvcjsKfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgewogIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgIHJldHVybiBjYWxsOwogIH0KCiAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7Cn0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICAgIHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7CiAgfTsKICByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOwp9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsKICBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7CiAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOwogIH0KCiAgcmV0dXJuIHNlbGY7Cn0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgewogIGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOwogIH0KCiAgc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7CiAgICBjb25zdHJ1Y3RvcjogewogICAgICB2YWx1ZTogc3ViQ2xhc3MsCiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUKICAgIH0KICB9KTsKICBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsKfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsKICBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsKICAgIG8uX19wcm90b19fID0gcDsKICAgIHJldHVybiBvOwogIH07CgogIHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9Cgp2YXIgS0VZX0NPREVTID0gewogIExFRlQ6IDM3LAogIFVQOiAzOCwKICBSSUdIVDogMzksCiAgRE9XTjogNDAsCiAgRU5URVI6IDEzLAogIEVTQzogMjcsCiAgVEFCOiA5LAogIEhPTUU6IDM2LAogIEVORDogMzUKfTsKdmFyIHJlY2VudFNlYXJjaFR5cGUgPSAncmVjZW50U2VhcmNoJzsKCnZhciBRdWVyeUJhcklucHV0VUkgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfQ29tcG9uZW50KSB7CiAgX2luaGVyaXRzKFF1ZXJ5QmFySW5wdXRVSSwgX0NvbXBvbmVudCk7CgogIGZ1bmN0aW9uIFF1ZXJ5QmFySW5wdXRVSSgpIHsKICAgIHZhciBfZ2V0UHJvdG90eXBlT2YyOwoKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUXVlcnlCYXJJbnB1dFVJKTsKCiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgYXJnc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgIH0KCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIChfZ2V0UHJvdG90eXBlT2YyID0gX2dldFByb3RvdHlwZU9mKFF1ZXJ5QmFySW5wdXRVSSkpLmNhbGwuYXBwbHkoX2dldFByb3RvdHlwZU9mMiwgW3RoaXNdLmNvbmNhdChhcmdzKSkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInN0YXRlIiwgewogICAgICBpc1N1Z2dlc3Rpb25zVmlzaWJsZTogZmFsc2UsCiAgICAgIGluZGV4OiBudWxsLAogICAgICBzdWdnZXN0aW9uczogW10sCiAgICAgIHN1Z2dlc3Rpb25MaW1pdDogNTAsCiAgICAgIHNlbGVjdGlvblN0YXJ0OiBudWxsLAogICAgICBzZWxlY3Rpb25FbmQ6IG51bGwsCiAgICAgIGluZGV4UGF0dGVybnM6IFtdCiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJpbnB1dFJlZiIsIG51bGwpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInBlcnNpc3RlZExvZyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiY29tcG9uZW50SXNVbm1vdW50aW5nIiwgZmFsc2UpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImdldFF1ZXJ5U3RyaW5nIiwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gKDAsIF9saWIudG9Vc2VyKShfdGhpcy5wcm9wcy5xdWVyeS5xdWVyeSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJmZXRjaEluZGV4UGF0dGVybnMiLAogICAgLyojX19QVVJFX18qLwogICAgX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAvKiNfX1BVUkVfXyovCiAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICB2YXIgc3RyaW5nUGF0dGVybnMsIG9iamVjdFBhdHRlcm5zLCBvYmplY3RQYXR0ZXJuc0Zyb21TdHJpbmdzOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgc3RyaW5nUGF0dGVybnMgPSBfdGhpcy5wcm9wcy5pbmRleFBhdHRlcm5zLmZpbHRlcihmdW5jdGlvbiAoaW5kZXhQYXR0ZXJuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIGluZGV4UGF0dGVybiA9PT0gJ3N0cmluZyc7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgb2JqZWN0UGF0dGVybnMgPSBfdGhpcy5wcm9wcy5pbmRleFBhdHRlcm5zLmZpbHRlcihmdW5jdGlvbiAoaW5kZXhQYXR0ZXJuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIGluZGV4UGF0dGVybiAhPT0gJ3N0cmluZyc7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgcmV0dXJuICgwLCBfZmV0Y2hfaW5kZXhfcGF0dGVybnMuZmV0Y2hJbmRleFBhdHRlcm5zKShfdGhpcy5wcm9wcy5zYXZlZE9iamVjdHNDbGllbnQsIHN0cmluZ1BhdHRlcm5zLCBfdGhpcy5wcm9wcy51aVNldHRpbmdzKTsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBvYmplY3RQYXR0ZXJuc0Zyb21TdHJpbmdzID0gX2NvbnRleHQuc2VudDsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuczogW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShvYmplY3RQYXR0ZXJucyksIF90b0NvbnN1bWFibGVBcnJheShvYmplY3RQYXR0ZXJuc0Zyb21TdHJpbmdzKSkKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImdldFN1Z2dlc3Rpb25zIiwKICAgIC8qI19fUFVSRV9fKi8KICAgIF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgIHZhciB1aVNldHRpbmdzLCBsYW5ndWFnZSwgcXVlcnlTdHJpbmcsIHJlY2VudFNlYXJjaFN1Z2dlc3Rpb25zLCBhdXRvY29tcGxldGVQcm92aWRlciwgaW5kZXhQYXR0ZXJucywgZ2V0QXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMsIF90aGlzJGlucHV0UmVmLCBzZWxlY3Rpb25TdGFydCwgc2VsZWN0aW9uRW5kLCBzdWdnZXN0aW9uczsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgaWYgKF90aGlzLmlucHV0UmVmKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICB1aVNldHRpbmdzID0gX3RoaXMucHJvcHMudWlTZXR0aW5nczsKICAgICAgICAgICAgICBsYW5ndWFnZSA9IF90aGlzLnByb3BzLnF1ZXJ5Lmxhbmd1YWdlOwogICAgICAgICAgICAgIHF1ZXJ5U3RyaW5nID0gX3RoaXMuZ2V0UXVlcnlTdHJpbmcoKTsKICAgICAgICAgICAgICByZWNlbnRTZWFyY2hTdWdnZXN0aW9ucyA9IF90aGlzLmdldFJlY2VudFNlYXJjaFN1Z2dlc3Rpb25zKHF1ZXJ5U3RyaW5nKTsKICAgICAgICAgICAgICBhdXRvY29tcGxldGVQcm92aWRlciA9ICgwLCBfYXV0b2NvbXBsZXRlX3Byb3ZpZGVycy5nZXRBdXRvY29tcGxldGVQcm92aWRlcikobGFuZ3VhZ2UpOwoKICAgICAgICAgICAgICBpZiAoISghYXV0b2NvbXBsZXRlUHJvdmlkZXIgfHwgIUFycmF5LmlzQXJyYXkoX3RoaXMuc3RhdGUuaW5kZXhQYXR0ZXJucykgfHwgKDAsIF9sb2Rhc2guY29tcGFjdCkoX3RoaXMuc3RhdGUuaW5kZXhQYXR0ZXJucykubGVuZ3RoID09PSAwKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA5OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgcmVjZW50U2VhcmNoU3VnZ2VzdGlvbnMpOwoKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIGluZGV4UGF0dGVybnMgPSBfdGhpcy5zdGF0ZS5pbmRleFBhdHRlcm5zOwogICAgICAgICAgICAgIGdldEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zID0gYXV0b2NvbXBsZXRlUHJvdmlkZXIoewogICAgICAgICAgICAgICAgY29uZmlnOiB1aVNldHRpbmdzLAogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuczogaW5kZXhQYXR0ZXJucwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIF90aGlzJGlucHV0UmVmID0gX3RoaXMuaW5wdXRSZWYsIHNlbGVjdGlvblN0YXJ0ID0gX3RoaXMkaW5wdXRSZWYuc2VsZWN0aW9uU3RhcnQsIHNlbGVjdGlvbkVuZCA9IF90aGlzJGlucHV0UmVmLnNlbGVjdGlvbkVuZDsKCiAgICAgICAgICAgICAgaWYgKCEoc2VsZWN0aW9uU3RhcnQgPT09IG51bGwgfHwgc2VsZWN0aW9uRW5kID09PSBudWxsKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE2OwogICAgICAgICAgICAgIHJldHVybiBnZXRBdXRvY29tcGxldGVTdWdnZXN0aW9ucyh7CiAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnlTdHJpbmcsCiAgICAgICAgICAgICAgICBzZWxlY3Rpb25TdGFydDogc2VsZWN0aW9uU3RhcnQsCiAgICAgICAgICAgICAgICBzZWxlY3Rpb25FbmQ6IHNlbGVjdGlvbkVuZAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICBzdWdnZXN0aW9ucyA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN1Z2dlc3Rpb25zKSwgX3RvQ29uc3VtYWJsZUFycmF5KHJlY2VudFNlYXJjaFN1Z2dlc3Rpb25zKSkpOwoKICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUyKTsKICAgIH0pKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZ2V0UmVjZW50U2VhcmNoU3VnZ2VzdGlvbnMiLCBmdW5jdGlvbiAocXVlcnkpIHsKICAgICAgaWYgKCFfdGhpcy5wZXJzaXN0ZWRMb2cpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KCiAgICAgIHZhciByZWNlbnRTZWFyY2hlcyA9IF90aGlzLnBlcnNpc3RlZExvZy5nZXQoKTsKCiAgICAgIHZhciBtYXRjaGluZ1JlY2VudFNlYXJjaGVzID0gcmVjZW50U2VhcmNoZXMuZmlsdGVyKGZ1bmN0aW9uIChyZWNlbnRRdWVyeSkgewogICAgICAgIHZhciByZWNlbnRRdWVyeVN0cmluZyA9IF90eXBlb2YocmVjZW50UXVlcnkpID09PSAnb2JqZWN0JyA/ICgwLCBfbGliLnRvVXNlcikocmVjZW50UXVlcnkpIDogcmVjZW50UXVlcnk7CiAgICAgICAgcmV0dXJuIHJlY2VudFF1ZXJ5U3RyaW5nLmluY2x1ZGVzKHF1ZXJ5KTsKICAgICAgfSk7CiAgICAgIHJldHVybiBtYXRjaGluZ1JlY2VudFNlYXJjaGVzLm1hcChmdW5jdGlvbiAocmVjZW50U2VhcmNoKSB7CiAgICAgICAgdmFyIHRleHQgPSAoMCwgX2xpYi50b1VzZXIpKHJlY2VudFNlYXJjaCk7CiAgICAgICAgdmFyIHN0YXJ0ID0gMDsKICAgICAgICB2YXIgZW5kID0gcXVlcnkubGVuZ3RoOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiByZWNlbnRTZWFyY2hUeXBlLAogICAgICAgICAgdGV4dDogdGV4dCwKICAgICAgICAgIHN0YXJ0OiBzdGFydCwKICAgICAgICAgIGVuZDogZW5kCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ1cGRhdGVTdWdnZXN0aW9ucyIsICgwLCBfbG9kYXNoLmRlYm91bmNlKSgKICAgIC8qI19fUFVSRV9fKi8KICAgIF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgIHZhciBzdWdnZXN0aW9uczsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmdldFN1Z2dlc3Rpb25zKCk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgX2NvbnRleHQzLnQwID0gX2NvbnRleHQzLnNlbnQ7CgogICAgICAgICAgICAgIGlmIChfY29udGV4dDMudDApIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQzLnQwID0gW107CgogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgc3VnZ2VzdGlvbnMgPSBfY29udGV4dDMudDA7CgogICAgICAgICAgICAgIGlmICghX3RoaXMuY29tcG9uZW50SXNVbm1vdW50aW5nKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb25zOiBzdWdnZXN0aW9ucwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTMpOwogICAgfSkpLCAxMDApKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblN1Ym1pdCIsIGZ1bmN0aW9uIChxdWVyeSkgewogICAgICBpZiAoX3RoaXMucHJvcHMub25TdWJtaXQpIHsKICAgICAgICBpZiAoX3RoaXMucGVyc2lzdGVkTG9nKSB7CiAgICAgICAgICBfdGhpcy5wZXJzaXN0ZWRMb2cuYWRkKHF1ZXJ5LnF1ZXJ5KTsKICAgICAgICB9CgogICAgICAgIF90aGlzLnByb3BzLm9uU3VibWl0KHsKICAgICAgICAgIHF1ZXJ5OiAoMCwgX2xpYi5mcm9tVXNlcikocXVlcnkucXVlcnkpLAogICAgICAgICAgbGFuZ3VhZ2U6IHF1ZXJ5Lmxhbmd1YWdlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQ2hhbmdlIiwgZnVuY3Rpb24gKHF1ZXJ5KSB7CiAgICAgIF90aGlzLnVwZGF0ZVN1Z2dlc3Rpb25zKCk7CgogICAgICBpZiAoX3RoaXMucHJvcHMub25DaGFuZ2UpIHsKICAgICAgICBfdGhpcy5wcm9wcy5vbkNoYW5nZSh7CiAgICAgICAgICBxdWVyeTogKDAsIF9saWIuZnJvbVVzZXIpKHF1ZXJ5LnF1ZXJ5KSwKICAgICAgICAgIGxhbmd1YWdlOiBxdWVyeS5sYW5ndWFnZQogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblF1ZXJ5U3RyaW5nQ2hhbmdlIiwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBpc1N1Z2dlc3Rpb25zVmlzaWJsZTogdHJ1ZSwKICAgICAgICBpbmRleDogbnVsbCwKICAgICAgICBzdWdnZXN0aW9uTGltaXQ6IDUwCiAgICAgIH0pOwoKICAgICAgX3RoaXMub25DaGFuZ2UoewogICAgICAgIHF1ZXJ5OiB2YWx1ZSwKICAgICAgICBsYW5ndWFnZTogX3RoaXMucHJvcHMucXVlcnkubGFuZ3VhZ2UKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbklucHV0Q2hhbmdlIiwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIF90aGlzLm9uUXVlcnlTdHJpbmdDaGFuZ2UoZXZlbnQudGFyZ2V0LnZhbHVlKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQ2xpY2tJbnB1dCIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBpZiAoZXZlbnQudGFyZ2V0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIF90aGlzLm9uUXVlcnlTdHJpbmdDaGFuZ2UoZXZlbnQudGFyZ2V0LnZhbHVlKTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25LZXlVcCIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBpZiAoW0tFWV9DT0RFUy5MRUZULCBLRVlfQ09ERVMuUklHSFQsIEtFWV9DT0RFUy5IT01FLCBLRVlfQ09ERVMuRU5EXS5pbmNsdWRlcyhldmVudC5rZXlDb2RlKSkgewogICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGlzU3VnZ2VzdGlvbnNWaXNpYmxlOiB0cnVlCiAgICAgICAgfSk7CgogICAgICAgIGlmIChldmVudC50YXJnZXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgICBfdGhpcy5vblF1ZXJ5U3RyaW5nQ2hhbmdlKGV2ZW50LnRhcmdldC52YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbktleURvd24iLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgaWYgKGV2ZW50LnRhcmdldCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICB2YXIgX3RoaXMkc3RhdGUgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgICAgaXNTdWdnZXN0aW9uc1Zpc2libGUgPSBfdGhpcyRzdGF0ZS5pc1N1Z2dlc3Rpb25zVmlzaWJsZSwKICAgICAgICAgICAgaW5kZXggPSBfdGhpcyRzdGF0ZS5pbmRleDsKICAgICAgICB2YXIgcHJldmVudERlZmF1bHQgPSBldmVudC5wcmV2ZW50RGVmYXVsdC5iaW5kKGV2ZW50KTsKICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0LAogICAgICAgICAgICBrZXkgPSBldmVudC5rZXksCiAgICAgICAgICAgIG1ldGFLZXkgPSBldmVudC5tZXRhS2V5OwogICAgICAgIHZhciB2YWx1ZSA9IHRhcmdldC52YWx1ZSwKICAgICAgICAgICAgc2VsZWN0aW9uU3RhcnQgPSB0YXJnZXQuc2VsZWN0aW9uU3RhcnQsCiAgICAgICAgICAgIHNlbGVjdGlvbkVuZCA9IHRhcmdldC5zZWxlY3Rpb25FbmQ7CgogICAgICAgIHZhciB1cGRhdGVRdWVyeSA9IGZ1bmN0aW9uIHVwZGF0ZVF1ZXJ5KHF1ZXJ5LCBuZXdTZWxlY3Rpb25TdGFydCwgbmV3U2VsZWN0aW9uRW5kKSB7CiAgICAgICAgICBfdGhpcy5vblF1ZXJ5U3RyaW5nQ2hhbmdlKHF1ZXJ5KTsKCiAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgIHNlbGVjdGlvblN0YXJ0OiBuZXdTZWxlY3Rpb25TdGFydCwKICAgICAgICAgICAgc2VsZWN0aW9uRW5kOiBuZXdTZWxlY3Rpb25FbmQKICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkgewogICAgICAgICAgY2FzZSBLRVlfQ09ERVMuRE9XTjoKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgIGlmIChpc1N1Z2dlc3Rpb25zVmlzaWJsZSAmJiBpbmRleCAhPT0gbnVsbCkgewogICAgICAgICAgICAgIF90aGlzLmluY3JlbWVudEluZGV4KGluZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBpc1N1Z2dlc3Rpb25zVmlzaWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIGluZGV4OiAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgS0VZX0NPREVTLlVQOgogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgaWYgKGlzU3VnZ2VzdGlvbnNWaXNpYmxlICYmIGluZGV4ICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgX3RoaXMuZGVjcmVtZW50SW5kZXgoaW5kZXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIEtFWV9DT0RFUy5FTlRFUjoKICAgICAgICAgICAgaWYgKCFfdGhpcy5wcm9wcy5idWJibGVTdWJtaXRFdmVudCkgewogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc1N1Z2dlc3Rpb25zVmlzaWJsZSAmJiBpbmRleCAhPT0gbnVsbCAmJiBfdGhpcy5zdGF0ZS5zdWdnZXN0aW9uc1tpbmRleF0pIHsKICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICBfdGhpcy5zZWxlY3RTdWdnZXN0aW9uKF90aGlzLnN0YXRlLnN1Z2dlc3Rpb25zW2luZGV4XSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXMub25TdWJtaXQoX3RoaXMucHJvcHMucXVlcnkpOwoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBpc1N1Z2dlc3Rpb25zVmlzaWJsZTogZmFsc2UKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSBLRVlfQ09ERVMuRVNDOgogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgIGlzU3VnZ2VzdGlvbnNWaXNpYmxlOiBmYWxzZSwKICAgICAgICAgICAgICBpbmRleDogbnVsbAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgS0VZX0NPREVTLlRBQjoKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgIGlzU3VnZ2VzdGlvbnNWaXNpYmxlOiBmYWxzZSwKICAgICAgICAgICAgICBpbmRleDogbnVsbAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGlmIChzZWxlY3Rpb25TdGFydCAhPT0gbnVsbCAmJiBzZWxlY3Rpb25FbmQgIT09IG51bGwpIHsKICAgICAgICAgICAgICAoMCwgX2xpYi5tYXRjaFBhaXJzKSh7CiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICBzZWxlY3Rpb25TdGFydDogc2VsZWN0aW9uU3RhcnQsCiAgICAgICAgICAgICAgICBzZWxlY3Rpb25FbmQ6IHNlbGVjdGlvbkVuZCwKICAgICAgICAgICAgICAgIGtleToga2V5LAogICAgICAgICAgICAgICAgbWV0YUtleTogbWV0YUtleSwKICAgICAgICAgICAgICAgIHVwZGF0ZVF1ZXJ5OiB1cGRhdGVRdWVyeSwKICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0OiBwcmV2ZW50RGVmYXVsdAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNlbGVjdFN1Z2dlc3Rpb24iLCBmdW5jdGlvbiAoX3JlZjQpIHsKICAgICAgdmFyIHR5cGUgPSBfcmVmNC50eXBlLAogICAgICAgICAgdGV4dCA9IF9yZWY0LnRleHQsCiAgICAgICAgICBzdGFydCA9IF9yZWY0LnN0YXJ0LAogICAgICAgICAgZW5kID0gX3JlZjQuZW5kOwoKICAgICAgaWYgKCFfdGhpcy5pbnB1dFJlZikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHF1ZXJ5ID0gX3RoaXMuZ2V0UXVlcnlTdHJpbmcoKTsKCiAgICAgIHZhciBfdGhpcyRpbnB1dFJlZjIgPSBfdGhpcy5pbnB1dFJlZiwKICAgICAgICAgIHNlbGVjdGlvblN0YXJ0ID0gX3RoaXMkaW5wdXRSZWYyLnNlbGVjdGlvblN0YXJ0LAogICAgICAgICAgc2VsZWN0aW9uRW5kID0gX3RoaXMkaW5wdXRSZWYyLnNlbGVjdGlvbkVuZDsKCiAgICAgIGlmIChzZWxlY3Rpb25TdGFydCA9PT0gbnVsbCB8fCBzZWxlY3Rpb25FbmQgPT09IG51bGwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciB2YWx1ZSA9IHF1ZXJ5LnN1YnN0cigwLCBzZWxlY3Rpb25TdGFydCkgKyBxdWVyeS5zdWJzdHIoc2VsZWN0aW9uRW5kKTsKICAgICAgdmFyIG5ld1F1ZXJ5U3RyaW5nID0gdmFsdWUuc3Vic3RyKDAsIHN0YXJ0KSArIHRleHQgKyB2YWx1ZS5zdWJzdHIoZW5kKTsKCiAgICAgIF90aGlzLm9uUXVlcnlTdHJpbmdDaGFuZ2UobmV3UXVlcnlTdHJpbmcpOwoKICAgICAgaWYgKHR5cGUgPT09IHJlY2VudFNlYXJjaFR5cGUpIHsKICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBpc1N1Z2dlc3Rpb25zVmlzaWJsZTogZmFsc2UsCiAgICAgICAgICBpbmRleDogbnVsbAogICAgICAgIH0pOwoKICAgICAgICBfdGhpcy5vblN1Ym1pdCh7CiAgICAgICAgICBxdWVyeTogbmV3UXVlcnlTdHJpbmcsCiAgICAgICAgICBsYW5ndWFnZTogX3RoaXMucHJvcHMucXVlcnkubGFuZ3VhZ2UKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaW5jcmVhc2VMaW1pdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHN1Z2dlc3Rpb25MaW1pdDogX3RoaXMuc3RhdGUuc3VnZ2VzdGlvbkxpbWl0ICsgNTAKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJpbmNyZW1lbnRJbmRleCIsIGZ1bmN0aW9uIChjdXJyZW50SW5kZXgpIHsKICAgICAgdmFyIG5leHRJbmRleCA9IGN1cnJlbnRJbmRleCArIDE7CgogICAgICBpZiAoY3VycmVudEluZGV4ID09PSBudWxsIHx8IG5leHRJbmRleCA+PSBfdGhpcy5zdGF0ZS5zdWdnZXN0aW9ucy5sZW5ndGgpIHsKICAgICAgICBuZXh0SW5kZXggPSAwOwogICAgICB9CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaW5kZXg6IG5leHRJbmRleAogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImRlY3JlbWVudEluZGV4IiwgZnVuY3Rpb24gKGN1cnJlbnRJbmRleCkgewogICAgICB2YXIgcHJldmlvdXNJbmRleCA9IGN1cnJlbnRJbmRleCAtIDE7CgogICAgICBpZiAocHJldmlvdXNJbmRleCA8IDApIHsKICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBpbmRleDogX3RoaXMuc3RhdGUuc3VnZ2VzdGlvbnMubGVuZ3RoIC0gMQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGluZGV4OiBwcmV2aW91c0luZGV4CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uU2VsZWN0TGFuZ3VhZ2UiLCBmdW5jdGlvbiAobGFuZ3VhZ2UpIHsKICAgICAgLy8gU2VuZCB0ZWxlbWV0cnkgaW5mbyBldmVyeSB0aW1lIHRoZSB1c2VyIG9wdHMgaW4gb3Igb3V0IG9mIGt1ZXJ5CiAgICAgIC8vIEFzIGEgcmVzdWx0IGl0IGlzIGltcG9ydGFudCB0aGlzIGZ1bmN0aW9uIG9ubHkgZXZlciBnZXRzIGNhbGxlZCBpbiB0aGUKICAgICAgLy8gVUkgY29tcG9uZW50J3MgY2hhbmdlIGhhbmRsZXIuCiAgICAgICgwLCBfa2ZldGNoLmtmZXRjaCkoewogICAgICAgIHBhdGhuYW1lOiAnL2FwaS9raWJhbmEva3FsX29wdF9pbl90ZWxlbWV0cnknLAogICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgIG9wdF9pbjogbGFuZ3VhZ2UgPT09ICdrdWVyeScKICAgICAgICB9KQogICAgICB9KTsKCiAgICAgIF90aGlzLnByb3BzLnN0b3JlLnNldCgna2liYW5hLnVzZXJRdWVyeUxhbmd1YWdlJywgbGFuZ3VhZ2UpOwoKICAgICAgdmFyIG5ld1F1ZXJ5ID0gewogICAgICAgIHF1ZXJ5OiAnJywKICAgICAgICBsYW5ndWFnZTogbGFuZ3VhZ2UKICAgICAgfTsKCiAgICAgIF90aGlzLm9uQ2hhbmdlKG5ld1F1ZXJ5KTsKCiAgICAgIF90aGlzLm9uU3VibWl0KG5ld1F1ZXJ5KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uT3V0c2lkZUNsaWNrIiwgZnVuY3Rpb24gKCkgewogICAgICBpZiAoX3RoaXMuc3RhdGUuaXNTdWdnZXN0aW9uc1Zpc2libGUpIHsKICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBpc1N1Z2dlc3Rpb25zVmlzaWJsZTogZmFsc2UsCiAgICAgICAgICBpbmRleDogbnVsbAogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkNsaWNrU3VnZ2VzdGlvbiIsIGZ1bmN0aW9uIChzdWdnZXN0aW9uKSB7CiAgICAgIGlmICghX3RoaXMuaW5wdXRSZWYpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIF90aGlzLnNlbGVjdFN1Z2dlc3Rpb24oc3VnZ2VzdGlvbik7CgogICAgICBfdGhpcy5pbnB1dFJlZi5mb2N1cygpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25Nb3VzZUVudGVyU3VnZ2VzdGlvbiIsIGZ1bmN0aW9uIChpbmRleCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaW5kZXg6IGluZGV4CiAgICAgIH0pOwogICAgfSk7CgogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFF1ZXJ5QmFySW5wdXRVSSwgW3sKICAgIGtleTogImNvbXBvbmVudERpZE1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHsKICAgICAgdmFyIHBhcnNlZFF1ZXJ5ID0gKDAsIF9saWIuZnJvbVVzZXIpKCgwLCBfbGliLnRvVXNlcikodGhpcy5wcm9wcy5xdWVyeS5xdWVyeSkpOwoKICAgICAgaWYgKCEoMCwgX2xvZGFzaC5pc0VxdWFsKSh0aGlzLnByb3BzLnF1ZXJ5LnF1ZXJ5LCBwYXJzZWRRdWVyeSkpIHsKICAgICAgICB0aGlzLm9uQ2hhbmdlKF9vYmplY3RTcHJlYWQoe30sIHRoaXMucHJvcHMucXVlcnksIHsKICAgICAgICAgIHF1ZXJ5OiBwYXJzZWRRdWVyeQogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgdGhpcy5wZXJzaXN0ZWRMb2cgPSB0aGlzLnByb3BzLnBlcnNpc3RlZExvZyA/IHRoaXMucHJvcHMucGVyc2lzdGVkTG9nIDogKDAsIF9nZXRfcXVlcnlfbG9nLmdldFF1ZXJ5TG9nKSh0aGlzLnByb3BzLnVpU2V0dGluZ3MsIHRoaXMucHJvcHMuYXBwTmFtZSwgdGhpcy5wcm9wcy5xdWVyeS5sYW5ndWFnZSk7CiAgICAgIHRoaXMuZmV0Y2hJbmRleFBhdHRlcm5zKCkudGhlbih0aGlzLnVwZGF0ZVN1Z2dlc3Rpb25zKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb21wb25lbnREaWRVcGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHsKICAgICAgdmFyIHBhcnNlZFF1ZXJ5ID0gKDAsIF9saWIuZnJvbVVzZXIpKCgwLCBfbGliLnRvVXNlcikodGhpcy5wcm9wcy5xdWVyeS5xdWVyeSkpOwoKICAgICAgaWYgKCEoMCwgX2xvZGFzaC5pc0VxdWFsKSh0aGlzLnByb3BzLnF1ZXJ5LnF1ZXJ5LCBwYXJzZWRRdWVyeSkpIHsKICAgICAgICB0aGlzLm9uQ2hhbmdlKF9vYmplY3RTcHJlYWQoe30sIHRoaXMucHJvcHMucXVlcnksIHsKICAgICAgICAgIHF1ZXJ5OiBwYXJzZWRRdWVyeQogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgdGhpcy5wZXJzaXN0ZWRMb2cgPSB0aGlzLnByb3BzLnBlcnNpc3RlZExvZyA/IHRoaXMucHJvcHMucGVyc2lzdGVkTG9nIDogKDAsIF9nZXRfcXVlcnlfbG9nLmdldFF1ZXJ5TG9nKSh0aGlzLnByb3BzLnVpU2V0dGluZ3MsIHRoaXMucHJvcHMuYXBwTmFtZSwgdGhpcy5wcm9wcy5xdWVyeS5sYW5ndWFnZSk7CgogICAgICBpZiAoISgwLCBfbG9kYXNoLmlzRXF1YWwpKHByZXZQcm9wcy5pbmRleFBhdHRlcm5zLCB0aGlzLnByb3BzLmluZGV4UGF0dGVybnMpKSB7CiAgICAgICAgdGhpcy5mZXRjaEluZGV4UGF0dGVybnMoKS50aGVuKHRoaXMudXBkYXRlU3VnZ2VzdGlvbnMpOwogICAgICB9IGVsc2UgaWYgKCEoMCwgX2xvZGFzaC5pc0VxdWFsKShwcmV2UHJvcHMucXVlcnksIHRoaXMucHJvcHMucXVlcnkpKSB7CiAgICAgICAgdGhpcy51cGRhdGVTdWdnZXN0aW9ucygpOwogICAgICB9CgogICAgICBpZiAodGhpcy5zdGF0ZS5zZWxlY3Rpb25TdGFydCAhPT0gbnVsbCAmJiB0aGlzLnN0YXRlLnNlbGVjdGlvbkVuZCAhPT0gbnVsbCkgewogICAgICAgIGlmICh0aGlzLmlucHV0UmVmKSB7CiAgICAgICAgICAvLyBGb3Igc29tZSByZWFzb24gdGhlIHR5cGUgZ3VhcmQgYWJvdmUgZG9lcyBub3QgbWFrZSB0aGUgY29tcGlsZXIgaGFwcHkKICAgICAgICAgIC8vIEB0cy1pZ25vcmUKICAgICAgICAgIHRoaXMuaW5wdXRSZWYuc2V0U2VsZWN0aW9uUmFuZ2UodGhpcy5zdGF0ZS5zZWxlY3Rpb25TdGFydCwgdGhpcy5zdGF0ZS5zZWxlY3Rpb25FbmQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBzZWxlY3Rpb25TdGFydDogbnVsbCwKICAgICAgICAgIHNlbGVjdGlvbkVuZDogbnVsbAogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50V2lsbFVubW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkgewogICAgICB0aGlzLnVwZGF0ZVN1Z2dlc3Rpb25zLmNhbmNlbCgpOwogICAgICB0aGlzLmNvbXBvbmVudElzVW5tb3VudGluZyA9IHRydWU7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIHJlc3QgPSAoMCwgX2xvZGFzaC5vbWl0KSh0aGlzLnByb3BzLCBbJ2luZGV4UGF0dGVybnMnLCAnaW50bCcsICdxdWVyeScsICdhcHBOYW1lJywgJ2Rpc2FibGVBdXRvRm9jdXMnLCAnc2NyZWVuVGl0bGUnLCAncHJlcGVuZCcsICdzdG9yZScsICdwZXJzaXN0ZWRMb2cnLCAnYnViYmxlU3VibWl0RXZlbnQnLCAnbGFuZ3VhZ2VTd2l0Y2hlclBvcG92ZXJBbmNob3JQb3NpdGlvbicsICdvbkNoYW5nZScsICdvblN1Ym1pdCcsICd1aVNldHRpbmdzJywgJ3NhdmVkT2JqZWN0c0NsaWVudCddKTsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlPdXRzaWRlQ2xpY2tEZXRlY3RvciwgewogICAgICAgIG9uT3V0c2lkZUNsaWNrOiB0aGlzLm9uT3V0c2lkZUNsaWNrCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICBzdHlsZTogewogICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScKICAgICAgICB9LAogICAgICAgIHJvbGU6ICJjb21ib2JveCIsCiAgICAgICAgImFyaWEtaGFzcG9wdXAiOiAidHJ1ZSIsCiAgICAgICAgImFyaWEtZXhwYW5kZWQiOiB0aGlzLnN0YXRlLmlzU3VnZ2VzdGlvbnNWaXNpYmxlLAogICAgICAgICJhcmlhLW93bnMiOiAia2JuVHlwZWFoZWFkX19pdGVtcyIsCiAgICAgICAgImFyaWEtY29udHJvbHMiOiAia2JuVHlwZWFoZWFkX19pdGVtcyIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgIHJvbGU6ICJzZWFyY2giCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICBjbGFzc05hbWU6ICJrdWlMb2NhbFNlYXJjaEFzc2lzdGVkSW5wdXQiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGaWVsZFRleHQsIF9leHRlbmRzKHsKICAgICAgICBwbGFjZWhvbGRlcjogdGhpcy5wcm9wcy5pbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICdkYXRhLnF1ZXJ5LnF1ZXJ5QmFyLnNlYXJjaElucHV0UGxhY2Vob2xkZXInLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTZWFyY2gnCiAgICAgICAgfSksCiAgICAgICAgdmFsdWU6IHRoaXMuZ2V0UXVlcnlTdHJpbmcoKSwKICAgICAgICBvbktleURvd246IHRoaXMub25LZXlEb3duLAogICAgICAgIG9uS2V5VXA6IHRoaXMub25LZXlVcCwKICAgICAgICBvbkNoYW5nZTogdGhpcy5vbklucHV0Q2hhbmdlLAogICAgICAgIG9uQ2xpY2s6IHRoaXMub25DbGlja0lucHV0LAogICAgICAgIGZ1bGxXaWR0aDogdHJ1ZSwKICAgICAgICBhdXRvRm9jdXM6ICF0aGlzLnByb3BzLmRpc2FibGVBdXRvRm9jdXMsCiAgICAgICAgaW5wdXRSZWY6IGZ1bmN0aW9uIGlucHV0UmVmKG5vZGUpIHsKICAgICAgICAgIGlmIChub2RlKSB7CiAgICAgICAgICAgIF90aGlzMi5pbnB1dFJlZiA9IG5vZGU7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhdXRvQ29tcGxldGU6ICJvZmYiLAogICAgICAgIHNwZWxsQ2hlY2s6IGZhbHNlLAogICAgICAgICJhcmlhLWxhYmVsIjogdGhpcy5wcm9wcy5zY3JlZW5UaXRsZSA/IHRoaXMucHJvcHMuaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAnZGF0YS5xdWVyeS5xdWVyeUJhci5zZWFyY2hJbnB1dEFyaWFMYWJlbCcsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1lvdSBhcmUgb24gc2VhcmNoIGJveCBvZiB7cHJldmlvdXNseVRyYW5zbGF0ZWRQYWdlVGl0bGV9IHBhZ2UuIFN0YXJ0IHR5cGluZyB0byBzZWFyY2ggYW5kIGZpbHRlciB0aGUge3BhZ2VUeXBlfScKICAgICAgICB9LCB7CiAgICAgICAgICBwcmV2aW91c2x5VHJhbnNsYXRlZFBhZ2VUaXRsZTogdGhpcy5wcm9wcy5zY3JlZW5UaXRsZSwKICAgICAgICAgIHBhZ2VUeXBlOiB0aGlzLnByb3BzLmFwcE5hbWUKICAgICAgICB9KSA6IHVuZGVmaW5lZCwKICAgICAgICB0eXBlOiAidGV4dCIsCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInF1ZXJ5SW5wdXQiLAogICAgICAgICJhcmlhLWF1dG9jb21wbGV0ZSI6ICJsaXN0IiwKICAgICAgICAiYXJpYS1jb250cm9scyI6ICJrYm5UeXBlYWhlYWRfX2l0ZW1zIiwKICAgICAgICAiYXJpYS1hY3RpdmVkZXNjZW5kYW50IjogdGhpcy5zdGF0ZS5pc1N1Z2dlc3Rpb25zVmlzaWJsZSA/ICdzdWdnZXN0aW9uLScgKyB0aGlzLnN0YXRlLmluZGV4IDogJycsCiAgICAgICAgcm9sZTogInRleHRib3giLAogICAgICAgIHByZXBlbmQ6IHRoaXMucHJvcHMucHJlcGVuZCwKICAgICAgICBhcHBlbmQ6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2xhbmd1YWdlX3N3aXRjaGVyLlF1ZXJ5TGFuZ3VhZ2VTd2l0Y2hlciwgewogICAgICAgICAgbGFuZ3VhZ2U6IHRoaXMucHJvcHMucXVlcnkubGFuZ3VhZ2UsCiAgICAgICAgICBhbmNob3JQb3NpdGlvbjogdGhpcy5wcm9wcy5sYW5ndWFnZVN3aXRjaGVyUG9wb3ZlckFuY2hvclBvc2l0aW9uLAogICAgICAgICAgb25TZWxlY3RMYW5ndWFnZTogdGhpcy5vblNlbGVjdExhbmd1YWdlCiAgICAgICAgfSkKICAgICAgfSwgcmVzdCkpKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N1Z2dlc3Rpb25zX2NvbXBvbmVudC5TdWdnZXN0aW9uc0NvbXBvbmVudCwgewogICAgICAgIHNob3c6IHRoaXMuc3RhdGUuaXNTdWdnZXN0aW9uc1Zpc2libGUsCiAgICAgICAgc3VnZ2VzdGlvbnM6IHRoaXMuc3RhdGUuc3VnZ2VzdGlvbnMuc2xpY2UoMCwgdGhpcy5zdGF0ZS5zdWdnZXN0aW9uTGltaXQpLAogICAgICAgIGluZGV4OiB0aGlzLnN0YXRlLmluZGV4LAogICAgICAgIG9uQ2xpY2s6IHRoaXMub25DbGlja1N1Z2dlc3Rpb24sCiAgICAgICAgb25Nb3VzZUVudGVyOiB0aGlzLm9uTW91c2VFbnRlclN1Z2dlc3Rpb24sCiAgICAgICAgbG9hZE1vcmU6IHRoaXMuaW5jcmVhc2VMaW1pdAogICAgICB9KSkpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFF1ZXJ5QmFySW5wdXRVSTsKfShfcmVhY3QuQ29tcG9uZW50KTsKCmV4cG9ydHMuUXVlcnlCYXJJbnB1dFVJID0gUXVlcnlCYXJJbnB1dFVJOwp2YXIgUXVlcnlCYXJJbnB1dCA9ICgwLCBfcmVhY3QyLmluamVjdEkxOG4pKFF1ZXJ5QmFySW5wdXRVSSk7CmV4cG9ydHMuUXVlcnlCYXJJbnB1dCA9IFF1ZXJ5QmFySW5wdXQ7"},null]}