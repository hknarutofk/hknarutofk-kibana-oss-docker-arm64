{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/ui/public/vis/map/kibana_map.js","dependencies":[{"path":"src/legacy/ui/public/vis/map/kibana_map.js","mtime":1572296413240},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLktpYmFuYU1hcCA9IHZvaWQgMDsKCnZhciBfZXZlbnRzID0gcmVxdWlyZSgiZXZlbnRzIik7Cgp2YXIgX21hcF9tZXNzYWdlcyA9IHJlcXVpcmUoIi4vbWFwX21lc3NhZ2VzIik7Cgp2YXIgX2xlYWZsZXQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxlYWZsZXQiKSk7Cgp2YXIgX2pxdWVyeSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgianF1ZXJ5IikpOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfem9vbV90b19wcmVjaXNpb24gPSByZXF1aXJlKCIuLi8uLi91dGlscy96b29tX3RvX3ByZWNpc2lvbiIpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX29yaWdpbiA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2NvcmVfcGx1Z2lucy90aWxlX21hcC9jb21tb24vb3JpZ2luIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7IHRyeSB7IHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsgfSBjYXRjaCAoZXJyb3IpIHsgcmVqZWN0KGVycm9yKTsgcmV0dXJuOyB9IGlmIChpbmZvLmRvbmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0gZWxzZSB7IFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsgfSB9CgpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB2YXIgc2VsZiA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsgZnVuY3Rpb24gX25leHQodmFsdWUpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsgfSBmdW5jdGlvbiBfdGhyb3coZXJyKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsgfSBfbmV4dCh1bmRlZmluZWQpOyB9KTsgfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7IGlmIChzZWxmID09PSB2b2lkIDApIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CgpmdW5jdGlvbiBtYWtlRml0Q29udHJvbChmaXRDb250YWluZXIsIGtpYmFuYU1hcCkgewogIHZhciBGaXRDb250cm9sID0gX2xlYWZsZXQuZGVmYXVsdC5Db250cm9sLmV4dGVuZCh7CiAgICBvcHRpb25zOiB7CiAgICAgIHBvc2l0aW9uOiAndG9wbGVmdCcKICAgIH0sCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKGZpdENvbnRhaW5lciwga2liYW5hTWFwKSB7CiAgICAgIHRoaXMuX2ZpdENvbnRhaW5lciA9IGZpdENvbnRhaW5lcjsKICAgICAgdGhpcy5fa2liYW5hTWFwID0ga2liYW5hTWFwOwogICAgICB0aGlzLl9sZWFmbGV0TWFwID0gbnVsbDsKICAgIH0sCiAgICBvbkFkZDogZnVuY3Rpb24gb25BZGQobGVhZmxldE1hcCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdGhpcy5fbGVhZmxldE1hcCA9IGxlYWZsZXRNYXA7CgogICAgICB2YXIgZml0RGF0Qm91bmRzTGFiZWwgPSBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnY29tbW9uLnVpLnZpcy5raWJhbmFNYXAubGVhZmxldC5maXREYXRhQm91bmRzQXJpYUxhYmVsJywgewogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRml0IERhdGEgQm91bmRzJwogICAgICB9KTsKCiAgICAgICgwLCBfanF1ZXJ5LmRlZmF1bHQpKHRoaXMuX2ZpdENvbnRhaW5lcikuaHRtbCgiPGEgY2xhc3M9XCJrdWlJY29uIGZhLWNyb3BcIiBocmVmPVwiI1wiIHRpdGxlPVwiIi5jb25jYXQoZml0RGF0Qm91bmRzTGFiZWwsICJcIiBhcmlhLWxhYmVsPVwiIikuY29uY2F0KGZpdERhdEJvdW5kc0xhYmVsLCAiXCI+PC9hPiIpKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgX3RoaXMuX2tpYmFuYU1hcC5maXRUb0RhdGEoKTsKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzLl9maXRDb250YWluZXI7CiAgICB9LAogICAgb25SZW1vdmU6IGZ1bmN0aW9uIG9uUmVtb3ZlKCkgewogICAgICAoMCwgX2pxdWVyeS5kZWZhdWx0KSh0aGlzLl9maXRDb250YWluZXIpLm9mZignY2xpY2snKTsKICAgIH0KICB9KTsKCiAgcmV0dXJuIG5ldyBGaXRDb250cm9sKGZpdENvbnRhaW5lciwga2liYW5hTWFwKTsKfQoKZnVuY3Rpb24gbWFrZUxlZ2VuZENvbnRyb2woY29udGFpbmVyLCBraWJhbmFNYXAsIHBvc2l0aW9uKSB7CiAgdmFyIExlZ2VuZENvbnRyb2wgPSBfbGVhZmxldC5kZWZhdWx0LkNvbnRyb2wuZXh0ZW5kKHsKICAgIG9wdGlvbnM6IHsKICAgICAgcG9zaXRpb246ICd0b3ByaWdodCcKICAgIH0sCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKGNvbnRhaW5lciwga2liYW5hTWFwLCBwb3NpdGlvbikgewogICAgICB0aGlzLl9sZWdlbmRDb250YWluZXIgPSBjb250YWluZXI7CiAgICAgIHRoaXMuX2tpYmFuYU1hcCA9IGtpYmFuYU1hcDsKICAgICAgdGhpcy5vcHRpb25zLnBvc2l0aW9uID0gcG9zaXRpb247CiAgICB9LAogICAgdXBkYXRlQ29udGVudHM6IGZ1bmN0aW9uIHVwZGF0ZUNvbnRlbnRzKCkgewogICAgICB0aGlzLl9sZWdlbmRDb250YWluZXIuZW1wdHkoKTsKCiAgICAgIHZhciAkZGl2ID0gKDAsIF9qcXVlcnkuZGVmYXVsdCkoJzxkaXY+JykuYWRkQ2xhc3MoJ3Zpc01hcExlZ2VuZCcpOwoKICAgICAgdGhpcy5fbGVnZW5kQ29udGFpbmVyLmFwcGVuZCgkZGl2KTsKCiAgICAgIHZhciBsYXllcnMgPSB0aGlzLl9raWJhbmFNYXAuZ2V0TGF5ZXJzKCk7CgogICAgICBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAobGF5ZXIpIHsKICAgICAgICByZXR1cm4gbGF5ZXIuYXBwZW5kTGVnZW5kQ29udGVudHMoJGRpdik7CiAgICAgIH0pOwogICAgfSwKICAgIG9uQWRkOiBmdW5jdGlvbiBvbkFkZCgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLl9sYXllclVwZGF0ZUhhbmRsZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX3RoaXMyLnVwZGF0ZUNvbnRlbnRzKCk7CiAgICAgIH07CgogICAgICB0aGlzLl9raWJhbmFNYXAub24oJ2xheWVyczp1cGRhdGUnLCB0aGlzLl9sYXllclVwZGF0ZUhhbmRsZSk7CgogICAgICB0aGlzLnVwZGF0ZUNvbnRlbnRzKCk7CiAgICAgIHJldHVybiB0aGlzLl9sZWdlbmRDb250YWluZXIuZ2V0KDApOwogICAgfSwKICAgIG9uUmVtb3ZlOiBmdW5jdGlvbiBvblJlbW92ZSgpIHsKICAgICAgdGhpcy5fa2liYW5hTWFwLnJlbW92ZUxpc3RlbmVyKCdsYXllcnM6dXBkYXRlJywgdGhpcy5fbGF5ZXJVcGRhdGVIYW5kbGUpOwoKICAgICAgdGhpcy5fbGVnZW5kQ29udGFpbmVyLmVtcHR5KCk7CiAgICB9CiAgfSk7CgogIHJldHVybiBuZXcgTGVnZW5kQ29udHJvbChjb250YWluZXIsIGtpYmFuYU1hcCwgcG9zaXRpb24pOwp9Ci8qKgogKiBDb2xsZWN0cyBtYXAgZnVuY3Rpb25hbGl0eSByZXF1aXJlZCBmb3IgS2liYW5hLgogKiBTZXJ2ZXMgYXMgc2ltcGxlIGFic3RyYWN0aW9uIGZvciBsZWFmbGV0IGFzIHdlbGwuCiAqLwoKCnZhciBLaWJhbmFNYXAgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfRXZlbnRFbWl0dGVyKSB7CiAgX2luaGVyaXRzKEtpYmFuYU1hcCwgX0V2ZW50RW1pdHRlcik7CgogIGZ1bmN0aW9uIEtpYmFuYU1hcChjb250YWluZXJOb2RlLCBvcHRpb25zKSB7CiAgICB2YXIgX3RoaXMzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBLaWJhbmFNYXApOwoKICAgIF90aGlzMyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihLaWJhbmFNYXApLmNhbGwodGhpcykpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzMyksICJnZXRab29tTGV2ZWwiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfdGhpczMuX2xlYWZsZXRNYXAuZ2V0Wm9vbSgpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMzKSwgImdldE1heFpvb21MZXZlbCIsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF90aGlzMy5fbGVhZmxldE1hcC5nZXRNYXhab29tKCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpczMpLCAiX2FkZE1heFpvb21NZXNzYWdlIiwgZnVuY3Rpb24gKGxheWVyKSB7CiAgICAgIHZhciB6b29tV2FybmluZ01zZyA9ICgwLCBfbWFwX21lc3NhZ2VzLmNyZWF0ZVpvb21XYXJuaW5nTXNnKShfdGhpczMuZ2V0Wm9vbUxldmVsLCBfdGhpczMuZ2V0TWF4Wm9vbUxldmVsKTsKCiAgICAgIF90aGlzMy5fbGVhZmxldE1hcC5vbignem9vbWVuZCcsIHpvb21XYXJuaW5nTXNnKTsKCiAgICAgIF90aGlzMy5fY29udGFpbmVyTm9kZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGVzdC1zdWJqJywgJ3pvb21XYXJuaW5nRW5hYmxlZCcpOwoKICAgICAgbGF5ZXIub24oJ3JlbW92ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczMuX2xlYWZsZXRNYXAub2ZmKCd6b29tZW5kJywgem9vbVdhcm5pbmdNc2cpOwoKICAgICAgICBfdGhpczMuX2NvbnRhaW5lck5vZGUucmVtb3ZlQXR0cmlidXRlKCdkYXRhLXRlc3Qtc3ViaicpOwogICAgICB9KTsKICAgIH0pOwoKICAgIF90aGlzMy5fY29udGFpbmVyTm9kZSA9IGNvbnRhaW5lck5vZGU7CiAgICBfdGhpczMuX2xlYWZsZXRCYXNlTGF5ZXIgPSBudWxsOwogICAgX3RoaXMzLl9iYXNlTGF5ZXJTZXR0aW5ncyA9IG51bGw7CiAgICBfdGhpczMuX2Jhc2VMYXllcklzRGVzYXR1cmF0ZWQgPSB0cnVlOwogICAgX3RoaXMzLl9sZWFmbGV0RHJhd0NvbnRyb2wgPSBudWxsOwogICAgX3RoaXMzLl9sZWFmbGV0Rml0Q29udHJvbCA9IG51bGw7CiAgICBfdGhpczMuX2xlYWZsZXRMZWdlbmRDb250cm9sID0gbnVsbDsKICAgIF90aGlzMy5fbGVnZW5kUG9zaXRpb24gPSAndG9wcmlnaHQnOwogICAgX3RoaXMzLl9sYXllcnMgPSBbXTsKICAgIF90aGlzMy5fbGlzdGVuZXJzID0gW107CiAgICBfdGhpczMuX3Nob3dUb29sdGlwID0gZmFsc2U7CiAgICB2YXIgbGVhZmxldE9wdGlvbnMgPSB7CiAgICAgIG1pblpvb206IG9wdGlvbnMubWluWm9vbSwKICAgICAgbWF4Wm9vbTogb3B0aW9ucy5tYXhab29tLAogICAgICBjZW50ZXI6IG9wdGlvbnMuY2VudGVyID8gb3B0aW9ucy5jZW50ZXIgOiBbMCwgMF0sCiAgICAgIHpvb206IG9wdGlvbnMuem9vbSA/IG9wdGlvbnMuem9vbSA6IDIsCiAgICAgIHJlbmRlcmVyOiBfbGVhZmxldC5kZWZhdWx0LmNhbnZhcygpLAogICAgICB6b29tQW5pbWF0aW9uOiBmYWxzZSwKICAgICAgLy8gRGVzYXR1cmF0ZSBtYXAgdGlsZXMgY2F1c2VzIGFuaW1hdGlvbiByZW5kZXJpbmcgYXJ0aWZhY3RzCiAgICAgIHpvb21Db250cm9sOiBvcHRpb25zLnpvb21Db250cm9sID09PSB1bmRlZmluZWQgPyB0cnVlIDogb3B0aW9ucy56b29tQ29udHJvbAogICAgfTsKICAgIF90aGlzMy5fbGVhZmxldE1hcCA9IF9sZWFmbGV0LmRlZmF1bHQubWFwKGNvbnRhaW5lck5vZGUsIGxlYWZsZXRPcHRpb25zKTsKCiAgICBfdGhpczMuX2xlYWZsZXRNYXAuYXR0cmlidXRpb25Db250cm9sLnNldFByZWZpeCgnJyk7CgogICAgaWYgKCFvcHRpb25zLnNjcm9sbFdoZWVsWm9vbSkgewogICAgICBfdGhpczMuX2xlYWZsZXRNYXAuc2Nyb2xsV2hlZWxab29tLmRpc2FibGUoKTsKICAgIH0KCiAgICB2YXIgcHJldmlvdXNab29tID0gX3RoaXMzLl9sZWFmbGV0TWFwLmdldFpvb20oKTsKCiAgICBfdGhpczMuX2xlYWZsZXRNYXAub24oJ3pvb21lbmQnLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChwcmV2aW91c1pvb20gIT09IF90aGlzMy5fbGVhZmxldE1hcC5nZXRab29tKCkpIHsKICAgICAgICBwcmV2aW91c1pvb20gPSBfdGhpczMuX2xlYWZsZXRNYXAuZ2V0Wm9vbSgpOwoKICAgICAgICBfdGhpczMuZW1pdCgnem9vbWNoYW5nZScpOwogICAgICB9CiAgICB9KTsKCiAgICBfdGhpczMuX2xlYWZsZXRNYXAub24oJ3pvb21lbmQnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfdGhpczMuZW1pdCgnem9vbWVuZCcpOwogICAgfSk7CgogICAgX3RoaXMzLl9sZWFmbGV0TWFwLm9uKCdkcmFnZW5kJywgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gX3RoaXMzLmVtaXQoJ2RyYWdlbmQnKTsKICAgIH0pOwoKICAgIF90aGlzMy5fbGVhZmxldE1hcC5vbignem9vbWVuZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF90aGlzMy5fdXBkYXRlRXh0ZW50KCk7CiAgICB9KTsKCiAgICBfdGhpczMuX2xlYWZsZXRNYXAub24oJ2RyYWdlbmQnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfdGhpczMuX3VwZGF0ZUV4dGVudCgpOwogICAgfSk7CgogICAgX3RoaXMzLl9sZWFmbGV0TWFwLm9uKCdtb3VzZW1vdmUnLCBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gX3RoaXMzLl9sYXllcnMuZm9yRWFjaChmdW5jdGlvbiAobGF5ZXIpIHsKICAgICAgICByZXR1cm4gbGF5ZXIubW92ZVBvaW50ZXIoJ21vdXNlbW92ZScsIGUpOwogICAgICB9KTsKICAgIH0pOwoKICAgIF90aGlzMy5fbGVhZmxldE1hcC5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gX3RoaXMzLl9sYXllcnMuZm9yRWFjaChmdW5jdGlvbiAobGF5ZXIpIHsKICAgICAgICByZXR1cm4gbGF5ZXIubW92ZVBvaW50ZXIoJ21vdXNlb3V0JywgZSk7CiAgICAgIH0pOwogICAgfSk7CgogICAgX3RoaXMzLl9sZWFmbGV0TWFwLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gX3RoaXMzLl9sYXllcnMuZm9yRWFjaChmdW5jdGlvbiAobGF5ZXIpIHsKICAgICAgICByZXR1cm4gbGF5ZXIubW92ZVBvaW50ZXIoJ21vdXNlZG93bicsIGUpOwogICAgICB9KTsKICAgIH0pOwoKICAgIF90aGlzMy5fbGVhZmxldE1hcC5vbignbW91c2V1cCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiBfdGhpczMuX2xheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChsYXllcikgewogICAgICAgIHJldHVybiBsYXllci5tb3ZlUG9pbnRlcignbW91c2V1cCcsIGUpOwogICAgICB9KTsKICAgIH0pOwoKICAgIF90aGlzMy5fbGVhZmxldE1hcC5vbignZHJhdzpjcmVhdGVkJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIHZhciBkcmF3VHlwZSA9IGV2ZW50LmxheWVyVHlwZTsKCiAgICAgIGlmIChkcmF3VHlwZSA9PT0gJ3JlY3RhbmdsZScpIHsKICAgICAgICB2YXIgYm91bmRzID0gZXZlbnQubGF5ZXIuZ2V0Qm91bmRzKCk7CiAgICAgICAgdmFyIHNvdXRoRWFzdCA9IGJvdW5kcy5nZXRTb3V0aEVhc3QoKTsKICAgICAgICB2YXIgbm9ydGhXZXN0ID0gYm91bmRzLmdldE5vcnRoV2VzdCgpOwogICAgICAgIHZhciBzb3V0aEVhc3RMbmcgPSBzb3V0aEVhc3QubG5nOwoKICAgICAgICBpZiAoc291dGhFYXN0TG5nID4gMTgwKSB7CiAgICAgICAgICBzb3V0aEVhc3RMbmcgLT0gMzYwOwogICAgICAgIH0KCiAgICAgICAgdmFyIG5vcnRoV2VzdExuZyA9IG5vcnRoV2VzdC5sbmc7CgogICAgICAgIGlmIChub3J0aFdlc3RMbmcgPCAtMTgwKSB7CiAgICAgICAgICBub3J0aFdlc3RMbmcgKz0gMzYwOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNvdXRoRWFzdExhdCA9IHNvdXRoRWFzdC5sYXQ7CiAgICAgICAgdmFyIG5vcnRoV2VzdExhdCA9IG5vcnRoV2VzdC5sYXQ7IC8vQm91bmRzIGNhbm5vdCBiZSBjcmVhdGVkIHVubGVzcyB0aGV5IGZvcm0gYSBib3ggd2l0aCBsYXJnZXIgdGhhbiAwIGRpbWVuc2lvbnMKICAgICAgICAvL0ludmFsaWQgYXJlYXMgYXJlIHJlamVjdGVkIGJ5IEVTLgoKICAgICAgICBpZiAoc291dGhFYXN0TGF0ID09PSBub3J0aFdlc3RMYXQgfHwgc291dGhFYXN0TG5nID09PSBub3J0aFdlc3RMbmcpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF90aGlzMy5lbWl0KCdkcmF3Q3JlYXRlZDpyZWN0YW5nbGUnLCB7CiAgICAgICAgICBib3VuZHM6IHsKICAgICAgICAgICAgYm90dG9tX3JpZ2h0OiB7CiAgICAgICAgICAgICAgbGF0OiBzb3V0aEVhc3RMYXQsCiAgICAgICAgICAgICAgbG9uOiBzb3V0aEVhc3RMbmcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdG9wX2xlZnQ6IHsKICAgICAgICAgICAgICBsYXQ6IG5vcnRoV2VzdExhdCwKICAgICAgICAgICAgICBsb246IG5vcnRoV2VzdExuZwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAoZHJhd1R5cGUgPT09ICdwb2x5Z29uJykgewogICAgICAgIHZhciBsYXRMb25ncyA9IGV2ZW50LmxheWVyLmdldExhdExuZ3MoKVswXTsKCiAgICAgICAgX3RoaXMzLmVtaXQoJ2RyYXdDcmVhdGVkOnBvbHlnb24nLCB7CiAgICAgICAgICBwb2ludHM6IGxhdExvbmdzLm1hcChmdW5jdGlvbiAobGVhZmxldExhdExuZykgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGxhdDogbGVhZmxldExhdExuZy5sYXQsCiAgICAgICAgICAgICAgbG9uOiBsZWFmbGV0TGF0TG5nLmxuZwogICAgICAgICAgICB9OwogICAgICAgICAgfSkKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CgogICAgX3RoaXMzLnJlc2l6ZSgpOwoKICAgIHJldHVybiBfdGhpczM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoS2liYW5hTWFwLCBbewogICAga2V5OiAic2V0U2hvd1Rvb2x0aXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFNob3dUb29sdGlwKHNob3dUb29sdGlwKSB7CiAgICAgIHRoaXMuX3Nob3dUb29sdGlwID0gc2hvd1Rvb2x0aXA7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TGF5ZXJzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMYXllcnMoKSB7CiAgICAgIHJldHVybiB0aGlzLl9sYXllcnMuc2xpY2UoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJhZGRMYXllciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkTGF5ZXIoa2liYW5hTGF5ZXIpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB2YXIgb25zaG93VG9vbHRpcCA9IGZ1bmN0aW9uIG9uc2hvd1Rvb2x0aXAoZXZlbnQpIHsKICAgICAgICBpZiAoIV90aGlzNC5fc2hvd1Rvb2x0aXApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghX3RoaXM0Ll9wb3B1cCkgewogICAgICAgICAgX3RoaXM0Ll9wb3B1cCA9IF9sZWFmbGV0LmRlZmF1bHQucmVzcG9uc2l2ZVBvcHVwKHsKICAgICAgICAgICAgYXV0b1BhbjogZmFsc2UKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzNC5fcG9wdXAuc2V0TGF0TG5nKGV2ZW50LnBvc2l0aW9uKTsKCiAgICAgICAgICBfdGhpczQuX3BvcHVwLnNldENvbnRlbnQoZXZlbnQuY29udGVudCk7CgogICAgICAgICAgX3RoaXM0Ll9wb3B1cC5vcGVuT24oX3RoaXM0Ll9sZWFmbGV0TWFwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKCFfdGhpczQuX3BvcHVwLmdldExhdExuZygpLmVxdWFscyhldmVudC5wb3NpdGlvbikpIHsKICAgICAgICAgICAgX3RoaXM0Ll9wb3B1cC5zZXRMYXRMbmcoZXZlbnQucG9zaXRpb24pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChfdGhpczQuX3BvcHVwLmdldENvbnRlbnQoKSAhPT0gZXZlbnQuY29udGVudCkgewogICAgICAgICAgICBfdGhpczQuX3BvcHVwLnNldENvbnRlbnQoZXZlbnQuY29udGVudCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwoKICAgICAga2liYW5hTGF5ZXIub24oJ3Nob3dUb29sdGlwJywgb25zaG93VG9vbHRpcCk7CgogICAgICB0aGlzLl9saXN0ZW5lcnMucHVzaCh7CiAgICAgICAgbmFtZTogJ3Nob3dUb29sdGlwJywKICAgICAgICBoYW5kbGU6IG9uc2hvd1Rvb2x0aXAsCiAgICAgICAgbGF5ZXI6IGtpYmFuYUxheWVyCiAgICAgIH0pOwoKICAgICAgdmFyIG9uSGlkZVRvb2x0aXAgPSBmdW5jdGlvbiBvbkhpZGVUb29sdGlwKCkgewogICAgICAgIF90aGlzNC5fbGVhZmxldE1hcC5jbG9zZVBvcHVwKCk7CgogICAgICAgIF90aGlzNC5fcG9wdXAgPSBudWxsOwogICAgICB9OwoKICAgICAga2liYW5hTGF5ZXIub24oJ2hpZGVUb29sdGlwJywgb25IaWRlVG9vbHRpcCk7CgogICAgICB0aGlzLl9saXN0ZW5lcnMucHVzaCh7CiAgICAgICAgbmFtZTogJ2hpZGVUb29sdGlwJywKICAgICAgICBoYW5kbGU6IG9uSGlkZVRvb2x0aXAsCiAgICAgICAgbGF5ZXI6IGtpYmFuYUxheWVyCiAgICAgIH0pOwoKICAgICAgdmFyIG9uU3R5bGVDaGFuZ2VkID0gZnVuY3Rpb24gb25TdHlsZUNoYW5nZWQoKSB7CiAgICAgICAgaWYgKF90aGlzNC5fbGVhZmxldExlZ2VuZENvbnRyb2wpIHsKICAgICAgICAgIF90aGlzNC5fbGVhZmxldExlZ2VuZENvbnRyb2wudXBkYXRlQ29udGVudHMoKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBraWJhbmFMYXllci5vbignc3R5bGVDaGFuZ2VkJywgb25TdHlsZUNoYW5nZWQpOwoKICAgICAgdGhpcy5fbGlzdGVuZXJzLnB1c2goewogICAgICAgIG5hbWU6ICdzdHlsZUNoYW5nZWQnLAogICAgICAgIGhhbmRsZTogb25TdHlsZUNoYW5nZWQsCiAgICAgICAgbGF5ZXI6IGtpYmFuYUxheWVyCiAgICAgIH0pOwoKICAgICAgdGhpcy5fbGF5ZXJzLnB1c2goa2liYW5hTGF5ZXIpOwoKICAgICAga2liYW5hTGF5ZXIuYWRkVG9MZWFmbGV0TWFwKHRoaXMuX2xlYWZsZXRNYXApOwogICAgICB0aGlzLmVtaXQoJ2xheWVyczp1cGRhdGUnKTsKCiAgICAgIHRoaXMuX2FkZEF0dHJpYnV0aW9ucyhraWJhbmFMYXllci5nZXRBdHRyaWJ1dGlvbnMoKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVtb3ZlTGF5ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUxheWVyKGtpYmFuYUxheWVyKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgaWYgKCFraWJhbmFMYXllcikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5fcmVtb3ZlQXR0cmlidXRpb25zKGtpYmFuYUxheWVyLmdldEF0dHJpYnV0aW9ucygpKTsKCiAgICAgIHZhciBpbmRleCA9IHRoaXMuX2xheWVycy5pbmRleE9mKGtpYmFuYUxheWVyKTsKCiAgICAgIGlmIChpbmRleCA+PSAwKSB7CiAgICAgICAgdGhpcy5fbGF5ZXJzLnNwbGljZShpbmRleCwgMSk7CgogICAgICAgIGtpYmFuYUxheWVyLnJlbW92ZUZyb21MZWFmbGV0TWFwKHRoaXMuX2xlYWZsZXRNYXApOwogICAgICB9CgogICAgICB0aGlzLl9saXN0ZW5lcnMuZm9yRWFjaChmdW5jdGlvbiAobGlzdGVuZXIpIHsKICAgICAgICBpZiAobGlzdGVuZXIubGF5ZXIgPT09IGtpYmFuYUxheWVyKSB7CiAgICAgICAgICBsaXN0ZW5lci5sYXllci5yZW1vdmVMaXN0ZW5lcihsaXN0ZW5lci5uYW1lLCBsaXN0ZW5lci5oYW5kbGUpOwogICAgICAgIH0KICAgICAgfSk7IC8vbXVzdCByZWFkZCBhbGwgYXR0cmlidXRpb25zLCBiZWNhdXNlIHdlIG1pZ2h0IGhhdmUgcmVtb3ZlZCBkdXBlcwoKCiAgICAgIHRoaXMuX2xheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChsYXllcikgewogICAgICAgIHJldHVybiBfdGhpczUuX2FkZEF0dHJpYnV0aW9ucyhsYXllci5nZXRBdHRyaWJ1dGlvbnMoKSk7CiAgICAgIH0pOwoKICAgICAgaWYgKHRoaXMuX2Jhc2VMYXllclNldHRpbmdzKSB7CiAgICAgICAgdGhpcy5fYWRkQXR0cmlidXRpb25zKHRoaXMuX2Jhc2VMYXllclNldHRpbmdzLm9wdGlvbnMuYXR0cmlidXRpb24pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiX2FkZEF0dHJpYnV0aW9ucyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZEF0dHJpYnV0aW9ucyhhdHRyaWJ1dGlvbikgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHZhciBhdHRyaWJ1dGlvbnMgPSBnZXRBdHRyaWJ1dGlvbkFycmF5KGF0dHJpYnV0aW9uKTsKICAgICAgYXR0cmlidXRpb25zLmZvckVhY2goZnVuY3Rpb24gKGF0dHJpYnV0aW9uKSB7CiAgICAgICAgX3RoaXM2Ll9sZWFmbGV0TWFwLmF0dHJpYnV0aW9uQ29udHJvbC5yZW1vdmVBdHRyaWJ1dGlvbihhdHRyaWJ1dGlvbik7IC8vdGhpcyBlbnN1cmVzIHdlIGRvIG5vdCBhZGQgZHVwbGljYXRlcwoKCiAgICAgICAgX3RoaXM2Ll9sZWFmbGV0TWFwLmF0dHJpYnV0aW9uQ29udHJvbC5hZGRBdHRyaWJ1dGlvbihhdHRyaWJ1dGlvbik7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl9yZW1vdmVBdHRyaWJ1dGlvbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW1vdmVBdHRyaWJ1dGlvbnMoYXR0cmlidXRpb24pIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICB2YXIgYXR0cmlidXRpb25zID0gZ2V0QXR0cmlidXRpb25BcnJheShhdHRyaWJ1dGlvbik7CiAgICAgIGF0dHJpYnV0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChhdHRyaWJ1dGlvbikgewogICAgICAgIF90aGlzNy5fbGVhZmxldE1hcC5hdHRyaWJ1dGlvbkNvbnRyb2wucmVtb3ZlQXR0cmlidXRpb24oYXR0cmlidXRpb24pOyAvL3RoaXMgZW5zdXJlcyB3ZSBkbyBub3QgYWRkIGR1cGxpY2F0ZXMKCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImRlc3Ryb3kiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgIGlmICh0aGlzLl9sZWFmbGV0Rml0Q29udHJvbCkgewogICAgICAgIHRoaXMuX2xlYWZsZXRNYXAucmVtb3ZlQ29udHJvbCh0aGlzLl9sZWFmbGV0Rml0Q29udHJvbCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9sZWFmbGV0RHJhd0NvbnRyb2wpIHsKICAgICAgICB0aGlzLl9sZWFmbGV0TWFwLnJlbW92ZUNvbnRyb2wodGhpcy5fbGVhZmxldERyYXdDb250cm9sKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuX2xlYWZsZXRMZWdlbmRDb250cm9sKSB7CiAgICAgICAgdGhpcy5fbGVhZmxldE1hcC5yZW1vdmVDb250cm9sKHRoaXMuX2xlYWZsZXRMZWdlbmRDb250cm9sKTsKICAgICAgfQoKICAgICAgdGhpcy5zZXRCYXNlTGF5ZXIobnVsbCk7CiAgICAgIHZhciBsYXllcjsKCiAgICAgIHdoaWxlICh0aGlzLl9sYXllcnMubGVuZ3RoKSB7CiAgICAgICAgbGF5ZXIgPSB0aGlzLl9sYXllcnMucG9wKCk7CiAgICAgICAgbGF5ZXIucmVtb3ZlRnJvbUxlYWZsZXRNYXAodGhpcy5fbGVhZmxldE1hcCk7CiAgICAgIH0KCiAgICAgIHRoaXMuX2xlYWZsZXRNYXAucmVtb3ZlKCk7CgogICAgICB0aGlzLl9jb250YWluZXJOb2RlLmlubmVySFRNTCA9ICcnOwoKICAgICAgdGhpcy5fbGlzdGVuZXJzLmZvckVhY2goZnVuY3Rpb24gKGxpc3RlbmVyKSB7CiAgICAgICAgcmV0dXJuIGxpc3RlbmVyLmxheWVyLnJlbW92ZUxpc3RlbmVyKGxpc3RlbmVyLm5hbWUsIGxpc3RlbmVyLmhhbmRsZSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldENlbnRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2VudGVyKCkgewogICAgICB2YXIgY2VudGVyID0gdGhpcy5fbGVhZmxldE1hcC5nZXRDZW50ZXIoKTsKCiAgICAgIHJldHVybiB7CiAgICAgICAgbG9uOiBjZW50ZXIubG5nLAogICAgICAgIGxhdDogY2VudGVyLmxhdAogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogInNldENlbnRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q2VudGVyKGxhdGl0dWRlLCBsb25naXR1ZGUpIHsKICAgICAgdmFyIGxhdExvbmcgPSBfbGVhZmxldC5kZWZhdWx0LmxhdExuZyhsYXRpdHVkZSwgbG9uZ2l0dWRlKTsKCiAgICAgIGlmIChsYXRMb25nLmVxdWFscyAmJiAhbGF0TG9uZy5lcXVhbHModGhpcy5fbGVhZmxldE1hcC5nZXRDZW50ZXIoKSkpIHsKICAgICAgICB0aGlzLl9sZWFmbGV0TWFwLnNldFZpZXcobGF0TG9uZyk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRab29tTGV2ZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFpvb21MZXZlbCh6b29tTGV2ZWwpIHsKICAgICAgaWYgKHRoaXMuX2xlYWZsZXRNYXAuZ2V0Wm9vbSgpICE9PSB6b29tTGV2ZWwpIHsKICAgICAgICB0aGlzLl9sZWFmbGV0TWFwLnNldFpvb20oem9vbUxldmVsKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImdldEdlb2hhc2hQcmVjaXNpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEdlb2hhc2hQcmVjaXNpb24oKSB7CiAgICAgIHJldHVybiAoMCwgX3pvb21fdG9fcHJlY2lzaW9uLnpvb21Ub1ByZWNpc2lvbikodGhpcy5fbGVhZmxldE1hcC5nZXRab29tKCksIDEyLCB0aGlzLl9sZWFmbGV0TWFwLmdldE1heFpvb20oKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TGVhZmxldEJvdW5kcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGVhZmxldEJvdW5kcygpIHsKICAgICAgcmV0dXJuIHRoaXMuX2xlYWZsZXRNYXAuZ2V0Qm91bmRzKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TWV0ZXJzUGVyUGl4ZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldE1ldGVyc1BlclBpeGVsKCkgewogICAgICB2YXIgcG9pbnRDID0gdGhpcy5fbGVhZmxldE1hcC5sYXRMbmdUb0NvbnRhaW5lclBvaW50KHRoaXMuX2xlYWZsZXRNYXAuZ2V0Q2VudGVyKCkpOyAvLyBjZW50ZXIgKHBpeGVscykKCgogICAgICB2YXIgcG9pbnRYID0gW3BvaW50Qy54ICsgMSwgcG9pbnRDLnldOyAvLyBhZGQgb25lIHBpeGVsIHRvIHgKCiAgICAgIHZhciBwb2ludFkgPSBbcG9pbnRDLngsIHBvaW50Qy55ICsgMV07IC8vIGFkZCBvbmUgcGl4ZWwgdG8geQoKICAgICAgdmFyIGxhdExuZ0MgPSB0aGlzLl9sZWFmbGV0TWFwLmNvbnRhaW5lclBvaW50VG9MYXRMbmcocG9pbnRDKTsKCiAgICAgIHZhciBsYXRMbmdYID0gdGhpcy5fbGVhZmxldE1hcC5jb250YWluZXJQb2ludFRvTGF0TG5nKHBvaW50WCk7CgogICAgICB2YXIgbGF0TG5nWSA9IHRoaXMuX2xlYWZsZXRNYXAuY29udGFpbmVyUG9pbnRUb0xhdExuZyhwb2ludFkpOwoKICAgICAgdmFyIGRpc3RhbmNlWCA9IGxhdExuZ0MuZGlzdGFuY2VUbyhsYXRMbmdYKTsgLy8gY2FsY3VsYXRlIGRpc3RhbmNlIGJldHdlZW4gYyBhbmQgeCAobGF0aXR1ZGUpCgogICAgICB2YXIgZGlzdGFuY2VZID0gbGF0TG5nQy5kaXN0YW5jZVRvKGxhdExuZ1kpOyAvLyBjYWxjdWxhdGUgZGlzdGFuY2UgYmV0d2VlbiBjIGFuZCB5IChsb25naXR1ZGUpCgogICAgICByZXR1cm4gX2xvZGFzaC5kZWZhdWx0Lm1pbihbZGlzdGFuY2VYLCBkaXN0YW5jZVldKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZ2V0TGVhZmxldEJvdW5kcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldExlYWZsZXRCb3VuZHMocmVzaXplT25GYWlsKSB7CiAgICAgIHZhciBib3VuZHNSYXcgPSB0aGlzLl9sZWFmbGV0TWFwLmdldEJvdW5kcygpOwoKICAgICAgdmFyIGJvdW5kcyA9IHRoaXMuX2xlYWZsZXRNYXAud3JhcExhdExuZ0JvdW5kcyhib3VuZHNSYXcpOwoKICAgICAgaWYgKCFib3VuZHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIHNvdXRoRWFzdCA9IGJvdW5kcy5nZXRTb3V0aEVhc3QoKTsKICAgICAgdmFyIG5vcnRoV2VzdCA9IGJvdW5kcy5nZXROb3J0aFdlc3QoKTsKCiAgICAgIGlmIChzb3V0aEVhc3QubG5nID09PSBub3J0aFdlc3QubG5nIHx8IHNvdXRoRWFzdC5sYXQgPT09IG5vcnRoV2VzdC5sYXQpIHsKICAgICAgICBpZiAocmVzaXplT25GYWlsKSB7CiAgICAgICAgICB0aGlzLl9sZWFmbGV0TWFwLmludmFsaWRhdGVTaXplKCk7CgogICAgICAgICAgcmV0dXJuIHRoaXMuX2dldExlYWZsZXRCb3VuZHMoZmFsc2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGJvdW5kczsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImdldEJvdW5kcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Qm91bmRzKCkgewogICAgICB2YXIgYm91bmRzID0gdGhpcy5fZ2V0TGVhZmxldEJvdW5kcyh0cnVlKTsKCiAgICAgIGlmICghYm91bmRzKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBzb3V0aEVhc3QgPSBib3VuZHMuZ2V0U291dGhFYXN0KCk7CiAgICAgIHZhciBub3J0aFdlc3QgPSBib3VuZHMuZ2V0Tm9ydGhXZXN0KCk7CiAgICAgIHZhciBzb3V0aEVhc3RMbmcgPSBzb3V0aEVhc3QubG5nOwogICAgICB2YXIgbm9ydGhXZXN0TG5nID0gbm9ydGhXZXN0LmxuZzsKICAgICAgdmFyIHNvdXRoRWFzdExhdCA9IHNvdXRoRWFzdC5sYXQ7CiAgICAgIHZhciBub3J0aFdlc3RMYXQgPSBub3J0aFdlc3QubGF0OyAvLyBXaGVuIG1hcCBoYXMgbm90IHdpZHRoIG9yIGhlaWdodCwgdGhlIG1hcCBoYXMgbm8gZGltZW5zaW9ucy4KICAgICAgLy8gVGhlc2UgZGltZW5zaW9ucyBhcmUgZW5mb3JjZWQgZHVlIHRvIENTUyBzdHlsZSBydWxlcyB0aGF0IGVuZm9yY2UgbWluLXdpZHRoL2hlaWdodCBvZiAwCiAgICAgIC8vIHRoYXQgZW5mb3JjZW1lbnQgYWxzbyByZXNvbHZlcyBlcnJvcnMgd2l0aCB0aGUgaGVhdG1hcCBsYXllciBwbHVnaW4uCgogICAgICByZXR1cm4gewogICAgICAgIGJvdHRvbV9yaWdodDogewogICAgICAgICAgbGF0OiBzb3V0aEVhc3RMYXQsCiAgICAgICAgICBsb246IHNvdXRoRWFzdExuZwogICAgICAgIH0sCiAgICAgICAgdG9wX2xlZnQ6IHsKICAgICAgICAgIGxhdDogbm9ydGhXZXN0TGF0LAogICAgICAgICAgbG9uOiBub3J0aFdlc3RMbmcKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0RGVzYXR1cmF0ZUJhc2VMYXllciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RGVzYXR1cmF0ZUJhc2VMYXllcihpc0Rlc2F0dXJhdGVkKSB7CiAgICAgIGlmIChpc0Rlc2F0dXJhdGVkID09PSB0aGlzLl9iYXNlTGF5ZXJJc0Rlc2F0dXJhdGVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLl9iYXNlTGF5ZXJJc0Rlc2F0dXJhdGVkID0gaXNEZXNhdHVyYXRlZDsKCiAgICAgIHRoaXMuX3VwZGF0ZURlc2F0dXJhdGlvbigpOwoKICAgICAgaWYgKHRoaXMuX2xlYWZsZXRCYXNlTGF5ZXIpIHsKICAgICAgICB0aGlzLl9sZWFmbGV0QmFzZUxheWVyLnJlZHJhdygpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiYWRkRHJhd0NvbnRyb2wiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZERyYXdDb250cm9sKCkgewogICAgICB2YXIgZHJhd0NvbG9yID0gJyMwMDAnOwogICAgICB2YXIgZHJhd09wdGlvbnMgPSB7CiAgICAgICAgZHJhdzogewogICAgICAgICAgcG9seWxpbmU6IGZhbHNlLAogICAgICAgICAgbWFya2VyOiBmYWxzZSwKICAgICAgICAgIGNpcmNsZTogZmFsc2UsCiAgICAgICAgICByZWN0YW5nbGU6IHsKICAgICAgICAgICAgc2hhcGVPcHRpb25zOiB7CiAgICAgICAgICAgICAgc3Ryb2tlOiBmYWxzZSwKICAgICAgICAgICAgICBjb2xvcjogZHJhd0NvbG9yCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBwb2x5Z29uOiB7CiAgICAgICAgICAgIHNoYXBlT3B0aW9uczogewogICAgICAgICAgICAgIGNvbG9yOiBkcmF3Q29sb3IKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIGNpcmNsZW1hcmtlcjogZmFsc2UKICAgICAgICB9CiAgICAgIH07CiAgICAgIHRoaXMuX2xlYWZsZXREcmF3Q29udHJvbCA9IG5ldyBfbGVhZmxldC5kZWZhdWx0LkNvbnRyb2wuRHJhdyhkcmF3T3B0aW9ucyk7CgogICAgICB0aGlzLl9sZWFmbGV0TWFwLmFkZENvbnRyb2wodGhpcy5fbGVhZmxldERyYXdDb250cm9sKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJhZGRGaXRDb250cm9sIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRGaXRDb250cm9sKCkgewogICAgICBpZiAodGhpcy5fbGVhZmxldEZpdENvbnRyb2wgfHwgIXRoaXMuX2xlYWZsZXRNYXApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBmaXRDb250YWluZXIgPSBfbGVhZmxldC5kZWZhdWx0LkRvbVV0aWwuY3JlYXRlKCdkaXYnLCAnbGVhZmxldC1jb250cm9sIGxlYWZsZXQtYmFyIGxlYWZsZXQtY29udHJvbC1maXQnKTsKCiAgICAgIHRoaXMuX2xlYWZsZXRGaXRDb250cm9sID0gbWFrZUZpdENvbnRyb2woZml0Q29udGFpbmVyLCB0aGlzKTsKCiAgICAgIHRoaXMuX2xlYWZsZXRNYXAuYWRkQ29udHJvbCh0aGlzLl9sZWFmbGV0Rml0Q29udHJvbCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiYWRkTGVnZW5kQ29udHJvbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkTGVnZW5kQ29udHJvbCgpIHsKICAgICAgaWYgKHRoaXMuX2xlYWZsZXRMZWdlbmRDb250cm9sIHx8ICF0aGlzLl9sZWFmbGV0TWFwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLl91cGRhdGVMZWdlbmQoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRMZWdlbmRQb3NpdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0TGVnZW5kUG9zaXRpb24ocG9zaXRpb24pIHsKICAgICAgaWYgKHRoaXMuX2xlZ2VuZFBvc2l0aW9uID09PSBwb3NpdGlvbikgewogICAgICAgIGlmICghdGhpcy5fbGVhZmxldExlZ2VuZENvbnRyb2wpIHsKICAgICAgICAgIHRoaXMuX3VwZGF0ZUxlZ2VuZCgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9sZWdlbmRQb3NpdGlvbiA9IHBvc2l0aW9uOwoKICAgICAgICB0aGlzLl91cGRhdGVMZWdlbmQoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIl91cGRhdGVMZWdlbmQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF91cGRhdGVMZWdlbmQoKSB7CiAgICAgIGlmICh0aGlzLl9sZWFmbGV0TGVnZW5kQ29udHJvbCkgewogICAgICAgIHRoaXMuX2xlYWZsZXRNYXAucmVtb3ZlQ29udHJvbCh0aGlzLl9sZWFmbGV0TGVnZW5kQ29udHJvbCk7CiAgICAgIH0KCiAgICAgIHZhciAkd3JhcHBlciA9ICgwLCBfanF1ZXJ5LmRlZmF1bHQpKCc8ZGl2PicpLmFkZENsYXNzKCd2aXNNYXBMZWdlbmRfX3dyYXBwZXInKTsKICAgICAgdGhpcy5fbGVhZmxldExlZ2VuZENvbnRyb2wgPSBtYWtlTGVnZW5kQ29udHJvbCgkd3JhcHBlciwgdGhpcywgdGhpcy5fbGVnZW5kUG9zaXRpb24pOwoKICAgICAgdGhpcy5fbGVhZmxldE1hcC5hZGRDb250cm9sKHRoaXMuX2xlYWZsZXRMZWdlbmRDb250cm9sKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZXNpemUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2l6ZSgpIHsKICAgICAgdGhpcy5fbGVhZmxldE1hcC5pbnZhbGlkYXRlU2l6ZSgpOwoKICAgICAgdGhpcy5fdXBkYXRlRXh0ZW50KCk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0TWluWm9vbSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0TWluWm9vbSh6b29tKSB7CiAgICAgIHRoaXMuX2xlYWZsZXRNYXAuc2V0TWluWm9vbSh6b29tKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRNYXhab29tIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRNYXhab29tKHpvb20pIHsKICAgICAgdGhpcy5fbGVhZmxldE1hcC5zZXRNYXhab29tKHpvb20pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldExlYWZsZXRCYXNlTGF5ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExlYWZsZXRCYXNlTGF5ZXIoKSB7CiAgICAgIHJldHVybiB0aGlzLl9sZWFmbGV0QmFzZUxheWVyOwogICAgfQogIH0sIHsKICAgIGtleTogInNldEJhc2VMYXllciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0QmFzZUxheWVyKHNldHRpbmdzKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgaWYgKF9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKHNldHRpbmdzLCB0aGlzLl9iYXNlTGF5ZXJTZXR0aW5ncykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChzZXR0aW5ncyA9PT0gbnVsbCkgewogICAgICAgIGlmICh0aGlzLl9sZWFmbGV0QmFzZUxheWVyICYmIHRoaXMuX2xlYWZsZXRNYXApIHsKICAgICAgICAgIHRoaXMuX3JlbW92ZUF0dHJpYnV0aW9ucyh0aGlzLl9iYXNlTGF5ZXJTZXR0aW5ncy5vcHRpb25zLmF0dHJpYnV0aW9uKTsKCiAgICAgICAgICB0aGlzLl9sZWFmbGV0TWFwLnJlbW92ZUxheWVyKHRoaXMuX2xlYWZsZXRCYXNlTGF5ZXIpOwoKICAgICAgICAgIHRoaXMuX2xlYWZsZXRCYXNlTGF5ZXIgPSBudWxsOwogICAgICAgICAgdGhpcy5fYmFzZUxheWVyU2V0dGluZ3MgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLl9iYXNlTGF5ZXJTZXR0aW5ncyA9IHNldHRpbmdzOwoKICAgICAgaWYgKHRoaXMuX2xlYWZsZXRCYXNlTGF5ZXIpIHsKICAgICAgICB0aGlzLl9sZWFmbGV0TWFwLnJlbW92ZUxheWVyKHRoaXMuX2xlYWZsZXRCYXNlTGF5ZXIpOwoKICAgICAgICB0aGlzLl9sZWFmbGV0QmFzZUxheWVyID0gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIGJhc2VMYXllcjsKCiAgICAgIGlmIChzZXR0aW5ncy5iYXNlTGF5ZXJUeXBlID09PSAnd21zJykgewogICAgICAgIGJhc2VMYXllciA9IHRoaXMuX2dldFdNU0Jhc2VMYXllcihzZXR0aW5ncy5vcHRpb25zKTsKICAgICAgfSBlbHNlIGlmIChzZXR0aW5ncy5iYXNlTGF5ZXJUeXBlID09PSAndG1zJykgewogICAgICAgIGJhc2VMYXllciA9IHRoaXMuX2dldFRNU0Jhc2VMYXllcihzZXR0aW5ncy5vcHRpb25zKTsKICAgICAgfQoKICAgICAgaWYgKGJhc2VMYXllcikgewogICAgICAgIGJhc2VMYXllci5vbigndGlsZWxvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXM4Ll91cGRhdGVEZXNhdHVyYXRpb24oKTsKICAgICAgICB9KTsKICAgICAgICBiYXNlTGF5ZXIub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczguZW1pdCgnYmFzZUxheWVyOmxvYWRlZCcpOwogICAgICAgIH0pOwogICAgICAgIGJhc2VMYXllci5vbignbG9hZGluZycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzOC5lbWl0KCdiYXNlTGF5ZXI6bG9hZGluZycpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuX2xlYWZsZXRCYXNlTGF5ZXIgPSBiYXNlTGF5ZXI7CgogICAgICAgIGlmIChzZXR0aW5ncy5vcHRpb25zLnNob3dab29tTWVzc2FnZSkgewogICAgICAgICAgYmFzZUxheWVyLm9uKCdhZGQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzOC5fYWRkTWF4Wm9vbU1lc3NhZ2UoYmFzZUxheWVyKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fbGVhZmxldEJhc2VMYXllci5hZGRUbyh0aGlzLl9sZWFmbGV0TWFwKTsKCiAgICAgICAgdGhpcy5fbGVhZmxldEJhc2VMYXllci5icmluZ1RvQmFjaygpOwoKICAgICAgICBpZiAoc2V0dGluZ3Mub3B0aW9ucy5taW5ab29tID4gdGhpcy5fbGVhZmxldE1hcC5nZXRab29tKCkpIHsKICAgICAgICAgIHRoaXMuX2xlYWZsZXRNYXAuc2V0Wm9vbShzZXR0aW5ncy5vcHRpb25zLm1pblpvb20pOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fYWRkQXR0cmlidXRpb25zKHNldHRpbmdzLm9wdGlvbnMuYXR0cmlidXRpb24pOwoKICAgICAgICB0aGlzLnJlc2l6ZSgpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNJbnNpZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzSW5zaWRlKGJ1Y2tldFJlY3RCb3VuZHMpIHsKICAgICAgdmFyIG1hcEJvdW5kcyA9IHRoaXMuX2xlYWZsZXRNYXAuZ2V0Qm91bmRzKCk7CgogICAgICByZXR1cm4gbWFwQm91bmRzLmludGVyc2VjdHMoYnVja2V0UmVjdEJvdW5kcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZml0VG9EYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZml0VG9EYXRhID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgICAgdmFyIGJvdW5kc0FycmF5LCBib3VuZHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9sZWFmbGV0TWFwKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwodGhpcy5fbGF5ZXJzLm1hcCgKICAgICAgICAgICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGF5ZXIuZ2V0Qm91bmRzKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0LnNlbnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9KCkpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgYm91bmRzQXJyYXkgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICAgIGJvdW5kcyA9IG51bGw7CiAgICAgICAgICAgICAgICBib3VuZHNBcnJheS5mb3JFYWNoKAogICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICB2YXIgX3JlZjIgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChib3VuZHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm91bmRzLmV4dGVuZChiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kcyA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWYyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9KCkpOwoKICAgICAgICAgICAgICAgIGlmIChib3VuZHMgJiYgYm91bmRzLmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICB0aGlzLl9sZWFmbGV0TWFwLmZpdEJvdW5kcyhib3VuZHMpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBmaXRUb0RhdGEoKSB7CiAgICAgICAgcmV0dXJuIF9maXRUb0RhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZpdFRvRGF0YTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogIl9nZXRUTVNCYXNlTGF5ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRUTVNCYXNlTGF5ZXIob3B0aW9ucykgewogICAgICByZXR1cm4gX2xlYWZsZXQuZGVmYXVsdC50aWxlTGF5ZXIob3B0aW9ucy51cmwsIHsKICAgICAgICBtaW5ab29tOiBvcHRpb25zLm1pblpvb20sCiAgICAgICAgbWF4Wm9vbTogb3B0aW9ucy5tYXhab29tLAogICAgICAgIHN1YmRvbWFpbnM6IG9wdGlvbnMuc3ViZG9tYWlucyB8fCBbXQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZ2V0V01TQmFzZUxheWVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0V01TQmFzZUxheWVyKG9wdGlvbnMpIHsKICAgICAgdmFyIHdtc09wdGlvbnMgPSB7CiAgICAgICAgZm9ybWF0OiBvcHRpb25zLmZvcm1hdCB8fCAnJywKICAgICAgICBsYXllcnM6IG9wdGlvbnMubGF5ZXJzIHx8ICcnLAogICAgICAgIG1pblpvb206IG9wdGlvbnMubWluWm9vbSwKICAgICAgICBtYXhab29tOiBvcHRpb25zLm1heFpvb20sCiAgICAgICAgc3R5bGVzOiBvcHRpb25zLnN0eWxlcyB8fCAnJywKICAgICAgICB0cmFuc3BhcmVudDogb3B0aW9ucy50cmFuc3BhcmVudCwKICAgICAgICB2ZXJzaW9uOiBvcHRpb25zLnZlcnNpb24gfHwgJzEuMy4wJwogICAgICB9OwogICAgICByZXR1cm4gdHlwZW9mIG9wdGlvbnMudXJsID09PSAnc3RyaW5nJyAmJiBvcHRpb25zLnVybC5sZW5ndGggPyBfbGVhZmxldC5kZWZhdWx0LnRpbGVMYXllci53bXMob3B0aW9ucy51cmwsIHdtc09wdGlvbnMpIDogbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfdXBkYXRlRXh0ZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfdXBkYXRlRXh0ZW50KCkgewogICAgICB0aGlzLl9sYXllcnMuZm9yRWFjaChmdW5jdGlvbiAobGF5ZXIpIHsKICAgICAgICByZXR1cm4gbGF5ZXIudXBkYXRlRXh0ZW50KCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl91cGRhdGVEZXNhdHVyYXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIF91cGRhdGVEZXNhdHVyYXRpb24oKSB7CiAgICAgIHZhciB0aWxlcyA9ICgwLCBfanF1ZXJ5LmRlZmF1bHQpKCdpbWcubGVhZmxldC10aWxlLWxvYWRlZCcpOyAvLyBEb24ndCBhcHBseSBjbGllbnQtc2lkZSBzdHlsaW5nIHRvIEVNUyBiYXNlbWFwcwoKICAgICAgaWYgKF9sb2Rhc2guZGVmYXVsdC5nZXQodGhpcy5fYmFzZUxheWVyU2V0dGluZ3MsICdvcHRpb25zLm9yaWdpbicpID09PSBfb3JpZ2luLk9SSUdJTi5FTVMpIHsKICAgICAgICB0aWxlcy5hZGRDbGFzcygnZmlsdGVycy1vZmYnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodGhpcy5fYmFzZUxheWVySXNEZXNhdHVyYXRlZCkgewogICAgICAgICAgdGlsZXMucmVtb3ZlQ2xhc3MoJ2ZpbHRlcnMtb2ZmJyk7CiAgICAgICAgfSBlbHNlIGlmICghdGhpcy5fYmFzZUxheWVySXNEZXNhdHVyYXRlZCkgewogICAgICAgICAgdGlsZXMuYWRkQ2xhc3MoJ2ZpbHRlcnMtb2ZmJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAicGVyc2lzdFVpU3RhdGVGb3JWaXN1YWxpemF0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwZXJzaXN0VWlTdGF0ZUZvclZpc3VhbGl6YXRpb24odmlzdWFsaXphdGlvbikgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIGZ1bmN0aW9uIHBlcnNpc3RNYXBTdGF0ZUluVWlTdGF0ZSgpIHsKICAgICAgICB2YXIgdWlTdGF0ZSA9IHZpc3VhbGl6YXRpb24uZ2V0VWlTdGF0ZSgpOwogICAgICAgIHZhciBjZW50ZXJGcm9tVUlTdGF0ZSA9IHVpU3RhdGUuZ2V0KCdtYXBDZW50ZXInKTsKICAgICAgICB2YXIgem9vbUZyb21VaVN0YXRlID0gcGFyc2VJbnQodWlTdGF0ZS5nZXQoJ21hcFpvb20nKSk7CgogICAgICAgIGlmIChpc05hTih6b29tRnJvbVVpU3RhdGUpIHx8IHRoaXMuZ2V0Wm9vbUxldmVsKCkgIT09IHpvb21Gcm9tVWlTdGF0ZSkgewogICAgICAgICAgdmlzdWFsaXphdGlvbi51aVN0YXRlVmFsKCdtYXBab29tJywgdGhpcy5nZXRab29tTGV2ZWwoKSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY2VudGVyRnJvbU1hcCA9IHRoaXMuZ2V0Q2VudGVyKCk7CgogICAgICAgIGlmICghY2VudGVyRnJvbVVJU3RhdGUgfHwgY2VudGVyRnJvbU1hcC5sb24gIT09IGNlbnRlckZyb21VSVN0YXRlWzFdIHx8IGNlbnRlckZyb21NYXAubGF0ICE9PSBjZW50ZXJGcm9tVUlTdGF0ZVswXSkgewogICAgICAgICAgdmlzdWFsaXphdGlvbi51aVN0YXRlVmFsKCdtYXBDZW50ZXInLCBbY2VudGVyRnJvbU1hcC5sYXQsIGNlbnRlckZyb21NYXAubG9uXSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLl9sZWFmbGV0TWFwLm9uKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmlzdWFsaXphdGlvbi5zZXNzaW9uU3RhdGUubWFwQm91bmRzID0gX3RoaXM5LmdldEJvdW5kcygpOwogICAgICB9KTsKCiAgICAgIHRoaXMuX2xlYWZsZXRNYXAub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmlzdWFsaXphdGlvbi5zZXNzaW9uU3RhdGUubWFwQm91bmRzID0gX3RoaXM5LmdldEJvdW5kcygpOwogICAgICB9KTsKCiAgICAgIHRoaXMub24oJ2RyYWdlbmQnLCBwZXJzaXN0TWFwU3RhdGVJblVpU3RhdGUpOwogICAgICB0aGlzLm9uKCd6b29tZW5kJywgcGVyc2lzdE1hcFN0YXRlSW5VaVN0YXRlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1c2VVaVN0YXRlRnJvbVZpc3VhbGl6YXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVzZVVpU3RhdGVGcm9tVmlzdWFsaXphdGlvbih2aXN1YWxpemF0aW9uKSB7CiAgICAgIHZhciB1aVN0YXRlID0gdmlzdWFsaXphdGlvbi5nZXRVaVN0YXRlKCk7CiAgICAgIHZhciB6b29tRnJvbVVpU3RhdGUgPSBwYXJzZUludCh1aVN0YXRlLmdldCgnbWFwWm9vbScpKTsKICAgICAgdmFyIGNlbnRlckZyb21VSVN0YXRlID0gdWlTdGF0ZS5nZXQoJ21hcENlbnRlcicpOwoKICAgICAgaWYgKCFpc05hTih6b29tRnJvbVVpU3RhdGUpKSB7CiAgICAgICAgdGhpcy5zZXRab29tTGV2ZWwoem9vbUZyb21VaVN0YXRlKTsKICAgICAgfQoKICAgICAgaWYgKGNlbnRlckZyb21VSVN0YXRlKSB7CiAgICAgICAgdGhpcy5zZXRDZW50ZXIoY2VudGVyRnJvbVVJU3RhdGVbMF0sIGNlbnRlckZyb21VSVN0YXRlWzFdKTsKICAgICAgfQogICAgfQogIH1dKTsKCiAgcmV0dXJuIEtpYmFuYU1hcDsKfShfZXZlbnRzLkV2ZW50RW1pdHRlcik7CgpleHBvcnRzLktpYmFuYU1hcCA9IEtpYmFuYU1hcDsKCmZ1bmN0aW9uIGdldEF0dHJpYnV0aW9uQXJyYXkoYXR0cmlidXRpb24pIHsKICB2YXIgYXR0cmlidXRpb25TdHJpbmcgPSBhdHRyaWJ1dGlvbiB8fCAnJzsKICB2YXIgYXR0cmlidXRpb25zID0gYXR0cmlidXRpb25TdHJpbmcuc3BsaXQoL1xzKlx8XHMqLyk7CgogIGlmIChhdHRyaWJ1dGlvbnMubGVuZ3RoID09PSAxKSB7CiAgICAvL3RlbXAgd29yay1hcm91bmQgZHVlIHRvIGluY29uc2lzdGVuY3kgaW4gbWFuaWZlc3RzIG9mIGhvdyBhdHRyaWJ1dGlvbnMgYXJlIGRlbGltaXRlZAogICAgYXR0cmlidXRpb25zID0gYXR0cmlidXRpb25zWzBdLnNwbGl0KCcsJyk7CiAgfQoKICByZXR1cm4gYXR0cmlidXRpb25zOwp9"},null]}