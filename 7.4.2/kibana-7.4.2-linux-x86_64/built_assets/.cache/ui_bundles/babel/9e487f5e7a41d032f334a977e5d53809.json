{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/management/sections/index_patterns/create_index_pattern_wizard/components/step_index_pattern/step_index_pattern.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/management/sections/index_patterns/create_index_pattern_wizard/components/step_index_pattern/step_index_pattern.js","mtime":1572296410536},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlN0ZXBJbmRleFBhdHRlcm4gPSBleHBvcnRzLlN0ZXBJbmRleFBhdHRlcm5Db21wb25lbnQgPSB2b2lkIDA7Cgp2YXIgX3JlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX3Byb3BUeXBlcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgicHJvcC10eXBlcyIpKTsKCnZhciBfaW5kZXhfcGF0dGVybnMgPSByZXF1aXJlKCJ1aS9pbmRleF9wYXR0ZXJucyIpOwoKdmFyIF9jb25zdGFudHMgPSByZXF1aXJlKCIuLi8uLi9jb25zdGFudHMiKTsKCnZhciBfbGliID0gcmVxdWlyZSgiLi4vLi4vbGliIik7Cgp2YXIgX2xvYWRpbmdfaW5kaWNlcyA9IHJlcXVpcmUoIi4vY29tcG9uZW50cy9sb2FkaW5nX2luZGljZXMiKTsKCnZhciBfc3RhdHVzX21lc3NhZ2UgPSByZXF1aXJlKCIuL2NvbXBvbmVudHMvc3RhdHVzX21lc3NhZ2UiKTsKCnZhciBfaW5kaWNlc19saXN0ID0gcmVxdWlyZSgiLi9jb21wb25lbnRzL2luZGljZXNfbGlzdCIpOwoKdmFyIF9oZWFkZXIgPSByZXF1aXJlKCIuL2NvbXBvbmVudHMvaGVhZGVyIik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9yZWFjdDIgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCnZhciBfY2hyb21lID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJ1aS9jaHJvbWUiKSk7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7IGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsgcmV0dXJuIG9iajsgfSBlbHNlIHsgdmFyIG5ld09iaiA9IHt9OyBpZiAob2JqICE9IG51bGwpIHsgZm9yICh2YXIga2V5IGluIG9iaikgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgeyB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7IH0gZWxzZSB7IG5ld09ialtrZXldID0gb2JqW2tleV07IH0gfSB9IH0gbmV3T2JqLmRlZmF1bHQgPSBvYmo7IHJldHVybiBuZXdPYmo7IH0gfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsgfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSB9CgpmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsgfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOyB9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7IHZhciBfYXJyID0gW107IHZhciBfbiA9IHRydWU7IHZhciBfZCA9IGZhbHNlOyB2YXIgX2UgPSB1bmRlZmluZWQ7IHRyeSB7IGZvciAodmFyIF9pID0gYXJyW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3M7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsgX2Fyci5wdXNoKF9zLnZhbHVlKTsgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOyB9IH0gY2F0Y2ggKGVycikgeyBfZCA9IHRydWU7IF9lID0gZXJyOyB9IGZpbmFsbHkgeyB0cnkgeyBpZiAoIV9uICYmIF9pWyJyZXR1cm4iXSAhPSBudWxsKSBfaVsicmV0dXJuIl0oKTsgfSBmaW5hbGx5IHsgaWYgKF9kKSB0aHJvdyBfZTsgfSB9IHJldHVybiBfYXJyOyB9CgpmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7IH0KCmZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsgdHJ5IHsgdmFyIGluZm8gPSBnZW5ba2V5XShhcmcpOyB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOyB9IGNhdGNoIChlcnJvcikgeyByZWplY3QoZXJyb3IpOyByZXR1cm47IH0gaWYgKGluZm8uZG9uZSkgeyByZXNvbHZlKHZhbHVlKTsgfSBlbHNlIHsgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOyB9IH0KCmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHZhciBzZWxmID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOyBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOyB9IGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOyB9IF9uZXh0KHVuZGVmaW5lZCk7IH0pOyB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCnZhciB1aVNldHRpbmdzID0gX2Nocm9tZS5kZWZhdWx0LmdldFVpU2V0dGluZ3NDbGllbnQoKTsKCnZhciBTdGVwSW5kZXhQYXR0ZXJuQ29tcG9uZW50ID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhTdGVwSW5kZXhQYXR0ZXJuQ29tcG9uZW50LCBfQ29tcG9uZW50KTsKCiAgZnVuY3Rpb24gU3RlcEluZGV4UGF0dGVybkNvbXBvbmVudChwcm9wcykgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTdGVwSW5kZXhQYXR0ZXJuQ29tcG9uZW50KTsKCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihTdGVwSW5kZXhQYXR0ZXJuQ29tcG9uZW50KS5jYWxsKHRoaXMsIHByb3BzKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZmV0Y2hFeGlzdGluZ0luZGV4UGF0dGVybnMiLAogICAgLyojX19QVVJFX18qLwogICAgX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAvKiNfX1BVUkVfXyovCiAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICB2YXIgX3JlZjIsIHNhdmVkT2JqZWN0cywgZXhpc3RpbmdJbmRleFBhdHRlcm5zOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiBfdGhpcy5wcm9wcy5zYXZlZE9iamVjdHNDbGllbnQuZmluZCh7CiAgICAgICAgICAgICAgICB0eXBlOiAnaW5kZXgtcGF0dGVybicsCiAgICAgICAgICAgICAgICBmaWVsZHM6IFsndGl0bGUnXSwKICAgICAgICAgICAgICAgIHBlclBhZ2U6IDEwMDAwCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgX3JlZjIgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgIHNhdmVkT2JqZWN0cyA9IF9yZWYyLnNhdmVkT2JqZWN0czsKICAgICAgICAgICAgICBleGlzdGluZ0luZGV4UGF0dGVybnMgPSBzYXZlZE9iamVjdHMubWFwKGZ1bmN0aW9uIChvYmopIHsKICAgICAgICAgICAgICAgIHJldHVybiBvYmogJiYgb2JqLmF0dHJpYnV0ZXMgPyBvYmouYXR0cmlidXRlcy50aXRsZSA6ICcnOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBleGlzdGluZ0luZGV4UGF0dGVybnM6IGV4aXN0aW5nSW5kZXhQYXR0ZXJucwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlKTsKICAgIH0pKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZmV0Y2hJbmRpY2VzIiwKICAgIC8qI19fUFVSRV9fKi8KICAgIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9yZWYzID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIocXVlcnkpIHsKICAgICAgICB2YXIgX3RoaXMkcHJvcHMsIGVzU2VydmljZSwgaW5kZXhQYXR0ZXJuQ3JlYXRpb25UeXBlLCBleGlzdGluZ0luZGV4UGF0dGVybnMsIF9leGFjdE1hdGNoZWRJbmRpY2VzLCBfcmVmNCwgX3JlZjUsIHBhcnRpYWxNYXRjaGVkSW5kaWNlcywgZXhhY3RNYXRjaGVkSW5kaWNlczsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF90aGlzJHByb3BzID0gX3RoaXMucHJvcHMsIGVzU2VydmljZSA9IF90aGlzJHByb3BzLmVzU2VydmljZSwgaW5kZXhQYXR0ZXJuQ3JlYXRpb25UeXBlID0gX3RoaXMkcHJvcHMuaW5kZXhQYXR0ZXJuQ3JlYXRpb25UeXBlOwogICAgICAgICAgICAgICAgZXhpc3RpbmdJbmRleFBhdHRlcm5zID0gX3RoaXMuc3RhdGUuZXhpc3RpbmdJbmRleFBhdHRlcm5zOwoKICAgICAgICAgICAgICAgIGlmICghZXhpc3RpbmdJbmRleFBhdHRlcm5zLmluY2x1ZGVzKHF1ZXJ5KSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuRXhpc3RzOiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgaXNMb2FkaW5nSW5kaWNlczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuRXhpc3RzOiBmYWxzZQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKCFxdWVyeS5lbmRzV2l0aCgnKicpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIHJldHVybiAoMCwgX2xpYi5lbnN1cmVNaW5pbXVtVGltZSkoKDAsIF9saWIuZ2V0SW5kaWNlcykoZXNTZXJ2aWNlLCBpbmRleFBhdHRlcm5DcmVhdGlvblR5cGUsIHF1ZXJ5LCBfY29uc3RhbnRzLk1BWF9TRUFSQ0hfU0laRSkpOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBfZXhhY3RNYXRjaGVkSW5kaWNlcyA9IF9jb250ZXh0Mi5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghKHF1ZXJ5ICE9PSBfdGhpcy5sYXN0UXVlcnkpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgZXhhY3RNYXRjaGVkSW5kaWNlczogX2V4YWN0TWF0Y2hlZEluZGljZXMsCiAgICAgICAgICAgICAgICAgIGlzTG9hZGluZ0luZGljZXM6IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfbGliLmVuc3VyZU1pbmltdW1UaW1lKShbKDAsIF9saWIuZ2V0SW5kaWNlcykoZXNTZXJ2aWNlLCBpbmRleFBhdHRlcm5DcmVhdGlvblR5cGUsICIiLmNvbmNhdChxdWVyeSwgIioiKSwgX2NvbnN0YW50cy5NQVhfU0VBUkNIX1NJWkUpLCAoMCwgX2xpYi5nZXRJbmRpY2VzKShlc1NlcnZpY2UsIGluZGV4UGF0dGVybkNyZWF0aW9uVHlwZSwgcXVlcnksIF9jb25zdGFudHMuTUFYX1NFQVJDSF9TSVpFKV0pOwoKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgX3JlZjQgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIF9yZWY1ID0gX3NsaWNlZFRvQXJyYXkoX3JlZjQsIDIpOwogICAgICAgICAgICAgICAgcGFydGlhbE1hdGNoZWRJbmRpY2VzID0gX3JlZjVbMF07CiAgICAgICAgICAgICAgICBleGFjdE1hdGNoZWRJbmRpY2VzID0gX3JlZjVbMV07CgogICAgICAgICAgICAgICAgaWYgKCEocXVlcnkgIT09IF90aGlzLmxhc3RRdWVyeSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICBwYXJ0aWFsTWF0Y2hlZEluZGljZXM6IHBhcnRpYWxNYXRjaGVkSW5kaWNlcywKICAgICAgICAgICAgICAgICAgZXhhY3RNYXRjaGVkSW5kaWNlczogZXhhY3RNYXRjaGVkSW5kaWNlcywKICAgICAgICAgICAgICAgICAgaXNMb2FkaW5nSW5kaWNlczogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyKTsKICAgICAgfSkpOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgICAgIHJldHVybiBfcmVmMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblF1ZXJ5Q2hhbmdlZCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciBhcHBlbmRlZFdpbGRjYXJkID0gX3RoaXMuc3RhdGUuYXBwZW5kZWRXaWxkY2FyZDsKICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0OwogICAgICB2YXIgcXVlcnkgPSB0YXJnZXQudmFsdWU7CgogICAgICBpZiAocXVlcnkubGVuZ3RoID09PSAxICYmICgwLCBfbGliLmNhbkFwcGVuZFdpbGRjYXJkKShxdWVyeSkpIHsKICAgICAgICBxdWVyeSArPSAnKic7CgogICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGFwcGVuZGVkV2lsZGNhcmQ6IHRydWUKICAgICAgICB9KTsKCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdGFyZ2V0LnNldFNlbGVjdGlvblJhbmdlKDEsIDEpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChxdWVyeSA9PT0gJyonICYmIGFwcGVuZGVkV2lsZGNhcmQpIHsKICAgICAgICAgIHF1ZXJ5ID0gJyc7CgogICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICBhcHBlbmRlZFdpbGRjYXJkOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBfdGhpcy5sYXN0UXVlcnkgPSBxdWVyeTsKCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgc2hvd2luZ0luZGV4UGF0dGVyblF1ZXJ5RXJyb3JzOiAhIXF1ZXJ5Lmxlbmd0aAogICAgICB9KTsKCiAgICAgIF90aGlzLmZldGNoSW5kaWNlcyhxdWVyeSk7CiAgICB9KTsKCiAgICB2YXIgX2luZGV4UGF0dGVybkNyZWF0aW9uVHlwZSA9IF90aGlzLnByb3BzLmluZGV4UGF0dGVybkNyZWF0aW9uVHlwZTsKICAgIF90aGlzLnN0YXRlID0gewogICAgICBwYXJ0aWFsTWF0Y2hlZEluZGljZXM6IFtdLAogICAgICBleGFjdE1hdGNoZWRJbmRpY2VzOiBbXSwKICAgICAgaXNMb2FkaW5nSW5kaWNlczogZmFsc2UsCiAgICAgIGV4aXN0aW5nSW5kZXhQYXR0ZXJuczogW10sCiAgICAgIGluZGV4UGF0dGVybkV4aXN0czogZmFsc2UsCiAgICAgIHF1ZXJ5OiBwcm9wcy5pbml0aWFsUXVlcnksCiAgICAgIGFwcGVuZGVkV2lsZGNhcmQ6IGZhbHNlLAogICAgICBzaG93aW5nSW5kZXhQYXR0ZXJuUXVlcnlFcnJvcnM6IGZhbHNlLAogICAgICBpbmRleFBhdHRlcm5OYW1lOiBfaW5kZXhQYXR0ZXJuQ3JlYXRpb25UeXBlLmdldEluZGV4UGF0dGVybk5hbWUoKQogICAgfTsKICAgIF90aGlzLklMTEVHQUxfQ0hBUkFDVEVSUyA9IF90b0NvbnN1bWFibGVBcnJheShfaW5kZXhfcGF0dGVybnMuSU5ERVhfUEFUVEVSTl9JTExFR0FMX0NIQVJBQ1RFUlMpOwogICAgX3RoaXMubGFzdFF1ZXJ5ID0gbnVsbDsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhTdGVwSW5kZXhQYXR0ZXJuQ29tcG9uZW50LCBbewogICAga2V5OiAiY29tcG9uZW50V2lsbE1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY29tcG9uZW50V2lsbE1vdW50ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMuZmV0Y2hFeGlzdGluZ0luZGV4UGF0dGVybnMoKTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5xdWVyeSkgewogICAgICAgICAgICAgICAgICB0aGlzLmxhc3RRdWVyeSA9IHRoaXMuc3RhdGUucXVlcnk7CiAgICAgICAgICAgICAgICAgIHRoaXMuZmV0Y2hJbmRpY2VzKHRoaXMuc3RhdGUucXVlcnkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBjb21wb25lbnRXaWxsTW91bnQoKSB7CiAgICAgICAgcmV0dXJuIF9jb21wb25lbnRXaWxsTW91bnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNvbXBvbmVudFdpbGxNb3VudDsKICAgIH0oKQogIH0sIHsKICAgIGtleTogInJlbmRlckxvYWRpbmdTdGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyTG9hZGluZ1N0YXRlKCkgewogICAgICB2YXIgaXNMb2FkaW5nSW5kaWNlcyA9IHRoaXMuc3RhdGUuaXNMb2FkaW5nSW5kaWNlczsKCiAgICAgIGlmICghaXNMb2FkaW5nSW5kaWNlcykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfbG9hZGluZ19pbmRpY2VzLkxvYWRpbmdJbmRpY2VzLCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImNyZWF0ZUluZGV4UGF0dGVyblN0ZXAxTG9hZGluZyIKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyU3RhdHVzTWVzc2FnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyU3RhdHVzTWVzc2FnZShtYXRjaGVkSW5kaWNlcykgewogICAgICB2YXIgaW5kZXhQYXR0ZXJuQ3JlYXRpb25UeXBlID0gdGhpcy5wcm9wcy5pbmRleFBhdHRlcm5DcmVhdGlvblR5cGU7CiAgICAgIHZhciBfdGhpcyRzdGF0ZSA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBxdWVyeSA9IF90aGlzJHN0YXRlLnF1ZXJ5LAogICAgICAgICAgaXNMb2FkaW5nSW5kaWNlcyA9IF90aGlzJHN0YXRlLmlzTG9hZGluZ0luZGljZXMsCiAgICAgICAgICBpbmRleFBhdHRlcm5FeGlzdHMgPSBfdGhpcyRzdGF0ZS5pbmRleFBhdHRlcm5FeGlzdHMsCiAgICAgICAgICBpc0luY2x1ZGluZ1N5c3RlbUluZGljZXMgPSBfdGhpcyRzdGF0ZS5pc0luY2x1ZGluZ1N5c3RlbUluZGljZXM7CgogICAgICBpZiAoaXNMb2FkaW5nSW5kaWNlcyB8fCBpbmRleFBhdHRlcm5FeGlzdHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N0YXR1c19tZXNzYWdlLlN0YXR1c01lc3NhZ2UsIHsKICAgICAgICBtYXRjaGVkSW5kaWNlczogbWF0Y2hlZEluZGljZXMsCiAgICAgICAgc2hvd1N5c3RlbUluZGljZXM6IGluZGV4UGF0dGVybkNyZWF0aW9uVHlwZS5nZXRTaG93U3lzdGVtSW5kaWNlcygpLAogICAgICAgIGlzSW5jbHVkaW5nU3lzdGVtSW5kaWNlczogaXNJbmNsdWRpbmdTeXN0ZW1JbmRpY2VzLAogICAgICAgIHF1ZXJ5OiBxdWVyeQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJMaXN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJMaXN0KF9yZWY2KSB7CiAgICAgIHZhciB2aXNpYmxlSW5kaWNlcyA9IF9yZWY2LnZpc2libGVJbmRpY2VzLAogICAgICAgICAgYWxsSW5kaWNlcyA9IF9yZWY2LmFsbEluZGljZXM7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTIgPSB0aGlzLnN0YXRlLAogICAgICAgICAgcXVlcnkgPSBfdGhpcyRzdGF0ZTIucXVlcnksCiAgICAgICAgICBpc0xvYWRpbmdJbmRpY2VzID0gX3RoaXMkc3RhdGUyLmlzTG9hZGluZ0luZGljZXMsCiAgICAgICAgICBpbmRleFBhdHRlcm5FeGlzdHMgPSBfdGhpcyRzdGF0ZTIuaW5kZXhQYXR0ZXJuRXhpc3RzOwoKICAgICAgaWYgKGlzTG9hZGluZ0luZGljZXMgfHwgaW5kZXhQYXR0ZXJuRXhpc3RzKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBpbmRpY2VzVG9MaXN0ID0gcXVlcnkubGVuZ3RoID8gdmlzaWJsZUluZGljZXMgOiBhbGxJbmRpY2VzOwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfaW5kaWNlc19saXN0LkluZGljZXNMaXN0LCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImNyZWF0ZUluZGV4UGF0dGVyblN0ZXAxSW5kaWNlc0xpc3QiLAogICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICBpbmRpY2VzOiBpbmRpY2VzVG9MaXN0CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckluZGV4UGF0dGVybkV4aXN0cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVySW5kZXhQYXR0ZXJuRXhpc3RzKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUzID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGluZGV4UGF0dGVybkV4aXN0cyA9IF90aGlzJHN0YXRlMy5pbmRleFBhdHRlcm5FeGlzdHMsCiAgICAgICAgICBxdWVyeSA9IF90aGlzJHN0YXRlMy5xdWVyeTsKCiAgICAgIGlmICghaW5kZXhQYXR0ZXJuRXhpc3RzKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ2FsbE91dCwgewogICAgICAgIHRpdGxlOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5jcmVhdGVJbmRleFBhdHRlcm4uc3RlcC53YXJuaW5nSGVhZGVyIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiVGhlcmUncyBhbHJlYWR5IGFuIGluZGV4IHBhdHRlcm4gY2FsbGVkIHtxdWVyeX0iLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeQogICAgICAgICAgfQogICAgICAgIH0pLAogICAgICAgIGljb25UeXBlOiAiaGVscCIsCiAgICAgICAgY29sb3I6ICJ3YXJuaW5nIgogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJIZWFkZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckhlYWRlcihfcmVmNykgewogICAgICB2YXIgaW5kaWNlcyA9IF9yZWY3LmV4YWN0TWF0Y2hlZEluZGljZXM7CiAgICAgIHZhciBfdGhpcyRwcm9wczIgPSB0aGlzLnByb3BzLAogICAgICAgICAgZ29Ub05leHRTdGVwID0gX3RoaXMkcHJvcHMyLmdvVG9OZXh0U3RlcCwKICAgICAgICAgIGluZGV4UGF0dGVybkNyZWF0aW9uVHlwZSA9IF90aGlzJHByb3BzMi5pbmRleFBhdHRlcm5DcmVhdGlvblR5cGUsCiAgICAgICAgICBpbnRsID0gX3RoaXMkcHJvcHMyLmludGw7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTQgPSB0aGlzLnN0YXRlLAogICAgICAgICAgcXVlcnkgPSBfdGhpcyRzdGF0ZTQucXVlcnksCiAgICAgICAgICBzaG93aW5nSW5kZXhQYXR0ZXJuUXVlcnlFcnJvcnMgPSBfdGhpcyRzdGF0ZTQuc2hvd2luZ0luZGV4UGF0dGVyblF1ZXJ5RXJyb3JzLAogICAgICAgICAgaW5kZXhQYXR0ZXJuRXhpc3RzID0gX3RoaXMkc3RhdGU0LmluZGV4UGF0dGVybkV4aXN0cywKICAgICAgICAgIGluZGV4UGF0dGVybk5hbWUgPSBfdGhpcyRzdGF0ZTQuaW5kZXhQYXR0ZXJuTmFtZTsKICAgICAgdmFyIGNvbnRhaW5zRXJyb3JzID0gZmFsc2U7CiAgICAgIHZhciBlcnJvcnMgPSBbXTsKICAgICAgdmFyIGNoYXJhY3Rlckxpc3QgPSB0aGlzLklMTEVHQUxfQ0hBUkFDVEVSUy5zbGljZSgwLCB0aGlzLklMTEVHQUxfQ0hBUkFDVEVSUy5sZW5ndGggLSAxKS5qb2luKCcsICcpOwogICAgICB2YXIgY2hlY2tJbmRpY2VzID0gaW5kZXhQYXR0ZXJuQ3JlYXRpb25UeXBlLmNoZWNrSW5kaWNlc0ZvckVycm9ycyhpbmRpY2VzKTsKCiAgICAgIGlmICghcXVlcnkgfHwgIXF1ZXJ5Lmxlbmd0aCB8fCBxdWVyeSA9PT0gJy4nIHx8IHF1ZXJ5ID09PSAnLi4nKSB7CiAgICAgICAgLy8gVGhpcyBpcyBhbiBlcnJvciBzY2VuYXJpbyBidXQgZG8gbm90IHJlcG9ydCBhbiBlcnJvcgogICAgICAgIGNvbnRhaW5zRXJyb3JzID0gdHJ1ZTsKICAgICAgfSBlbHNlIGlmICgoMCwgX2xpYi5jb250YWluc0lsbGVnYWxDaGFyYWN0ZXJzKShxdWVyeSwgX2luZGV4X3BhdHRlcm5zLklOREVYX1BBVFRFUk5fSUxMRUdBTF9DSEFSQUNURVJTKSkgewogICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSBpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICdrYm4ubWFuYWdlbWVudC5jcmVhdGVJbmRleFBhdHRlcm4uc3RlcC5pbnZhbGlkQ2hhcmFjdGVyc0Vycm9yTWVzc2FnZScsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0Ege2luZGV4UGF0dGVybk5hbWV9IGNhbm5vdCBjb250YWluIHNwYWNlcyBvciB0aGUgY2hhcmFjdGVyczoge2NoYXJhY3Rlckxpc3R9JwogICAgICAgIH0sIHsKICAgICAgICAgIGNoYXJhY3Rlckxpc3Q6IGNoYXJhY3Rlckxpc3QsCiAgICAgICAgICBpbmRleFBhdHRlcm5OYW1lOiBpbmRleFBhdHRlcm5OYW1lCiAgICAgICAgfSk7CiAgICAgICAgZXJyb3JzLnB1c2goZXJyb3JNZXNzYWdlKTsKICAgICAgICBjb250YWluc0Vycm9ycyA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoY2hlY2tJbmRpY2VzKSB7CiAgICAgICAgZXJyb3JzLnB1c2guYXBwbHkoZXJyb3JzLCBfdG9Db25zdW1hYmxlQXJyYXkoY2hlY2tJbmRpY2VzKSk7CiAgICAgICAgY29udGFpbnNFcnJvcnMgPSB0cnVlOwogICAgICB9CgogICAgICB2YXIgaXNJbnB1dEludmFsaWQgPSBzaG93aW5nSW5kZXhQYXR0ZXJuUXVlcnlFcnJvcnMgJiYgY29udGFpbnNFcnJvcnMgJiYgZXJyb3JzLmxlbmd0aCA+IDA7CiAgICAgIHZhciBpc05leHRTdGVwRGlzYWJsZWQgPSBjb250YWluc0Vycm9ycyB8fCBpbmRpY2VzLmxlbmd0aCA9PT0gMCB8fCBpbmRleFBhdHRlcm5FeGlzdHM7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9oZWFkZXIuSGVhZGVyLCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImNyZWF0ZUluZGV4UGF0dGVyblN0ZXAxSGVhZGVyIiwKICAgICAgICBpc0lucHV0SW52YWxpZDogaXNJbnB1dEludmFsaWQsCiAgICAgICAgZXJyb3JzOiBlcnJvcnMsCiAgICAgICAgY2hhcmFjdGVyTGlzdDogY2hhcmFjdGVyTGlzdCwKICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgb25RdWVyeUNoYW5nZWQ6IHRoaXMub25RdWVyeUNoYW5nZWQsCiAgICAgICAgZ29Ub05leHRTdGVwOiBnb1RvTmV4dFN0ZXAsCiAgICAgICAgaXNOZXh0U3RlcERpc2FibGVkOiBpc05leHRTdGVwRGlzYWJsZWQKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wczMgPSB0aGlzLnByb3BzLAogICAgICAgICAgaXNJbmNsdWRpbmdTeXN0ZW1JbmRpY2VzID0gX3RoaXMkcHJvcHMzLmlzSW5jbHVkaW5nU3lzdGVtSW5kaWNlcywKICAgICAgICAgIGFsbEluZGljZXMgPSBfdGhpcyRwcm9wczMuYWxsSW5kaWNlczsKICAgICAgdmFyIF90aGlzJHN0YXRlNSA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBxdWVyeSA9IF90aGlzJHN0YXRlNS5xdWVyeSwKICAgICAgICAgIHBhcnRpYWxNYXRjaGVkSW5kaWNlcyA9IF90aGlzJHN0YXRlNS5wYXJ0aWFsTWF0Y2hlZEluZGljZXMsCiAgICAgICAgICBleGFjdE1hdGNoZWRJbmRpY2VzID0gX3RoaXMkc3RhdGU1LmV4YWN0TWF0Y2hlZEluZGljZXM7CiAgICAgIHZhciBtYXRjaGVkSW5kaWNlcyA9ICgwLCBfbGliLmdldE1hdGNoZWRJbmRpY2VzKShhbGxJbmRpY2VzLCBwYXJ0aWFsTWF0Y2hlZEluZGljZXMsIGV4YWN0TWF0Y2hlZEluZGljZXMsIHF1ZXJ5LCBpc0luY2x1ZGluZ1N5c3RlbUluZGljZXMpOwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBhbmVsLCB7CiAgICAgICAgcGFkZGluZ1NpemU6ICJsIgogICAgICB9LCB0aGlzLnJlbmRlckhlYWRlcihtYXRjaGVkSW5kaWNlcyksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAicyIKICAgICAgfSksIHRoaXMucmVuZGVyTG9hZGluZ1N0YXRlKG1hdGNoZWRJbmRpY2VzKSwgdGhpcy5yZW5kZXJJbmRleFBhdHRlcm5FeGlzdHMoKSwgdGhpcy5yZW5kZXJTdGF0dXNNZXNzYWdlKG1hdGNoZWRJbmRpY2VzKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJzIgogICAgICB9KSwgdGhpcy5yZW5kZXJMaXN0KG1hdGNoZWRJbmRpY2VzKSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gU3RlcEluZGV4UGF0dGVybkNvbXBvbmVudDsKfShfcmVhY3QuQ29tcG9uZW50KTsKCmV4cG9ydHMuU3RlcEluZGV4UGF0dGVybkNvbXBvbmVudCA9IFN0ZXBJbmRleFBhdHRlcm5Db21wb25lbnQ7CgpfZGVmaW5lUHJvcGVydHkoU3RlcEluZGV4UGF0dGVybkNvbXBvbmVudCwgInByb3BUeXBlcyIsIHsKICBhbGxJbmRpY2VzOiBfcHJvcFR5cGVzLmRlZmF1bHQuYXJyYXkuaXNSZXF1aXJlZCwKICBpc0luY2x1ZGluZ1N5c3RlbUluZGljZXM6IF9wcm9wVHlwZXMuZGVmYXVsdC5ib29sLmlzUmVxdWlyZWQsCiAgZXNTZXJ2aWNlOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LmlzUmVxdWlyZWQsCiAgc2F2ZWRPYmplY3RzQ2xpZW50OiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LmlzUmVxdWlyZWQsCiAgaW5kZXhQYXR0ZXJuQ3JlYXRpb25UeXBlOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LmlzUmVxdWlyZWQsCiAgZ29Ub05leHRTdGVwOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYy5pc1JlcXVpcmVkLAogIGluaXRpYWxRdWVyeTogX3Byb3BUeXBlcy5kZWZhdWx0LnN0cmluZwp9KTsKCl9kZWZpbmVQcm9wZXJ0eShTdGVwSW5kZXhQYXR0ZXJuQ29tcG9uZW50LCAiZGVmYXVsdFByb3BzIiwgewogIGluaXRpYWxRdWVyeTogdWlTZXR0aW5ncy5nZXQoJ2luZGV4UGF0dGVybjpwbGFjZWhvbGRlcicpCn0pOwoKdmFyIFN0ZXBJbmRleFBhdHRlcm4gPSAoMCwgX3JlYWN0Mi5pbmplY3RJMThuKShTdGVwSW5kZXhQYXR0ZXJuQ29tcG9uZW50KTsKZXhwb3J0cy5TdGVwSW5kZXhQYXR0ZXJuID0gU3RlcEluZGV4UGF0dGVybjs="},null]}