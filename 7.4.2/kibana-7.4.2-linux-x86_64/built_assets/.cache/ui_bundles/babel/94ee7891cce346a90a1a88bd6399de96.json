{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/console/public/src/autocomplete.js","dependencies":[{"path":"src/legacy/core_plugins/console/public/src/autocomplete.js","mtime":1572296409220},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmdldEVuZHBvaW50RnJvbVBvc2l0aW9uID0gZ2V0RW5kcG9pbnRGcm9tUG9zaXRpb247CmV4cG9ydHMuZGVmYXVsdCA9IF9kZWZhdWx0OwoKdmFyIF9rYiA9IHJlcXVpcmUoIi4va2IiKTsKCnZhciBfdXRpbHMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIi4vdXRpbHMiKSk7Cgp2YXIgX2VuZ2luZSA9IHJlcXVpcmUoIi4vYXV0b2NvbXBsZXRlL2VuZ2luZSIpOwoKdmFyIF9jb21wb25lbnRzID0gcmVxdWlyZSgiLi9hdXRvY29tcGxldGUvY29tcG9uZW50cyIpOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfYnJhY2UgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImJyYWNlIikpOwoKcmVxdWlyZSgiYnJhY2UvZXh0L2xhbmd1YWdlX3Rvb2xzIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCnZhciBBY2VSYW5nZSA9IF9icmFjZS5kZWZhdWx0LmFjZXF1aXJlKCdhY2UvcmFuZ2UnKS5SYW5nZTsKCnZhciBMQVNUX0VWQUxVQVRFRF9UT0tFTiA9IG51bGw7CgpmdW5jdGlvbiBpc1VybFBhcmFtc1Rva2VuKHRva2VuKSB7CiAgc3dpdGNoICgodG9rZW4gfHwge30pLnR5cGUpIHsKICAgIGNhc2UgJ3VybC5wYXJhbSc6CiAgICBjYXNlICd1cmwuZXF1YWwnOgogICAgY2FzZSAndXJsLnZhbHVlJzoKICAgIGNhc2UgJ3VybC5xdWVzdGlvbm1hcmsnOgogICAgY2FzZSAndXJsLmFtcCc6CiAgICAgIHJldHVybiB0cnVlOwoKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiBmYWxzZTsKICB9Cn0KCmZ1bmN0aW9uIGdldEN1cnJlbnRNZXRob2RBbmRUb2tlblBhdGhzKGVkaXRvciwgcG9zLCBmb3JjZUVuZE9mVXJsKSB7CiAgdmFyIHRva2VuSXRlciA9IGVkaXRvci5pdGVyRm9yUG9zaXRpb24ocG9zLnJvdywgcG9zLmNvbHVtbik7CiAgdmFyIHN0YXJ0UG9zID0gcG9zOwogIHZhciBib2R5VG9rZW5QYXRoID0gW107CiAgdmFyIHJldCA9IHt9OwogIHZhciBTVEFURVMgPSB7CiAgICBsb29raW5nX2Zvcl9rZXk6IDAsCiAgICAvLyBsb29raW5nIGZvciBhIGtleSBidXQgd2l0aG91dCBqdW1waW5nIG92ZXIgYW55dGhpbmcgYnV0IHdoaXRlIHNwYWNlIGFuZCBjb2xvbi4KICAgIGxvb2tpbmdfZm9yX3Njb3BlX3N0YXJ0OiAxLAogICAgLy8gc2tpcCBldmVyeXRoaW5nIHVudGlsIHNjb3BlIHN0YXJ0CiAgICBzdGFydDogMwogIH07CiAgdmFyIHN0YXRlID0gU1RBVEVTLnN0YXJ0OyAvLyBpbml0aWFsaXphdGlvbiBwcm9ibGVtcyAtCgogIHZhciB0ID0gdG9rZW5JdGVyLmdldEN1cnJlbnRUb2tlbigpOwoKICBpZiAodCkgewogICAgaWYgKHN0YXJ0UG9zLmNvbHVtbiA9PT0gMCkgewogICAgICAvLyBpZiB3ZSBhcmUgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgbGluZSwgdGhlIGN1cnJlbnQgdG9rZW4gaXMgdGhlIG9uZSBhZnRlciBjdXJzb3IsIG5vdCBiZWZvcmUgd2hpY2gKICAgICAgLy8gZGV2aWF0ZXMgZnJvbSB0aGUgc3RhbmRhcmQuCiAgICAgIHQgPSB0b2tlbkl0ZXIuc3RlcEJhY2t3YXJkKCk7CiAgICAgIHN0YXRlID0gU1RBVEVTLmxvb2tpbmdfZm9yX3Njb3BlX3N0YXJ0OwogICAgfQogIH0gZWxzZSB7CiAgICBpZiAoc3RhcnRQb3MuY29sdW1uID09PSAwKSB7CiAgICAgIC8vIGVtcHR5IGxpbmVzIGRvIG5vIGhhdmUgdG9rZW5zLCBtb3ZlIG9uZSBiYWNrCiAgICAgIHQgPSB0b2tlbkl0ZXIuc3RlcEJhY2t3YXJkKCk7CiAgICAgIHN0YXRlID0gU1RBVEVTLnN0YXJ0OwogICAgfQogIH0KCiAgdmFyIHdhbGtlZFNvbWVCb2R5ID0gZmFsc2U7IC8vIGNsaW1iIG9uZSBzY29wZSBhdCBhIHRpbWUgYW5kIGdldCB0aGUgc2NvcGUga2V5CgogIGZvciAoOyB0ICYmIHQudHlwZS5pbmRleE9mKCd1cmwnKSA9PT0gLTEgJiYgdC50eXBlICE9PSAnbWV0aG9kJzsgdCA9IHRva2VuSXRlci5zdGVwQmFja3dhcmQoKSkgewogICAgaWYgKHQudHlwZSAhPT0gJ3doaXRlc3BhY2UnKSB7CiAgICAgIHdhbGtlZFNvbWVCb2R5ID0gdHJ1ZTsKICAgIH0gLy8gbWFya3Mgd2Ugc2F3IHNvbWV0aGluZwoKCiAgICBzd2l0Y2ggKHQudHlwZSkgewogICAgICBjYXNlICd2YXJpYWJsZSc6CiAgICAgICAgaWYgKHN0YXRlID09PSBTVEFURVMubG9va2luZ19mb3Jfa2V5KSB7CiAgICAgICAgICBib2R5VG9rZW5QYXRoLnVuc2hpZnQodC52YWx1ZS50cmltKCkucmVwbGFjZSgvIi9nLCAnJykpOwogICAgICAgIH0KCiAgICAgICAgc3RhdGUgPSBTVEFURVMubG9va2luZ19mb3Jfc2NvcGVfc3RhcnQ7IC8vIHNraXAgZXZlcnl0aGluZyB1bnRpbCB0aGUgYmVnaW5uaW5nIG9mIHRoaXMgc2NvcGUKCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdwYXJlbi5scGFyZW4nOgogICAgICAgIGJvZHlUb2tlblBhdGgudW5zaGlmdCh0LnZhbHVlKTsKCiAgICAgICAgaWYgKHN0YXRlID09PSBTVEFURVMubG9va2luZ19mb3Jfc2NvcGVfc3RhcnQpIHsKICAgICAgICAgIC8vIGZvdW5kIGl0LiBnbyBsb29rIGZvciB0aGUgcmVsZXZhbnQga2V5CiAgICAgICAgICBzdGF0ZSA9IFNUQVRFUy5sb29raW5nX2Zvcl9rZXk7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3BhcmVuLnJwYXJlbic6CiAgICAgICAgLy8gcmVzZXQgaGUgc2VhcmNoIGZvciBrZXkKICAgICAgICBzdGF0ZSA9IFNUQVRFUy5sb29raW5nX2Zvcl9zY29wZV9zdGFydDsgLy8gYW5kIGlnbm9yZSB0aGlzIHN1YiBzY29wZS4uCgogICAgICAgIHZhciBwYXJlbkNvdW50ID0gMTsKICAgICAgICB0ID0gdG9rZW5JdGVyLnN0ZXBCYWNrd2FyZCgpOwoKICAgICAgICB3aGlsZSAodCAmJiBwYXJlbkNvdW50ID4gMCkgewogICAgICAgICAgc3dpdGNoICh0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAncGFyZW4ubHBhcmVuJzoKICAgICAgICAgICAgICBwYXJlbkNvdW50LS07CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdwYXJlbi5ycGFyZW4nOgogICAgICAgICAgICAgIHBhcmVuQ291bnQrKzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocGFyZW5Db3VudCA+IDApIHsKICAgICAgICAgICAgdCA9IHRva2VuSXRlci5zdGVwQmFja3dhcmQoKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghdCkgLy8gb29wcyB3ZSBydW4gb3V0Li4gd2UgZG9uJ3Qga25vdyB3aGF0J3MgdXAgcmV0dXJuIG51bGw7CiAgICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICAgIH0KCiAgICAgICAgY29udGludWU7CgogICAgICBjYXNlICdwdW5jdHVhdGlvbi5lbmRfdHJpcGxlX3F1b3RlJzoKICAgICAgICAvLyByZXNldCB0aGUgc2VhcmNoIGZvciBrZXkKICAgICAgICBzdGF0ZSA9IFNUQVRFUy5sb29raW5nX2Zvcl9zY29wZV9zdGFydDsKCiAgICAgICAgZm9yICh0ID0gdG9rZW5JdGVyLnN0ZXBCYWNrd2FyZCgpOyB0OyB0ID0gdG9rZW5JdGVyLnN0ZXBCYWNrd2FyZCgpKSB7CiAgICAgICAgICBpZiAodC50eXBlID09PSAncHVuY3R1YXRpb24uc3RhcnRfdHJpcGxlX3F1b3RlJykgewogICAgICAgICAgICB0ID0gdG9rZW5JdGVyLnN0ZXBCYWNrd2FyZCgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghdCkgLy8gb29wcyB3ZSBydW4gb3V0Li4gd2UgZG9uJ3Qga25vdyB3aGF0J3MgdXAgcmV0dXJuIG51bGw7CiAgICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICAgIH0KCiAgICAgICAgY29udGludWU7CgogICAgICBjYXNlICdwdW5jdHVhdGlvbi5zdGFydF90cmlwbGVfcXVvdGUnOgogICAgICAgIGlmIChzdGF0ZSA9PT0gU1RBVEVTLnN0YXJ0KSB7CiAgICAgICAgICBzdGF0ZSA9IFNUQVRFUy5sb29raW5nX2Zvcl9rZXk7CiAgICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gU1RBVEVTLmxvb2tpbmdfZm9yX2tleSkgewogICAgICAgICAgc3RhdGUgPSBTVEFURVMubG9va2luZ19mb3Jfc2NvcGVfc3RhcnQ7CiAgICAgICAgfQoKICAgICAgICBib2R5VG9rZW5QYXRoLnVuc2hpZnQoJyIiIicpOwogICAgICAgIGNvbnRpbnVlOwoKICAgICAgY2FzZSAnc3RyaW5nJzoKICAgICAgY2FzZSAnY29uc3RhbnQubnVtZXJpYyc6CiAgICAgIGNhc2UgJ2NvbnN0YW50Lmxhbmd1YWdlLmJvb2xlYW4nOgogICAgICBjYXNlICd0ZXh0JzoKICAgICAgICBpZiAoc3RhdGUgPT09IFNUQVRFUy5zdGFydCkgewogICAgICAgICAgc3RhdGUgPSBTVEFURVMubG9va2luZ19mb3Jfa2V5OwogICAgICAgIH0gZWxzZSBpZiAoc3RhdGUgPT09IFNUQVRFUy5sb29raW5nX2Zvcl9rZXkpIHsKICAgICAgICAgIHN0YXRlID0gU1RBVEVTLmxvb2tpbmdfZm9yX3Njb3BlX3N0YXJ0OwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdwdW5jdHVhdGlvbi5jb21tYSc6CiAgICAgICAgaWYgKHN0YXRlID09PSBTVEFURVMuc3RhcnQpIHsKICAgICAgICAgIHN0YXRlID0gU1RBVEVTLmxvb2tpbmdfZm9yX3Njb3BlX3N0YXJ0OwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdwdW5jdHVhdGlvbi5jb2xvbic6CiAgICAgIGNhc2UgJ3doaXRlc3BhY2UnOgogICAgICAgIGlmIChzdGF0ZSA9PT0gU1RBVEVTLnN0YXJ0KSB7CiAgICAgICAgICBzdGF0ZSA9IFNUQVRFUy5sb29raW5nX2Zvcl9rZXk7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKICAgICAgLy8gc2tpcCB3aGl0ZSBzcGFjZQogICAgfQogIH0KCiAgaWYgKHdhbGtlZFNvbWVCb2R5ICYmICghYm9keVRva2VuUGF0aCB8fCBib2R5VG9rZW5QYXRoLmxlbmd0aCA9PT0gMCkpIHsKICAgIC8vIHdlIGhhZCBzb21lIGNvbnRlbnQgYW5kIHN0aWxsIG5vIHBhdGggLT4gdGhlIGN1cnNvciBpcyBwb3NpdGlvbiBhZnRlciBhIGNsb3NlZCBib2R5IC0+IG5vIGF1dG8gY29tcGxldGUKICAgIHJldHVybiB7fTsKICB9CgogIHJldC51cmxUb2tlblBhdGggPSBbXTsKCiAgaWYgKHRva2VuSXRlci5nZXRDdXJyZW50VG9rZW5Sb3coKSA9PT0gc3RhcnRQb3Mucm93KSB7CiAgICBpZiAodCAmJiAodC50eXBlID09PSAndXJsLnBhcnQnIHx8IHQudHlwZSA9PT0gJ3VybC5wYXJhbScgfHwgdC50eXBlID09PSAndXJsLnZhbHVlJykpIHsKICAgICAgLy8gd2UgYXJlIGZvcmNpbmcgdGhlIGVuZCBvZiB0aGUgdXJsIGZvciB0aGUgcHVycG9zZXMgb2YgZGV0ZXJtaW5pbmcgYW4gZW5kcG9pbnQKICAgICAgaWYgKGZvcmNlRW5kT2ZVcmwgJiYgdC50eXBlID09PSAndXJsLnBhcnQnKSB7CiAgICAgICAgcmV0LnVybFRva2VuUGF0aC5wdXNoKHQudmFsdWUpOwogICAgICAgIHJldC51cmxUb2tlblBhdGgucHVzaChfY29tcG9uZW50cy5VUkxfUEFUSF9FTkRfTUFSS0VSKTsKICAgICAgfSAvLyB3ZSBhcmUgb24gdGhlIHNhbWUgbGluZSBhcyBjdXJzb3IgYW5kIGRlYWxpbmcgd2l0aCBhIHVybC4gQ3VycmVudCB0b2tlbiBpcyBub3QgcGFydCBvZiB0aGUgY29udGV4dAoKCiAgICAgIHQgPSB0b2tlbkl0ZXIuc3RlcEJhY2t3YXJkKCk7IC8vIFRoaXMgd2lsbCBmb3JjZSBtZXRob2QgcGFyc2luZwoKICAgICAgd2hpbGUgKHQudHlwZSA9PT0gJ3doaXRlc3BhY2UnKSB7CiAgICAgICAgdCA9IHRva2VuSXRlci5zdGVwQmFja3dhcmQoKTsKICAgICAgfQogICAgfQoKICAgIGJvZHlUb2tlblBhdGggPSBudWxsOyAvLyBubyBub3Qgb24gYSBib2R5IGxpbmUuCiAgfQoKICByZXQuYm9keVRva2VuUGF0aCA9IGJvZHlUb2tlblBhdGg7CiAgcmV0LnVybFBhcmFtc1Rva2VuUGF0aCA9IG51bGw7CiAgcmV0LnJlcXVlc3RTdGFydFJvdyA9IHRva2VuSXRlci5nZXRDdXJyZW50VG9rZW5Sb3coKTsKICB2YXIgY3VyVXJsUGFydDsKCiAgd2hpbGUgKHQgJiYgaXNVcmxQYXJhbXNUb2tlbih0KSkgewogICAgc3dpdGNoICh0LnR5cGUpIHsKICAgICAgY2FzZSAndXJsLnZhbHVlJzoKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjdXJVcmxQYXJ0KSkgewogICAgICAgICAgY3VyVXJsUGFydC51bnNoaWZ0KHQudmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAoY3VyVXJsUGFydCkgewogICAgICAgICAgY3VyVXJsUGFydCA9IFt0LnZhbHVlLCBjdXJVcmxQYXJ0XTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VyVXJsUGFydCA9IHQudmFsdWU7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3VybC5jb21tYSc6CiAgICAgICAgaWYgKCFjdXJVcmxQYXJ0KSB7CiAgICAgICAgICBjdXJVcmxQYXJ0ID0gW107CiAgICAgICAgfSBlbHNlIGlmICghQXJyYXkuaXNBcnJheShjdXJVcmxQYXJ0KSkgewogICAgICAgICAgY3VyVXJsUGFydCA9IFtjdXJVcmxQYXJ0XTsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAndXJsLnBhcmFtJzoKICAgICAgICB2YXIgdiA9IGN1clVybFBhcnQ7CiAgICAgICAgY3VyVXJsUGFydCA9IHt9OwogICAgICAgIGN1clVybFBhcnRbdC52YWx1ZV0gPSB2OwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAndXJsLmFtcCc6CiAgICAgIGNhc2UgJ3VybC5xdWVzdGlvbm1hcmsnOgogICAgICAgIGlmICghcmV0LnVybFBhcmFtc1Rva2VuUGF0aCkgewogICAgICAgICAgcmV0LnVybFBhcmFtc1Rva2VuUGF0aCA9IFtdOwogICAgICAgIH0KCiAgICAgICAgcmV0LnVybFBhcmFtc1Rva2VuUGF0aC51bnNoaWZ0KGN1clVybFBhcnQgfHwge30pOwogICAgICAgIGN1clVybFBhcnQgPSBudWxsOwogICAgICAgIGJyZWFrOwogICAgfQoKICAgIHQgPSB0b2tlbkl0ZXIuc3RlcEJhY2t3YXJkKCk7CiAgfQoKICBjdXJVcmxQYXJ0ID0gbnVsbDsKCiAgd2hpbGUgKHQgJiYgdC50eXBlLmluZGV4T2YoJ3VybCcpICE9PSAtMSkgewogICAgc3dpdGNoICh0LnR5cGUpIHsKICAgICAgY2FzZSAndXJsLnBhcnQnOgogICAgICAgIGlmIChBcnJheS5pc0FycmF5KGN1clVybFBhcnQpKSB7CiAgICAgICAgICBjdXJVcmxQYXJ0LnVuc2hpZnQodC52YWx1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChjdXJVcmxQYXJ0KSB7CiAgICAgICAgICBjdXJVcmxQYXJ0ID0gW3QudmFsdWUsIGN1clVybFBhcnRdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdXJVcmxQYXJ0ID0gdC52YWx1ZTsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAndXJsLmNvbW1hJzoKICAgICAgICBpZiAoIWN1clVybFBhcnQpIHsKICAgICAgICAgIGN1clVybFBhcnQgPSBbXTsKICAgICAgICB9IGVsc2UgaWYgKCFBcnJheS5pc0FycmF5KGN1clVybFBhcnQpKSB7CiAgICAgICAgICBjdXJVcmxQYXJ0ID0gW2N1clVybFBhcnRdOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICd1cmwuc2xhc2gnOgogICAgICAgIGlmIChjdXJVcmxQYXJ0KSB7CiAgICAgICAgICByZXQudXJsVG9rZW5QYXRoLnVuc2hpZnQoY3VyVXJsUGFydCk7CiAgICAgICAgICBjdXJVcmxQYXJ0ID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwogICAgfQoKICAgIHQgPSBlZGl0b3IucGFyc2VyLnByZXZOb25FbXB0eVRva2VuKHRva2VuSXRlcik7CiAgfQoKICBpZiAoY3VyVXJsUGFydCkgewogICAgcmV0LnVybFRva2VuUGF0aC51bnNoaWZ0KGN1clVybFBhcnQpOwogIH0KCiAgaWYgKCFyZXQuYm9keVRva2VuUGF0aCAmJiAhcmV0LnVybFBhcmFtc1Rva2VuUGF0aCkgewogICAgaWYgKHJldC51cmxUb2tlblBhdGgubGVuZ3RoID4gMCkgewogICAgICAvLyAgIC8vIHN0YXJ0ZWQgb24gdGhlIHVybCwgZmlyc3QgdG9rZW4gaXMgY3VycmVudCB0b2tlbgogICAgICByZXQub3RoZXJUb2tlblZhbHVlcyA9IHJldC51cmxUb2tlblBhdGhbMF07CiAgICB9CiAgfSBlbHNlIHsKICAgIC8vIG1hcmsgdGhlIHVybCBhcyBjb21wbGV0ZWQuCiAgICByZXQudXJsVG9rZW5QYXRoLnB1c2goX2NvbXBvbmVudHMuVVJMX1BBVEhfRU5EX01BUktFUik7CiAgfQoKICBpZiAodCAmJiB0LnR5cGUgPT09ICdtZXRob2QnKSB7CiAgICByZXQubWV0aG9kID0gdC52YWx1ZTsKICB9CgogIHJldHVybiByZXQ7Cn0KCmZ1bmN0aW9uIGdldEVuZHBvaW50RnJvbVBvc2l0aW9uKGVkaXRvciwgcG9zKSB7CiAgdmFyIGNvbnRleHQgPSBfb2JqZWN0U3ByZWFkKHt9LCBnZXRDdXJyZW50TWV0aG9kQW5kVG9rZW5QYXRocyhlZGl0b3IsIHBvcywgdHJ1ZSkpOwoKICB2YXIgY29tcG9uZW50cyA9ICgwLCBfa2IuZ2V0VG9wTGV2ZWxVcmxDb21wbGV0ZUNvbXBvbmVudHMpKGNvbnRleHQubWV0aG9kKTsKICAoMCwgX2VuZ2luZS5wb3B1bGF0ZUNvbnRleHQpKGNvbnRleHQudXJsVG9rZW5QYXRoLCBjb250ZXh0LCBlZGl0b3IsIHRydWUsIGNvbXBvbmVudHMpOwogIHJldHVybiBjb250ZXh0LmVuZHBvaW50Owp9CgpmdW5jdGlvbiBfZGVmYXVsdChlZGl0b3IpIHsKICBmdW5jdGlvbiBpc1VybFBhdGhUb2tlbih0b2tlbikgewogICAgc3dpdGNoICgodG9rZW4gfHwge30pLnR5cGUpIHsKICAgICAgY2FzZSAndXJsLnNsYXNoJzoKICAgICAgY2FzZSAndXJsLmNvbW1hJzoKICAgICAgY2FzZSAndXJsLnBhcnQnOgogICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhZGRNZXRhVG9UZXJtc0xpc3QobGlzdCwgbWV0YSwgdGVtcGxhdGUpIHsKICAgIHJldHVybiBfbG9kYXNoLmRlZmF1bHQubWFwKGxpc3QsIGZ1bmN0aW9uICh0KSB7CiAgICAgIGlmIChfdHlwZW9mKHQpICE9PSAnb2JqZWN0JykgewogICAgICAgIHQgPSB7CiAgICAgICAgICBuYW1lOiB0CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9sb2Rhc2guZGVmYXVsdC5kZWZhdWx0cyh0LCB7CiAgICAgICAgbWV0YTogbWV0YSwKICAgICAgICB0ZW1wbGF0ZTogdGVtcGxhdGUKICAgICAgfSk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGFwcGx5VGVybSh0ZXJtKSB7CiAgICB2YXIgc2Vzc2lvbiA9IGVkaXRvci5nZXRTZXNzaW9uKCk7CiAgICB2YXIgY29udGV4dCA9IHRlcm0uY29udGV4dDsgLy8gbWFrZSBzdXJlIHdlIGdldCB1cCB0byBkYXRlIHJlcGxhY2VtZW50IGluZm8uCgogICAgYWRkUmVwbGFjZW1lbnRJbmZvVG9Db250ZXh0KGNvbnRleHQsIGVkaXRvci5nZXRDdXJzb3JQb3NpdGlvbigpLCB0ZXJtLmluc2VydFZhbHVlKTsKICAgIHZhciB0ZXJtQXNTdHJpbmc7CgogICAgaWYgKGNvbnRleHQuYXV0b0NvbXBsZXRlVHlwZSA9PT0gJ2JvZHknKSB7CiAgICAgIHRlcm1Bc1N0cmluZyA9IHR5cGVvZiB0ZXJtLmluc2VydFZhbHVlID09PSAnc3RyaW5nJyA/ICciJyArIHRlcm0uaW5zZXJ0VmFsdWUgKyAnIicgOiB0ZXJtLmluc2VydFZhbHVlICsgJyc7CgogICAgICBpZiAodGVybS5pbnNlcnRWYWx1ZSA9PT0gJ1snIHx8IHRlcm0uaW5zZXJ0VmFsdWUgPT09ICd7JykgewogICAgICAgIHRlcm1Bc1N0cmluZyA9ICcnOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0ZXJtQXNTdHJpbmcgPSB0ZXJtLmluc2VydFZhbHVlICsgJyc7CiAgICB9CgogICAgdmFyIHZhbHVlVG9JbnNlcnQgPSB0ZXJtQXNTdHJpbmc7CiAgICB2YXIgdGVtcGxhdGVJbnNlcnRlZCA9IGZhbHNlOwoKICAgIGlmIChjb250ZXh0LmFkZFRlbXBsYXRlICYmICFfbG9kYXNoLmRlZmF1bHQuaXNVbmRlZmluZWQodGVybS50ZW1wbGF0ZSkgJiYgIV9sb2Rhc2guZGVmYXVsdC5pc051bGwodGVybS50ZW1wbGF0ZSkpIHsKICAgICAgdmFyIGluZGVudGVkVGVtcGxhdGVMaW5lcyA9IF91dGlscy5kZWZhdWx0Lmpzb25Ub1N0cmluZyh0ZXJtLnRlbXBsYXRlLCB0cnVlKS5zcGxpdCgnXG4nKTsKCiAgICAgIHZhciBjdXJyZW50SW5kZW50YXRpb24gPSBzZXNzaW9uLmdldExpbmUoY29udGV4dC5yYW5nZVRvUmVwbGFjZS5zdGFydC5yb3cpOwogICAgICBjdXJyZW50SW5kZW50YXRpb24gPSBjdXJyZW50SW5kZW50YXRpb24ubWF0Y2goL15ccyovKVswXTsKCiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgaW5kZW50ZWRUZW1wbGF0ZUxpbmVzLmxlbmd0aDsgaSsrKSAvLyBza2lwIGZpcnN0IGxpbmUKICAgICAgewogICAgICAgIGluZGVudGVkVGVtcGxhdGVMaW5lc1tpXSA9IGN1cnJlbnRJbmRlbnRhdGlvbiArIGluZGVudGVkVGVtcGxhdGVMaW5lc1tpXTsKICAgICAgfQoKICAgICAgdmFsdWVUb0luc2VydCArPSAnOiAnICsgaW5kZW50ZWRUZW1wbGF0ZUxpbmVzLmpvaW4oJ1xuJyk7CiAgICAgIHRlbXBsYXRlSW5zZXJ0ZWQgPSB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgdGVtcGxhdGVJbnNlcnRlZCA9IHRydWU7CgogICAgICBpZiAodGVybS52YWx1ZSA9PT0gJ1snKSB7CiAgICAgICAgdmFsdWVUb0luc2VydCArPSAnW10nOwogICAgICB9IGVsc2UgaWYgKHRlcm0udmFsdWUgPT09ICd7JykgewogICAgICAgIHZhbHVlVG9JbnNlcnQgKz0gJ3t9JzsKICAgICAgfSBlbHNlIHsKICAgICAgICB0ZW1wbGF0ZUluc2VydGVkID0gZmFsc2U7CiAgICAgIH0KICAgIH0KCiAgICB2YWx1ZVRvSW5zZXJ0ID0gY29udGV4dC5wcmVmaXhUb0FkZCArIHZhbHVlVG9JbnNlcnQgKyBjb250ZXh0LnN1ZmZpeFRvQWRkOyAvLyBkaXNhYmxlIGxpc3RlbmluZyB0byB0aGUgY2hhbmdlcyB3ZSBhcmUgbWFraW5nLgoKICAgIHJlbW92ZUNoYW5nZUxpc3RlbmVyKCk7CgogICAgaWYgKGNvbnRleHQucmFuZ2VUb1JlcGxhY2Uuc3RhcnQuY29sdW1uICE9PSBjb250ZXh0LnJhbmdlVG9SZXBsYWNlLmVuZC5jb2x1bW4pIHsKICAgICAgc2Vzc2lvbi5yZXBsYWNlKGNvbnRleHQucmFuZ2VUb1JlcGxhY2UsIHZhbHVlVG9JbnNlcnQpOwogICAgfSBlbHNlIHsKICAgICAgZWRpdG9yLmluc2VydCh2YWx1ZVRvSW5zZXJ0KTsKICAgIH0KCiAgICBlZGl0b3IuY2xlYXJTZWxlY3Rpb24oKTsgLy8gZm9yIHNvbWUgcmVhc29uIHRoZSBhYm92ZSBjaGFuZ2VzIHNlbGVjdGlvbgogICAgLy8gZ28gYmFjayB0byBzZWUgd2hldGhlciB3ZSBoYXZlIG9uZSBvZiAoIDogeyAmIFsgZG8gbm90IHJlcXVpcmUgYSBjb21tYS4gQWxsIHRoZSByZXN0IGRvLgoKICAgIHZhciBuZXdQb3MgPSB7CiAgICAgIHJvdzogY29udGV4dC5yYW5nZVRvUmVwbGFjZS5zdGFydC5yb3csCiAgICAgIGNvbHVtbjogY29udGV4dC5yYW5nZVRvUmVwbGFjZS5zdGFydC5jb2x1bW4gKyB0ZXJtQXNTdHJpbmcubGVuZ3RoICsgY29udGV4dC5wcmVmaXhUb0FkZC5sZW5ndGggKyAodGVtcGxhdGVJbnNlcnRlZCA/IDAgOiBjb250ZXh0LnN1ZmZpeFRvQWRkLmxlbmd0aCkKICAgIH07CiAgICB2YXIgdG9rZW5JdGVyID0gZWRpdG9yLml0ZXJGb3JQb3NpdGlvbihuZXdQb3Mucm93LCBuZXdQb3MuY29sdW1uKTsKCiAgICBpZiAoY29udGV4dC5hdXRvQ29tcGxldGVUeXBlID09PSAnYm9keScpIHsKICAgICAgLy8gbG9vayBmb3IgdGhlIG5leHQgcGxhY2Ugc3RhbmQsIGp1c3QgYWZ0ZXIgYSBjb21tYSwgewogICAgICB2YXIgbm9uRW1wdHlUb2tlbiA9IGVkaXRvci5wYXJzZXIubmV4dE5vbkVtcHR5VG9rZW4odG9rZW5JdGVyKTsKCiAgICAgIHN3aXRjaCAobm9uRW1wdHlUb2tlbiA/IG5vbkVtcHR5VG9rZW4udHlwZSA6ICdOT1RPS0VOJykgewogICAgICAgIGNhc2UgJ3BhcmVuLnJwYXJlbic6CiAgICAgICAgICBuZXdQb3MgPSB7CiAgICAgICAgICAgIHJvdzogdG9rZW5JdGVyLmdldEN1cnJlbnRUb2tlblJvdygpLAogICAgICAgICAgICBjb2x1bW46IHRva2VuSXRlci5nZXRDdXJyZW50VG9rZW5Db2x1bW4oKQogICAgICAgICAgfTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdwdW5jdHVhdGlvbi5jb2xvbic6CiAgICAgICAgICBub25FbXB0eVRva2VuID0gZWRpdG9yLnBhcnNlci5uZXh0Tm9uRW1wdHlUb2tlbih0b2tlbkl0ZXIpOwoKICAgICAgICAgIGlmICgobm9uRW1wdHlUb2tlbiB8fCB7fSkudHlwZSA9PT0gJ3BhcmVuLmxwYXJlbicpIHsKICAgICAgICAgICAgbm9uRW1wdHlUb2tlbiA9IGVkaXRvci5wYXJzZXIubmV4dE5vbkVtcHR5VG9rZW4odG9rZW5JdGVyKTsKICAgICAgICAgICAgbmV3UG9zID0gewogICAgICAgICAgICAgIHJvdzogdG9rZW5JdGVyLmdldEN1cnJlbnRUb2tlblJvdygpLAogICAgICAgICAgICAgIGNvbHVtbjogdG9rZW5JdGVyLmdldEN1cnJlbnRUb2tlbkNvbHVtbigpCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBpZiAobm9uRW1wdHlUb2tlbiAmJiBub25FbXB0eVRva2VuLnZhbHVlLmluZGV4T2YoJyInKSA9PT0gMCkgewogICAgICAgICAgICAgIG5ld1Bvcy5jb2x1bW4rKzsKICAgICAgICAgICAgfSAvLyBkb24ndCBzdGFuZCBvbiAiCgogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdwYXJlbi5scGFyZW4nOgogICAgICAgIGNhc2UgJ3B1bmN0dWF0aW9uLmNvbW1hJzoKICAgICAgICAgIHRva2VuSXRlci5zdGVwRm9yd2FyZCgpOwogICAgICAgICAgbmV3UG9zID0gewogICAgICAgICAgICByb3c6IHRva2VuSXRlci5nZXRDdXJyZW50VG9rZW5Sb3coKSwKICAgICAgICAgICAgY29sdW1uOiB0b2tlbkl0ZXIuZ2V0Q3VycmVudFRva2VuQ29sdW1uKCkKICAgICAgICAgIH07CiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgZWRpdG9yLm1vdmVDdXJzb3JUb1Bvc2l0aW9uKG5ld1Bvcyk7CiAgICB9IC8vIHJlLWVuYWJsZSBsaXN0ZW5pbmcgdG8gdHlwaW5nCgoKICAgIGFkZENoYW5nZUxpc3RlbmVyKCk7CiAgfQoKICBmdW5jdGlvbiBnZXRBdXRvQ29tcGxldGVDb250ZXh0KGVkaXRvciwgc2Vzc2lvbiwgcG9zKSB7CiAgICAvLyBkZWR1Y2VzIGFsbCB0aGUgcGFyYW1ldGVycyBuZWVkIHRvIHBvc2l0aW9uIGFuZCBpbnNlcnQgdGhlIGF1dG8gY29tcGxldGUKICAgIHZhciBjb250ZXh0ID0gewogICAgICBhdXRvQ29tcGxldGVTZXQ6IG51bGwsCiAgICAgIC8vIGluc3RydWN0aW9ucyBmb3Igd2hhdCBjYW4gYmUgaGVyZQogICAgICBlbmRwb2ludDogbnVsbCwKICAgICAgdXJsUGF0aDogbnVsbCwKICAgICAgbWV0aG9kOiBudWxsLAogICAgICBhY3RpdmVTY2hlbWU6IG51bGwsCiAgICAgIGVkaXRvcjogZWRpdG9yCiAgICB9OyAvLyAgY29udGV4dC51cGRhdGVkRm9yVG9rZW4gPSBzZXNzaW9uLmdldFRva2VuQXQocG9zLnJvdywgcG9zLmNvbHVtbik7CiAgICAvLwogICAgLy8gIGlmICghY29udGV4dC51cGRhdGVkRm9yVG9rZW4pCiAgICAvLyAgICBjb250ZXh0LnVwZGF0ZWRGb3JUb2tlbiA9IHsgdmFsdWU6ICIiLCBzdGFydDogcG9zLmNvbHVtbiB9OyAvLyBlbXB0eSBsaW5lCiAgICAvLwogICAgLy8gIGNvbnRleHQudXBkYXRlZEZvclRva2VuLnJvdyA9IHBvcy5yb3c7IC8vIGV4dGVuZAoKICAgIGNvbnRleHQuYXV0b0NvbXBsZXRlVHlwZSA9IGdldEF1dG9Db21wbGV0ZVR5cGUocG9zKTsKCiAgICBzd2l0Y2ggKGNvbnRleHQuYXV0b0NvbXBsZXRlVHlwZSkgewogICAgICBjYXNlICdwYXRoJzoKICAgICAgICBhZGRQYXRoQXV0b0NvbXBsZXRlU2V0VG9Db250ZXh0KGNvbnRleHQsIHBvcyk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICd1cmxfcGFyYW1zJzoKICAgICAgICBhZGRVcmxQYXJhbXNBdXRvQ29tcGxldGVTZXRUb0NvbnRleHQoY29udGV4dCwgcG9zKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ21ldGhvZCc6CiAgICAgICAgYWRkTWV0aG9kQXV0b0NvbXBsZXRlU2V0VG9Db250ZXh0KGNvbnRleHQsIHBvcyk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdib2R5JzoKICAgICAgICBhZGRCb2R5QXV0b0NvbXBsZXRlU2V0VG9Db250ZXh0KGNvbnRleHQsIHBvcyk7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGlmICghY29udGV4dC5hdXRvQ29tcGxldGVTZXQpIHsKICAgICAgcmV0dXJuIG51bGw7IC8vIG5vdGhpbmcgdG8gZG8uLgogICAgfQoKICAgIGFkZFJlcGxhY2VtZW50SW5mb1RvQ29udGV4dChjb250ZXh0LCBwb3MpOwogICAgY29udGV4dC5jcmVhdGVkV2l0aFRva2VuID0gX2xvZGFzaC5kZWZhdWx0LmNsb25lKGNvbnRleHQudXBkYXRlZEZvclRva2VuKTsKICAgIHJldHVybiBjb250ZXh0OwogIH0KCiAgZnVuY3Rpb24gZ2V0QXV0b0NvbXBsZXRlVHlwZShwb3MpIHsKICAgIC8vIHJldHVybiAibWV0aG9kIiwgInBhdGgiIG9yICJib2R5IiB0byBkZXRlcm1pbmUgYXV0byBjb21wbGV0ZSB0eXBlLgogICAgdmFyIHJvd01vZGUgPSBlZGl0b3IucGFyc2VyLmdldFJvd1BhcnNlTW9kZSgpOyAvL25vaW5zcGVjdGlvbiBKU0JpdHdpc2VPcGVyYXRvclVzYWdlCgogICAgaWYgKHJvd01vZGUgJiBlZGl0b3IucGFyc2VyLk1PREUuSU5fUkVRVUVTVCkgewogICAgICByZXR1cm4gJ2JvZHknOwogICAgfSAvL25vaW5zcGVjdGlvbiBKU0JpdHdpc2VPcGVyYXRvclVzYWdlCgoKICAgIGlmIChyb3dNb2RlICYgZWRpdG9yLnBhcnNlci5NT0RFLlJFUVVFU1RfU1RBUlQpIHsKICAgICAgLy8gb24gdXJsIHBhdGgsIHVybCBwYXJhbXMgb3IgbWV0aG9kLgogICAgICB2YXIgdG9rZW5JdGVyID0gZWRpdG9yLml0ZXJGb3JQb3NpdGlvbihwb3Mucm93LCBwb3MuY29sdW1uKTsKICAgICAgdmFyIHQgPSB0b2tlbkl0ZXIuZ2V0Q3VycmVudFRva2VuKCk7CgogICAgICB3aGlsZSAodC50eXBlID09PSAndXJsLmNvbW1hJykgewogICAgICAgIHQgPSB0b2tlbkl0ZXIuc3RlcEJhY2t3YXJkKCk7CiAgICAgIH0KCiAgICAgIHN3aXRjaCAodC50eXBlKSB7CiAgICAgICAgY2FzZSAnbWV0aG9kJzoKICAgICAgICAgIHJldHVybiAnbWV0aG9kJzsKCiAgICAgICAgY2FzZSAnd2hpdGVzcGFjZSc6CiAgICAgICAgICB0ID0gZWRpdG9yLnBhcnNlci5wcmV2Tm9uRW1wdHlUb2tlbih0b2tlbkl0ZXIpOwoKICAgICAgICAgIHN3aXRjaCAoKHQgfHwge30pLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnbWV0aG9kJzoKICAgICAgICAgICAgICAvLyB3ZSBtb3ZlZCBvbmUgYmFjawogICAgICAgICAgICAgIHJldHVybiAncGF0aCc7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGlmIChpc1VybFBhdGhUb2tlbih0KSkgewogICAgICAgICAgICAgICAgcmV0dXJuICdwYXRoJzsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChpc1VybFBhcmFtc1Rva2VuKHQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJ3VybF9wYXJhbXMnOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBpZiAoaXNVcmxQYXRoVG9rZW4odCkpIHsKICAgICAgICAgICAgcmV0dXJuICdwYXRoJzsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaXNVcmxQYXJhbXNUb2tlbih0KSkgewogICAgICAgICAgICByZXR1cm4gJ3VybF9wYXJhbXMnOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9IC8vIGFmdGVyIHN0YXJ0IHRvIGF2b2lkIHNpbmdsZSBsaW5lIHVybCBvbmx5IHJlcXVlc3RzCiAgICAvL25vaW5zcGVjdGlvbiBKU0JpdHdpc2VPcGVyYXRvclVzYWdlCgoKICAgIGlmIChyb3dNb2RlICYgZWRpdG9yLnBhcnNlci5NT0RFLlJFUVVFU1RfRU5EKSB7CiAgICAgIHJldHVybiAnYm9keSc7CiAgICB9IC8vIGluIGJldHdlZW4gcmVxdWVzdCBvbiBhbiBlbXB0eQoKCiAgICBpZiAoKGVkaXRvci5nZXRTZXNzaW9uKCkuZ2V0TGluZShwb3Mucm93KSB8fCAnJykudHJpbSgpID09PSAnJykgewogICAgICAvLyBjaGVjayBpZiB0aGUgcHJldmlvdXMgbGluZSBpcyBhIHNpbmdsZSBsaW5lIGJlZ2dpbmcgb2YgYSBuZXcgcmVxdWVzdAogICAgICByb3dNb2RlID0gZWRpdG9yLnBhcnNlci5nZXRSb3dQYXJzZU1vZGUocG9zLnJvdyAtIDEpOyAvL25vaW5zcGVjdGlvbiBKU0JpdHdpc2VPcGVyYXRvclVzYWdlCgogICAgICBpZiAocm93TW9kZSAmIGVkaXRvci5wYXJzZXIuTU9ERS5SRVFVRVNUX1NUQVJUICYmIHJvd01vZGUgJiBlZGl0b3IucGFyc2VyLk1PREUuUkVRVUVTVF9FTkQpIHsKICAgICAgICByZXR1cm4gJ2JvZHknOwogICAgICB9IC8vby53IHN1Z2dlc3QgYSBtZXRob2QKCgogICAgICByZXR1cm4gJ21ldGhvZCc7CiAgICB9CgogICAgcmV0dXJuIG51bGw7CiAgfQoKICBmdW5jdGlvbiBhZGRSZXBsYWNlbWVudEluZm9Ub0NvbnRleHQoY29udGV4dCwgcG9zLCByZXBsYWNpbmdUZXJtKSB7CiAgICAvLyBleHRyYWN0IHRoZSBpbml0aWFsIHZhbHVlLCByYW5nZVRvUmVwbGFjZSAmIHRleHRCb3hQb3NpdGlvbgogICAgLy8gU2NlbmFyaW9zIGZvciBjdXJyZW50IHRva2VuOgogICAgLy8gICAtICBOaWNlIHRva2VuIHsgImJsYXwiCiAgICAvLyAgIC0gIEJyb2tlbiB0ZXh0IHRva2VuIHsgICBibGF8CiAgICAvLyAgIC0gIE5vIHRva2VuIDogeyB8CiAgICAvLyAgIC0gQnJva2VuIHNjZW5hcmlvIHsgLCBibGF8CiAgICAvLyAgIC0gTmljZSB0b2tlbiwgYnJva2VuIGJlZm9yZTogeywgImJsYSIKICAgIHZhciBzZXNzaW9uID0gZWRpdG9yLmdldFNlc3Npb24oKTsKICAgIGNvbnRleHQudXBkYXRlZEZvclRva2VuID0gX2xvZGFzaC5kZWZhdWx0LmNsb25lKHNlc3Npb24uZ2V0VG9rZW5BdChwb3Mucm93LCBwb3MuY29sdW1uKSk7CgogICAgaWYgKCFjb250ZXh0LnVwZGF0ZWRGb3JUb2tlbikgewogICAgICBjb250ZXh0LnVwZGF0ZWRGb3JUb2tlbiA9IHsKICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgc3RhcnQ6IHBvcy5jb2x1bW4KICAgICAgfTsKICAgIH0gLy8gZW1wdHkgbGluZQoKCiAgICB2YXIgYW5jaG9yVG9rZW4gPSBjb250ZXh0LmNyZWF0ZWRXaXRoVG9rZW47CgogICAgaWYgKCFhbmNob3JUb2tlbikgewogICAgICBhbmNob3JUb2tlbiA9IGNvbnRleHQudXBkYXRlZEZvclRva2VuOwogICAgfQoKICAgIHN3aXRjaCAoY29udGV4dC51cGRhdGVkRm9yVG9rZW4udHlwZSkgewogICAgICBjYXNlICd2YXJpYWJsZSc6CiAgICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgIGNhc2UgJ3RleHQnOgogICAgICBjYXNlICdjb25zdGFudC5udW1lcmljJzoKICAgICAgY2FzZSAnY29uc3RhbnQubGFuZ3VhZ2UuYm9vbGVhbic6CiAgICAgIGNhc2UgJ21ldGhvZCc6CiAgICAgIGNhc2UgJ3VybC5pbmRleCc6CiAgICAgIGNhc2UgJ3VybC50eXBlJzoKICAgICAgY2FzZSAndXJsLmlkJzoKICAgICAgY2FzZSAndXJsLm1ldGhvZCc6CiAgICAgIGNhc2UgJ3VybC5lbmRwb2ludCc6CiAgICAgIGNhc2UgJ3VybC5wYXJ0JzoKICAgICAgY2FzZSAndXJsLnBhcmFtJzoKICAgICAgY2FzZSAndXJsLnZhbHVlJzoKICAgICAgICBjb250ZXh0LnJhbmdlVG9SZXBsYWNlID0gbmV3IEFjZVJhbmdlKHBvcy5yb3csIGFuY2hvclRva2VuLnN0YXJ0LCBwb3Mucm93LCBjb250ZXh0LnVwZGF0ZWRGb3JUb2tlbi5zdGFydCArIGNvbnRleHQudXBkYXRlZEZvclRva2VuLnZhbHVlLmxlbmd0aCk7CiAgICAgICAgY29udGV4dC5yZXBsYWNpbmdUb2tlbiA9IHRydWU7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIGlmIChyZXBsYWNpbmdUZXJtICYmIGNvbnRleHQudXBkYXRlZEZvclRva2VuLnZhbHVlID09PSByZXBsYWNpbmdUZXJtKSB7CiAgICAgICAgICBjb250ZXh0LnJhbmdlVG9SZXBsYWNlID0gbmV3IEFjZVJhbmdlKHBvcy5yb3csIGFuY2hvclRva2VuLnN0YXJ0LCBwb3Mucm93LCBjb250ZXh0LnVwZGF0ZWRGb3JUb2tlbi5zdGFydCArIGNvbnRleHQudXBkYXRlZEZvclRva2VuLnZhbHVlLmxlbmd0aCk7CiAgICAgICAgICBjb250ZXh0LnJlcGxhY2luZ1Rva2VuID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gc3RhbmRpbmcgb24gd2hpdGUgc3BhY2UsIHF1b3RlcyBvciBhbm90aGVyIHB1bmN0dWF0aW9uIC0gbm8gcmVwbGFjaW5nCiAgICAgICAgICBjb250ZXh0LnJhbmdlVG9SZXBsYWNlID0gbmV3IEFjZVJhbmdlKHBvcy5yb3csIHBvcy5jb2x1bW4sIHBvcy5yb3csIHBvcy5jb2x1bW4pOwogICAgICAgICAgY29udGV4dC5yZXBsYWNpbmdUb2tlbiA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CiAgICB9CgogICAgY29udGV4dC50ZXh0Qm94UG9zaXRpb24gPSB7CiAgICAgIHJvdzogY29udGV4dC5yYW5nZVRvUmVwbGFjZS5zdGFydC5yb3csCiAgICAgIGNvbHVtbjogY29udGV4dC5yYW5nZVRvUmVwbGFjZS5zdGFydC5jb2x1bW4KICAgIH07CgogICAgc3dpdGNoIChjb250ZXh0LmF1dG9Db21wbGV0ZVR5cGUpIHsKICAgICAgY2FzZSAncGF0aCc6CiAgICAgICAgYWRkUGF0aFByZWZpeFN1ZmZpeFRvQ29udGV4dChjb250ZXh0KTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3VybF9wYXJhbXMnOgogICAgICAgIGFkZFVybFBhcmFtc1ByZWZpeFN1ZmZpeFRvQ29udGV4dChjb250ZXh0KTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ21ldGhvZCc6CiAgICAgICAgYWRkTWV0aG9kUHJlZml4U3VmZml4VG9Db250ZXh0KGNvbnRleHQpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYm9keSc6CiAgICAgICAgYWRkQm9keVByZWZpeFN1ZmZpeFRvQ29udGV4dChjb250ZXh0KTsKICAgICAgICBicmVhazsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGFkZEJvZHlQcmVmaXhTdWZmaXhUb0NvbnRleHQoY29udGV4dCkgewogICAgLy8gRmlndXJlIG91dCB3aGF0IGhhcHBlbnMgbmV4dCB0byB0aGUgdG9rZW4gdG8gc2VlIHdoZXRoZXIgaXQgbmVlZHMgdHJhaWxpbmcgY29tbWFzIGV0Yy4KICAgIC8vIFRlbXBsYXRlcyB3aWxsIGJlIHVzZWQgaWYgbm90IGRlc3Ryb3lpbmcgZXhpc3Rpbmcgc3RydWN0dXJlLgogICAgLy8gLT4gdG9rZW4gOiB7fSBvciB0b2tlbiBdL30gb3IgdG9rZW4gLCBidXQgbm90IHRva2VuIDogU09NRVRISU5HIEVMU0UKICAgIGNvbnRleHQucHJlZml4VG9BZGQgPSAnJzsKICAgIGNvbnRleHQuc3VmZml4VG9BZGQgPSAnJzsKICAgIHZhciB0b2tlbkl0ZXIgPSBlZGl0b3IuaXRlckZvckN1cnJlbnRMb2MoKTsKICAgIHZhciBub25FbXB0eVRva2VuID0gZWRpdG9yLnBhcnNlci5uZXh0Tm9uRW1wdHlUb2tlbih0b2tlbkl0ZXIpOwoKICAgIHN3aXRjaCAobm9uRW1wdHlUb2tlbiA/IG5vbkVtcHR5VG9rZW4udHlwZSA6ICdOT1RPS0VOJykgewogICAgICBjYXNlICdOT1RPS0VOJzoKICAgICAgY2FzZSAncGFyZW4ubHBhcmVuJzoKICAgICAgY2FzZSAncGFyZW4ucnBhcmVuJzoKICAgICAgY2FzZSAncHVuY3R1YXRpb24uY29tbWEnOgogICAgICAgIGNvbnRleHQuYWRkVGVtcGxhdGUgPSB0cnVlOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAncHVuY3R1YXRpb24uY29sb24nOgogICAgICAgIC8vIHRlc3QgaWYgdGhlcmUgaXMgYW4gZW1wdHkgb2JqZWN0IC0gaWYgc28gd2UgcmVwbGFjZSBpdAogICAgICAgIGNvbnRleHQuYWRkVGVtcGxhdGUgPSBmYWxzZTsKICAgICAgICBub25FbXB0eVRva2VuID0gZWRpdG9yLnBhcnNlci5uZXh0Tm9uRW1wdHlUb2tlbih0b2tlbkl0ZXIpOwoKICAgICAgICBpZiAoIShub25FbXB0eVRva2VuICYmIG5vbkVtcHR5VG9rZW4udmFsdWUgPT09ICd7JykpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgbm9uRW1wdHlUb2tlbiA9IGVkaXRvci5wYXJzZXIubmV4dE5vbkVtcHR5VG9rZW4odG9rZW5JdGVyKTsKCiAgICAgICAgaWYgKCEobm9uRW1wdHlUb2tlbiAmJiBub25FbXB0eVRva2VuLnZhbHVlID09PSAnfScpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGNvbnRleHQuYWRkVGVtcGxhdGUgPSB0cnVlOyAvLyBleHRlbmQgcmFuZ2UgdG8gcmVwbGFjZSB0byBpbmNsdWRlIGFsbCB1cCB0byB0b2tlbgoKICAgICAgICBjb250ZXh0LnJhbmdlVG9SZXBsYWNlLmVuZC5yb3cgPSB0b2tlbkl0ZXIuZ2V0Q3VycmVudFRva2VuUm93KCk7CiAgICAgICAgY29udGV4dC5yYW5nZVRvUmVwbGFjZS5lbmQuY29sdW1uID0gdG9rZW5JdGVyLmdldEN1cnJlbnRUb2tlbkNvbHVtbigpICsgbm9uRW1wdHlUb2tlbi52YWx1ZS5sZW5ndGg7IC8vIG1vdmUgb25lIG1vcmUgdGltZSB0byBjaGVjayBpZiB3ZSBuZWVkIGEgdHJhaWxpbmcgY29tbWEKCiAgICAgICAgbm9uRW1wdHlUb2tlbiA9IGVkaXRvci5wYXJzZXIubmV4dE5vbkVtcHR5VG9rZW4odG9rZW5JdGVyKTsKCiAgICAgICAgc3dpdGNoIChub25FbXB0eVRva2VuID8gbm9uRW1wdHlUb2tlbi50eXBlIDogJ05PVE9LRU4nKSB7CiAgICAgICAgICBjYXNlICdOT1RPS0VOJzoKICAgICAgICAgIGNhc2UgJ3BhcmVuLnJwYXJlbic6CiAgICAgICAgICBjYXNlICdwdW5jdHVhdGlvbi5jb21tYSc6CiAgICAgICAgICBjYXNlICdwdW5jdHVhdGlvbi5jb2xvbic6CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGNvbnRleHQuc3VmZml4VG9BZGQgPSAnLCAnOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIGNvbnRleHQuYWRkVGVtcGxhdGUgPSB0cnVlOwogICAgICAgIGNvbnRleHQuc3VmZml4VG9BZGQgPSAnLCAnOwogICAgICAgIGJyZWFrOwogICAgICAvLyBmb3Igbm93IHBsYXkgc2FmZSBhbmQgZG8gbm90aGluZy4gTWF5IGJlIG1hZGUgc21hcnRlci4KICAgIH0gLy8gZ28gYmFjayB0byBzZWUgd2hldGhlciB3ZSBoYXZlIG9uZSBvZiAoIDogeyAmIFsgZG8gbm90IHJlcXVpcmUgYSBjb21tYS4gQWxsIHRoZSByZXN0IGRvLgoKCiAgICB0b2tlbkl0ZXIgPSBlZGl0b3IuaXRlckZvckN1cnJlbnRMb2MoKTsKICAgIG5vbkVtcHR5VG9rZW4gPSB0b2tlbkl0ZXIuZ2V0Q3VycmVudFRva2VuKCk7CiAgICB2YXIgaW5zZXJ0aW5nUmVsYXRpdmVUb1Rva2VuOyAvLyAtMSBpcyBiZWZvcmUgdG9rZW4sIDAgbWlkZGxlLCArMSBhZnRlciB0b2tlbgoKICAgIGlmIChjb250ZXh0LnJlcGxhY2luZ1Rva2VuKSB7CiAgICAgIGluc2VydGluZ1JlbGF0aXZlVG9Ub2tlbiA9IDA7CiAgICB9IGVsc2UgewogICAgICB2YXIgcG9zID0gZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCk7CgogICAgICBpZiAocG9zLmNvbHVtbiA9PT0gY29udGV4dC51cGRhdGVkRm9yVG9rZW4uc3RhcnQpIHsKICAgICAgICBpbnNlcnRpbmdSZWxhdGl2ZVRvVG9rZW4gPSAtMTsKICAgICAgfSBlbHNlIGlmIChwb3MuY29sdW1uIDwgY29udGV4dC51cGRhdGVkRm9yVG9rZW4uc3RhcnQgKyBjb250ZXh0LnVwZGF0ZWRGb3JUb2tlbi52YWx1ZS5sZW5ndGgpIHsKICAgICAgICBpbnNlcnRpbmdSZWxhdGl2ZVRvVG9rZW4gPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGluc2VydGluZ1JlbGF0aXZlVG9Ub2tlbiA9IDE7CiAgICAgIH0KICAgIH0gLy8gd2Ugc2hvdWxkIGFjdHVhbGx5IGxvb2sgYXQgd2hhdCdzIGhhcHBlbmluZyBiZWZvcmUgdGhpcyB0b2tlbgoKCiAgICBpZiAoZWRpdG9yLnBhcnNlci5pc0VtcHR5VG9rZW4obm9uRW1wdHlUb2tlbikgfHwgaW5zZXJ0aW5nUmVsYXRpdmVUb1Rva2VuIDw9IDApIHsKICAgICAgbm9uRW1wdHlUb2tlbiA9IGVkaXRvci5wYXJzZXIucHJldk5vbkVtcHR5VG9rZW4odG9rZW5JdGVyKTsKICAgIH0KCiAgICBzd2l0Y2ggKG5vbkVtcHR5VG9rZW4gPyBub25FbXB0eVRva2VuLnR5cGUgOiAnTk9UT0tFTicpIHsKICAgICAgY2FzZSAnTk9UT0tFTic6CiAgICAgIGNhc2UgJ3BhcmVuLmxwYXJlbic6CiAgICAgIGNhc2UgJ3B1bmN0dWF0aW9uLmNvbW1hJzoKICAgICAgY2FzZSAncHVuY3R1YXRpb24uY29sb24nOgogICAgICBjYXNlICdtZXRob2QnOgogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICBpZiAobm9uRW1wdHlUb2tlbiAmJiBub25FbXB0eVRva2VuLnR5cGUuaW5kZXhPZigndXJsJykgPCAwKSB7CiAgICAgICAgICBjb250ZXh0LnByZWZpeFRvQWRkID0gJywgJzsKICAgICAgICB9CgogICAgfQoKICAgIHJldHVybiBjb250ZXh0OwogIH0KCiAgZnVuY3Rpb24gYWRkVXJsUGFyYW1zUHJlZml4U3VmZml4VG9Db250ZXh0KGNvbnRleHQpIHsKICAgIGNvbnRleHQucHJlZml4VG9BZGQgPSAnJzsKICAgIGNvbnRleHQuc3VmZml4VG9BZGQgPSAnJzsKICB9CgogIGZ1bmN0aW9uIGFkZE1ldGhvZFByZWZpeFN1ZmZpeFRvQ29udGV4dChjb250ZXh0KSB7CiAgICBjb250ZXh0LnByZWZpeFRvQWRkID0gJyc7CiAgICBjb250ZXh0LnN1ZmZpeFRvQWRkID0gJyc7CiAgICB2YXIgdG9rZW5JdGVyID0gZWRpdG9yLml0ZXJGb3JDdXJyZW50TG9jKCk7CiAgICB2YXIgcm93ID0gdG9rZW5JdGVyLmdldEN1cnJlbnRUb2tlblJvdygpOwogICAgdmFyIHQgPSBlZGl0b3IucGFyc2VyLm5leHROb25FbXB0eVRva2VuKHRva2VuSXRlcik7CgogICAgaWYgKHRva2VuSXRlci5nZXRDdXJyZW50VG9rZW5Sb3coKSAhPT0gcm93IHx8ICF0KSB7CiAgICAgIC8vIHdlIHN0aWxsIGhhdmUgbm90aGluZyBuZXh0IHRvIHRoZSBtZXRob2QsIGFkZCBhIHNwYWNlLi4KICAgICAgY29udGV4dC5zdWZmaXhUb0FkZCA9ICcgJzsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGFkZFBhdGhQcmVmaXhTdWZmaXhUb0NvbnRleHQoY29udGV4dCkgewogICAgY29udGV4dC5wcmVmaXhUb0FkZCA9ICcnOwogICAgY29udGV4dC5zdWZmaXhUb0FkZCA9ICcnOwogIH0KCiAgZnVuY3Rpb24gYWRkTWV0aG9kQXV0b0NvbXBsZXRlU2V0VG9Db250ZXh0KGNvbnRleHQpIHsKICAgIGNvbnRleHQuYXV0b0NvbXBsZXRlU2V0ID0gWydHRVQnLCAnUFVUJywgJ1BPU1QnLCAnREVMRVRFJywgJ0hFQUQnXS5tYXAoZnVuY3Rpb24gKG0sIGkpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiBtLAogICAgICAgIHNjb3JlOiAtaSwKICAgICAgICBtZXRhOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnY29uc29sZS5hdXRvY29tcGxldGUuYWRkTWV0aG9kTWV0YVRleHQnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ21ldGhvZCcKICAgICAgICB9KQogICAgICB9OwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBhZGRQYXRoQXV0b0NvbXBsZXRlU2V0VG9Db250ZXh0KGNvbnRleHQsIHBvcykgewogICAgdmFyIHJldCA9IGdldEN1cnJlbnRNZXRob2RBbmRUb2tlblBhdGhzKGVkaXRvciwgcG9zKTsKICAgIGNvbnRleHQubWV0aG9kID0gcmV0Lm1ldGhvZDsKICAgIGNvbnRleHQudG9rZW4gPSByZXQudG9rZW47CiAgICBjb250ZXh0Lm90aGVyVG9rZW5WYWx1ZXMgPSByZXQub3RoZXJUb2tlblZhbHVlczsKICAgIGNvbnRleHQudXJsVG9rZW5QYXRoID0gcmV0LnVybFRva2VuUGF0aDsKICAgIHZhciBjb21wb25lbnRzID0gKDAsIF9rYi5nZXRUb3BMZXZlbFVybENvbXBsZXRlQ29tcG9uZW50cykoY29udGV4dC5tZXRob2QpOwogICAgKDAsIF9lbmdpbmUucG9wdWxhdGVDb250ZXh0KShyZXQudXJsVG9rZW5QYXRoLCBjb250ZXh0LCBlZGl0b3IsIHRydWUsIGNvbXBvbmVudHMpOwogICAgY29udGV4dC5hdXRvQ29tcGxldGVTZXQgPSBhZGRNZXRhVG9UZXJtc0xpc3QoY29udGV4dC5hdXRvQ29tcGxldGVTZXQsICdlbmRwb2ludCcpOwogIH0KCiAgZnVuY3Rpb24gYWRkVXJsUGFyYW1zQXV0b0NvbXBsZXRlU2V0VG9Db250ZXh0KGNvbnRleHQsIHBvcykgewogICAgdmFyIHJldCA9IGdldEN1cnJlbnRNZXRob2RBbmRUb2tlblBhdGhzKGVkaXRvciwgcG9zKTsKICAgIGNvbnRleHQubWV0aG9kID0gcmV0Lm1ldGhvZDsKICAgIGNvbnRleHQub3RoZXJUb2tlblZhbHVlcyA9IHJldC5vdGhlclRva2VuVmFsdWVzOwogICAgY29udGV4dC51cmxUb2tlblBhdGggPSByZXQudXJsVG9rZW5QYXRoOwoKICAgIGlmICghcmV0LnVybFRva2VuUGF0aCkgewogICAgICAvLyB6ZXJvIGxlbmd0aCB0b2tlblBhdGggaXMgdHJ1ZQogICAgICBjb25zb2xlLmxvZygnQ2FuXCd0IGV4dHJhY3QgYSB2YWxpZCB1cmwgdG9rZW4gcGF0aC4nKTsKICAgICAgcmV0dXJuIGNvbnRleHQ7CiAgICB9CgogICAgKDAsIF9lbmdpbmUucG9wdWxhdGVDb250ZXh0KShyZXQudXJsVG9rZW5QYXRoLCBjb250ZXh0LCBlZGl0b3IsIGZhbHNlLCAoMCwgX2tiLmdldFRvcExldmVsVXJsQ29tcGxldGVDb21wb25lbnRzKShjb250ZXh0Lm1ldGhvZCkpOwoKICAgIGlmICghY29udGV4dC5lbmRwb2ludCkgewogICAgICBjb25zb2xlLmxvZygnY291bGRuXCd0IHJlc29sdmUgYW4gZW5kcG9pbnQuJyk7CiAgICAgIHJldHVybiBjb250ZXh0OwogICAgfQoKICAgIGlmICghcmV0LnVybFBhcmFtc1Rva2VuUGF0aCkgewogICAgICAvLyB6ZXJvIGxlbmd0aCB0b2tlblBhdGggaXMgdHJ1ZQogICAgICBjb25zb2xlLmxvZygnQ2FuXCd0IGV4dHJhY3QgYSB2YWxpZCB1cmxQYXJhbXMgdG9rZW4gcGF0aC4nKTsKICAgICAgcmV0dXJuIGNvbnRleHQ7CiAgICB9CgogICAgdmFyIHRva2VuUGF0aCA9IFtdOwogICAgdmFyIGN1cnJlbnRQYXJhbSA9IHJldC51cmxQYXJhbXNUb2tlblBhdGgucG9wKCk7CgogICAgaWYgKGN1cnJlbnRQYXJhbSkgewogICAgICB0b2tlblBhdGggPSBPYmplY3Qua2V5cyhjdXJyZW50UGFyYW0pOyAvLyBzaW5nbGUga2V5IG9iamVjdAoKICAgICAgY29udGV4dC5vdGhlclRva2VuVmFsdWVzID0gY3VycmVudFBhcmFtW3Rva2VuUGF0aFswXV07CiAgICB9CgogICAgKDAsIF9lbmdpbmUucG9wdWxhdGVDb250ZXh0KSh0b2tlblBhdGgsIGNvbnRleHQsIGVkaXRvciwgdHJ1ZSwgY29udGV4dC5lbmRwb2ludC5wYXJhbXNBdXRvY29tcGxldGUuZ2V0VG9wTGV2ZWxDb21wb25lbnRzKGNvbnRleHQubWV0aG9kKSk7CiAgICByZXR1cm4gY29udGV4dDsKICB9CgogIGZ1bmN0aW9uIGFkZEJvZHlBdXRvQ29tcGxldGVTZXRUb0NvbnRleHQoY29udGV4dCwgcG9zKSB7CiAgICB2YXIgcmV0ID0gZ2V0Q3VycmVudE1ldGhvZEFuZFRva2VuUGF0aHMoZWRpdG9yLCBwb3MpOwogICAgY29udGV4dC5tZXRob2QgPSByZXQubWV0aG9kOwogICAgY29udGV4dC5vdGhlclRva2VuVmFsdWVzID0gcmV0Lm90aGVyVG9rZW5WYWx1ZXM7CiAgICBjb250ZXh0LnVybFRva2VuUGF0aCA9IHJldC51cmxUb2tlblBhdGg7CiAgICBjb250ZXh0LnJlcXVlc3RTdGFydFJvdyA9IHJldC5yZXF1ZXN0U3RhcnRSb3c7CgogICAgaWYgKCFyZXQudXJsVG9rZW5QYXRoKSB7CiAgICAgIC8vIHplcm8gbGVuZ3RoIHRva2VuUGF0aCBpcyB0cnVlCiAgICAgIGNvbnNvbGUubG9nKCdDYW5cJ3QgZXh0cmFjdCBhIHZhbGlkIHVybCB0b2tlbiBwYXRoLicpOwogICAgICByZXR1cm4gY29udGV4dDsKICAgIH0KCiAgICAoMCwgX2VuZ2luZS5wb3B1bGF0ZUNvbnRleHQpKHJldC51cmxUb2tlblBhdGgsIGNvbnRleHQsIGVkaXRvciwgZmFsc2UsICgwLCBfa2IuZ2V0VG9wTGV2ZWxVcmxDb21wbGV0ZUNvbXBvbmVudHMpKGNvbnRleHQubWV0aG9kKSk7CiAgICBjb250ZXh0LmJvZHlUb2tlblBhdGggPSByZXQuYm9keVRva2VuUGF0aDsKCiAgICBpZiAoIXJldC5ib2R5VG9rZW5QYXRoKSB7CiAgICAgIC8vIHplcm8gbGVuZ3RoIHRva2VuUGF0aCBpcyB0cnVlCiAgICAgIGNvbnNvbGUubG9nKCdDYW5cJ3QgZXh0cmFjdCBhIHZhbGlkIGJvZHkgdG9rZW4gcGF0aC4nKTsKICAgICAgcmV0dXJuIGNvbnRleHQ7CiAgICB9IC8vIG5lZWRlZCBmb3Igc2NvcGUgbGlua2luZyArIGdsb2JhbCB0ZXJtIHJlc29sdmluZwoKCiAgICBjb250ZXh0LmVuZHBvaW50Q29tcG9uZW50UmVzb2x2ZXIgPSBfa2IuZ2V0RW5kcG9pbnRCb2R5Q29tcGxldGVDb21wb25lbnRzOwogICAgY29udGV4dC5nbG9iYWxDb21wb25lbnRSZXNvbHZlciA9IF9rYi5nZXRHbG9iYWxBdXRvY29tcGxldGVDb21wb25lbnRzOwogICAgdmFyIGNvbXBvbmVudHM7CgogICAgaWYgKGNvbnRleHQuZW5kcG9pbnQpIHsKICAgICAgY29tcG9uZW50cyA9IGNvbnRleHQuZW5kcG9pbnQuYm9keUF1dG9jb21wbGV0ZVJvb3RDb21wb25lbnRzOwogICAgfSBlbHNlIHsKICAgICAgY29tcG9uZW50cyA9ICgwLCBfa2IuZ2V0VW5tYXRjaGVkRW5kcG9pbnRDb21wb25lbnRzKSgpOwogICAgfQoKICAgICgwLCBfZW5naW5lLnBvcHVsYXRlQ29udGV4dCkocmV0LmJvZHlUb2tlblBhdGgsIGNvbnRleHQsIGVkaXRvciwgdHJ1ZSwgY29tcG9uZW50cyk7CiAgICByZXR1cm4gY29udGV4dDsKICB9CgogIHZhciBldmFsdWF0ZUN1cnJlbnRUb2tlbkFmdGVyQUNoYW5nZSA9IF9sb2Rhc2guZGVmYXVsdC5kZWJvdW5jZShmdW5jdGlvbiBldmFsdWF0ZUN1cnJlbnRUb2tlbkFmdGVyQUNoYW5nZShwb3MpIHsKICAgIHZhciBzZXNzaW9uID0gZWRpdG9yLmdldFNlc3Npb24oKTsKICAgIHZhciBjdXJyZW50VG9rZW4gPSBzZXNzaW9uLmdldFRva2VuQXQocG9zLnJvdywgcG9zLmNvbHVtbik7CgogICAgaWYgKCFjdXJyZW50VG9rZW4pIHsKICAgICAgaWYgKHBvcy5yb3cgPT09IDApIHsKICAgICAgICBMQVNUX0VWQUxVQVRFRF9UT0tFTiA9IG51bGw7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjdXJyZW50VG9rZW4gPSB7CiAgICAgICAgc3RhcnQ6IDAsCiAgICAgICAgdmFsdWU6ICcnCiAgICAgIH07IC8vIGVtcHR5IHJvdwogICAgfQoKICAgIGN1cnJlbnRUb2tlbi5yb3cgPSBwb3Mucm93OyAvLyBleHRlbmQgdG9rZW4gd2l0aCByb3cuIEFjZSBkb2Vzbid0IHN1cHBseSBpdCBieSBkZWZhdWx0CgogICAgaWYgKGVkaXRvci5wYXJzZXIuaXNFbXB0eVRva2VuKGN1cnJlbnRUb2tlbikpIHsKICAgICAgLy8gZW1wdHkgdG9rZW4uIGNoZWNrIHdoYXQncyBjb21pbmcgbmV4dAogICAgICB2YXIgbmV4dFRva2VuID0gc2Vzc2lvbi5nZXRUb2tlbkF0KHBvcy5yb3csIHBvcy5jb2x1bW4gKyAxKTsKCiAgICAgIGlmIChlZGl0b3IucGFyc2VyLmlzRW1wdHlUb2tlbihuZXh0VG9rZW4pKSB7CiAgICAgICAgLy8gRW1wdHkgbGluZSwgb3Igd2UncmUgbm90IG9uIHRoZSBlZGdlIG9mIGN1cnJlbnQgdG9rZW4uIFNhdmUgdGhlIGN1cnJlbnQgcG9zaXRpb24gYXMgYmFzZQogICAgICAgIGN1cnJlbnRUb2tlbi5zdGFydCA9IHBvcy5jb2x1bW47CiAgICAgICAgTEFTVF9FVkFMVUFURURfVE9LRU4gPSBjdXJyZW50VG9rZW47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV4dFRva2VuLnJvdyA9IHBvcy5yb3c7CiAgICAgICAgTEFTVF9FVkFMVUFURURfVE9LRU4gPSBuZXh0VG9rZW47CiAgICAgIH0KCiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoIUxBU1RfRVZBTFVBVEVEX1RPS0VOKSB7CiAgICAgIExBU1RfRVZBTFVBVEVEX1RPS0VOID0gY3VycmVudFRva2VuOwogICAgICByZXR1cm47IC8vIHdhaXQgZm9yIHRoZSBuZXh0IHR5cGluZy4KICAgIH0KCiAgICBpZiAoTEFTVF9FVkFMVUFURURfVE9LRU4uc3RhcnQgIT09IGN1cnJlbnRUb2tlbi5zdGFydCB8fCBMQVNUX0VWQUxVQVRFRF9UT0tFTi5yb3cgIT09IGN1cnJlbnRUb2tlbi5yb3cgfHwgTEFTVF9FVkFMVUFURURfVE9LRU4udmFsdWUgPT09IGN1cnJlbnRUb2tlbi52YWx1ZSkgewogICAgICAvLyBub3Qgb24gdGhlIHNhbWUgcGxhY2Ugb3Igbm90aGluZyBjaGFuZ2VkLCBjYWNoZSBhbmQgd2FpdCBmb3IgdGhlIG5leHQgdGltZQogICAgICBMQVNUX0VWQUxVQVRFRF9UT0tFTiA9IGN1cnJlbnRUb2tlbjsKICAgICAgcmV0dXJuOwogICAgfSAvLyBkb24ndCBhdXRvbWF0aWNhbGx5IG9wZW4gdGhlIGF1dG8gY29tcGxldGUgaWYgc29tZSBqdXN0IGhpdCBlbnRlciAobmV3IGxpbmUpIG9yIG9wZW4gYSBwYXJlbnRoZXNlcwoKCiAgICBzd2l0Y2ggKGN1cnJlbnRUb2tlbi50eXBlIHx8ICdVTktOT1dOJykgewogICAgICBjYXNlICdwYXJlbi5scGFyZW4nOgogICAgICBjYXNlICdwYXJlbi5ycGFyZW4nOgogICAgICBjYXNlICdwdW5jdHVhdGlvbi5jb2xvbic6CiAgICAgIGNhc2UgJ3B1bmN0dWF0aW9uLmNvbW1hJzoKICAgICAgY2FzZSAnVU5LTk9XTic6CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIExBU1RfRVZBTFVBVEVEX1RPS0VOID0gY3VycmVudFRva2VuOwogICAgZWRpdG9yLmV4ZWNDb21tYW5kKCdzdGFydEF1dG9jb21wbGV0ZScpOwogIH0sIDEwMCk7CgogIGZ1bmN0aW9uIGVkaXRvckNoYW5nZUxpc3RlbmVyKCkgewogICAgdmFyIGN1cnNvciA9IGVkaXRvci5zZWxlY3Rpb24ubGVhZDsKCiAgICBpZiAoZWRpdG9yLl9fYWNlLmNvbXBsZXRlciAmJiBlZGl0b3IuX19hY2UuY29tcGxldGVyLmFjdGl2YXRlZCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgZXZhbHVhdGVDdXJyZW50VG9rZW5BZnRlckFDaGFuZ2UoY3Vyc29yKTsKICB9CgogIGZ1bmN0aW9uIGFkZENoYW5nZUxpc3RlbmVyKCkgewogICAgZWRpdG9yLm9uKCdjaGFuZ2VTZWxlY3Rpb24nLCBlZGl0b3JDaGFuZ2VMaXN0ZW5lcik7CiAgfQoKICBmdW5jdGlvbiByZW1vdmVDaGFuZ2VMaXN0ZW5lcigpIHsKICAgIGVkaXRvci5vZmYoJ2NoYW5nZVNlbGVjdGlvbicsIGVkaXRvckNoYW5nZUxpc3RlbmVyKTsKICB9CgogIGZ1bmN0aW9uIGdldENvbXBsZXRpb25zKGFjZUVkaXRvciwgc2Vzc2lvbiwgcG9zLCBwcmVmaXgsIGNhbGxiYWNrKSB7CiAgICB0cnkgewogICAgICB2YXIgY29udGV4dCA9IGdldEF1dG9Db21wbGV0ZUNvbnRleHQoZWRpdG9yLCBzZXNzaW9uLCBwb3MpOwoKICAgICAgaWYgKCFjb250ZXh0KSB7CiAgICAgICAgY2FsbGJhY2sobnVsbCwgW10pOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciB0ZXJtcyA9IF9sb2Rhc2guZGVmYXVsdC5tYXAoY29udGV4dC5hdXRvQ29tcGxldGVTZXQsIGZ1bmN0aW9uICh0ZXJtKSB7CiAgICAgICAgICBpZiAoX3R5cGVvZih0ZXJtKSAhPT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgdGVybSA9IHsKICAgICAgICAgICAgICBuYW1lOiB0ZXJtCiAgICAgICAgICAgIH07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZXJtID0gX2xvZGFzaC5kZWZhdWx0LmNsb25lKHRlcm0pOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBkZWZhdWx0cyA9IHsKICAgICAgICAgICAgdmFsdWU6IHRlcm0ubmFtZSwKICAgICAgICAgICAgbWV0YTogJ0FQSScsCiAgICAgICAgICAgIHNjb3JlOiAwLAogICAgICAgICAgICBjb250ZXh0OiBjb250ZXh0CiAgICAgICAgICB9OyAvLyB3ZSBvbmx5IG5lZWQgb3V0IGN1c3RvbSBpbnNlcnRNYXRjaCBiZWhhdmlvciBmb3IgdGhlIGJvZHkKCiAgICAgICAgICBpZiAoY29udGV4dC5hdXRvQ29tcGxldGVUeXBlID09PSAnYm9keScpIHsKICAgICAgICAgICAgZGVmYXVsdHMuY29tcGxldGVyID0gewogICAgICAgICAgICAgIGluc2VydE1hdGNoOiBmdW5jdGlvbiBpbnNlcnRNYXRjaCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhcHBseVRlcm0odGVybSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBfbG9kYXNoLmRlZmF1bHQuZGVmYXVsdHModGVybSwgZGVmYXVsdHMpOwogICAgICAgIH0pOwoKICAgICAgICB0ZXJtcy5zb3J0KGZ1bmN0aW9uICh0MSwgdDIpIHsKICAgICAgICAgIC8qIHNjb3JlIHNvcnRzIGZyb20gaGlnaCB0byBsb3cgKi8KICAgICAgICAgIGlmICh0MS5zY29yZSA+IHQyLnNjb3JlKSB7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodDEuc2NvcmUgPCB0Mi5zY29yZSkgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgIH0KICAgICAgICAgIC8qIG5hbWVzIHNvcnQgZnJvbSBsb3cgdG8gaGlnaCAqLwoKCiAgICAgICAgICBpZiAodDEubmFtZSA8IHQyLm5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0MS5uYW1lID09PSB0Mi5uYW1lKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0pOwogICAgICAgIGNhbGxiYWNrKG51bGwsIF9sb2Rhc2guZGVmYXVsdC5tYXAodGVybXMsIGZ1bmN0aW9uICh0LCBpKSB7CiAgICAgICAgICB0Lmluc2VydFZhbHVlID0gdC5pbnNlcnRWYWx1ZSB8fCB0LnZhbHVlOwogICAgICAgICAgdC52YWx1ZSA9ICcnICsgdC52YWx1ZTsgLy8gbm9ybWFsaXplIHRvIHN0cmluZ3MKCiAgICAgICAgICB0LnNjb3JlID0gLWk7CiAgICAgICAgICByZXR1cm4gdDsKICAgICAgICB9KSk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc29sZS5sb2coJ2Vycm9yIHdoaWxlIGdldHRpbmcgY29tcGxldGlvbiB0ZXJtcycsIGUpOwogICAgICBjYWxsYmFjayhlLCBudWxsKTsKICAgIH0KICB9CgogIGFkZENoYW5nZUxpc3RlbmVyKCk7IC8vIEhvb2sgaW50byBBY2UKICAvLyBkaXNhYmxlIHN0YW5kYXJkIGNvbnRleHQgYmFzZWQgYXV0b2NvbXBsZXRpb24uCgogIF9icmFjZS5kZWZhdWx0LmRlZmluZSgnYWNlL2F1dG9jb21wbGV0ZS90ZXh0X2NvbXBsZXRlcicsIFsncmVxdWlyZScsICdleHBvcnRzJywgJ21vZHVsZSddLCBmdW5jdGlvbiAocmVxdWlyZSwgZXhwb3J0cykgewogICAgZXhwb3J0cy5nZXRDb21wbGV0aW9ucyA9IGZ1bmN0aW9uIChlZGl0b3IsIHNlc3Npb24sIHBvcywgcHJlZml4LCBjYWxsYmFjaykgewogICAgICBjYWxsYmFjayhudWxsLCBbXSk7CiAgICB9OwogIH0pOwoKICB2YXIgbGFuZ1Rvb2xzID0gX2JyYWNlLmRlZmF1bHQuYWNlcXVpcmUoJ2FjZS9leHQvbGFuZ3VhZ2VfdG9vbHMnKTsKCiAgbGFuZ1Rvb2xzLnNldENvbXBsZXRlcnMoW3sKICAgIGlkZW50aWZpZXJSZWdleHBzOiBbL1thLXpBLVpfMC05XC5cJFwtXHUwMEEyLVx1RkZGRl0vIC8vIGFkZHMgc3VwcG9ydCBmb3IgZG90IGNoYXJhY3RlcgogICAgXSwKICAgIGdldENvbXBsZXRpb25zOiBnZXRDb21wbGV0aW9ucwogIH1dKTsKICBlZGl0b3Iuc2V0T3B0aW9ucyh7CiAgICBlbmFibGVCYXNpY0F1dG9jb21wbGV0aW9uOiB0cnVlCiAgfSk7CiAgZWRpdG9yLiRibG9ja1Njcm9sbGluZyA9IEluZmluaXR5OwogIHJldHVybiB7CiAgICBfdGVzdDogewogICAgICBnZXRDb21wbGV0aW9uczogZ2V0Q29tcGxldGlvbnMsCiAgICAgIGFkZFJlcGxhY2VtZW50SW5mb1RvQ29udGV4dDogYWRkUmVwbGFjZW1lbnRJbmZvVG9Db250ZXh0LAogICAgICBhZGRDaGFuZ2VMaXN0ZW5lcjogYWRkQ2hhbmdlTGlzdGVuZXIsCiAgICAgIHJlbW92ZUNoYW5nZUxpc3RlbmVyOiByZW1vdmVDaGFuZ2VMaXN0ZW5lcgogICAgfQogIH07Cn0="},null]}