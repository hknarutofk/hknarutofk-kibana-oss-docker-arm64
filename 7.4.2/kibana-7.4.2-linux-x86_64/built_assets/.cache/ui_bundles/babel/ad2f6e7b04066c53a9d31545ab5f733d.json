{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/visualize/editor/editor.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/visualize/editor/editor.js","mtime":1572296410812},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfcnhqcyA9IHJlcXVpcmUoInJ4anMiKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKcmVxdWlyZSgiLi4vc2F2ZWRfdmlzdWFsaXphdGlvbnMvc2F2ZWRfdmlzdWFsaXphdGlvbnMiKTsKCnJlcXVpcmUoIi4vdmlzdWFsaXphdGlvbl9lZGl0b3IiKTsKCnJlcXVpcmUoInVpL3Zpcy9lZGl0b3JzL2RlZmF1bHQvc2lkZWJhciIpOwoKcmVxdWlyZSgidWkvdmlzdWFsaXplIik7CgpyZXF1aXJlKCJ1aS9jb2xsYXBzaWJsZV9zaWRlYmFyIik7Cgp2YXIgX2NhcGFiaWxpdGllcyA9IHJlcXVpcmUoInVpL2NhcGFiaWxpdGllcyIpOwoKdmFyIF9jaHJvbWUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInVpL2Nocm9tZSIpKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9hbmd1bGFyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJhbmd1bGFyIikpOwoKdmFyIF9yZWFjdDIgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCnZhciBfbm90aWZ5ID0gcmVxdWlyZSgidWkvbm90aWZ5Iik7Cgp2YXIgX3Zpc190eXBlcyA9IHJlcXVpcmUoInVpL3JlZ2lzdHJ5L3Zpc190eXBlcyIpOwoKdmFyIF9kb2NfdGl0bGUgPSByZXF1aXJlKCJ1aS9kb2NfdGl0bGUiKTsKCnZhciBfcXVlcnlfZmlsdGVyID0gcmVxdWlyZSgidWkvZmlsdGVyX21hbmFnZXIvcXVlcnlfZmlsdGVyIik7Cgp2YXIgX3N0YXRlX21vbml0b3JfZmFjdG9yeSA9IHJlcXVpcmUoInVpL3N0YXRlX21hbmFnZW1lbnQvc3RhdGVfbW9uaXRvcl9mYWN0b3J5Iik7Cgp2YXIgX2xpYiA9IHJlcXVpcmUoIi4vbGliIik7Cgp2YXIgX3JvdXRlcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgidWkvcm91dGVzIikpOwoKdmFyIF9tb2R1bGVzID0gcmVxdWlyZSgidWkvbW9kdWxlcyIpOwoKdmFyIF9lZGl0b3IgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIi4vZWRpdG9yLmh0bWwiKSk7Cgp2YXIgX2Rhc2hib2FyZF9jb25zdGFudHMgPSByZXF1aXJlKCIuLi8uLi9kYXNoYm9hcmQvZGFzaGJvYXJkX2NvbnN0YW50cyIpOwoKdmFyIF92aXN1YWxpemVfY29uc3RhbnRzID0gcmVxdWlyZSgiLi4vdmlzdWFsaXplX2NvbnN0YW50cyIpOwoKdmFyIF9raWJhbmFfcGFyc2VkX3VybCA9IHJlcXVpcmUoInVpL3VybC9raWJhbmFfcGFyc2VkX3VybCIpOwoKdmFyIF9hYnNvbHV0ZV90b19wYXJzZWRfdXJsID0gcmVxdWlyZSgidWkvdXJsL2Fic29sdXRlX3RvX3BhcnNlZF91cmwiKTsKCnZhciBfbWlncmF0ZV9sZWdhY3lfcXVlcnkgPSByZXF1aXJlKCJ1aS91dGlscy9taWdyYXRlX2xlZ2FjeV9xdWVyeSIpOwoKdmFyIF9zdWJzY3JpYmVfd2l0aF9zY29wZSA9IHJlcXVpcmUoInVpL3V0aWxzL3N1YnNjcmliZV93aXRoX3Njb3BlIik7Cgp2YXIgX3BlcnNpc3RlZF9sb2cgPSByZXF1aXJlKCJ1aS9wZXJzaXN0ZWRfbG9nIik7Cgp2YXIgX3RpbWVmaWx0ZXIgPSByZXF1aXJlKCJ1aS90aW1lZmlsdGVyIik7Cgp2YXIgX2xvYWRlciA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uL3VpL3B1YmxpYy92aXN1YWxpemUvbG9hZGVyIik7Cgp2YXIgX3NoYXJlID0gcmVxdWlyZSgidWkvc2hhcmUiKTsKCnZhciBfc3RhdGVfaGFzaGluZyA9IHJlcXVpcmUoInVpL3N0YXRlX21hbmFnZW1lbnQvc3RhdGVfaGFzaGluZyIpOwoKdmFyIF9zaG93X3NhdmVkX29iamVjdF9zYXZlX21vZGFsID0gcmVxdWlyZSgidWkvc2F2ZWRfb2JqZWN0cy9zaG93X3NhdmVkX29iamVjdF9zYXZlX21vZGFsIik7Cgp2YXIgX3NhdmVkX29iamVjdF9zYXZlX21vZGFsID0gcmVxdWlyZSgidWkvc2F2ZWRfb2JqZWN0cy9jb21wb25lbnRzL3NhdmVkX29iamVjdF9zYXZlX21vZGFsIik7Cgp2YXIgX2JyZWFkY3J1bWJzID0gcmVxdWlyZSgiLi4vYnJlYWRjcnVtYnMiKTsKCnZhciBfbmV3X3BsYXRmb3JtID0gcmVxdWlyZSgidWkvbmV3X3BsYXRmb3JtIik7Cgp2YXIgX2xlZ2FjeSA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uL2NvcmVfcGx1Z2lucy9kYXRhL3B1YmxpYy9sZWdhY3kiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7IHRyeSB7IHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsgfSBjYXRjaCAoZXJyb3IpIHsgcmVqZWN0KGVycm9yKTsgcmV0dXJuOyB9IGlmIChpbmZvLmRvbmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0gZWxzZSB7IFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsgfSB9CgpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB2YXIgc2VsZiA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsgZnVuY3Rpb24gX25leHQodmFsdWUpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsgfSBmdW5jdGlvbiBfdGhyb3coZXJyKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsgfSBfbmV4dCh1bmRlZmluZWQpOyB9KTsgfTsgfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gfQoKdmFyIHNhdmVkUXVlcnlTZXJ2aWNlID0gX2xlZ2FjeS5zZXR1cC5zZWFyY2guc2VydmljZXMuc2F2ZWRRdWVyeVNlcnZpY2U7Cgpfcm91dGVzLmRlZmF1bHQud2hlbihfdmlzdWFsaXplX2NvbnN0YW50cy5WaXN1YWxpemVDb25zdGFudHMuQ1JFQVRFX1BBVEgsIHsKICB0ZW1wbGF0ZTogX2VkaXRvci5kZWZhdWx0LAogIGs3QnJlYWRjcnVtYnM6IF9icmVhZGNydW1icy5nZXRDcmVhdGVCcmVhZGNydW1icywKICByZXNvbHZlOiB7CiAgICBzYXZlZFZpczogZnVuY3Rpb24gc2F2ZWRWaXMoc2F2ZWRWaXN1YWxpemF0aW9ucywgcmVkaXJlY3RXaGVuTWlzc2luZywgJHJvdXRlLCBQcml2YXRlKSB7CiAgICAgIHZhciB2aXNUeXBlcyA9IFByaXZhdGUoX3Zpc190eXBlcy5WaXNUeXBlc1JlZ2lzdHJ5UHJvdmlkZXIpOwoKICAgICAgdmFyIHZpc1R5cGUgPSBfbG9kYXNoLmRlZmF1bHQuZmluZCh2aXNUeXBlcywgewogICAgICAgIG5hbWU6ICRyb3V0ZS5jdXJyZW50LnBhcmFtcy50eXBlCiAgICAgIH0pOwoKICAgICAgdmFyIHNob3VsZEhhdmVJbmRleCA9IHZpc1R5cGUucmVxdWlyZXNTZWFyY2ggJiYgdmlzVHlwZS5vcHRpb25zLnNob3dJbmRleFNlbGVjdGlvbjsKICAgICAgdmFyIGhhc0luZGV4ID0gJHJvdXRlLmN1cnJlbnQucGFyYW1zLmluZGV4UGF0dGVybiB8fCAkcm91dGUuY3VycmVudC5wYXJhbXMuc2F2ZWRTZWFyY2hJZDsKCiAgICAgIGlmIChzaG91bGRIYXZlSW5kZXggJiYgIWhhc0luZGV4KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udmlzdWFsaXplLmNyZWF0ZVZpc3VhbGl6YXRpb24ubm9JbmRleFBhdHRlcm5PclNhdmVkU2VhcmNoSWRFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1lvdSBtdXN0IHByb3ZpZGUgZWl0aGVyIGFuIGluZGV4UGF0dGVybiBvciBhIHNhdmVkU2VhcmNoSWQnCiAgICAgICAgfSkpOwogICAgICB9CgogICAgICByZXR1cm4gc2F2ZWRWaXN1YWxpemF0aW9ucy5nZXQoJHJvdXRlLmN1cnJlbnQucGFyYW1zKS5jYXRjaChyZWRpcmVjdFdoZW5NaXNzaW5nKHsKICAgICAgICAnKic6ICcvdmlzdWFsaXplJwogICAgICB9KSk7CiAgICB9CiAgfQp9KS53aGVuKCIiLmNvbmNhdChfdmlzdWFsaXplX2NvbnN0YW50cy5WaXN1YWxpemVDb25zdGFudHMuRURJVF9QQVRILCAiLzppZCIpLCB7CiAgdGVtcGxhdGU6IF9lZGl0b3IuZGVmYXVsdCwKICBrN0JyZWFkY3J1bWJzOiBfYnJlYWRjcnVtYnMuZ2V0RWRpdEJyZWFkY3J1bWJzLAogIHJlc29sdmU6IHsKICAgIHNhdmVkVmlzOiBmdW5jdGlvbiBzYXZlZFZpcyhzYXZlZFZpc3VhbGl6YXRpb25zLCByZWRpcmVjdFdoZW5NaXNzaW5nLCAkcm91dGUpIHsKICAgICAgcmV0dXJuIHNhdmVkVmlzdWFsaXphdGlvbnMuZ2V0KCRyb3V0ZS5jdXJyZW50LnBhcmFtcy5pZCkudGhlbihmdW5jdGlvbiAoc2F2ZWRWaXMpIHsKICAgICAgICBfcGVyc2lzdGVkX2xvZy5yZWNlbnRseUFjY2Vzc2VkLmFkZChzYXZlZFZpcy5nZXRGdWxsUGF0aCgpLCBzYXZlZFZpcy50aXRsZSwgc2F2ZWRWaXMuaWQpOwoKICAgICAgICByZXR1cm4gc2F2ZWRWaXM7CiAgICAgIH0pLmNhdGNoKHJlZGlyZWN0V2hlbk1pc3NpbmcoewogICAgICAgICd2aXN1YWxpemF0aW9uJzogJy92aXN1YWxpemUnLAogICAgICAgICdzZWFyY2gnOiAnL21hbmFnZW1lbnQva2liYW5hL29iamVjdHMvc2F2ZWRWaXN1YWxpemF0aW9ucy8nICsgJHJvdXRlLmN1cnJlbnQucGFyYW1zLmlkLAogICAgICAgICdpbmRleC1wYXR0ZXJuJzogJy9tYW5hZ2VtZW50L2tpYmFuYS9vYmplY3RzL3NhdmVkVmlzdWFsaXphdGlvbnMvJyArICRyb3V0ZS5jdXJyZW50LnBhcmFtcy5pZCwKICAgICAgICAnaW5kZXgtcGF0dGVybi1maWVsZCc6ICcvbWFuYWdlbWVudC9raWJhbmEvb2JqZWN0cy9zYXZlZFZpc3VhbGl6YXRpb25zLycgKyAkcm91dGUuY3VycmVudC5wYXJhbXMuaWQKICAgICAgfSkpOwogICAgfQogIH0KfSk7CgpfbW9kdWxlcy51aU1vZHVsZXMuZ2V0KCdhcHAvdmlzdWFsaXplJywgWydraWJhbmEvdXJsJ10pLmRpcmVjdGl2ZSgndmlzdWFsaXplQXBwJywgZnVuY3Rpb24gKCkgewogIHJldHVybiB7CiAgICByZXN0cmljdDogJ0UnLAogICAgY29udHJvbGxlckFzOiAndmlzdWFsaXplQXBwJywKICAgIGNvbnRyb2xsZXI6IFZpc0VkaXRvcgogIH07Cn0pOwoKZnVuY3Rpb24gVmlzRWRpdG9yKCRzY29wZSwgJGVsZW1lbnQsICRyb3V0ZSwgQXBwU3RhdGUsICR3aW5kb3csICRpbmplY3RvciwgaW5kZXhQYXR0ZXJucywga2JuVXJsLCByZWRpcmVjdFdoZW5NaXNzaW5nLCBQcml2YXRlLCBQcm9taXNlLCBjb25maWcsIGtibkJhc2VVcmwsIGxvY2FsU3RvcmFnZSwgLy8gdW51c2VkIGJ1dCByZXF1aXJlZCB0byBpbml0aWFsaXplIGF1dG8gcmVmcmVzaCA6LVwKCi8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzICovCmNvdXJpZXIpIHsKICB2YXIgcXVlcnlGaWx0ZXIgPSBQcml2YXRlKF9xdWVyeV9maWx0ZXIuRmlsdGVyQmFyUXVlcnlGaWx0ZXJQcm92aWRlcik7CiAgdmFyIGdldFVuaGFzaGFibGVTdGF0ZXMgPSBQcml2YXRlKF9zdGF0ZV9oYXNoaW5nLmdldFVuaGFzaGFibGVTdGF0ZXNQcm92aWRlcik7CiAgdmFyIHNoYXJlQ29udGV4dE1lbnVFeHRlbnNpb25zID0gUHJpdmF0ZShfc2hhcmUuU2hhcmVDb250ZXh0TWVudUV4dGVuc2lvbnNSZWdpc3RyeVByb3ZpZGVyKTsgLy8gUmV0cmlldmUgdGhlIHJlc29sdmVkIFNhdmVkVmlzIGluc3RhbmNlLgoKICB2YXIgc2F2ZWRWaXMgPSAkcm91dGUuY3VycmVudC5sb2NhbHMuc2F2ZWRWaXM7IC8vIHZpcyBpcyBpbnN0YW5jZSBvZiBzcmMvbGVnYWN5L3VpL3B1YmxpYy92aXMvdmlzLmpzLgogIC8vIFNlYXJjaFNvdXJjZSBpcyBhIHByb21pc2UtYmFzZWQgc3RyZWFtIG9mIHNlYXJjaCByZXN1bHRzIHRoYXQgY2FuIGluaGVyaXQgZnJvbSBvdGhlciBzZWFyY2ggc291cmNlcy4KCiAgdmFyIHZpcyA9IHNhdmVkVmlzLnZpcywKICAgICAgc2VhcmNoU291cmNlID0gc2F2ZWRWaXMuc2VhcmNoU291cmNlOwogICRzY29wZS52aXMgPSB2aXM7CiAgdmFyICRhcHBTdGF0dXMgPSB0aGlzLmFwcFN0YXR1cyA9IHsKICAgIGRpcnR5OiAhc2F2ZWRWaXMuaWQKICB9OwogICRzY29wZS50b3BOYXZNZW51ID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShfY2FwYWJpbGl0aWVzLmNhcGFiaWxpdGllcy5nZXQoKS52aXN1YWxpemUuc2F2ZSA/IFt7CiAgICBpZDogJ3NhdmUnLAogICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udG9wTmF2TWVudS5zYXZlVmlzdWFsaXphdGlvbkJ1dHRvbkxhYmVsJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogJ3NhdmUnCiAgICB9KSwKICAgIGRlc2NyaXB0aW9uOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLnZpc3VhbGl6ZS50b3BOYXZNZW51LnNhdmVWaXN1YWxpemF0aW9uQnV0dG9uQXJpYUxhYmVsJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogJ1NhdmUgVmlzdWFsaXphdGlvbicKICAgIH0pLAogICAgdGVzdElkOiAndmlzdWFsaXplU2F2ZUJ1dHRvbicsCiAgICBkaXNhYmxlQnV0dG9uOiBmdW5jdGlvbiBkaXNhYmxlQnV0dG9uKCkgewogICAgICByZXR1cm4gQm9vbGVhbih2aXMuZGlydHkpOwogICAgfSwKICAgIHRvb2x0aXA6IGZ1bmN0aW9uIHRvb2x0aXAoKSB7CiAgICAgIGlmICh2aXMuZGlydHkpIHsKICAgICAgICByZXR1cm4gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi52aXN1YWxpemUudG9wTmF2TWVudS5zYXZlVmlzdWFsaXphdGlvbkRpc2FibGVkQnV0dG9uVG9vbHRpcCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQXBwbHkgb3IgRGlzY2FyZCB5b3VyIGNoYW5nZXMgYmVmb3JlIHNhdmluZycKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHJ1bjogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3J1biA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIG9uU2F2ZSwgY29uZmlybUJ1dHRvbkxhYmVsLCBzYXZlTW9kYWw7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgb25TYXZlID0gZnVuY3Rpb24gb25TYXZlKF9yZWYpIHsKICAgICAgICAgICAgICAgICAgdmFyIG5ld1RpdGxlID0gX3JlZi5uZXdUaXRsZSwKICAgICAgICAgICAgICAgICAgICAgIG5ld0NvcHlPblNhdmUgPSBfcmVmLm5ld0NvcHlPblNhdmUsCiAgICAgICAgICAgICAgICAgICAgICBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkID0gX3JlZi5pc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkLAogICAgICAgICAgICAgICAgICAgICAgb25UaXRsZUR1cGxpY2F0ZSA9IF9yZWYub25UaXRsZUR1cGxpY2F0ZTsKICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRUaXRsZSA9IHNhdmVkVmlzLnRpdGxlOwogICAgICAgICAgICAgICAgICBzYXZlZFZpcy50aXRsZSA9IG5ld1RpdGxlOwogICAgICAgICAgICAgICAgICBzYXZlZFZpcy5jb3B5T25TYXZlID0gbmV3Q29weU9uU2F2ZTsKICAgICAgICAgICAgICAgICAgdmFyIHNhdmVPcHRpb25zID0gewogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1PdmVyd3JpdGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQ6IGlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQsCiAgICAgICAgICAgICAgICAgICAgb25UaXRsZUR1cGxpY2F0ZTogb25UaXRsZUR1cGxpY2F0ZQogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICByZXR1cm4gZG9TYXZlKHNhdmVPcHRpb25zKS50aGVuKGZ1bmN0aW9uIChfcmVmMikgewogICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IF9yZWYyLmlkLAogICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IF9yZWYyLmVycm9yOwoKICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgc2F2ZSB3YXNuJ3Qgc3VjY2Vzc2Z1bCwgcHV0IHRoZSBvcmlnaW5hbCB2YWx1ZXMgYmFjay4KICAgICAgICAgICAgICAgICAgICBpZiAoIWlkIHx8IGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICBzYXZlZFZpcy50aXRsZSA9IGN1cnJlbnRUaXRsZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICBpZDogaWQsCiAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3IKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkxhYmVsID0gJHNjb3BlLmlzQWRkVG9EYXNoTW9kZSgpID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICAgICAgaWQ6ICJrYm4udmlzdWFsaXplLnNhdmVEaWFsb2cuc2F2ZUFuZEFkZFRvRGFzaGJvYXJkQnV0dG9uTGFiZWwiLAogICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmUgYW5kIGFkZCB0byBkYXNoYm9hcmQiCiAgICAgICAgICAgICAgICB9KSA6IG51bGw7CiAgICAgICAgICAgICAgICBzYXZlTW9kYWwgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zYXZlZF9vYmplY3Rfc2F2ZV9tb2RhbC5TYXZlZE9iamVjdFNhdmVNb2RhbCwgewogICAgICAgICAgICAgICAgICBvblNhdmU6IG9uU2F2ZSwKICAgICAgICAgICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24gb25DbG9zZSgpIHt9LAogICAgICAgICAgICAgICAgICB0aXRsZTogc2F2ZWRWaXMudGl0bGUsCiAgICAgICAgICAgICAgICAgIHNob3dDb3B5T25TYXZlOiBzYXZlZFZpcy5pZCA/IHRydWUgOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgb2JqZWN0VHlwZTogInZpc3VhbGl6YXRpb24iLAogICAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uTGFiZWw6IGNvbmZpcm1CdXR0b25MYWJlbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAoMCwgX3Nob3dfc2F2ZWRfb2JqZWN0X3NhdmVfbW9kYWwuc2hvd1NhdmVNb2RhbCkoc2F2ZU1vZGFsKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHJ1bigpIHsKICAgICAgICByZXR1cm4gX3J1bi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcnVuOwogICAgfSgpCiAgfV0gOiBbXSksIFt7CiAgICBpZDogJ3NoYXJlJywKICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLnRvcE5hdk1lbnUuc2hhcmVWaXN1YWxpemF0aW9uQnV0dG9uTGFiZWwnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAnc2hhcmUnCiAgICB9KSwKICAgIGRlc2NyaXB0aW9uOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLnZpc3VhbGl6ZS50b3BOYXZNZW51LnNoYXJlVmlzdWFsaXphdGlvbkJ1dHRvbkFyaWFMYWJlbCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTaGFyZSBWaXN1YWxpemF0aW9uJwogICAgfSksCiAgICB0ZXN0SWQ6ICdzaGFyZVRvcE5hdkJ1dHRvbicsCiAgICBydW46IGZ1bmN0aW9uIHJ1bihhbmNob3JFbGVtZW50KSB7CiAgICAgIHZhciBoYXNVbmFwcGxpZWRDaGFuZ2VzID0gdmlzLmRpcnR5OwogICAgICB2YXIgaGFzVW5zYXZlZENoYW5nZXMgPSAkYXBwU3RhdHVzLmRpcnR5OwogICAgICAoMCwgX3NoYXJlLnNob3dTaGFyZUNvbnRleHRNZW51KSh7CiAgICAgICAgYW5jaG9yRWxlbWVudDogYW5jaG9yRWxlbWVudCwKICAgICAgICBhbGxvd0VtYmVkOiB0cnVlLAogICAgICAgIGFsbG93U2hvcnRVcmw6IF9jYXBhYmlsaXRpZXMuY2FwYWJpbGl0aWVzLmdldCgpLnZpc3VhbGl6ZS5jcmVhdGVTaG9ydFVybCwKICAgICAgICBnZXRVbmhhc2hhYmxlU3RhdGVzOiBnZXRVbmhhc2hhYmxlU3RhdGVzLAogICAgICAgIG9iamVjdElkOiBzYXZlZFZpcy5pZCwKICAgICAgICBvYmplY3RUeXBlOiAndmlzdWFsaXphdGlvbicsCiAgICAgICAgc2hhcmVDb250ZXh0TWVudUV4dGVuc2lvbnM6IHNoYXJlQ29udGV4dE1lbnVFeHRlbnNpb25zLAogICAgICAgIHNoYXJpbmdEYXRhOiB7CiAgICAgICAgICB0aXRsZTogc2F2ZWRWaXMudGl0bGUKICAgICAgICB9LAogICAgICAgIGlzRGlydHk6IGhhc1VuYXBwbGllZENoYW5nZXMgfHwgaGFzVW5zYXZlZENoYW5nZXMKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAgaWQ6ICdpbnNwZWN0b3InLAogICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udG9wTmF2TWVudS5vcGVuSW5zcGVjdG9yQnV0dG9uTGFiZWwnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAnaW5zcGVjdCcKICAgIH0pLAogICAgZGVzY3JpcHRpb246IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udmlzdWFsaXplLnRvcE5hdk1lbnUub3Blbkluc3BlY3RvckJ1dHRvbkFyaWFMYWJlbCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdPcGVuIEluc3BlY3RvciBmb3IgdmlzdWFsaXphdGlvbicKICAgIH0pLAogICAgdGVzdElkOiAnb3Blbkluc3BlY3RvckJ1dHRvbicsCiAgICBkaXNhYmxlQnV0dG9uOiBmdW5jdGlvbiBkaXNhYmxlQnV0dG9uKCkgewogICAgICByZXR1cm4gIXZpcy5oYXNJbnNwZWN0b3IgfHwgIXZpcy5oYXNJbnNwZWN0b3IoKTsKICAgIH0sCiAgICBydW46IGZ1bmN0aW9uIHJ1bigpIHsKICAgICAgdmFyIGluc3BlY3RvclNlc3Npb24gPSB2aXMub3Blbkluc3BlY3RvcigpOyAvLyBDbG9zZSB0aGUgaW5zcGVjdG9yIGlmIHRoaXMgc2NvcGUgaXMgZGVzdHJveWVkIChlLmcuIGJlY2F1c2UgdGhlIHVzZXIgbmF2aWdhdGVzIGF3YXkpLgoKICAgICAgdmFyIHJlbW92ZVdhdGNoID0gJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGluc3BlY3RvclNlc3Npb24uY2xvc2UoKTsKICAgICAgfSk7IC8vIFJlbW92ZSB0aGF0IHdhdGNoIGluIGNhc2UgdGhlIHVzZXIgY2xvc2VzIHRoZSBpbnNwZWN0b3Igc2Vzc2lvbiBoZXJzZWxmLgoKICAgICAgaW5zcGVjdG9yU2Vzc2lvbi5vbkNsb3NlLmZpbmFsbHkocmVtb3ZlV2F0Y2gpOwogICAgfSwKICAgIHRvb2x0aXA6IGZ1bmN0aW9uIHRvb2x0aXAoKSB7CiAgICAgIGlmICghdmlzLmhhc0luc3BlY3RvciB8fCAhdmlzLmhhc0luc3BlY3RvcigpKSB7CiAgICAgICAgcmV0dXJuIF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udmlzdWFsaXplLnRvcE5hdk1lbnUub3Blbkluc3BlY3RvckRpc2FibGVkQnV0dG9uVG9vbHRpcCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiVGhpcyB2aXN1YWxpemF0aW9uIGRvZXNuJ3Qgc3VwcG9ydCBhbnkgaW5zcGVjdG9ycy4iCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBpZDogJ3JlZnJlc2gnLAogICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udG9wTmF2TWVudS5yZWZyZXNoQnV0dG9uTGFiZWwnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAncmVmcmVzaCcKICAgIH0pLAogICAgZGVzY3JpcHRpb246IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udmlzdWFsaXplLnRvcE5hdk1lbnUucmVmcmVzaEJ1dHRvbkFyaWFMYWJlbCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdSZWZyZXNoJwogICAgfSksCiAgICBydW46IGZ1bmN0aW9uIHJ1bigpIHsKICAgICAgdmlzLmZvcmNlUmVsb2FkKCk7CiAgICB9LAogICAgdGVzdElkOiAndmlzdWFsaXplUmVmcmVzaEJ1dHRvbicKICB9XSk7CiAgdmFyIHN0YXRlTW9uaXRvcjsKCiAgaWYgKHNhdmVkVmlzLmlkKSB7CiAgICBfZG9jX3RpdGxlLmRvY1RpdGxlLmNoYW5nZShzYXZlZFZpcy50aXRsZSk7CiAgfSAvLyBFeHRyYWN0IHZpc3VhbGl6YXRpb24gc3RhdGUgd2l0aCBmaWx0ZXJlZCBhZ2dzLiBZb3UgY2FuIHNlZSB0aGVzZSBmaWx0ZXJlZCBhZ2dzIGluIHRoZSBVUkwuCiAgLy8gQ29uc2lzdHMgb2YgdGhpbmdzIGxpa2UgYWdncywgcGFyYW1zLCBsaXN0ZW5lcnMsIHRpdGxlLCB0eXBlLCBldGMuCgoKICB2YXIgc2F2ZWRWaXNTdGF0ZSA9IHZpcy5nZXRTdGF0ZSgpOwogIHZhciBzdGF0ZURlZmF1bHRzID0gewogICAgdWlTdGF0ZTogc2F2ZWRWaXMudWlTdGF0ZUpTT04gPyBKU09OLnBhcnNlKHNhdmVkVmlzLnVpU3RhdGVKU09OKSA6IHt9LAogICAgbGlua2VkOiAhIXNhdmVkVmlzLnNhdmVkU2VhcmNoSWQsCiAgICBxdWVyeTogc2VhcmNoU291cmNlLmdldE93bkZpZWxkKCdxdWVyeScpIHx8IHsKICAgICAgcXVlcnk6ICcnLAogICAgICBsYW5ndWFnZTogbG9jYWxTdG9yYWdlLmdldCgna2liYW5hLnVzZXJRdWVyeUxhbmd1YWdlJykgfHwgY29uZmlnLmdldCgnc2VhcmNoOnF1ZXJ5TGFuZ3VhZ2UnKQogICAgfSwKICAgIGZpbHRlcnM6IHNlYXJjaFNvdXJjZS5nZXRPd25GaWVsZCgnZmlsdGVyJykgfHwgW10sCiAgICB2aXM6IHNhdmVkVmlzU3RhdGUKICB9OyAvLyBJbnN0YW5jZSBvZiBhcHBfc3RhdGUuanMuCgogIHZhciAkc3RhdGUgPSBmdW5jdGlvbiBpbml0U3RhdGUoKSB7CiAgICAvLyBUaGlzIGlzIHVzZWQgdG8gc3luYyB2aXN1YWxpemF0aW9uIHN0YXRlIHdpdGggdGhlIHVybCB3aGVuIGBhcHBTdGF0ZS5zYXZlKClgIGlzIGNhbGxlZC4KICAgIHZhciBhcHBTdGF0ZSA9IG5ldyBBcHBTdGF0ZShzdGF0ZURlZmF1bHRzKTsgLy8gSW5pdGlhbGl6aW5nIGFwcFN0YXRlIGRvZXMgdHdvIHRoaW5ncyAtIGZpcnN0IGl0IHRyYW5zbGF0ZXMgdGhlIGRlZmF1bHRzIGludG8gQXBwU3RhdGUsCiAgICAvLyBzZWNvbmQgaXQgdXBkYXRlcyBhcHBTdGF0ZSBiYXNlZCBvbiB0aGUgdXJsICh0aGUgdXJsIHRydW1wcyB0aGUgZGVmYXVsdHMpLiBUaGlzIG1lYW5zIGlmCiAgICAvLyB3ZSB1cGRhdGUgdGhlIHN0YXRlIGZvcm1hdCBhdCBhbGwgYW5kIHdhbnQgdG8gaGFuZGxlIEJXQywgd2UgbXVzdCBub3Qgb25seSBtaWdyYXRlIHRoZQogICAgLy8gZGF0YSBzdG9yZWQgd2l0aCBzYXZlZCB2aXMsIGJ1dCBhbHNvIGFueSBvbGQgc3RhdGUgaW4gdGhlIHVybC4KCiAgICAoMCwgX2xpYi5taWdyYXRlQXBwU3RhdGUpKGFwcFN0YXRlKTsgLy8gVGhlIHNhdmVkVmlzIGlzIHB1bGxlZCBmcm9tIGVsYXN0aWNzZWFyY2gsIGJ1dCB0aGUgYXBwU3RhdGUgaXMgcHVsbGVkIGZyb20gdGhlIHVybCwgd2l0aCB0aGUKICAgIC8vIGRlZmF1bHRzIGFwcGxpZWQuIElmIHRoZSB1cmwgd2FzIGZyb20gYSBwcmV2aW91cyBzZXNzaW9uIHdoaWNoIGluY2x1ZGVkIG1vZGlmaWNhdGlvbnMgdG8gdGhlCiAgICAvLyBhcHBTdGF0ZSB0aGVuIHRoZXkgd29uJ3QgYmUgZXF1YWwuCgogICAgaWYgKCFfYW5ndWxhci5kZWZhdWx0LmVxdWFscyhhcHBTdGF0ZS52aXMsIHNhdmVkVmlzU3RhdGUpKSB7CiAgICAgIFByb21pc2UudHJ5KGZ1bmN0aW9uICgpIHsKICAgICAgICB2aXMuc2V0U3RhdGUoYXBwU3RhdGUudmlzKTsKICAgICAgfSkuY2F0Y2gocmVkaXJlY3RXaGVuTWlzc2luZyh7CiAgICAgICAgJ2luZGV4LXBhdHRlcm4tZmllbGQnOiAnL3Zpc3VhbGl6ZScKICAgICAgfSkpOwogICAgfQoKICAgIHJldHVybiBhcHBTdGF0ZTsKICB9KCk7CgogICRzY29wZS5maWx0ZXJzID0gcXVlcnlGaWx0ZXIuZ2V0RmlsdGVycygpOwoKICAkc2NvcGUub25GaWx0ZXJzVXBkYXRlZCA9IGZ1bmN0aW9uIChmaWx0ZXJzKSB7CiAgICAvLyBUaGUgZmlsdGVycyB3aWxsIGF1dG9tYXRpY2FsbHkgYmUgc2V0IHdoZW4gdGhlIHF1ZXJ5RmlsdGVyIGVtaXRzIGFuIHVwZGF0ZSBldmVudCAoc2VlIGJlbG93KQogICAgcXVlcnlGaWx0ZXIuc2V0RmlsdGVycyhmaWx0ZXJzKTsKICB9OwoKICAkc2NvcGUub25DYW5jZWxBcHBseUZpbHRlcnMgPSBmdW5jdGlvbiAoKSB7CiAgICAkc2NvcGUuc3RhdGUuJG5ld0ZpbHRlcnMgPSBbXTsKICB9OwoKICAkc2NvcGUub25BcHBseUZpbHRlcnMgPSBmdW5jdGlvbiAoZmlsdGVycykgewogICAgcXVlcnlGaWx0ZXIuYWRkRmlsdGVyc0FuZENoYW5nZVRpbWVGaWx0ZXIoZmlsdGVycyk7CiAgICAkc2NvcGUuc3RhdGUuJG5ld0ZpbHRlcnMgPSBbXTsKICB9OwoKICAkc2NvcGUuJHdhdGNoKCdzdGF0ZS4kbmV3RmlsdGVycycsIGZ1bmN0aW9uICgpIHsKICAgIHZhciBmaWx0ZXJzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTsKCiAgICBpZiAoZmlsdGVycy5sZW5ndGggPT09IDEpIHsKICAgICAgJHNjb3BlLm9uQXBwbHlGaWx0ZXJzKGZpbHRlcnMpOwogICAgfQogIH0pOwogICRzY29wZS5zaG93U2F2ZVF1ZXJ5ID0gX2NhcGFiaWxpdGllcy5jYXBhYmlsaXRpZXMuZ2V0KCkudmlzdWFsaXplLnNhdmVRdWVyeTsKICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBfY2FwYWJpbGl0aWVzLmNhcGFiaWxpdGllcy5nZXQoKS52aXN1YWxpemUuc2F2ZVF1ZXJ5OwogIH0sIGZ1bmN0aW9uIChuZXdDYXBhYmlsaXR5KSB7CiAgICAkc2NvcGUuc2hvd1NhdmVRdWVyeSA9IG5ld0NhcGFiaWxpdHk7CiAgfSk7CgogIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAvLyBleHBvcnQgc29tZSBvYmplY3RzCiAgICAkc2NvcGUuc2F2ZWRWaXMgPSBzYXZlZFZpczsKCiAgICBpZiAodmlzLmluZGV4UGF0dGVybikgewogICAgICAkc2NvcGUuaW5kZXhQYXR0ZXJuID0gdmlzLmluZGV4UGF0dGVybjsKICAgIH0gZWxzZSB7CiAgICAgIGluZGV4UGF0dGVybnMuZ2V0RGVmYXVsdCgpLnRoZW4oZnVuY3Rpb24gKGRlZmF1bHRJbmRleFBhdHRlcm4pIHsKICAgICAgICAkc2NvcGUuaW5kZXhQYXR0ZXJuID0gZGVmYXVsdEluZGV4UGF0dGVybjsKICAgICAgfSk7CiAgICB9CgogICAgJHNjb3BlLnNlYXJjaFNvdXJjZSA9IHNlYXJjaFNvdXJjZTsKICAgICRzY29wZS5zdGF0ZSA9ICRzdGF0ZTsKICAgICRzY29wZS5yZWZyZXNoSW50ZXJ2YWwgPSBfdGltZWZpbHRlci50aW1lZmlsdGVyLmdldFJlZnJlc2hJbnRlcnZhbCgpOyAvLyBDcmVhdGUgYSBQZXJzaXN0ZWRTdGF0ZSBpbnN0YW5jZS4KCiAgICAkc2NvcGUudWlTdGF0ZSA9ICRzdGF0ZS5tYWtlU3RhdGVmdWwoJ3VpU3RhdGUnKTsKICAgICRzY29wZS5hcHBTdGF0dXMgPSAkYXBwU3RhdHVzOwogICAgdmFyIGFkZFRvRGFzaE1vZGUgPSAkcm91dGUuY3VycmVudC5wYXJhbXNbX2Rhc2hib2FyZF9jb25zdGFudHMuRGFzaGJvYXJkQ29uc3RhbnRzLkFERF9WSVNVQUxJWkFUSU9OX1RPX0RBU0hCT0FSRF9NT0RFX1BBUkFNXTsKICAgIGtiblVybC5yZW1vdmVQYXJhbShfZGFzaGJvYXJkX2NvbnN0YW50cy5EYXNoYm9hcmRDb25zdGFudHMuQUREX1ZJU1VBTElaQVRJT05fVE9fREFTSEJPQVJEX01PREVfUEFSQU0pOwoKICAgICRzY29wZS5pc0FkZFRvRGFzaE1vZGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBhZGRUb0Rhc2hNb2RlOwogICAgfTsKCiAgICAkc2NvcGUuc2hvd0ZpbHRlckJhciA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHZpcy50eXBlLm9wdGlvbnMuc2hvd0ZpbHRlckJhcjsKICAgIH07CgogICAgJHNjb3BlLnNob3dRdWVyeUlucHV0ID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdmlzLnR5cGUucmVxdWlyZXNTZWFyY2ggJiYgdmlzLnR5cGUub3B0aW9ucy5zaG93UXVlcnlCYXI7CiAgICB9OwoKICAgICRzY29wZS5zaG93UXVlcnlCYXJUaW1lUGlja2VyID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdmlzLnR5cGUub3B0aW9ucy5zaG93VGltZVBpY2tlcjsKICAgIH07CgogICAgJHNjb3BlLnRpbWVSYW5nZSA9IF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIuZ2V0VGltZSgpOwogICAgJHNjb3BlLm9wdHMgPSBfbG9kYXNoLmRlZmF1bHQucGljaygkc2NvcGUsICdzYXZlZFZpcycsICdpc0FkZFRvRGFzaE1vZGUnKTsKICAgIHN0YXRlTW9uaXRvciA9IF9zdGF0ZV9tb25pdG9yX2ZhY3Rvcnkuc3RhdGVNb25pdG9yRmFjdG9yeS5jcmVhdGUoJHN0YXRlLCBzdGF0ZURlZmF1bHRzKTsKICAgIHN0YXRlTW9uaXRvci5pZ25vcmVQcm9wcyhbJ3Zpcy5saXN0ZW5lcnMnXSkub25DaGFuZ2UoZnVuY3Rpb24gKHN0YXR1cykgewogICAgICAkYXBwU3RhdHVzLmRpcnR5ID0gc3RhdHVzLmRpcnR5IHx8ICFzYXZlZFZpcy5pZDsKICAgIH0pOwogICAgJHNjb3BlLiR3YXRjaCgnc3RhdGUucXVlcnknLCBmdW5jdGlvbiAobmV3UXVlcnkpIHsKICAgICAgdmFyIHF1ZXJ5ID0gKDAsIF9taWdyYXRlX2xlZ2FjeV9xdWVyeS5taWdyYXRlTGVnYWN5UXVlcnkpKG5ld1F1ZXJ5KTsKICAgICAgJHNjb3BlLnVwZGF0ZVF1ZXJ5QW5kRmV0Y2goewogICAgICAgIHF1ZXJ5OiBxdWVyeQogICAgICB9KTsKICAgIH0pOwogICAgJHN0YXRlLnJlcGxhY2UoKTsKCiAgICB2YXIgdXBkYXRlVGltZVJhbmdlID0gZnVuY3Rpb24gdXBkYXRlVGltZVJhbmdlKCkgewogICAgICAkc2NvcGUudGltZVJhbmdlID0gX3RpbWVmaWx0ZXIudGltZWZpbHRlci5nZXRUaW1lKCk7IC8vIEluIGNhc2Ugd2UgYXJlIHJ1bm5pbmcgaW4gZW1iZWRkZWQgbW9kZSAoaS5lLiB3ZSB1c2VkIHRoZSB2aXN1YWxpemUgbG9hZGVyIHRvIGVtYmVkKQogICAgICAvLyB0aGUgdmlzdWFsaXphdGlvbiwgd2UgbmVlZCB0byB1cGRhdGUgdGhlIHRpbWVSYW5nZSBvbiB0aGUgdmlzdWFsaXplIGhhbmRsZXIuCgogICAgICBpZiAoJHNjb3BlLl9oYW5kbGVyKSB7CiAgICAgICAgJHNjb3BlLl9oYW5kbGVyLnVwZGF0ZSh7CiAgICAgICAgICB0aW1lUmFuZ2U6ICRzY29wZS50aW1lUmFuZ2UKICAgICAgICB9KTsKICAgICAgfQogICAgfTsKCiAgICB2YXIgc3Vic2NyaXB0aW9ucyA9IG5ldyBfcnhqcy5TdWJzY3JpcHRpb24oKTsKICAgIHN1YnNjcmlwdGlvbnMuYWRkKCgwLCBfc3Vic2NyaWJlX3dpdGhfc2NvcGUuc3Vic2NyaWJlV2l0aFNjb3BlKSgkc2NvcGUsIF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIuZ2V0UmVmcmVzaEludGVydmFsVXBkYXRlJCgpLCB7CiAgICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgICAgJHNjb3BlLnJlZnJlc2hJbnRlcnZhbCA9IF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIuZ2V0UmVmcmVzaEludGVydmFsKCk7CiAgICAgIH0KICAgIH0pKTsKICAgIHN1YnNjcmlwdGlvbnMuYWRkKCgwLCBfc3Vic2NyaWJlX3dpdGhfc2NvcGUuc3Vic2NyaWJlV2l0aFNjb3BlKSgkc2NvcGUsIF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIuZ2V0VGltZVVwZGF0ZSQoKSwgewogICAgICBuZXh0OiB1cGRhdGVUaW1lUmFuZ2UKICAgIH0pKTsgLy8gdXBkYXRlIHRoZSBzZWFyY2hTb3VyY2Ugd2hlbiBxdWVyeSB1cGRhdGVzCgogICAgJHNjb3BlLmZldGNoID0gZnVuY3Rpb24gKCkgewogICAgICAkc3RhdGUuc2F2ZSgpOwogICAgICBzYXZlZFZpcy5zZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ3F1ZXJ5JywgJHN0YXRlLnF1ZXJ5KTsKICAgICAgc2F2ZWRWaXMuc2VhcmNoU291cmNlLnNldEZpZWxkKCdmaWx0ZXInLCAkc3RhdGUuZmlsdGVycyk7CiAgICAgICRzY29wZS52aXMuZm9yY2VSZWxvYWQoKTsKICAgIH07IC8vIHVwZGF0ZSB0aGUgc2VhcmNoU291cmNlIHdoZW4gZmlsdGVycyB1cGRhdGUKCgogICAgc3Vic2NyaXB0aW9ucy5hZGQoKDAsIF9zdWJzY3JpYmVfd2l0aF9zY29wZS5zdWJzY3JpYmVXaXRoU2NvcGUpKCRzY29wZSwgcXVlcnlGaWx0ZXIuZ2V0VXBkYXRlcyQoKSwgewogICAgICBuZXh0OiBmdW5jdGlvbiBuZXh0KCkgewogICAgICAgICRzY29wZS5maWx0ZXJzID0gcXVlcnlGaWx0ZXIuZ2V0RmlsdGVycygpOwogICAgICAgICRzY29wZS5nbG9iYWxGaWx0ZXJzID0gcXVlcnlGaWx0ZXIuZ2V0R2xvYmFsRmlsdGVycygpOwogICAgICB9CiAgICB9KSk7CiAgICBzdWJzY3JpcHRpb25zLmFkZCgoMCwgX3N1YnNjcmliZV93aXRoX3Njb3BlLnN1YnNjcmliZVdpdGhTY29wZSkoJHNjb3BlLCBxdWVyeUZpbHRlci5nZXRGZXRjaGVzJCgpLCB7CiAgICAgIG5leHQ6ICRzY29wZS5mZXRjaAogICAgfSkpOwogICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICgkc2NvcGUuX2hhbmRsZXIpIHsKICAgICAgICAkc2NvcGUuX2hhbmRsZXIuZGVzdHJveSgpOwogICAgICB9CgogICAgICBzYXZlZFZpcy5kZXN0cm95KCk7CiAgICAgIHN0YXRlTW9uaXRvci5kZXN0cm95KCk7CiAgICAgIHN1YnNjcmlwdGlvbnMudW5zdWJzY3JpYmUoKTsKICAgIH0pOwoKICAgIGlmICghJHNjb3BlLmNocm9tZS5nZXRWaXNpYmxlKCkpIHsKICAgICAgKDAsIF9sb2FkZXIuZ2V0VmlzdWFsaXplTG9hZGVyKSgpLnRoZW4oZnVuY3Rpb24gKGxvYWRlcikgewogICAgICAgICRzY29wZS5faGFuZGxlciA9IGxvYWRlci5lbWJlZFZpc3VhbGl6YXRpb25XaXRoU2F2ZWRPYmplY3QoJGVsZW1lbnQuZmluZCgnLnZpc3VhbGl6ZScpWzBdLCBzYXZlZFZpcywgewogICAgICAgICAgdGltZVJhbmdlOiAkc2NvcGUudGltZVJhbmdlLAogICAgICAgICAgdWlTdGF0ZTogJHNjb3BlLnVpU3RhdGUsCiAgICAgICAgICBhcHBTdGF0ZTogJHN0YXRlLAogICAgICAgICAgbGlzdGVuT25DaGFuZ2U6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgJHNjb3BlLnVwZGF0ZVF1ZXJ5QW5kRmV0Y2ggPSBmdW5jdGlvbiAoX3JlZjMpIHsKICAgIHZhciBxdWVyeSA9IF9yZWYzLnF1ZXJ5LAogICAgICAgIGRhdGVSYW5nZSA9IF9yZWYzLmRhdGVSYW5nZTsKICAgIHZhciBpc1VwZGF0ZSA9IHF1ZXJ5ICYmICFfbG9kYXNoLmRlZmF1bHQuaXNFcXVhbChxdWVyeSwgJHN0YXRlLnF1ZXJ5KSB8fCBkYXRlUmFuZ2UgJiYgIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKGRhdGVSYW5nZSwgJHNjb3BlLnRpbWVSYW5nZSk7CiAgICAkc3RhdGUucXVlcnkgPSBxdWVyeTsKCiAgICBfdGltZWZpbHRlci50aW1lZmlsdGVyLnNldFRpbWUoZGF0ZVJhbmdlKTsgLy8gSWYgbm90aGluZyBoYXMgY2hhbmdlZCwgdHJpZ2dlciB0aGUgZmV0Y2ggbWFudWFsbHksIG90aGVyd2lzZSBpdCB3aWxsIGhhcHBlbiBhcyBhIHJlc3VsdCBvZiB0aGUgY2hhbmdlcwoKCiAgICBpZiAoIWlzVXBkYXRlKSAkc2NvcGUuZmV0Y2goKTsKICB9OwoKICAkc2NvcGUub25SZWZyZXNoQ2hhbmdlID0gZnVuY3Rpb24gKF9yZWY0KSB7CiAgICB2YXIgaXNQYXVzZWQgPSBfcmVmNC5pc1BhdXNlZCwKICAgICAgICByZWZyZXNoSW50ZXJ2YWwgPSBfcmVmNC5yZWZyZXNoSW50ZXJ2YWw7CgogICAgX3RpbWVmaWx0ZXIudGltZWZpbHRlci5zZXRSZWZyZXNoSW50ZXJ2YWwoewogICAgICBwYXVzZTogaXNQYXVzZWQsCiAgICAgIHZhbHVlOiByZWZyZXNoSW50ZXJ2YWwgPyByZWZyZXNoSW50ZXJ2YWwgOiAkc2NvcGUucmVmcmVzaEludGVydmFsLnZhbHVlCiAgICB9KTsKICB9OwoKICAkc2NvcGUub25RdWVyeVNhdmVkID0gZnVuY3Rpb24gKHNhdmVkUXVlcnkpIHsKICAgICRzY29wZS5zYXZlZFF1ZXJ5ID0gc2F2ZWRRdWVyeTsKICB9OwoKICAkc2NvcGUub25TYXZlZFF1ZXJ5VXBkYXRlZCA9IGZ1bmN0aW9uIChzYXZlZFF1ZXJ5KSB7CiAgICAkc2NvcGUuc2F2ZWRRdWVyeSA9IF9vYmplY3RTcHJlYWQoe30sIHNhdmVkUXVlcnkpOwogIH07CgogICRzY29wZS5vbkNsZWFyU2F2ZWRRdWVyeSA9IGZ1bmN0aW9uICgpIHsKICAgIGRlbGV0ZSAkc2NvcGUuc2F2ZWRRdWVyeTsKICAgIGRlbGV0ZSAkc3RhdGUuc2F2ZWRRdWVyeTsKICAgICRzdGF0ZS5xdWVyeSA9IHsKICAgICAgcXVlcnk6ICcnLAogICAgICBsYW5ndWFnZTogbG9jYWxTdG9yYWdlLmdldCgna2liYW5hLnVzZXJRdWVyeUxhbmd1YWdlJykgfHwgY29uZmlnLmdldCgnc2VhcmNoOnF1ZXJ5TGFuZ3VhZ2UnKQogICAgfTsKICAgIHF1ZXJ5RmlsdGVyLnJlbW92ZUFsbCgpOwogICAgJHN0YXRlLnNhdmUoKTsKICAgICRzY29wZS5mZXRjaCgpOwogIH07CgogIHZhciB1cGRhdGVTdGF0ZUZyb21TYXZlZFF1ZXJ5ID0gZnVuY3Rpb24gdXBkYXRlU3RhdGVGcm9tU2F2ZWRRdWVyeShzYXZlZFF1ZXJ5KSB7CiAgICAkc3RhdGUucXVlcnkgPSBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMucXVlcnk7CiAgICBxdWVyeUZpbHRlci5zZXRGaWx0ZXJzKHNhdmVkUXVlcnkuYXR0cmlidXRlcy5maWx0ZXJzIHx8IFtdKTsKCiAgICBpZiAoc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIpIHsKICAgICAgX3RpbWVmaWx0ZXIudGltZWZpbHRlci5zZXRUaW1lKHsKICAgICAgICBmcm9tOiBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlci5mcm9tLAogICAgICAgIHRvOiBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlci50bwogICAgICB9KTsKCiAgICAgIGlmIChzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlci5yZWZyZXNoSW50ZXJ2YWwpIHsKICAgICAgICBfdGltZWZpbHRlci50aW1lZmlsdGVyLnNldFJlZnJlc2hJbnRlcnZhbChzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlci5yZWZyZXNoSW50ZXJ2YWwpOwogICAgICB9CiAgICB9CgogICAgJHNjb3BlLmZldGNoKCk7CiAgfTsKCiAgJHNjb3BlLiR3YXRjaCgnc2F2ZWRRdWVyeScsIGZ1bmN0aW9uIChuZXdTYXZlZFF1ZXJ5LCBvbGRTYXZlZFF1ZXJ5KSB7CiAgICBpZiAoIW5ld1NhdmVkUXVlcnkpIHJldHVybjsKICAgICRzdGF0ZS5zYXZlZFF1ZXJ5ID0gbmV3U2F2ZWRRdWVyeS5pZDsKICAgICRzdGF0ZS5zYXZlKCk7CgogICAgaWYgKG5ld1NhdmVkUXVlcnkuaWQgPT09IChvbGRTYXZlZFF1ZXJ5ICYmIG9sZFNhdmVkUXVlcnkuaWQpKSB7CiAgICAgIHVwZGF0ZVN0YXRlRnJvbVNhdmVkUXVlcnkobmV3U2F2ZWRRdWVyeSk7CiAgICB9CiAgfSk7CiAgJHNjb3BlLiR3YXRjaCgnc3RhdGUuc2F2ZWRRdWVyeScsIGZ1bmN0aW9uIChuZXdTYXZlZFF1ZXJ5SWQpIHsKICAgIGlmICghbmV3U2F2ZWRRdWVyeUlkKSB7CiAgICAgICRzY29wZS5zYXZlZFF1ZXJ5ID0gdW5kZWZpbmVkOwogICAgICByZXR1cm47CiAgICB9CgogICAgc2F2ZWRRdWVyeVNlcnZpY2UuZ2V0U2F2ZWRRdWVyeShuZXdTYXZlZFF1ZXJ5SWQpLnRoZW4oZnVuY3Rpb24gKHNhdmVkUXVlcnkpIHsKICAgICAgJHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkgewogICAgICAgICRzY29wZS5zYXZlZFF1ZXJ5ID0gc2F2ZWRRdWVyeTsKICAgICAgICB1cGRhdGVTdGF0ZUZyb21TYXZlZFF1ZXJ5KHNhdmVkUXVlcnkpOwogICAgICB9KTsKICAgIH0pOwogIH0pOwogIC8qKgogICAqIENhbGxlZCB3aGVuIHRoZSB1c2VyIGNsaWNrcyAiU2F2ZSIgYnV0dG9uLgogICAqLwoKICBmdW5jdGlvbiBkb1NhdmUoc2F2ZU9wdGlvbnMpIHsKICAgIC8vIHZpcy50aXRsZSB3YXMgbm90IGJvdW5kIGFuZCBpdCdzIG5lZWRlZCB0byByZWZsZWN0IHRpdGxlIGludG8gdmlzU3RhdGUKICAgICRzdGF0ZS52aXMudGl0bGUgPSBzYXZlZFZpcy50aXRsZTsKICAgICRzdGF0ZS52aXMudHlwZSA9IHNhdmVkVmlzLnR5cGUgfHwgJHN0YXRlLnZpcy50eXBlOwogICAgc2F2ZWRWaXMudmlzU3RhdGUgPSAkc3RhdGUudmlzOwogICAgc2F2ZWRWaXMudWlTdGF0ZUpTT04gPSBfYW5ndWxhci5kZWZhdWx0LnRvSnNvbigkc2NvcGUudWlTdGF0ZS5nZXRDaGFuZ2VzKCkpOwogICAgcmV0dXJuIHNhdmVkVmlzLnNhdmUoc2F2ZU9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKGlkKSB7CiAgICAgICRzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHsKICAgICAgICBzdGF0ZU1vbml0b3Iuc2V0SW5pdGlhbFN0YXRlKCRzdGF0ZS50b0pTT04oKSk7CgogICAgICAgIGlmIChpZCkgewogICAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkU3VjY2Vzcyh7CiAgICAgICAgICAgIHRpdGxlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLnZpc3VhbGl6ZS50b3BOYXZNZW51LnNhdmVWaXN1YWxpemF0aW9uLnN1Y2Nlc3NOb3RpZmljYXRpb25UZXh0JywgewogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2F2ZWQgJ3t2aXNUaXRsZX0nIiwKICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgIHZpc1RpdGxlOiBzYXZlZFZpcy50aXRsZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgICdkYXRhLXRlc3Qtc3Viaic6ICdzYXZlVmlzdWFsaXphdGlvblN1Y2Nlc3MnCiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoJHNjb3BlLmlzQWRkVG9EYXNoTW9kZSgpKSB7CiAgICAgICAgICAgIHZhciBzYXZlZFZpc3VhbGl6YXRpb25QYXJzZWRVcmwgPSBuZXcgX2tpYmFuYV9wYXJzZWRfdXJsLktpYmFuYVBhcnNlZFVybCh7CiAgICAgICAgICAgICAgYmFzZVBhdGg6IF9jaHJvbWUuZGVmYXVsdC5nZXRCYXNlUGF0aCgpLAogICAgICAgICAgICAgIGFwcElkOiBrYm5CYXNlVXJsLnNsaWNlKCcvYXBwLycubGVuZ3RoKSwKICAgICAgICAgICAgICBhcHBQYXRoOiBrYm5VcmwuZXZhbCgiIi5jb25jYXQoX3Zpc3VhbGl6ZV9jb25zdGFudHMuVmlzdWFsaXplQ29uc3RhbnRzLkVESVRfUEFUSCwgIi97e2lkfX0iKSwgewogICAgICAgICAgICAgICAgaWQ6IHNhdmVkVmlzLmlkCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7IC8vIE1hbnVhbGx5IGluc2VydCBhIG5ldyB1cmwgc28gdGhlIGJhY2sgYnV0dG9uIHdpbGwgb3BlbiB0aGUgc2F2ZWQgdmlzdWFsaXphdGlvbi4KCiAgICAgICAgICAgICR3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUoe30sICcnLCBzYXZlZFZpc3VhbGl6YXRpb25QYXJzZWRVcmwuZ2V0Um9vdFJlbGF0aXZlUGF0aCgpKTsgLy8gU2luY2Ugd2UgYXJlbid0IHJlbG9hZGluZyB0aGUgcGFnZSwgb25seSBpbnNlcnRpbmcgYSBuZXcgYnJvd3NlciBoaXN0b3J5IGl0ZW0sIHdlIG5lZWQgdG8gbWFudWFsbHkgdXBkYXRlCiAgICAgICAgICAgIC8vIHRoZSBsYXN0IHVybCBmb3IgdGhpcyBhcHAsIHNvIGRpcmVjdGx5IGNsaWNraW5nIG9uIHRoZSBWaXN1YWxpemUgdGFiIHdpbGwgYWxzbyBicmluZyB0aGUgdXNlciB0byB0aGUgc2F2ZWQKICAgICAgICAgICAgLy8gdXJsLCBub3QgdGhlIHVuc2F2ZWQgb25lLgoKICAgICAgICAgICAgX2Nocm9tZS5kZWZhdWx0LnRyYWNrU3ViVXJsRm9yQXBwKCdraWJhbmE6dmlzdWFsaXplJywgc2F2ZWRWaXN1YWxpemF0aW9uUGFyc2VkVXJsKTsKCiAgICAgICAgICAgIHZhciBsYXN0RGFzaGJvYXJkQWJzb2x1dGVVcmwgPSBfbmV3X3BsYXRmb3JtLm5wU3RhcnQuY29yZS5jaHJvbWUubmF2TGlua3MuZ2V0KCdraWJhbmE6ZGFzaGJvYXJkJykudXJsOwoKICAgICAgICAgICAgdmFyIGRhc2hib2FyZFBhcnNlZFVybCA9ICgwLCBfYWJzb2x1dGVfdG9fcGFyc2VkX3VybC5hYnNvbHV0ZVRvUGFyc2VkVXJsKShsYXN0RGFzaGJvYXJkQWJzb2x1dGVVcmwsIF9jaHJvbWUuZGVmYXVsdC5nZXRCYXNlUGF0aCgpKTsKICAgICAgICAgICAgZGFzaGJvYXJkUGFyc2VkVXJsLmFkZFF1ZXJ5UGFyYW1ldGVyKF9kYXNoYm9hcmRfY29uc3RhbnRzLkRhc2hib2FyZENvbnN0YW50cy5ORVdfVklTVUFMSVpBVElPTl9JRF9QQVJBTSwgc2F2ZWRWaXMuaWQpOwogICAgICAgICAgICBrYm5VcmwuY2hhbmdlKGRhc2hib2FyZFBhcnNlZFVybC5hcHBQYXRoKTsKICAgICAgICAgIH0gZWxzZSBpZiAoc2F2ZWRWaXMuaWQgPT09ICRyb3V0ZS5jdXJyZW50LnBhcmFtcy5pZCkgewogICAgICAgICAgICBfZG9jX3RpdGxlLmRvY1RpdGxlLmNoYW5nZShzYXZlZFZpcy5sYXN0U2F2ZWRUaXRsZSk7CgogICAgICAgICAgICBfY2hyb21lLmRlZmF1bHQuYnJlYWRjcnVtYnMuc2V0KCRpbmplY3Rvci5pbnZva2UoX2JyZWFkY3J1bWJzLmdldEVkaXRCcmVhZGNydW1icykpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAga2JuVXJsLmNoYW5nZSgiIi5jb25jYXQoX3Zpc3VhbGl6ZV9jb25zdGFudHMuVmlzdWFsaXplQ29uc3RhbnRzLkVESVRfUEFUSCwgIi97e2lkfX0iKSwgewogICAgICAgICAgICAgIGlkOiBzYXZlZFZpcy5pZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gewogICAgICAgIGlkOiBpZAogICAgICB9OwogICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZQogICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKCiAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZERhbmdlcih7CiAgICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udmlzdWFsaXplLnRvcE5hdk1lbnUuc2F2ZVZpc3VhbGl6YXRpb24uZmFpbHVyZU5vdGlmaWNhdGlvblRleHQnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkVycm9yIG9uIHNhdmluZyAne3Zpc1RpdGxlfSciLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIHZpc1RpdGxlOiBzYXZlZFZpcy50aXRsZQogICAgICAgICAgfQogICAgICAgIH0pLAogICAgICAgIHRleHQ6IGVycm9yLm1lc3NhZ2UsCiAgICAgICAgJ2RhdGEtdGVzdC1zdWJqJzogJ3NhdmVWaXN1YWxpemF0aW9uRXJyb3InCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHsKICAgICAgICBlcnJvcjogZXJyb3IKICAgICAgfTsKICAgIH0pOwogIH0KCiAgJHNjb3BlLnVubGluayA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICghJHN0YXRlLmxpbmtlZCkgcmV0dXJuOwogICAgJHN0YXRlLmxpbmtlZCA9IGZhbHNlOwogICAgdmFyIHNlYXJjaFNvdXJjZVBhcmVudCA9IHNlYXJjaFNvdXJjZS5nZXRQYXJlbnQoKTsKICAgIHZhciBzZWFyY2hTb3VyY2VHcmFuZHBhcmVudCA9IHNlYXJjaFNvdXJjZVBhcmVudC5nZXRQYXJlbnQoKTsKICAgIGRlbGV0ZSBzYXZlZFZpcy5zYXZlZFNlYXJjaElkOwogICAgZGVsZXRlIHZpcy5zYXZlZFNlYXJjaElkOwogICAgc2VhcmNoU291cmNlUGFyZW50LnNldEZpZWxkKCdmaWx0ZXInLCBfbG9kYXNoLmRlZmF1bHQudW5pb24oc2VhcmNoU291cmNlLmdldE93bkZpZWxkKCdmaWx0ZXInKSwgc2VhcmNoU291cmNlUGFyZW50LmdldE93bkZpZWxkKCdmaWx0ZXInKSkpOwogICAgJHN0YXRlLnF1ZXJ5ID0gc2VhcmNoU291cmNlUGFyZW50LmdldEZpZWxkKCdxdWVyeScpOwogICAgJHN0YXRlLmZpbHRlcnMgPSBzZWFyY2hTb3VyY2VQYXJlbnQuZ2V0RmllbGQoJ2ZpbHRlcicpOwogICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdpbmRleCcsIHNlYXJjaFNvdXJjZVBhcmVudC5nZXRGaWVsZCgnaW5kZXgnKSk7CiAgICBzZWFyY2hTb3VyY2Uuc2V0UGFyZW50KHNlYXJjaFNvdXJjZUdyYW5kcGFyZW50KTsKCiAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGRTdWNjZXNzKF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udmlzdWFsaXplLmxpbmtlZFRvU2VhcmNoLnVubGlua1N1Y2Nlc3NOb3RpZmljYXRpb25UZXh0JywgewogICAgICBkZWZhdWx0TWVzc2FnZTogIlVubGlua2VkIGZyb20gc2F2ZWQgc2VhcmNoICd7c2VhcmNoVGl0bGV9JyIsCiAgICAgIHZhbHVlczogewogICAgICAgIHNlYXJjaFRpdGxlOiBzYXZlZFZpcy5zYXZlZFNlYXJjaC50aXRsZQogICAgICB9CiAgICB9KSk7CgogICAgJHNjb3BlLmZldGNoKCk7CiAgfTsKCiAgJHNjb3BlLmdldEFkZGl0aW9uYWxNZXNzYWdlID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuICc8aSBjbGFzcz0ia3VpSWNvbiBmYS1mbGFzayI+PC9pPicgKyBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLnZpc3VhbGl6ZS5leHBlcmltZW50YWxWaXNJbmZvVGV4dCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdUaGlzIHZpc3VhbGl6YXRpb24gaXMgbWFya2VkIGFzIGV4cGVyaW1lbnRhbC4nCiAgICB9KSArICcgJyArIHZpcy50eXBlLmZlZWRiYWNrTWVzc2FnZTsKICB9OwoKICBpbml0KCk7Cn0="},null]}