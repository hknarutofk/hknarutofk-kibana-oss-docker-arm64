{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/discover/embeddable/search_embeddable.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/discover/embeddable/search_embeddable.js","mtime":1572296410204},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuU2VhcmNoRW1iZWRkYWJsZSA9IGV4cG9ydHMuU0VBUkNIX0VNQkVEREFCTEVfVFlQRSA9IHZvaWQgMDsKCnZhciBfZmlsdGVyX21hbmFnZXIgPSByZXF1aXJlKCJ1aS9maWx0ZXJfbWFuYWdlciIpOwoKdmFyIF9hbmd1bGFyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJhbmd1bGFyIikpOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfY291cmllcl9pbnNwZWN0b3JfdXRpbHMgPSByZXF1aXJlKCJ1aS9jb3VyaWVyL3V0aWxzL2NvdXJpZXJfaW5zcGVjdG9yX3V0aWxzIik7Cgp2YXIgX2FkYXB0ZXJzID0gcmVxdWlyZSgidWkvaW5zcGVjdG9yL2FkYXB0ZXJzIik7Cgp2YXIgUnggPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyeGpzIikpOwoKdmFyIF9lc1F1ZXJ5ID0gcmVxdWlyZSgiQGtibi9lcy1xdWVyeSIpOwoKdmFyIF9jaHJvbWUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInVpL2Nocm9tZSIpKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9ub3RpZnkgPSByZXF1aXJlKCJ1aS9ub3RpZnkiKTsKCnZhciBfdGltZWZpbHRlciA9IHJlcXVpcmUoInVpL3RpbWVmaWx0ZXIiKTsKCnZhciBfcHVibGljID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vZGF0YS9wdWJsaWMiKTsKCnZhciBfcHVibGljMiA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2VtYmVkZGFibGVfYXBpL3B1YmxpYy9ucF9yZWFkeS9wdWJsaWMiKTsKCnZhciBjb2x1bW5BY3Rpb25zID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgiLi4vZG9jX3RhYmxlL2FjdGlvbnMvY29sdW1ucyIpKTsKCnZhciBfc2VhcmNoX3RlbXBsYXRlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCIuL3NlYXJjaF90ZW1wbGF0ZS5odG1sIikpOwoKdmFyIF9nZXRfc29ydCA9IHJlcXVpcmUoIi4uL2RvY190YWJsZS9saWIvZ2V0X3NvcnQiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgewogIGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKICAgIHJldHVybiBvYmo7CiAgfSBlbHNlIHsKICAgIHZhciBuZXdPYmogPSB7fTsKCiAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsKCiAgICAgICAgICBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld09ialtrZXldID0gb2JqW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgbmV3T2JqLmRlZmF1bHQgPSBvYmo7CiAgICByZXR1cm4gbmV3T2JqOwogIH0KfQoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID09PSAic3ltYm9sIikgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9IGVsc2UgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0KCiAgcmV0dXJuIF90eXBlb2Yob2JqKTsKfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgfSk7CiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgfQoKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgaWYgKGkgJSAyKSB7CiAgICAgIG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICB9IGVsc2UgewogICAgICBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgewogIHRyeSB7CiAgICB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7CiAgICB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICByZWplY3QoZXJyb3IpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKGluZm8uZG9uZSkgewogICAgcmVzb2x2ZSh2YWx1ZSk7CiAgfSBlbHNlIHsKICAgIFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsKICB9Cn0KCmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOwoKICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBfdGhyb3coZXJyKSB7CiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOwogICAgICB9CgogICAgICBfbmV4dCh1bmRlZmluZWQpOwogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICB9Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgfQp9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogIHJldHVybiBDb25zdHJ1Y3RvcjsKfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgewogIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgIHJldHVybiBjYWxsOwogIH0KCiAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7Cn0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgewogIGlmIChzZWxmID09PSB2b2lkIDApIHsKICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgfQoKICByZXR1cm4gc2VsZjsKfQoKZnVuY3Rpb24gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlcikgewogIGlmICh0eXBlb2YgUmVmbGVjdCAhPT0gInVuZGVmaW5lZCIgJiYgUmVmbGVjdC5nZXQpIHsKICAgIF9nZXQgPSBSZWZsZWN0LmdldDsKICB9IGVsc2UgewogICAgX2dldCA9IGZ1bmN0aW9uIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHsKICAgICAgdmFyIGJhc2UgPSBfc3VwZXJQcm9wQmFzZSh0YXJnZXQsIHByb3BlcnR5KTsKCiAgICAgIGlmICghYmFzZSkgcmV0dXJuOwogICAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYmFzZSwgcHJvcGVydHkpOwoKICAgICAgaWYgKGRlc2MuZ2V0KSB7CiAgICAgICAgcmV0dXJuIGRlc2MuZ2V0LmNhbGwocmVjZWl2ZXIpOwogICAgICB9CgogICAgICByZXR1cm4gZGVzYy52YWx1ZTsKICAgIH07CiAgfQoKICByZXR1cm4gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlciB8fCB0YXJnZXQpOwp9CgpmdW5jdGlvbiBfc3VwZXJQcm9wQmFzZShvYmplY3QsIHByb3BlcnR5KSB7CiAgd2hpbGUgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSkpIHsKICAgIG9iamVjdCA9IF9nZXRQcm90b3R5cGVPZihvYmplY3QpOwogICAgaWYgKG9iamVjdCA9PT0gbnVsbCkgYnJlYWs7CiAgfQoKICByZXR1cm4gb2JqZWN0Owp9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOwogIH07CiAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgfQoKICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfQogIH0pOwogIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwp9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgby5fX3Byb3RvX18gPSBwOwogICAgcmV0dXJuIG87CiAgfTsKCiAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBjb25maWcgPSBfY2hyb21lLmRlZmF1bHQuZ2V0VWlTZXR0aW5nc0NsaWVudCgpOwoKdmFyIFNFQVJDSF9FTUJFRERBQkxFX1RZUEUgPSAnc2VhcmNoJzsKZXhwb3J0cy5TRUFSQ0hfRU1CRUREQUJMRV9UWVBFID0gU0VBUkNIX0VNQkVEREFCTEVfVFlQRTsKCnZhciBTZWFyY2hFbWJlZGRhYmxlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0VtYmVkZGFibGUpIHsKICBfaW5oZXJpdHMoU2VhcmNoRW1iZWRkYWJsZSwgX0VtYmVkZGFibGUpOwoKICBmdW5jdGlvbiBTZWFyY2hFbWJlZGRhYmxlKF9yZWYsIGluaXRpYWxJbnB1dCwgZXhlY3V0ZVRyaWdnZXJBY3Rpb25zLCBwYXJlbnQpIHsKICAgIHZhciBfdGhpczsKCiAgICB2YXIgJHJvb3RTY29wZSA9IF9yZWYuJHJvb3RTY29wZSwKICAgICAgICAkY29tcGlsZSA9IF9yZWYuJGNvbXBpbGUsCiAgICAgICAgc2F2ZWRTZWFyY2ggPSBfcmVmLnNhdmVkU2VhcmNoLAogICAgICAgIGVkaXRVcmwgPSBfcmVmLmVkaXRVcmwsCiAgICAgICAgaW5kZXhQYXR0ZXJucyA9IF9yZWYuaW5kZXhQYXR0ZXJucywKICAgICAgICBlZGl0YWJsZSA9IF9yZWYuZWRpdGFibGUsCiAgICAgICAgcXVlcnlGaWx0ZXIgPSBfcmVmLnF1ZXJ5RmlsdGVyOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTZWFyY2hFbWJlZGRhYmxlKTsKCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihTZWFyY2hFbWJlZGRhYmxlKS5jYWxsKHRoaXMsIGluaXRpYWxJbnB1dCwgewogICAgICBkZWZhdWx0VGl0bGU6IHNhdmVkU2VhcmNoLnRpdGxlLAogICAgICBlZGl0VXJsOiBlZGl0VXJsLAogICAgICBpbmRleFBhdHRlcm5zOiBpbmRleFBhdHRlcm5zLAogICAgICBlZGl0YWJsZTogZWRpdGFibGUKICAgIH0sIHBhcmVudCkpOwogICAgX3RoaXMuZXhlY3V0ZVRyaWdnZXJBY3Rpb25zID0gZXhlY3V0ZVRyaWdnZXJBY3Rpb25zOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNhdmVkU2VhcmNoIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICIkcm9vdFNjb3BlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICIkY29tcGlsZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaW5zcGVjdG9yQWRhcHRvcnMiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNlYXJjaFNjb3BlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJwYW5lbFRpdGxlIiwgJycpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImZpbHRlcnNTZWFyY2hTb3VyY2UiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNlYXJjaEluc3RhbmNlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJhdXRvUmVmcmVzaEZldGNoU3Vic2NyaXB0aW9uIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdWJzY3JpcHRpb24iLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInR5cGUiLCBTRUFSQ0hfRU1CRUREQUJMRV9UWVBFKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJmaWx0ZXJHZW4iLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInByZXZUaW1lUmFuZ2UiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInByZXZGaWx0ZXJzIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJwcmV2UXVlcnkiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImZldGNoIiwKICAgIC8qI19fUFVSRV9fKi8KICAgIF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgdmFyIHNlYXJjaFNvdXJjZSwgdGl0bGUsIGRlc2NyaXB0aW9uLCBpbnNwZWN0b3JSZXF1ZXN0LCByZXNwOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgaWYgKF90aGlzLnNlYXJjaFNjb3BlKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgc2VhcmNoU291cmNlID0gX3RoaXMuc2F2ZWRTZWFyY2guc2VhcmNoU291cmNlOyAvLyBBYm9ydCBhbnkgaW4tcHJvZ3Jlc3MgcmVxdWVzdHMKCiAgICAgICAgICAgICAgc2VhcmNoU291cmNlLmNhbmNlbFF1ZXVlZCgpOwogICAgICAgICAgICAgIHNlYXJjaFNvdXJjZS5zZXRGaWVsZCgnc2l6ZScsIGNvbmZpZy5nZXQoJ2Rpc2NvdmVyOnNhbXBsZVNpemUnKSk7CiAgICAgICAgICAgICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdzb3J0JywgKDAsIF9nZXRfc29ydC5nZXRTb3J0KShfdGhpcy5zZWFyY2hTY29wZS5zb3J0LCBfdGhpcy5zZWFyY2hTY29wZS5pbmRleFBhdHRlcm4pKTsgLy8gTG9nIHJlcXVlc3QgdG8gaW5zcGVjdG9yCgogICAgICAgICAgICAgIF90aGlzLmluc3BlY3RvckFkYXB0b3JzLnJlcXVlc3RzLnJlc2V0KCk7CgogICAgICAgICAgICAgIHRpdGxlID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5lbWJlZGRhYmxlLmluc3BlY3RvclJlcXVlc3REYXRhVGl0bGUnLCB7CiAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0RhdGEnCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLmVtYmVkZGFibGUuaW5zcGVjdG9yUmVxdWVzdERlc2NyaXB0aW9uJywgewogICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdUaGlzIHJlcXVlc3QgcXVlcmllcyBFbGFzdGljc2VhcmNoIHRvIGZldGNoIHRoZSBkYXRhIGZvciB0aGUgc2VhcmNoLicKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpbnNwZWN0b3JSZXF1ZXN0ID0gX3RoaXMuaW5zcGVjdG9yQWRhcHRvcnMucmVxdWVzdHMuc3RhcnQodGl0bGUsIHsKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGluc3BlY3RvclJlcXVlc3Quc3RhdHMoKDAsIF9jb3VyaWVyX2luc3BlY3Rvcl91dGlscy5nZXRSZXF1ZXN0SW5zcGVjdG9yU3RhdHMpKHNlYXJjaFNvdXJjZSkpOwogICAgICAgICAgICAgIHNlYXJjaFNvdXJjZS5nZXRTZWFyY2hSZXF1ZXN0Qm9keSgpLnRoZW4oZnVuY3Rpb24gKGJvZHkpIHsKICAgICAgICAgICAgICAgIGluc3BlY3RvclJlcXVlc3QuanNvbihib2R5KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBfdGhpcy5zZWFyY2hTY29wZS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxMzsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgcmV0dXJuIHNlYXJjaFNvdXJjZS5mZXRjaCgpOwoKICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICByZXNwID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICBfdGhpcy5zZWFyY2hTY29wZS5pc0xvYWRpbmcgPSBmYWxzZTsgLy8gTG9nIHJlc3BvbnNlIHRvIGluc3BlY3RvcgoKICAgICAgICAgICAgICBpbnNwZWN0b3JSZXF1ZXN0LnN0YXRzKCgwLCBfY291cmllcl9pbnNwZWN0b3JfdXRpbHMuZ2V0UmVzcG9uc2VJbnNwZWN0b3JTdGF0cykoc2VhcmNoU291cmNlLCByZXNwKSkub2soewogICAgICAgICAgICAgICAganNvbjogcmVzcAogICAgICAgICAgICAgIH0pOyAvLyBBcHBseSB0aGUgY2hhbmdlcyB0byB0aGUgYW5ndWxhciBzY29wZQoKICAgICAgICAgICAgICBfdGhpcy5zZWFyY2hTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgX3RoaXMuc2VhcmNoU2NvcGUuaGl0cyA9IHJlc3AuaGl0cy5oaXRzOwogICAgICAgICAgICAgICAgX3RoaXMuc2VhcmNoU2NvcGUudG90YWxIaXRDb3VudCA9IHJlc3AuaGl0cy50b3RhbDsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI3OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMjI7CiAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgxMyk7CgogICAgICAgICAgICAgIGlmICghKF9jb250ZXh0LnQwLm5hbWUgPT09ICdBYm9ydEVycm9yJykpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZEVycm9yKF9jb250ZXh0LnQwLCB7CiAgICAgICAgICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5lbWJlZGRhYmxlLmVycm9yVGl0bGUnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRXJyb3IgZmV0Y2hpbmcgZGF0YScKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzEzLCAyMl1dKTsKICAgIH0pKSk7CgogICAgX3RoaXMuZmlsdGVyR2VuID0gKDAsIF9maWx0ZXJfbWFuYWdlci5nZXRGaWx0ZXJHZW5lcmF0b3IpKHF1ZXJ5RmlsdGVyKTsKICAgIF90aGlzLnNhdmVkU2VhcmNoID0gc2F2ZWRTZWFyY2g7CiAgICBfdGhpcy4kcm9vdFNjb3BlID0gJHJvb3RTY29wZTsKICAgIF90aGlzLiRjb21waWxlID0gJGNvbXBpbGU7CiAgICBfdGhpcy5pbnNwZWN0b3JBZGFwdG9ycyA9IHsKICAgICAgcmVxdWVzdHM6IG5ldyBfYWRhcHRlcnMuUmVxdWVzdEFkYXB0ZXIoKQogICAgfTsKCiAgICBfdGhpcy5pbml0aWFsaXplU2VhcmNoU2NvcGUoKTsKCiAgICBfdGhpcy5hdXRvUmVmcmVzaEZldGNoU3Vic2NyaXB0aW9uID0gX3RpbWVmaWx0ZXIudGltZWZpbHRlci5nZXRBdXRvUmVmcmVzaEZldGNoJCgpLnN1YnNjcmliZShfdGhpcy5mZXRjaCk7CiAgICBfdGhpcy5zdWJzY3JpcHRpb24gPSBSeC5tZXJnZShfdGhpcy5nZXRPdXRwdXQkKCksIF90aGlzLmdldElucHV0JCgpKS5zdWJzY3JpYmUoZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5wYW5lbFRpdGxlID0gX3RoaXMub3V0cHV0LnRpdGxlIHx8ICcnOwoKICAgICAgaWYgKF90aGlzLnNlYXJjaFNjb3BlKSB7CiAgICAgICAgX3RoaXMucHVzaENvbnRhaW5lclN0YXRlUGFyYW1zVG9TY29wZShfdGhpcy5zZWFyY2hTY29wZSk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFNlYXJjaEVtYmVkZGFibGUsIFt7CiAgICBrZXk6ICJnZXRJbnNwZWN0b3JBZGFwdGVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0SW5zcGVjdG9yQWRhcHRlcnMoKSB7CiAgICAgIHJldHVybiB0aGlzLmluc3BlY3RvckFkYXB0b3JzOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFNhdmVkU2VhcmNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTYXZlZFNlYXJjaCgpIHsKICAgICAgcmV0dXJuIHRoaXMuc2F2ZWRTZWFyY2g7CiAgICB9CiAgICAvKioKICAgICAqCiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGRvbU5vZGUKICAgICAqIEBwYXJhbSB7Q29udGFpbmVyU3RhdGV9IGNvbnRhaW5lclN0YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoZG9tTm9kZSkgewogICAgICBpZiAoIXRoaXMuc2VhcmNoU2NvcGUpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlYXJjaCBzY29wZSBub3QgZGVmaW5lZCcpOwogICAgICB9CgogICAgICB0aGlzLnNlYXJjaEluc3RhbmNlID0gdGhpcy4kY29tcGlsZShfc2VhcmNoX3RlbXBsYXRlLmRlZmF1bHQpKHRoaXMuc2VhcmNoU2NvcGUpOwoKICAgICAgdmFyIHJvb3ROb2RlID0gX2FuZ3VsYXIuZGVmYXVsdC5lbGVtZW50KGRvbU5vZGUpOwoKICAgICAgcm9vdE5vZGUuYXBwZW5kKHRoaXMuc2VhcmNoSW5zdGFuY2UpOwogICAgICB0aGlzLnB1c2hDb250YWluZXJTdGF0ZVBhcmFtc1RvU2NvcGUodGhpcy5zZWFyY2hTY29wZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgX2dldChfZ2V0UHJvdG90eXBlT2YoU2VhcmNoRW1iZWRkYWJsZS5wcm90b3R5cGUpLCAiZGVzdHJveSIsIHRoaXMpLmNhbGwodGhpcyk7CgogICAgICB0aGlzLnNhdmVkU2VhcmNoLmRlc3Ryb3koKTsKCiAgICAgIGlmICh0aGlzLnNlYXJjaEluc3RhbmNlKSB7CiAgICAgICAgdGhpcy5zZWFyY2hJbnN0YW5jZS5yZW1vdmUoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2VhcmNoU2NvcGUpIHsKICAgICAgICB0aGlzLnNlYXJjaFNjb3BlLiRkZXN0cm95KCk7CiAgICAgICAgZGVsZXRlIHRoaXMuc2VhcmNoU2NvcGU7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbikgewogICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmF1dG9SZWZyZXNoRmV0Y2hTdWJzY3JpcHRpb24pIHsKICAgICAgICB0aGlzLmF1dG9SZWZyZXNoRmV0Y2hTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTsKICAgICAgfQoKICAgICAgdGhpcy5zYXZlZFNlYXJjaC5zZWFyY2hTb3VyY2UuY2FuY2VsUXVldWVkKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaW5pdGlhbGl6ZVNlYXJjaFNjb3BlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aWFsaXplU2VhcmNoU2NvcGUoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIHNlYXJjaFNjb3BlID0gdGhpcy5zZWFyY2hTY29wZSA9IHRoaXMuJHJvb3RTY29wZS4kbmV3KCk7CiAgICAgIHNlYXJjaFNjb3BlLmRlc2NyaXB0aW9uID0gdGhpcy5zYXZlZFNlYXJjaC5kZXNjcmlwdGlvbjsKICAgICAgc2VhcmNoU2NvcGUuaW5zcGVjdG9yQWRhcHRlcnMgPSB0aGlzLmluc3BlY3RvckFkYXB0b3JzOwogICAgICB2YXIgc2VhcmNoU291cmNlID0gdGhpcy5zYXZlZFNlYXJjaC5zZWFyY2hTb3VyY2U7CiAgICAgIHZhciBpbmRleFBhdHRlcm4gPSBzZWFyY2hTY29wZS5pbmRleFBhdHRlcm4gPSBzZWFyY2hTb3VyY2UuZ2V0RmllbGQoJ2luZGV4Jyk7CiAgICAgIHZhciB0aW1lUmFuZ2VTZWFyY2hTb3VyY2UgPSBzZWFyY2hTb3VyY2UuY3JlYXRlKCk7CiAgICAgIHRpbWVSYW5nZVNlYXJjaFNvdXJjZS5zZXRGaWVsZCgnZmlsdGVyJywgZnVuY3Rpb24gKCkgewogICAgICAgIGlmICghX3RoaXMyLnNlYXJjaFNjb3BlIHx8ICFfdGhpczIuaW5wdXQudGltZVJhbmdlKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKDAsIF90aW1lZmlsdGVyLmdldFRpbWUpKGluZGV4UGF0dGVybiwgX3RoaXMyLmlucHV0LnRpbWVSYW5nZSk7CiAgICAgIH0pOwogICAgICB0aGlzLmZpbHRlcnNTZWFyY2hTb3VyY2UgPSBzZWFyY2hTb3VyY2UuY3JlYXRlKCk7CiAgICAgIHRoaXMuZmlsdGVyc1NlYXJjaFNvdXJjZS5zZXRQYXJlbnQodGltZVJhbmdlU2VhcmNoU291cmNlKTsKICAgICAgc2VhcmNoU291cmNlLnNldFBhcmVudCh0aGlzLmZpbHRlcnNTZWFyY2hTb3VyY2UpOwogICAgICB0aGlzLnB1c2hDb250YWluZXJTdGF0ZVBhcmFtc1RvU2NvcGUoc2VhcmNoU2NvcGUpOwoKICAgICAgc2VhcmNoU2NvcGUuc2V0U29ydE9yZGVyID0gZnVuY3Rpb24gKHNvcnQpIHsKICAgICAgICBfdGhpczIudXBkYXRlSW5wdXQoewogICAgICAgICAgc29ydDogc29ydAogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgc2VhcmNoU2NvcGUuYWRkQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbk5hbWUpIHsKICAgICAgICBpZiAoIXNlYXJjaFNjb3BlLmNvbHVtbnMpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGluZGV4UGF0dGVybi5wb3B1bGFyaXplRmllbGQoY29sdW1uTmFtZSwgMSk7CiAgICAgICAgY29sdW1uQWN0aW9ucy5hZGRDb2x1bW4oc2VhcmNoU2NvcGUuY29sdW1ucywgY29sdW1uTmFtZSk7CgogICAgICAgIF90aGlzMi51cGRhdGVJbnB1dCh7CiAgICAgICAgICBjb2x1bW5zOiBzZWFyY2hTY29wZS5jb2x1bW5zCiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICBzZWFyY2hTY29wZS5yZW1vdmVDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uTmFtZSkgewogICAgICAgIGlmICghc2VhcmNoU2NvcGUuY29sdW1ucykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29sdW1uQWN0aW9ucy5yZW1vdmVDb2x1bW4oc2VhcmNoU2NvcGUuY29sdW1ucywgY29sdW1uTmFtZSk7CgogICAgICAgIF90aGlzMi51cGRhdGVJbnB1dCh7CiAgICAgICAgICBjb2x1bW5zOiBzZWFyY2hTY29wZS5jb2x1bW5zCiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICBzZWFyY2hTY29wZS5tb3ZlQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbk5hbWUsIG5ld0luZGV4KSB7CiAgICAgICAgaWYgKCFzZWFyY2hTY29wZS5jb2x1bW5zKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb2x1bW5BY3Rpb25zLm1vdmVDb2x1bW4oc2VhcmNoU2NvcGUuY29sdW1ucywgY29sdW1uTmFtZSwgbmV3SW5kZXgpOwoKICAgICAgICBfdGhpczIudXBkYXRlSW5wdXQoewogICAgICAgICAgY29sdW1uczogc2VhcmNoU2NvcGUuY29sdW1ucwogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgc2VhcmNoU2NvcGUuZmlsdGVyID0KICAgICAgLyojX19QVVJFX18qLwogICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9yZWYzID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKGZpZWxkLCB2YWx1ZSwgb3BlcmF0b3IpIHsKICAgICAgICAgIHZhciBmaWx0ZXJzOwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgZmlsdGVycyA9IF90aGlzMi5maWx0ZXJHZW4uZ2VuZXJhdGUoZmllbGQsIHZhbHVlLCBvcGVyYXRvciwgaW5kZXhQYXR0ZXJuLmlkKTsKICAgICAgICAgICAgICAgICAgZmlsdGVycyA9IGZpbHRlcnMubWFwKGZ1bmN0aW9uIChmaWx0ZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgZmlsdGVyLCB7CiAgICAgICAgICAgICAgICAgICAgICAkc3RhdGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmU6IF9lc1F1ZXJ5LkZpbHRlclN0YXRlU3RvcmUuQVBQX1NUQVRFCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczIuZXhlY3V0ZVRyaWdnZXJBY3Rpb25zKF9wdWJsaWMyLkFQUExZX0ZJTFRFUl9UUklHR0VSLCB7CiAgICAgICAgICAgICAgICAgICAgZW1iZWRkYWJsZTogX3RoaXMyLAogICAgICAgICAgICAgICAgICAgIHRyaWdnZXJDb250ZXh0OiB7CiAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzOiBmaWx0ZXJzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWUyKTsKICAgICAgICB9KSk7CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gsIF94MiwgX3gzKSB7CiAgICAgICAgICByZXR1cm4gX3JlZjMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9OwogICAgICB9KCk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWxvYWQoKSB7CiAgICAgIHRoaXMuZmV0Y2goKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJwdXNoQ29udGFpbmVyU3RhdGVQYXJhbXNUb1Njb3BlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwdXNoQ29udGFpbmVyU3RhdGVQYXJhbXNUb1Njb3BlKHNlYXJjaFNjb3BlKSB7CiAgICAgIHZhciBpc0ZldGNoUmVxdWlyZWQgPSAhKDAsIF9wdWJsaWMub25seURpc2FibGVkRmlsdGVyc0NoYW5nZWQpKHRoaXMuaW5wdXQuZmlsdGVycywgdGhpcy5wcmV2RmlsdGVycykgfHwgIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKHRoaXMucHJldlF1ZXJ5LCB0aGlzLmlucHV0LnF1ZXJ5KSB8fCAhX2xvZGFzaC5kZWZhdWx0LmlzRXF1YWwodGhpcy5wcmV2VGltZVJhbmdlLCB0aGlzLmlucHV0LnRpbWVSYW5nZSkgfHwgIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKHNlYXJjaFNjb3BlLnNvcnQsIHRoaXMuaW5wdXQuc29ydCB8fCB0aGlzLnNhdmVkU2VhcmNoLnNvcnQpOyAvLyBJZiB0aGVyZSBpcyBjb2x1bW4gb3Igc29ydCBkYXRhIG9uIHRoZSBwYW5lbCwgdGhhdCBtZWFucyB0aGUgb3JpZ2luYWwgY29sdW1ucyBvciBzb3J0IHNldHRpbmdzIGhhdmUKICAgICAgLy8gYmVlbiBvdmVycmlkZGVuIGluIGEgZGFzaGJvYXJkLgoKICAgICAgc2VhcmNoU2NvcGUuY29sdW1ucyA9IHRoaXMuaW5wdXQuY29sdW1ucyB8fCB0aGlzLnNhdmVkU2VhcmNoLmNvbHVtbnM7CiAgICAgIHNlYXJjaFNjb3BlLnNvcnQgPSB0aGlzLmlucHV0LnNvcnQgfHwgdGhpcy5zYXZlZFNlYXJjaC5zb3J0OwogICAgICBzZWFyY2hTY29wZS5zaGFyZWRJdGVtVGl0bGUgPSB0aGlzLnBhbmVsVGl0bGU7CgogICAgICBpZiAoaXNGZXRjaFJlcXVpcmVkKSB7CiAgICAgICAgdGhpcy5maWx0ZXJzU2VhcmNoU291cmNlLnNldEZpZWxkKCdmaWx0ZXInLCB0aGlzLmlucHV0LmZpbHRlcnMpOwogICAgICAgIHRoaXMuZmlsdGVyc1NlYXJjaFNvdXJjZS5zZXRGaWVsZCgncXVlcnknLCB0aGlzLmlucHV0LnF1ZXJ5KTsKICAgICAgICB0aGlzLmZldGNoKCk7CiAgICAgICAgdGhpcy5wcmV2RmlsdGVycyA9IHRoaXMuaW5wdXQuZmlsdGVyczsKICAgICAgICB0aGlzLnByZXZRdWVyeSA9IHRoaXMuaW5wdXQucXVlcnk7CiAgICAgICAgdGhpcy5wcmV2VGltZVJhbmdlID0gdGhpcy5pbnB1dC50aW1lUmFuZ2U7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBTZWFyY2hFbWJlZGRhYmxlOwp9KF9wdWJsaWMyLkVtYmVkZGFibGUpOwoKZXhwb3J0cy5TZWFyY2hFbWJlZGRhYmxlID0gU2VhcmNoRW1iZWRkYWJsZTs="},null]}