{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/ui/public/share/components/url_panel_content.js","dependencies":[{"path":"src/legacy/ui/public/share/components/url_panel_content.js","mtime":1572296412928},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuVXJsUGFuZWxDb250ZW50ID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfdXJsID0gcmVxdWlyZSgidXJsIik7Cgp2YXIgX3JlYWN0MiA9IHJlcXVpcmUoIkBrYm4vaTE4bi9yZWFjdCIpOwoKdmFyIF9zdGF0ZV9oYXNoaW5nID0gcmVxdWlyZSgiLi4vLi4vc3RhdGVfbWFuYWdlbWVudC9zdGF0ZV9oYXNoaW5nIik7Cgp2YXIgX3VybF9zaG9ydGVuZXIgPSByZXF1aXJlKCIuLi9saWIvdXJsX3Nob3J0ZW5lciIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPT09ICJzeW1ib2wiKSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0gZWxzZSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfQoKICByZXR1cm4gX3R5cGVvZihvYmopOwp9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7CiAgdHJ5IHsKICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgIHZhciB2YWx1ZSA9IGluZm8udmFsdWU7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIHJlamVjdChlcnJvcik7CiAgICByZXR1cm47CiAgfQoKICBpZiAoaW5mby5kb25lKSB7CiAgICByZXNvbHZlKHZhbHVlKTsKICB9IGVsc2UgewogICAgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOwogIH0KfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CgogICAgICBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7CiAgICAgIH0KCiAgICAgIF9uZXh0KHVuZGVmaW5lZCk7CiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICB9Cn0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgcmV0dXJuIENvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7CiAgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgewogICAgcmV0dXJuIGNhbGw7CiAgfQoKICByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsKfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogICAgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsKICB9OwogIHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7Cn0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgewogIGlmIChzZWxmID09PSB2b2lkIDApIHsKICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgfQoKICByZXR1cm4gc2VsZjsKfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgfQoKICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfQogIH0pOwogIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwp9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgby5fX3Byb3RvX18gPSBwOwogICAgcmV0dXJuIG87CiAgfTsKCiAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0gLy8gVE9ETzogUmVtb3ZlIG9uY2UgRXVpSWNvblRpcCBzdXBwb3J0cyAiY29udGVudCIgcHJvcAoKCnZhciBGaXhlZEV1aUljb25UaXAgPSBfZXVpLkV1aUljb25UaXA7CnZhciBFeHBvcnRVcmxBc1R5cGU7CgooZnVuY3Rpb24gKEV4cG9ydFVybEFzVHlwZSkgewogIEV4cG9ydFVybEFzVHlwZVsiRVhQT1JUX1VSTF9BU19TQVZFRF9PQkpFQ1QiXSA9ICJzYXZlZE9iamVjdCI7CiAgRXhwb3J0VXJsQXNUeXBlWyJFWFBPUlRfVVJMX0FTX1NOQVBTSE9UIl0gPSAic25hcHNob3QiOwp9KShFeHBvcnRVcmxBc1R5cGUgfHwgKEV4cG9ydFVybEFzVHlwZSA9IHt9KSk7Cgp2YXIgVXJsUGFuZWxDb250ZW50VUkgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfQ29tcG9uZW50KSB7CiAgX2luaGVyaXRzKFVybFBhbmVsQ29udGVudFVJLCBfQ29tcG9uZW50KTsKCiAgZnVuY3Rpb24gVXJsUGFuZWxDb250ZW50VUkocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVXJsUGFuZWxDb250ZW50VUkpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFVybFBhbmVsQ29udGVudFVJKS5jYWxsKHRoaXMsIHByb3BzKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAibW91bnRlZCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2hvcnRVcmxDYWNoZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaXNOb3RTYXZlZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF90aGlzLnByb3BzLm9iamVjdElkID09PSB1bmRlZmluZWQgfHwgX3RoaXMucHJvcHMub2JqZWN0SWQgPT09ICcnOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVzZXRVcmwiLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChfdGhpcy5tb3VudGVkKSB7CiAgICAgICAgX3RoaXMuc2hvcnRVcmxDYWNoZSA9IHVuZGVmaW5lZDsKCiAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgdXNlU2hvcnRVcmw6IGZhbHNlCiAgICAgICAgfSwgX3RoaXMuc2V0VXJsKTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZ2V0U2F2ZWRPYmplY3RVcmwiLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChfdGhpcy5pc05vdFNhdmVkKCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsgLy8gUmVwbGFjZSBoYXNoZXMgd2l0aCBvcmlnaW5hbCBSSVNPTiB2YWx1ZXMuCgogICAgICB2YXIgdW5oYXNoZWRVcmwgPSAoMCwgX3N0YXRlX2hhc2hpbmcudW5oYXNoVXJsKSh1cmwsIF90aGlzLnByb3BzLmdldFVuaGFzaGFibGVTdGF0ZXMoKSk7CiAgICAgIHZhciBwYXJzZWRVcmwgPSAoMCwgX3VybC5wYXJzZSkodW5oYXNoZWRVcmwpOwoKICAgICAgaWYgKCFwYXJzZWRVcmwgfHwgIXBhcnNlZFVybC5oYXNoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIEdldCB0aGUgYXBwbGljYXRpb24gcm91dGUsIGFmdGVyIHRoZSBoYXNoLCBhbmQgcmVtb3ZlIHRoZSAjLgoKCiAgICAgIHZhciBwYXJzZWRBcHBVcmwgPSAoMCwgX3VybC5wYXJzZSkocGFyc2VkVXJsLmhhc2guc2xpY2UoMSksIHRydWUpOwogICAgICByZXR1cm4gKDAsIF91cmwuZm9ybWF0KSh7CiAgICAgICAgcHJvdG9jb2w6IHBhcnNlZFVybC5wcm90b2NvbCwKICAgICAgICBhdXRoOiBwYXJzZWRVcmwuYXV0aCwKICAgICAgICBob3N0OiBwYXJzZWRVcmwuaG9zdCwKICAgICAgICBwYXRobmFtZTogcGFyc2VkVXJsLnBhdGhuYW1lLAogICAgICAgIGhhc2g6ICgwLCBfdXJsLmZvcm1hdCkoewogICAgICAgICAgcGF0aG5hbWU6IHBhcnNlZEFwcFVybC5wYXRobmFtZSwKICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgIC8vIEFkZCBnbG9iYWwgc3RhdGUgdG8gdGhlIFVSTCBzbyB0aGF0IHRoZSBpZnJhbWUgZG9lc24ndCBqdXN0IHNob3cgdGhlIHRpbWUgcmFuZ2UKICAgICAgICAgICAgLy8gZGVmYXVsdC4KICAgICAgICAgICAgX2c6IHBhcnNlZEFwcFVybC5xdWVyeS5fZwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZ2V0U25hcHNob3RVcmwiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsgLy8gUmVwbGFjZSBoYXNoZXMgd2l0aCBvcmlnaW5hbCBSSVNPTiB2YWx1ZXMuCgogICAgICByZXR1cm4gKDAsIF9zdGF0ZV9oYXNoaW5nLnVuaGFzaFVybCkodXJsLCBfdGhpcy5wcm9wcy5nZXRVbmhhc2hhYmxlU3RhdGVzKCkpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAibWFrZVVybEVtYmVkZGFibGUiLCBmdW5jdGlvbiAodXJsKSB7CiAgICAgIHZhciBlbWJlZFF1ZXJ5UGFyYW0gPSAnP2VtYmVkPXRydWUnOwogICAgICB2YXIgdXJsSGFzUXVlcnlTdHJpbmcgPSB1cmwuaW5kZXhPZignPycpICE9PSAtMTsKCiAgICAgIGlmICh1cmxIYXNRdWVyeVN0cmluZykgewogICAgICAgIHJldHVybiB1cmwucmVwbGFjZSgnPycsICIiLmNvbmNhdChlbWJlZFF1ZXJ5UGFyYW0sICImIikpOwogICAgICB9CgogICAgICByZXR1cm4gIiIuY29uY2F0KHVybCkuY29uY2F0KGVtYmVkUXVlcnlQYXJhbSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJtYWtlSWZyYW1lVGFnIiwgZnVuY3Rpb24gKHVybCkgewogICAgICBpZiAoIXVybCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGVtYmVkZGFibGVVcmwgPSBfdGhpcy5tYWtlVXJsRW1iZWRkYWJsZSh1cmwpOwoKICAgICAgcmV0dXJuICI8aWZyYW1lIHNyYz1cIiIuY29uY2F0KGVtYmVkZGFibGVVcmwsICJcIiBoZWlnaHQ9XCI2MDBcIiB3aWR0aD1cIjgwMFwiPjwvaWZyYW1lPiIpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2V0VXJsIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgdXJsOwoKICAgICAgaWYgKF90aGlzLnN0YXRlLmV4cG9ydFVybEFzID09PSBFeHBvcnRVcmxBc1R5cGUuRVhQT1JUX1VSTF9BU19TQVZFRF9PQkpFQ1QpIHsKICAgICAgICB1cmwgPSBfdGhpcy5nZXRTYXZlZE9iamVjdFVybCgpOwogICAgICB9IGVsc2UgaWYgKF90aGlzLnN0YXRlLnVzZVNob3J0VXJsKSB7CiAgICAgICAgdXJsID0gX3RoaXMuc2hvcnRVcmxDYWNoZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB1cmwgPSBfdGhpcy5nZXRTbmFwc2hvdFVybCgpOwogICAgICB9CgogICAgICBpZiAoX3RoaXMucHJvcHMuaXNFbWJlZGRlZCkgewogICAgICAgIHVybCA9IF90aGlzLm1ha2VJZnJhbWVUYWcodXJsKTsKICAgICAgfQoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHVybDogdXJsCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFuZGxlRXhwb3J0VXJsQXMiLCBmdW5jdGlvbiAob3B0aW9uSWQpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGV4cG9ydFVybEFzOiBvcHRpb25JZAogICAgICB9LCBfdGhpcy5zZXRVcmwpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFuZGxlU2hvcnRVcmxDaGFuZ2UiLAogICAgLyojX19QVVJFX18qLwogICAgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JlZiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoZXZ0KSB7CiAgICAgICAgdmFyIGlzQ2hlY2tlZCwgc2hvcnRVcmw7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaXNDaGVja2VkID0gZXZ0LnRhcmdldC5jaGVja2VkOwoKICAgICAgICAgICAgICAgIGlmICghKCFpc0NoZWNrZWQgfHwgX3RoaXMuc2hvcnRVcmxDYWNoZSAhPT0gdW5kZWZpbmVkKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICB1c2VTaG9ydFVybDogaXNDaGVja2VkCiAgICAgICAgICAgICAgICB9LCBfdGhpcy5zZXRVcmwpOwoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAvLyAiVXNlIHNob3J0IFVSTCIgaXMgY2hlY2tlZCBidXQgc2hvcnRVcmwgaGFzIG5vdCBiZWVuIGdlbmVyYXRlZCB5ZXQgc28gb25lIG5lZWRzIHRvIGJlIGNyZWF0ZWQuCiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgIGlzQ3JlYXRpbmdTaG9ydFVybDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgc2hvcnRVcmxFcnJvck1zZzogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gNTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfdXJsX3Nob3J0ZW5lci5zaG9ydGVuVXJsKShfdGhpcy5nZXRTbmFwc2hvdFVybCgpKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgc2hvcnRVcmwgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgICAgIGlmIChfdGhpcy5tb3VudGVkKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzLnNob3J0VXJsQ2FjaGUgPSBzaG9ydFVybDsKCiAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICBpc0NyZWF0aW5nU2hvcnRVcmw6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHVzZVNob3J0VXJsOiBpc0NoZWNrZWQKICAgICAgICAgICAgICAgICAgfSwgX3RoaXMuc2V0VXJsKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxMjsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oNSk7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzLm1vdW50ZWQpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMuc2hvcnRVcmxDYWNoZSA9IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICB1c2VTaG9ydFVybDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgaXNDcmVhdGluZ1Nob3J0VXJsOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBzaG9ydFVybEVycm9yTXNnOiBfdGhpcy5wcm9wcy5pbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICAgICAgaWQ6ICdjb21tb24udWkuc2hhcmUudXJsUGFuZWwudW5hYmxlQ3JlYXRlU2hvcnRVcmxFcnJvck1lc3NhZ2UnLAogICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdVbmFibGUgdG8gY3JlYXRlIHNob3J0IFVSTC4gRXJyb3I6IHtlcnJvck1lc3NhZ2V9JwogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZTogX2NvbnRleHQudDAubWVzc2FnZQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgIH0sIF90aGlzLnNldFVybCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzUsIDEyXV0pOwogICAgICB9KSk7CgogICAgICByZXR1cm4gZnVuY3Rpb24gKF94KSB7CiAgICAgICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0oKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVuZGVyRXhwb3J0VXJsQXNPcHRpb25zIiwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gW19kZWZpbmVQcm9wZXJ0eSh7CiAgICAgICAgaWQ6IEV4cG9ydFVybEFzVHlwZS5FWFBPUlRfVVJMX0FTX1NOQVBTSE9ULAogICAgICAgIGxhYmVsOiBfdGhpcy5yZW5kZXJXaXRoSWNvblRpcChfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJjb21tb24udWkuc2hhcmUudXJsUGFuZWwuc25hcHNob3RMYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNuYXBzaG90IgogICAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJjb21tb24udWkuc2hhcmUudXJsUGFuZWwuc25hcHNob3REZXNjcmlwdGlvbiIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNuYXBzaG90IFVSTHMgZW5jb2RlIHRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSB7b2JqZWN0VHlwZX0gaW4gdGhlIFVSTCBpdHNlbGYuIEVkaXRzIHRvIHRoZSBzYXZlZCB7b2JqZWN0VHlwZX0gd29uJ3QgYmUgdmlzaWJsZSB2aWEgdGhpcyBVUkwuIiwKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBvYmplY3RUeXBlOiBfdGhpcy5wcm9wcy5vYmplY3RUeXBlCiAgICAgICAgICB9CiAgICAgICAgfSkpCiAgICAgIH0sICdkYXRhLXRlc3Qtc3ViaicsICdleHBvcnRBc1NuYXBzaG90JyksIF9kZWZpbmVQcm9wZXJ0eSh7CiAgICAgICAgaWQ6IEV4cG9ydFVybEFzVHlwZS5FWFBPUlRfVVJMX0FTX1NBVkVEX09CSkVDVCwKICAgICAgICBkaXNhYmxlZDogX3RoaXMuaXNOb3RTYXZlZCgpLAogICAgICAgIGxhYmVsOiBfdGhpcy5yZW5kZXJXaXRoSWNvblRpcChfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJjb21tb24udWkuc2hhcmUudXJsUGFuZWwuc2F2ZWRPYmplY3RMYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmVkIG9iamVjdCIKICAgICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAiY29tbW9uLnVpLnNoYXJlLnVybFBhbmVsLnNhdmVkT2JqZWN0RGVzY3JpcHRpb24iLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJZb3UgY2FuIHNoYXJlIHRoaXMgVVJMIHdpdGggcGVvcGxlIHRvIGxldCB0aGVtIGxvYWQgdGhlIG1vc3QgcmVjZW50IHNhdmVkIHZlcnNpb24gb2YgdGhpcyB7b2JqZWN0VHlwZX0uIiwKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBvYmplY3RUeXBlOiBfdGhpcy5wcm9wcy5vYmplY3RUeXBlCiAgICAgICAgICB9CiAgICAgICAgfSkpCiAgICAgIH0sICdkYXRhLXRlc3Qtc3ViaicsICdleHBvcnRBc1NhdmVkT2JqZWN0JyldOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVuZGVyV2l0aEljb25UaXAiLCBmdW5jdGlvbiAoY2hpbGQsIHRpcENvbnRlbnQpIHsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICBndXR0ZXJTaXplOiAibm9uZSIsCiAgICAgICAgcmVzcG9uc2l2ZTogZmFsc2UKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCBudWxsLCBjaGlsZCksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IGZhbHNlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoRml4ZWRFdWlJY29uVGlwLCB7CiAgICAgICAgY29udGVudDogdGlwQ29udGVudCwKICAgICAgICBwb3NpdGlvbjogImJvdHRvbSIKICAgICAgfSkpKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlbmRlckV4cG9ydEFzUmFkaW9Hcm91cCIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGdlbmVyYXRlTGlua0FzSGVscCA9IF90aGlzLmlzTm90U2F2ZWQoKSA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuc2hhcmUudXJsUGFuZWwuY2FuTm90U2hhcmVBc1NhdmVkT2JqZWN0SGVscFRleHQiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ2FuJ3Qgc2hhcmUgYXMgc2F2ZWQgb2JqZWN0IHVudGlsIHRoZSB7b2JqZWN0VHlwZX0gaGFzIGJlZW4gc2F2ZWQuIiwKICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgIG9iamVjdFR5cGU6IF90aGlzLnByb3BzLm9iamVjdFR5cGUKICAgICAgICB9CiAgICAgIH0pIDogdW5kZWZpbmVkOwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBsYWJlbDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAiY29tbW9uLnVpLnNoYXJlLnVybFBhbmVsLmdlbmVyYXRlTGlua0FzTGFiZWwiLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJHZW5lcmF0ZSB0aGUgbGluayBhcyIKICAgICAgICB9KSwKICAgICAgICBoZWxwVGV4dDogZ2VuZXJhdGVMaW5rQXNIZWxwCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlSYWRpb0dyb3VwLCB7CiAgICAgICAgb3B0aW9uczogX3RoaXMucmVuZGVyRXhwb3J0VXJsQXNPcHRpb25zKCksCiAgICAgICAgaWRTZWxlY3RlZDogX3RoaXMuc3RhdGUuZXhwb3J0VXJsQXMsCiAgICAgICAgb25DaGFuZ2U6IF90aGlzLmhhbmRsZUV4cG9ydFVybEFzCiAgICAgIH0pKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlbmRlclNob3J0VXJsU3dpdGNoIiwgZnVuY3Rpb24gKCkgewogICAgICBpZiAoX3RoaXMuc3RhdGUuZXhwb3J0VXJsQXMgPT09IEV4cG9ydFVybEFzVHlwZS5FWFBPUlRfVVJMX0FTX1NBVkVEX09CSkVDVCB8fCAhX3RoaXMucHJvcHMuYWxsb3dTaG9ydFVybCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHNob3J0VXJsTGFiZWwgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAiY29tbW9uLnVpLnNoYXJlLnVybFBhbmVsLnNob3J0VXJsTGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2hvcnQgVVJMIgogICAgICB9KTsKCiAgICAgIHZhciBzd2l0Y2hMYWJlbCA9IF90aGlzLnN0YXRlLmlzQ3JlYXRpbmdTaG9ydFVybCA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTG9hZGluZ1NwaW5uZXIsIHsKICAgICAgICBzaXplOiAicyIKICAgICAgfSksICIgIiwgc2hvcnRVcmxMYWJlbCkgOiBzaG9ydFVybExhYmVsOwoKICAgICAgdmFyIHN3aXRjaENvbXBvbmVudCA9IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTd2l0Y2gsIHsKICAgICAgICBsYWJlbDogc3dpdGNoTGFiZWwsCiAgICAgICAgY2hlY2tlZDogX3RoaXMuc3RhdGUudXNlU2hvcnRVcmwsCiAgICAgICAgb25DaGFuZ2U6IF90aGlzLmhhbmRsZVNob3J0VXJsQ2hhbmdlLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJ1c2VTaG9ydFVybCIKICAgICAgfSk7CgogICAgICB2YXIgdGlwQ29udGVudCA9IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuc2hhcmUudXJsUGFuZWwuc2hvcnRVcmxIZWxwVGV4dCIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJXZSByZWNvbW1lbmQgc2hhcmluZyBzaG9ydGVuZWQgc25hcHNob3QgVVJMcyBmb3IgbWF4aW11bSBjb21wYXRpYmlsaXR5LiBJbnRlcm5ldCBFeHBsb3JlciBoYXMgVVJMIGxlbmd0aCByZXN0cmljdGlvbnMsIGFuZCBzb21lIHdpa2kgYW5kIG1hcmt1cCBwYXJzZXJzIGRvbid0IGRvIHdlbGwgd2l0aCB0aGUgZnVsbC1sZW5ndGggdmVyc2lvbiBvZiB0aGUgc25hcHNob3QgVVJMLCBidXQgdGhlIHNob3J0IFVSTCBzaG91bGQgd29yayBncmVhdC4iCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgaGVscFRleHQ6IF90aGlzLnN0YXRlLnNob3J0VXJsRXJyb3JNc2csCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImNyZWF0ZVNob3J0VXJsIgogICAgICB9LCBfdGhpcy5yZW5kZXJXaXRoSWNvblRpcChzd2l0Y2hDb21wb25lbnQsIHRpcENvbnRlbnQpKTsKICAgIH0pOwoKICAgIF90aGlzLnNob3J0VXJsQ2FjaGUgPSB1bmRlZmluZWQ7CiAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgZXhwb3J0VXJsQXM6IEV4cG9ydFVybEFzVHlwZS5FWFBPUlRfVVJMX0FTX1NOQVBTSE9ULAogICAgICB1c2VTaG9ydFVybDogZmFsc2UsCiAgICAgIGlzQ3JlYXRpbmdTaG9ydFVybDogZmFsc2UsCiAgICAgIHVybDogJycKICAgIH07CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoVXJsUGFuZWxDb250ZW50VUksIFt7CiAgICBrZXk6ICJjb21wb25lbnRXaWxsVW5tb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50V2lsbFVubW91bnQoKSB7CiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdoYXNoY2hhbmdlJywgdGhpcy5yZXNldFVybCk7CiAgICAgIHRoaXMubW91bnRlZCA9IGZhbHNlOwogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudERpZE1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHsKICAgICAgdGhpcy5tb3VudGVkID0gdHJ1ZTsKICAgICAgdGhpcy5zZXRVcmwoKTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2hhc2hjaGFuZ2UnLCB0aGlzLnJlc2V0VXJsLCBmYWxzZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtLCB7CiAgICAgICAgY2xhc3NOYW1lOiAia2JuU2hhcmVDb250ZXh0TWVudV9fZmluYWxQYW5lbCIsCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInNoYXJlVXJsRm9ybSIKICAgICAgfSwgdGhpcy5yZW5kZXJFeHBvcnRBc1JhZGlvR3JvdXAoKSwgdGhpcy5yZW5kZXJTaG9ydFVybFN3aXRjaCgpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ29weSwgewogICAgICAgIHRleHRUb0NvcHk6IHRoaXMuc3RhdGUudXJsIHx8ICcnLAogICAgICAgIGFuY2hvckNsYXNzTmFtZTogImtiblNoYXJlQ29udGV4dE1lbnVfX2NvcHlBbmNob3IiCiAgICAgIH0sIGZ1bmN0aW9uIChjb3B5KSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b24sIHsKICAgICAgICAgIGZpbGw6IHRydWUsCiAgICAgICAgICBvbkNsaWNrOiBjb3B5LAogICAgICAgICAgZGlzYWJsZWQ6IF90aGlzMi5zdGF0ZS5pc0NyZWF0aW5nU2hvcnRVcmwgfHwgX3RoaXMyLnN0YXRlLnVybCA9PT0gJycsCiAgICAgICAgICAiZGF0YS1zaGFyZS11cmwiOiBfdGhpczIuc3RhdGUudXJsLAogICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImNvcHlTaGFyZVVybEJ1dHRvbiIsCiAgICAgICAgICBzaXplOiAicyIKICAgICAgICB9LCBfdGhpczIucHJvcHMuaXNFbWJlZGRlZCA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogImNvbW1vbi51aS5zaGFyZS51cmxQYW5lbC5jb3B5SWZyYW1lQ29kZUJ1dHRvbkxhYmVsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ29weSBpRnJhbWUgY29kZSIKICAgICAgICB9KSA6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogImNvbW1vbi51aS5zaGFyZS51cmxQYW5lbC5jb3B5TGlua0J1dHRvbkxhYmVsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ29weSBsaW5rIgogICAgICAgIH0pKTsKICAgICAgfSkpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFVybFBhbmVsQ29udGVudFVJOwp9KF9yZWFjdC5Db21wb25lbnQpOwoKdmFyIFVybFBhbmVsQ29udGVudCA9ICgwLCBfcmVhY3QyLmluamVjdEkxOG4pKFVybFBhbmVsQ29udGVudFVJKTsKZXhwb3J0cy5VcmxQYW5lbENvbnRlbnQgPSBVcmxQYW5lbENvbnRlbnQ7"},null]}