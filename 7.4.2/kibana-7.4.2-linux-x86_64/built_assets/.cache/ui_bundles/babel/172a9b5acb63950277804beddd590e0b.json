{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/ui/public/courier/search_source/search_source.js","dependencies":[{"path":"src/legacy/ui/public/courier/search_source/search_source.js","mtime":1572296412544},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlNlYXJjaFNvdXJjZVByb3ZpZGVyID0gU2VhcmNoU291cmNlUHJvdmlkZXI7Cgp2YXIgX2xvZGFzaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgibG9kYXNoIikpOwoKdmFyIF9hbmd1bGFyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJhbmd1bGFyIikpOwoKdmFyIF9lc1F1ZXJ5ID0gcmVxdWlyZSgiQGtibi9lcy1xdWVyeSIpOwoKdmFyIF9wcm9taXNlcyA9IHJlcXVpcmUoInVpL3Byb21pc2VzIik7Cgp2YXIgX25vcm1hbGl6ZV9zb3J0X3JlcXVlc3QgPSByZXF1aXJlKCIuL19ub3JtYWxpemVfc29ydF9yZXF1ZXN0Iik7Cgp2YXIgX3JlcXVlc3QgPSByZXF1aXJlKCIuLi9mZXRjaC9yZXF1ZXN0Iik7Cgp2YXIgX3NlYXJjaF9yZXF1ZXN0X3F1ZXVlID0gcmVxdWlyZSgiLi4vc2VhcmNoX3JlcXVlc3RfcXVldWUiKTsKCnZhciBfZmV0Y2ggPSByZXF1aXJlKCIuLi9mZXRjaCIpOwoKdmFyIF9maWVsZF93aWxkY2FyZCA9IHJlcXVpcmUoIi4uLy4uL2ZpZWxkX3dpbGRjYXJkIik7Cgp2YXIgX2hpZ2hsaWdodCA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2NvcmVfcGx1Z2lucy9raWJhbmEvY29tbW9uL2hpZ2hsaWdodCIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsgdHJ5IHsgdmFyIGluZm8gPSBnZW5ba2V5XShhcmcpOyB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOyB9IGNhdGNoIChlcnJvcikgeyByZWplY3QoZXJyb3IpOyByZXR1cm47IH0gaWYgKGluZm8uZG9uZSkgeyByZXNvbHZlKHZhbHVlKTsgfSBlbHNlIHsgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOyB9IH0KCmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHZhciBzZWxmID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOyBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOyB9IGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOyB9IF9uZXh0KHVuZGVmaW5lZCk7IH0pOyB9OyB9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsgfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCnZhciBGSUVMRFMgPSBbJ3R5cGUnLCAncXVlcnknLCAnZmlsdGVyJywgJ3NvcnQnLCAnaGlnaGxpZ2h0JywgJ2hpZ2hsaWdodEFsbCcsICdhZ2dzJywgJ2Zyb20nLCAnc2VhcmNoQWZ0ZXInLCAnc2l6ZScsICdzb3VyY2UnLCAndmVyc2lvbicsICdmaWVsZHMnLCAnaW5kZXgnXTsKCmZ1bmN0aW9uIHBhcnNlSW5pdGlhbEZpZWxkcyhpbml0aWFsRmllbGRzKSB7CiAgaWYgKCFpbml0aWFsRmllbGRzKSB7CiAgICByZXR1cm4ge307CiAgfQoKICByZXR1cm4gdHlwZW9mIGluaXRpYWxGaWVsZHMgPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZShpbml0aWFsRmllbGRzKSA6IF9sb2Rhc2guZGVmYXVsdC5jbG9uZURlZXAoaW5pdGlhbEZpZWxkcyk7Cn0KCmZ1bmN0aW9uIGlzSW5kZXhQYXR0ZXJuKHZhbCkgewogIHJldHVybiBCb29sZWFuKHZhbCAmJiB0eXBlb2YgdmFsLmdldEluZGV4ID09PSAnZnVuY3Rpb24nKTsKfQoKZnVuY3Rpb24gU2VhcmNoU291cmNlUHJvdmlkZXIoUHJvbWlzZSwgUHJpdmF0ZSwgY29uZmlnKSB7CiAgdmFyIFNlYXJjaFJlcXVlc3QgPSBQcml2YXRlKF9yZXF1ZXN0LlNlYXJjaFJlcXVlc3RQcm92aWRlcik7CiAgdmFyIG5vcm1hbGl6ZVNvcnRSZXF1ZXN0ID0gUHJpdmF0ZShfbm9ybWFsaXplX3NvcnRfcmVxdWVzdC5Ob3JtYWxpemVTb3J0UmVxdWVzdFByb3ZpZGVyKTsKICB2YXIgZmV0Y2hTb29uID0gUHJpdmF0ZShfZmV0Y2guRmV0Y2hTb29uUHJvdmlkZXIpOwoKICB2YXIgX1ByaXZhdGUgPSBQcml2YXRlKF9maWVsZF93aWxkY2FyZC5GaWVsZFdpbGRjYXJkUHJvdmlkZXIpLAogICAgICBmaWVsZFdpbGRjYXJkRmlsdGVyID0gX1ByaXZhdGUuZmllbGRXaWxkY2FyZEZpbHRlcjsKCiAgdmFyIGdldENvbmZpZyA9IGZ1bmN0aW9uIGdldENvbmZpZygpIHsKICAgIHJldHVybiBjb25maWcuZ2V0LmFwcGx5KGNvbmZpZywgYXJndW1lbnRzKTsKICB9OwoKICB2YXIgZm9ySXAgPSBTeW1ib2woJ2ZvciB3aGljaCBpbmRleCBwYXR0ZXJuPycpOwoKICB2YXIgU2VhcmNoU291cmNlID0KICAvKiNfX1BVUkVfXyovCiAgZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gU2VhcmNoU291cmNlKGluaXRpYWxGaWVsZHMpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTZWFyY2hTb3VyY2UpOwoKICAgICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJzZXRGaWVsZCIsIGZ1bmN0aW9uIChmaWVsZCwgdmFsdWUpIHsKICAgICAgICBpZiAoIUZJRUxEUy5pbmNsdWRlcyhmaWVsZCkpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2FuJ3Qgc2V0IGZpZWxkICciLmNvbmNhdChmaWVsZCwgIicgb24gU2VhcmNoU291cmNlLiBBY2NlcHRhYmxlIGZpZWxkcyBhcmU6ICIpLmNvbmNhdChGSUVMRFMuam9pbignLCAnKSwgIi4iKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZmllbGQgPT09ICdpbmRleCcpIHsKICAgICAgICAgIHZhciBmaWVsZHMgPSBfdGhpcy5fZmllbGRzOwogICAgICAgICAgdmFyIGhhc1NvdXJjZSA9IGZpZWxkcy5zb3VyY2U7CiAgICAgICAgICB2YXIgc291cmNlQ2FtZUZyb21JcCA9IGhhc1NvdXJjZSAmJiBmaWVsZHMuc291cmNlLmhhc093blByb3BlcnR5KGZvcklwKTsKICAgICAgICAgIHZhciBzb3VyY2VJc0Zvck91cklwID0gc291cmNlQ2FtZUZyb21JcCAmJiBmaWVsZHMuc291cmNlW2ZvcklwXSA9PT0gZmllbGRzLmluZGV4OwoKICAgICAgICAgIGlmIChzb3VyY2VJc0Zvck91cklwKSB7CiAgICAgICAgICAgIGRlbGV0ZSBmaWVsZHMuc291cmNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGRlbGV0ZSBmaWVsZHMuaW5kZXg7CiAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWlzSW5kZXhQYXR0ZXJuKHZhbHVlKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdleHBlY3RlZCBpbmRleFBhdHRlcm4gdG8gYmUgYW4gSW5kZXhQYXR0ZXJuIGR1Y2suJyk7CiAgICAgICAgICB9CgogICAgICAgICAgZmllbGRzW2ZpZWxkXSA9IHZhbHVlOwoKICAgICAgICAgIGlmICghZmllbGRzLnNvdXJjZSkgewogICAgICAgICAgICAvLyBpbXBseSBzb3VyY2UgZmlsdGVyaW5nIGJhc2VkIG9uIHRoZSBpbmRleCBwYXR0ZXJuLCBidXQgYWxsb3cgb3ZlcnJpZGluZwogICAgICAgICAgICAvLyBpdCBieSBzaW1wbHkgc2V0dGluZyBhbm90aGVyIGZpZWxkIGZvciAic291cmNlIi4gV2hlbiBpbmRleCBpcyBjaGFuZ2VkCiAgICAgICAgICAgIGZpZWxkcy5zb3VyY2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlLmdldFNvdXJjZUZpbHRlcmluZygpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgZmllbGRzLnNvdXJjZVtmb3JJcF0gPSB2YWx1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgZGVsZXRlIF90aGlzLl9maWVsZHNbZmllbGRdOwogICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMuX2ZpZWxkc1tmaWVsZF0gPSB2YWx1ZTsKICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgIH0pOwoKICAgICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJnZXRGaWVsZCIsIGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgIGlmICghRklFTERTLmluY2x1ZGVzKGZpZWxkKSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW4ndCBnZXQgZmllbGQgJyIuY29uY2F0KGZpZWxkLCAiJyBmcm9tIFNlYXJjaFNvdXJjZS4gQWNjZXB0YWJsZSBmaWVsZHMgYXJlOiAiKS5jb25jYXQoRklFTERTLmpvaW4oJywgJyksICIuIikpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNlYXJjaFNvdXJjZSA9IF90aGlzOwoKICAgICAgICB3aGlsZSAoc2VhcmNoU291cmNlKSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSBzZWFyY2hTb3VyY2UuX2ZpZWxkc1tmaWVsZF07CgogICAgICAgICAgaWYgKHZhbHVlICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfQoKICAgICAgICAgIHNlYXJjaFNvdXJjZSA9IHNlYXJjaFNvdXJjZS5nZXRQYXJlbnQoKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdGhpcy5faWQgPSBfbG9kYXNoLmRlZmF1bHQudW5pcXVlSWQoJ2RhdGFfc291cmNlJyk7CiAgICAgIHRoaXMuX3NlYXJjaFN0cmF0ZWd5SWQgPSB1bmRlZmluZWQ7CiAgICAgIHRoaXMuX2ZpZWxkcyA9IHBhcnNlSW5pdGlhbEZpZWxkcyhpbml0aWFsRmllbGRzKTsKICAgICAgdGhpcy5fcGFyZW50ID0gdW5kZWZpbmVkOwogICAgICB0aGlzLmhpc3RvcnkgPSBbXTsKICAgICAgdGhpcy5fcmVxdWVzdFN0YXJ0SGFuZGxlcnMgPSBbXTsKICAgICAgdGhpcy5faW5oZXJpdE9wdGlvbnMgPSB7fTsKICAgICAgdGhpcy5fZmlsdGVyUHJlZGljYXRlcyA9IFtmdW5jdGlvbiAoZmlsdGVyKSB7CiAgICAgICAgLy8gcmVtb3ZlIG51bGwvdW5kZWZpbmVkIGZpbHRlcnMKICAgICAgICByZXR1cm4gZmlsdGVyOwogICAgICB9LCBmdW5jdGlvbiAoZmlsdGVyKSB7CiAgICAgICAgdmFyIGRpc2FibGVkID0gX2xvZGFzaC5kZWZhdWx0LmdldChmaWx0ZXIsICdtZXRhLmRpc2FibGVkJyk7CgogICAgICAgIHJldHVybiBkaXNhYmxlZCA9PT0gdW5kZWZpbmVkIHx8IGRpc2FibGVkID09PSBmYWxzZTsKICAgICAgfSwgZnVuY3Rpb24gKGZpbHRlciwgZGF0YSkgewogICAgICAgIHZhciBpbmRleCA9IGRhdGEuaW5kZXggfHwgX3RoaXMuZ2V0RmllbGQoJ2luZGV4Jyk7CgogICAgICAgIHJldHVybiAhY29uZmlnLmdldCgnY291cmllcjppZ25vcmVGaWx0ZXJJZkZpZWxkTm90SW5JbmRleCcpIHx8ICgwLCBfZXNRdWVyeS5maWx0ZXJNYXRjaGVzSW5kZXgpKGZpbHRlciwgaW5kZXgpOwogICAgICB9XTsKICAgIH0KICAgIC8qKioqKgogICAgICogUFVCTElDIEFQSQogICAgICoqKioqLwoKCiAgICBfY3JlYXRlQ2xhc3MoU2VhcmNoU291cmNlLCBbewogICAgICBrZXk6ICJzZXRQcmVmZXJyZWRTZWFyY2hTdHJhdGVneUlkIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldFByZWZlcnJlZFNlYXJjaFN0cmF0ZWd5SWQoc2VhcmNoU3RyYXRlZ3lJZCkgewogICAgICAgIHRoaXMuX3NlYXJjaFN0cmF0ZWd5SWQgPSBzZWFyY2hTdHJhdGVneUlkOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImdldFByZWZlcnJlZFNlYXJjaFN0cmF0ZWd5SWQiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UHJlZmVycmVkU2VhcmNoU3RyYXRlZ3lJZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2VhcmNoU3RyYXRlZ3lJZDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJzZXRGaWVsZHMiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RmllbGRzKG5ld0ZpZWxkcykgewogICAgICAgIHRoaXMuX2ZpZWxkcyA9IG5ld0ZpZWxkczsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJnZXRJZCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faWQ7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZ2V0RmllbGRzIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZpZWxkcygpIHsKICAgICAgICByZXR1cm4gX2xvZGFzaC5kZWZhdWx0LmNsb25lKHRoaXMuX2ZpZWxkcyk7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIEdldCBmaWVsZHMgZnJvbSB0aGUgZmllbGRzCiAgICAgICAqLwoKICAgIH0sIHsKICAgICAga2V5OiAiZ2V0T3duRmllbGQiLAoKICAgICAgLyoqCiAgICAgICAqIEdldCB0aGUgZmllbGQgZnJvbSBvdXIgb3duIGZpZWxkcywgZG9uJ3QgdHJhdmVyc2UgdXAgdGhlIGNoYWluCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3duRmllbGQoZmllbGQpIHsKICAgICAgICBpZiAoIUZJRUxEUy5pbmNsdWRlcyhmaWVsZCkpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2FuJ3QgZ2V0IGZpZWxkICciLmNvbmNhdChmaWVsZCwgIicgZnJvbSBTZWFyY2hTb3VyY2UuIEFjY2VwdGFibGUgZmllbGRzIGFyZTogIikuY29uY2F0KEZJRUxEUy5qb2luKCcsICcpLCAiLiIpKTsKICAgICAgICB9CgogICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuX2ZpZWxkc1tmaWVsZF07CgogICAgICAgIGlmICh2YWx1ZSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImNyZWF0ZSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWFyY2hTb3VyY2UoKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJjcmVhdGVDb3B5IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUNvcHkoKSB7CiAgICAgICAgdmFyIGpzb24gPSBfYW5ndWxhci5kZWZhdWx0LnRvSnNvbih0aGlzLl9maWVsZHMpOwoKICAgICAgICB2YXIgbmV3U2VhcmNoU291cmNlID0gbmV3IFNlYXJjaFNvdXJjZShqc29uKTsgLy8gd2hlbiBzZXJpYWxpemluZyB0aGUgaW50ZXJuYWwgZmllbGRzIHdlIGxvc2UgdGhlIGludGVybmFsIGNsYXNzZXMgdXNlZCBpbiB0aGUgaW5kZXgKICAgICAgICAvLyBwYXR0ZXJuLCBzbyB3ZSBoYXZlIHRvIHNldCBpdCBhZ2FpbiB0byB3b3JrYXJvdW5kIHRoaXMgYmVoYXZpb3IKCiAgICAgICAgbmV3U2VhcmNoU291cmNlLnNldEZpZWxkKCdpbmRleCcsIHRoaXMuZ2V0RmllbGQoJ2luZGV4JykpOwogICAgICAgIG5ld1NlYXJjaFNvdXJjZS5zZXRQYXJlbnQodGhpcy5nZXRQYXJlbnQoKSk7CiAgICAgICAgcmV0dXJuIG5ld1NlYXJjaFNvdXJjZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJjcmVhdGVDaGlsZCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVDaGlsZCgpIHsKICAgICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgICAgdmFyIGNoaWxkU2VhcmNoU291cmNlID0gbmV3IFNlYXJjaFNvdXJjZSgpOwogICAgICAgIGNoaWxkU2VhcmNoU291cmNlLnNldFBhcmVudCh0aGlzLCBvcHRpb25zKTsKICAgICAgICByZXR1cm4gY2hpbGRTZWFyY2hTb3VyY2U7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIFNldCBhIHNlYXJjaFNvdXJjZSB0aGF0IHRoaXMgc291cmNlIHNob3VsZCBpbmhlcml0IGZyb20KICAgICAgICogQHBhcmFtICB7U2VhcmNoU291cmNlfSBzZWFyY2hTb3VyY2UgLSB0aGUgcGFyZW50IHNlYXJjaFNvdXJjZQogICAgICAgKiBAcmV0dXJuIHt0aGlzfSAtIGNoYWluYWJsZQogICAgICAgKi8KCiAgICB9LCB7CiAgICAgIGtleTogInNldFBhcmVudCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRQYXJlbnQocGFyZW50KSB7CiAgICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICAgIHRoaXMuX3BhcmVudCA9IHBhcmVudDsKICAgICAgICB0aGlzLl9pbmhlcml0T3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIEdldCB0aGUgcGFyZW50IG9mIHRoaXMgU2VhcmNoU291cmNlCiAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZHxzZWFyY2hTb3VyY2V9CiAgICAgICAqLwoKICAgIH0sIHsKICAgICAga2V5OiAiZ2V0UGFyZW50IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBhcmVudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFyZW50IHx8IHVuZGVmaW5lZDsKICAgICAgfQogICAgICAvKioKICAgICAgICogRmV0Y2ggdGhpcyBzb3VyY2UgYW5kIHJlamVjdCB0aGUgcmV0dXJuZWQgUHJvbWlzZSBvbiBlcnJvcgogICAgICAgKgogICAgICAgKiBAYXN5bmMKICAgICAgICovCgogICAgfSwgewogICAgICBrZXk6ICJmZXRjaCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaCgpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgIHZhciByZXEgPSBfbG9kYXNoLmRlZmF1bHQuZmlyc3Qoc2VsZi5fbXlTdGFydGFibGVRdWV1ZWQoKSk7CgogICAgICAgIGlmICghcmVxKSB7CiAgICAgICAgICB2YXIgZXJyb3JIYW5kbGVyID0gZnVuY3Rpb24gZXJyb3JIYW5kbGVyKHJlcXVlc3QsIGVycm9yKSB7CiAgICAgICAgICAgIHJlcXVlc3QuZGVmZXIucmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgcmVxdWVzdC5hYm9ydCgpOwogICAgICAgICAgfTsKCiAgICAgICAgICByZXEgPSBzZWxmLl9jcmVhdGVSZXF1ZXN0KHsKICAgICAgICAgICAgZXJyb3JIYW5kbGVyOiBlcnJvckhhbmRsZXIKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZmV0Y2hTb29uLmZldGNoU2VhcmNoUmVxdWVzdHMoW3JlcV0pOwogICAgICAgIHJldHVybiByZXEuZ2V0Q29tcGxldGVQcm9taXNlKCk7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIEZldGNoIGFsbCBwZW5kaW5nIHJlcXVlc3RzIGZvciB0aGlzIHNvdXJjZSBBU0FQCiAgICAgICAqIEBhc3luYwogICAgICAgKi8KCiAgICB9LCB7CiAgICAgIGtleTogImZldGNoUXVldWVkIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoUXVldWVkKCkgewogICAgICAgIHJldHVybiBmZXRjaFNvb24uZmV0Y2hTZWFyY2hSZXF1ZXN0cyh0aGlzLl9teVN0YXJ0YWJsZVF1ZXVlZCgpKTsKICAgICAgfQogICAgICAvKioKICAgICAgICogQ2FuY2VsIGFsbCBwZW5kaW5nIHJlcXVlc3RzIGZvciB0aGlzIHNlYXJjaFNvdXJjZQogICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgICAqLwoKICAgIH0sIHsKICAgICAga2V5OiAiY2FuY2VsUXVldWVkIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNhbmNlbFF1ZXVlZCgpIHsKICAgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgICAgX3NlYXJjaF9yZXF1ZXN0X3F1ZXVlLnNlYXJjaFJlcXVlc3RRdWV1ZS5nZXRBbGwoKS5maWx0ZXIoZnVuY3Rpb24gKHJlcSkgewogICAgICAgICAgcmV0dXJuIHJlcS5zb3VyY2UgPT09IF90aGlzMjsKICAgICAgICB9KS5mb3JFYWNoKGZ1bmN0aW9uIChyZXEpIHsKICAgICAgICAgIHJldHVybiByZXEuYWJvcnQoKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICAvKioKICAgICAgICogIEFkZCBhIGhhbmRsZXIgdGhhdCB3aWxsIGJlIG5vdGlmaWVkIHdoZW5ldmVyIHJlcXVlc3RzIHN0YXJ0CiAgICAgICAqICBAcGFyYW0gIHtGdW5jdGlvbn0gaGFuZGxlcgogICAgICAgKiAgQHJldHVybiB7dW5kZWZpbmVkfQogICAgICAgKi8KCiAgICB9LCB7CiAgICAgIGtleTogIm9uUmVxdWVzdFN0YXJ0IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uUmVxdWVzdFN0YXJ0KGhhbmRsZXIpIHsKICAgICAgICB0aGlzLl9yZXF1ZXN0U3RhcnRIYW5kbGVycy5wdXNoKGhhbmRsZXIpOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiAgQ2FsbGVkIGJ5IHJlcXVlc3RzIG9mIHRoaXMgc2VhcmNoIHNvdXJjZSB3aGVuIHRoZXkgYXJlIHN0YXJ0ZWQKICAgICAgICogIEBwYXJhbSAge0NvdXJpZXIuUmVxdWVzdH0gcmVxdWVzdAogICAgICAgKiAgQHJldHVybiB7UHJvbWlzZTx1bmRlZmluZWQ+fQogICAgICAgKi8KCiAgICB9LCB7CiAgICAgIGtleTogInJlcXVlc3RJc1N0YXJ0aW5nIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlcXVlc3RJc1N0YXJ0aW5nKHJlcXVlc3QpIHsKICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgdGhpcy5hY3RpdmVGZXRjaENvdW50ID0gKHRoaXMuYWN0aXZlRmV0Y2hDb3VudCB8fCAwKSArIDE7CiAgICAgICAgdGhpcy5oaXN0b3J5ID0gW3JlcXVlc3RdOwoKICAgICAgICB2YXIgaGFuZGxlcnMgPSBfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5fcmVxdWVzdFN0YXJ0SGFuZGxlcnMpOyAvLyBJZiBjYWxscGFyZW50U3RhcnRIYW5kbGVycyBoYXMgYmVlbiBzZXQgdG8gdHJ1ZSwgd2UgYWxzbyBjYWxsIGFsbAogICAgICAgIC8vIGhhbmRsZXJzIG9mIHBhcmVudCBzZWFyY2ggc291cmNlcy4KCgogICAgICAgIGlmICh0aGlzLl9pbmhlcml0T3B0aW9ucy5jYWxsUGFyZW50U3RhcnRIYW5kbGVycykgewogICAgICAgICAgdmFyIHNlYXJjaFNvdXJjZSA9IHRoaXMuZ2V0UGFyZW50KCk7CgogICAgICAgICAgd2hpbGUgKHNlYXJjaFNvdXJjZSkgewogICAgICAgICAgICBoYW5kbGVycy5wdXNoLmFwcGx5KGhhbmRsZXJzLCBfdG9Db25zdW1hYmxlQXJyYXkoc2VhcmNoU291cmNlLl9yZXF1ZXN0U3RhcnRIYW5kbGVycykpOwogICAgICAgICAgICBzZWFyY2hTb3VyY2UgPSBzZWFyY2hTb3VyY2UuZ2V0UGFyZW50KCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gUHJvbWlzZS5tYXAoaGFuZGxlcnMsIGZ1bmN0aW9uIChmbikgewogICAgICAgICAgcmV0dXJuIGZuKF90aGlzMywgcmVxdWVzdCk7CiAgICAgICAgfSkudGhlbihfbG9kYXNoLmRlZmF1bHQubm9vcCk7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIFB1dCBhIHJlcXVlc3QgaW4gdG8gdGhlIGNvdXJpZXIgdGhhdCB0aGlzIFNvdXJjZSBzaG91bGQKICAgICAgICogYmUgZmV0Y2hlZCBvbiB0aGUgbmV4dCBydW4gb2YgdGhlIGNvdXJpZXIKICAgICAgICogQHJldHVybiB7UHJvbWlzZX0KICAgICAgICovCgogICAgfSwgewogICAgICBrZXk6ICJvblJlc3VsdHMiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gb25SZXN1bHRzKCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdmFyIGRlZmVyID0gKDAsIF9wcm9taXNlcy5jcmVhdGVEZWZlcikoUHJvbWlzZSk7CiAgICAgICAgICBkZWZlci5wcm9taXNlLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTsKCiAgICAgICAgICB2YXIgZXJyb3JIYW5kbGVyID0gZnVuY3Rpb24gZXJyb3JIYW5kbGVyKHJlcXVlc3QsIGVycm9yKSB7CiAgICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgICAgIHJlcXVlc3QuYWJvcnQoKTsKICAgICAgICAgIH07CgogICAgICAgICAgc2VsZi5fY3JlYXRlUmVxdWVzdCh7CiAgICAgICAgICAgIGRlZmVyOiBkZWZlciwKICAgICAgICAgICAgZXJyb3JIYW5kbGVyOiBlcnJvckhhbmRsZXIKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImdldFNlYXJjaFJlcXVlc3RCb2R5IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX2dldFNlYXJjaFJlcXVlc3RCb2R5ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgICB2YXIgc2VhcmNoUmVxdWVzdDsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mbGF0dGVuKCk7CgogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICBzZWFyY2hSZXF1ZXN0ID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgc2VhcmNoUmVxdWVzdC5ib2R5KTsKCiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgICAgfSkpOwoKICAgICAgICBmdW5jdGlvbiBnZXRTZWFyY2hSZXF1ZXN0Qm9keSgpIHsKICAgICAgICAgIHJldHVybiBfZ2V0U2VhcmNoUmVxdWVzdEJvZHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBnZXRTZWFyY2hSZXF1ZXN0Qm9keTsKICAgICAgfSgpCiAgICAgIC8qKgogICAgICAgKiAgQ2FsbGVkIGJ5IHJlcXVlc3RzIG9mIHRoaXMgc2VhcmNoIHNvdXJjZSB3aGVuIHRoZXkgYXJlIGRvbmUKICAgICAgICogIEBwYXJhbSAge0NvdXJpZXIuUmVxdWVzdH0gcmVxdWVzdAogICAgICAgKiAgQHJldHVybiB7dW5kZWZpbmVkfQogICAgICAgKi8KCiAgICB9LCB7CiAgICAgIGtleTogInJlcXVlc3RJc1N0b3BwZWQiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVxdWVzdElzU3RvcHBlZCgpIHsKICAgICAgICB0aGlzLmFjdGl2ZUZldGNoQ291bnQgLT0gMTsKICAgICAgfQogICAgICAvKioKICAgICAgICogQ29tcGxldGVseSBkZXN0cm95IHRoZSBTZWFyY2hTb3VyY2UuCiAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KICAgICAgICovCgogICAgfSwgewogICAgICBrZXk6ICJkZXN0cm95IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgdGhpcy5jYW5jZWxRdWV1ZWQoKTsKICAgICAgICB0aGlzLl9yZXF1ZXN0U3RhcnRIYW5kbGVycy5sZW5ndGggPSAwOwogICAgICB9CiAgICAgIC8qKioqKioKICAgICAgICogUFJJVkFURSBBUElTCiAgICAgICAqKioqKiovCgogICAgfSwgewogICAgICBrZXk6ICJfbXlTdGFydGFibGVRdWV1ZWQiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX215U3RhcnRhYmxlUXVldWVkKCkgewogICAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgICByZXR1cm4gX3NlYXJjaF9yZXF1ZXN0X3F1ZXVlLnNlYXJjaFJlcXVlc3RRdWV1ZS5nZXRTdGFydGFibGUoKS5maWx0ZXIoZnVuY3Rpb24gKHJlcSkgewogICAgICAgICAgcmV0dXJuIHJlcS5zb3VyY2UgPT09IF90aGlzNDsKICAgICAgICB9KTsKICAgICAgfQogICAgICAvKioKICAgICAgICogQ3JlYXRlIGEgY29tbW9uIHNlYXJjaCByZXF1ZXN0IG9iamVjdCwgd2hpY2ggc2hvdWxkCiAgICAgICAqIGJlIHB1dCBpbnRvIHRoZSBwZW5kaW5nIHJlcXVlc3QgcXVldWUsIGZvciB0aGlzIHNlYXJjaAogICAgICAgKiBzb3VyY2UKICAgICAgICoKICAgICAgICogQHBhcmFtIHtEZWZlcnJlZH0gZGVmZXIgLSB0aGUgZGVmZXJyZWQgb2JqZWN0IHRoYXQgc2hvdWxkIGJlIHJlc29sdmVkCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgIHdoZW4gdGhlIHJlcXVlc3QgaXMgY29tcGxldGUKICAgICAgICogQHJldHVybiB7U2VhcmNoUmVxdWVzdH0KICAgICAgICovCgogICAgfSwgewogICAgICBrZXk6ICJfY3JlYXRlUmVxdWVzdCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlUmVxdWVzdChfcmVmKSB7CiAgICAgICAgdmFyIGRlZmVyID0gX3JlZi5kZWZlciwKICAgICAgICAgICAgZXJyb3JIYW5kbGVyID0gX3JlZi5lcnJvckhhbmRsZXI7CiAgICAgICAgcmV0dXJuIG5ldyBTZWFyY2hSZXF1ZXN0KHsKICAgICAgICAgIHNvdXJjZTogdGhpcywKICAgICAgICAgIGRlZmVyOiBkZWZlciwKICAgICAgICAgIGVycm9ySGFuZGxlcjogZXJyb3JIYW5kbGVyCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIFVzZWQgdG8gbWVyZ2UgcHJvcGVydGllcyBpbnRvIHRoZSBkYXRhIHdpdGhpbiAuX2ZsYXR0ZW4oKS4KICAgICAgICogVGhlIGRhdGEgaXMgcGFzc2VkIGluIGFuZCBtb2RpZmllZCBieSB0aGUgZnVuY3Rpb24KICAgICAgICoKICAgICAgICogQHBhcmFtICB7b2JqZWN0fSBkYXRhIC0gdGhlIGN1cnJlbnQgbWVyZ2VkIGRhdGEKICAgICAgICogQHBhcmFtICB7Kn0gdmFsIC0gdGhlIHZhbHVlIGF0IGBrZXlgCiAgICAgICAqIEBwYXJhbSAgeyp9IGtleSAtIFRoZSBrZXkgb2YgYHZhbGAKICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICAgKi8KCiAgICB9LCB7CiAgICAgIGtleTogIl9tZXJnZVByb3AiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX21lcmdlUHJvcChkYXRhLCB2YWwsIGtleSkgewogICAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgdmFyIHNvdXJjZSA9IHRoaXM7CiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5jYXN0KHZhbCh0aGlzKSkudGhlbihmdW5jdGlvbiAobmV3VmFsKSB7CiAgICAgICAgICAgIHJldHVybiBzb3VyY2UuX21lcmdlUHJvcChkYXRhLCBuZXdWYWwsIGtleSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmICh2YWwgPT0gbnVsbCB8fCAha2V5IHx8ICFfbG9kYXNoLmRlZmF1bHQuaXNTdHJpbmcoa2V5KSkgcmV0dXJuOwoKICAgICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgICAgY2FzZSAnZmlsdGVyJzoKICAgICAgICAgICAgdmFyIGZpbHRlcnMgPSBBcnJheS5pc0FycmF5KHZhbCkgPyB2YWwgOiBbdmFsXTsKICAgICAgICAgICAgZmlsdGVycyA9IGZpbHRlcnMuZmlsdGVyKGZ1bmN0aW9uIChmaWx0ZXIpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXM1Ll9maWx0ZXJQcmVkaWNhdGVzLmV2ZXJ5KGZ1bmN0aW9uIChwcmVkaWNhdGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwcmVkaWNhdGUoZmlsdGVyLCBkYXRhKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGRhdGEuZmlsdGVycyA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoZGF0YS5maWx0ZXJzIHx8IFtdKSwgX3RvQ29uc3VtYWJsZUFycmF5KGZpbHRlcnMpKTsKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgIGNhc2UgJ2luZGV4JzoKICAgICAgICAgIGNhc2UgJ3R5cGUnOgogICAgICAgICAgY2FzZSAnaWQnOgogICAgICAgICAgY2FzZSAnaGlnaGxpZ2h0QWxsJzoKICAgICAgICAgICAgaWYgKGtleSAmJiBkYXRhW2tleV0gPT0gbnVsbCkgewogICAgICAgICAgICAgIGRhdGFba2V5XSA9IHZhbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgIGNhc2UgJ3NlYXJjaEFmdGVyJzoKICAgICAgICAgICAga2V5ID0gJ3NlYXJjaF9hZnRlcic7CiAgICAgICAgICAgIGFkZFRvQm9keSgpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdzb3VyY2UnOgogICAgICAgICAgICBrZXkgPSAnX3NvdXJjZSc7CiAgICAgICAgICAgIGFkZFRvQm9keSgpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdzb3J0JzoKICAgICAgICAgICAgdmFsID0gbm9ybWFsaXplU29ydFJlcXVlc3QodmFsLCB0aGlzLmdldEZpZWxkKCdpbmRleCcpKTsKICAgICAgICAgICAgYWRkVG9Cb2R5KCk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ3F1ZXJ5JzoKICAgICAgICAgICAgZGF0YS5xdWVyeSA9IChkYXRhLnF1ZXJ5IHx8IFtdKS5jb25jYXQodmFsKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnZmllbGRzJzoKICAgICAgICAgICAgZGF0YVtrZXldID0gX2xvZGFzaC5kZWZhdWx0LnVuaXEoW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShkYXRhW2tleV0gfHwgW10pLCBfdG9Db25zdW1hYmxlQXJyYXkodmFsKSkpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBhZGRUb0JvZHkoKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQWRkIHRoZSBrZXkgYW5kIHZhbCB0byB0aGUgYm9keSBvZiB0aGUgcmVxdWVzdAogICAgICAgICAqLwoKCiAgICAgICAgZnVuY3Rpb24gYWRkVG9Cb2R5KCkgewogICAgICAgICAgZGF0YS5ib2R5ID0gZGF0YS5ib2R5IHx8IHt9OyAvLyBpZ25vcmUgaWYgd2UgYWxyZWFkeSBoYXZlIGEgdmFsdWUKCiAgICAgICAgICBpZiAoZGF0YS5ib2R5W2tleV0gPT0gbnVsbCkgewogICAgICAgICAgICBkYXRhLmJvZHlba2V5XSA9IHZhbDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIFdhbGsgdGhlIGluaGVyaXRhbmNlIGNoYWluIG9mIGEgc291cmNlIGFuZCByZXR1cm4gaXQncwogICAgICAgKiBmbGF0IHJlcHJlc2VudGF0aW9uICh0YWtpbmcgaW50byBhY2NvdW50IG1lcmdpbmcgcnVsZXMpCiAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfQogICAgICAgKiBAcmVzb2x2ZWQge09iamVjdHxudWxsfSAtIHRoZSBmbGF0IGRhdGEgb2YgdGhlIFNlYXJjaFNvdXJjZQogICAgICAgKi8KCiAgICB9LCB7CiAgICAgIGtleTogIl9mbGF0dGVuIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9mbGF0dGVuKCkgewogICAgICAgIC8vIHRoZSBtZXJnZWQgZGF0YSBvZiB0aGlzIGRhdGFTb3VyY2UgYW5kIGl0J3MgYW5jZXN0b3JzCiAgICAgICAgdmFyIGZsYXREYXRhID0ge307IC8vIGZ1bmN0aW9uIHVzZWQgdG8gd3JpdGUgZWFjaCBwcm9wZXJ0eSBmcm9tIGVhY2ggZGF0YSBvYmplY3QgaW4gdGhlIGNoYWluIHRvIGZsYXQgZGF0YQoKICAgICAgICB2YXIgcm9vdCA9IHRoaXM7IC8vIHN0YXJ0IHRoZSBjaGFpbiBhdCB0aGlzIHNvdXJjZQoKICAgICAgICB2YXIgY3VycmVudCA9IHRoaXM7IC8vIGNhbGwgdGhlIGl0dHIgYW5kIHJldHVybiBpdCdzIHByb21pc2UKCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGl0dHIoKSB7CiAgICAgICAgICAvLyBpdGVyYXRlIHRoZSBfZmllbGRzIG9iamVjdCAobm90IGFycmF5KSBhbmQKICAgICAgICAgIC8vIHBhc3MgZWFjaCBrZXk6dmFsdWUgcGFpciB0byBzb3VyY2UuX21lcmdlUHJvcC4gaWYgX21lcmdlUHJvcAogICAgICAgICAgLy8gcmV0dXJucyBhIHByb21pc2UsIHRoZW4gd2FpdCBmb3IgaXQgdG8gY29tcGxldGUgYW5kIGNhbGwgX21lcmdlUHJvcCBhZ2FpbgogICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKF9sb2Rhc2guZGVmYXVsdC5tYXAoY3VycmVudC5fZmllbGRzLCBmdW5jdGlvbiBpdHRyKHZhbHVlLCBrZXkpIHsKICAgICAgICAgICAgaWYgKFByb21pc2UuaXModmFsdWUpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaXR0cih2YWx1ZSwga2V5KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHByb20gPSByb290Ll9tZXJnZVByb3AoZmxhdERhdGEsIHZhbHVlLCBrZXkpOwoKICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuaXMocHJvbSkgPyBwcm9tIDogbnVsbDsKICAgICAgICAgIH0pKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy8gbW92ZSB0byB0aGlzIHNvdXJjZXMgcGFyZW50CiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBjdXJyZW50LmdldFBhcmVudCgpOyAvLyBrZWVwIGNhbGxpbmcgdW50aWwgd2UgcmVhY2ggdGhlIHRvcCBwYXJlbnQKCiAgICAgICAgICAgIGlmIChwYXJlbnQpIHsKICAgICAgICAgICAgICBjdXJyZW50ID0gcGFyZW50OwogICAgICAgICAgICAgIHJldHVybiBpdHRyKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0oKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIFRoaXMgaXMgZG93biBoZXJlIHRvIHByZXZlbnQgdGhlIGNpcmN1bGFyIGRlcGVuZGVuY3kKICAgICAgICAgIGZsYXREYXRhLmJvZHkgPSBmbGF0RGF0YS5ib2R5IHx8IHt9OwogICAgICAgICAgdmFyIGNvbXB1dGVkRmllbGRzID0gZmxhdERhdGEuaW5kZXguZ2V0Q29tcHV0ZWRGaWVsZHMoKTsKICAgICAgICAgIGZsYXREYXRhLmJvZHkuc3RvcmVkX2ZpZWxkcyA9IGNvbXB1dGVkRmllbGRzLnN0b3JlZEZpZWxkczsKICAgICAgICAgIGZsYXREYXRhLmJvZHkuc2NyaXB0X2ZpZWxkcyA9IGZsYXREYXRhLmJvZHkuc2NyaXB0X2ZpZWxkcyB8fCB7fTsKICAgICAgICAgIGZsYXREYXRhLmJvZHkuZG9jdmFsdWVfZmllbGRzID0gZmxhdERhdGEuYm9keS5kb2N2YWx1ZV9maWVsZHMgfHwgW107CgogICAgICAgICAgX2xvZGFzaC5kZWZhdWx0LmV4dGVuZChmbGF0RGF0YS5ib2R5LnNjcmlwdF9maWVsZHMsIGNvbXB1dGVkRmllbGRzLnNjcmlwdEZpZWxkcyk7CgogICAgICAgICAgZmxhdERhdGEuYm9keS5kb2N2YWx1ZV9maWVsZHMgPSBfbG9kYXNoLmRlZmF1bHQudW5pb24oZmxhdERhdGEuYm9keS5kb2N2YWx1ZV9maWVsZHMsIGNvbXB1dGVkRmllbGRzLmRvY3ZhbHVlRmllbGRzKTsKCiAgICAgICAgICBpZiAoZmxhdERhdGEuYm9keS5fc291cmNlKSB7CiAgICAgICAgICAgIC8vIGV4Y2x1ZGUgc291cmNlIGZpZWxkcyBmb3IgdGhpcyBpbmRleCBwYXR0ZXJuIHNwZWNpZmllZCBieSB0aGUgdXNlcgogICAgICAgICAgICB2YXIgZmlsdGVyID0gZmllbGRXaWxkY2FyZEZpbHRlcihmbGF0RGF0YS5ib2R5Ll9zb3VyY2UuZXhjbHVkZXMpOwogICAgICAgICAgICBmbGF0RGF0YS5ib2R5LmRvY3ZhbHVlX2ZpZWxkcyA9IGZsYXREYXRhLmJvZHkuZG9jdmFsdWVfZmllbGRzLmZpbHRlcihmdW5jdGlvbiAoZG9jdmFsdWVGaWVsZCkgewogICAgICAgICAgICAgIHJldHVybiBmaWx0ZXIoZG9jdmFsdWVGaWVsZC5maWVsZCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSAvLyBpZiB3ZSBvbmx5IHdhbnQgdG8gc2VhcmNoIGZvciBjZXJ0YWluIGZpZWxkcwoKCiAgICAgICAgICB2YXIgZmllbGRzID0gZmxhdERhdGEuZmllbGRzOwoKICAgICAgICAgIGlmIChmaWVsZHMpIHsKICAgICAgICAgICAgLy8gZmlsdGVyIG91dCB0aGUgZG9jdmFsdWVfZmllbGRzLCBhbmQgc2NyaXB0X2ZpZWxkcyB0byBvbmx5IGluY2x1ZGUgdGhvc2UgdGhhdCB3ZSBhcmUgY29uY2VybmVkIHdpdGgKICAgICAgICAgICAgZmxhdERhdGEuYm9keS5kb2N2YWx1ZV9maWVsZHMgPSBfbG9kYXNoLmRlZmF1bHQuaW50ZXJzZWN0aW9uKGZsYXREYXRhLmJvZHkuZG9jdmFsdWVfZmllbGRzLCBmaWVsZHMpOwogICAgICAgICAgICBmbGF0RGF0YS5ib2R5LnNjcmlwdF9maWVsZHMgPSBfbG9kYXNoLmRlZmF1bHQucGljayhmbGF0RGF0YS5ib2R5LnNjcmlwdF9maWVsZHMsIGZpZWxkcyk7IC8vIHJlcXVlc3QgdGhlIHJlbWFpbmluZyBmaWVsZHMgZnJvbSBib3RoIHN0b3JlZF9maWVsZHMgYW5kIF9zb3VyY2UKCiAgICAgICAgICAgIHZhciByZW1haW5pbmdGaWVsZHMgPSBfbG9kYXNoLmRlZmF1bHQuZGlmZmVyZW5jZShmaWVsZHMsIF9sb2Rhc2guZGVmYXVsdC5rZXlzKGZsYXREYXRhLmJvZHkuc2NyaXB0X2ZpZWxkcykpOwoKICAgICAgICAgICAgZmxhdERhdGEuYm9keS5zdG9yZWRfZmllbGRzID0gcmVtYWluaW5nRmllbGRzOwoKICAgICAgICAgICAgX2xvZGFzaC5kZWZhdWx0LnNldChmbGF0RGF0YS5ib2R5LCAnX3NvdXJjZS5pbmNsdWRlcycsIHJlbWFpbmluZ0ZpZWxkcyk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGVzUXVlcnlDb25maWdzID0gKDAsIF9lc1F1ZXJ5LmdldEVzUXVlcnlDb25maWcpKGNvbmZpZyk7CiAgICAgICAgICBmbGF0RGF0YS5ib2R5LnF1ZXJ5ID0gKDAsIF9lc1F1ZXJ5LmJ1aWxkRXNRdWVyeSkoZmxhdERhdGEuaW5kZXgsIGZsYXREYXRhLnF1ZXJ5LCBmbGF0RGF0YS5maWx0ZXJzLCBlc1F1ZXJ5Q29uZmlncyk7CgogICAgICAgICAgaWYgKGZsYXREYXRhLmhpZ2hsaWdodEFsbCAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChmbGF0RGF0YS5oaWdobGlnaHRBbGwgJiYgZmxhdERhdGEuYm9keS5xdWVyeSkgewogICAgICAgICAgICAgIGZsYXREYXRhLmJvZHkuaGlnaGxpZ2h0ID0gKDAsIF9oaWdobGlnaHQuZ2V0SGlnaGxpZ2h0UmVxdWVzdCkoZmxhdERhdGEuYm9keS5xdWVyeSwgZ2V0Q29uZmlnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGVsZXRlIGZsYXREYXRhLmhpZ2hsaWdodEFsbDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogVHJhbnNsYXRlIGEgZmlsdGVyIGludG8gYSBxdWVyeSB0byBzdXBwb3J0IGVzIDMrCiAgICAgICAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGZpbHRlciAtIFRoZSBmaWx0ZXIgdG8gdHJhbnNsYXRlCiAgICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IHRoZSBxdWVyeSB2ZXJzaW9uIG9mIHRoYXQgZmlsdGVyCiAgICAgICAgICAgKi8KCgogICAgICAgICAgdmFyIHRyYW5zbGF0ZVRvUXVlcnkgPSBmdW5jdGlvbiB0cmFuc2xhdGVUb1F1ZXJ5KGZpbHRlcikgewogICAgICAgICAgICBpZiAoIWZpbHRlcikgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKGZpbHRlci5xdWVyeSkgewogICAgICAgICAgICAgIHJldHVybiBmaWx0ZXIucXVlcnk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBmaWx0ZXI7CiAgICAgICAgICB9OyAvLyByZS13cml0ZSBmaWx0ZXJzIHdpdGhpbiBmaWx0ZXIgYWdncmVnYXRpb25zCgoKICAgICAgICAgIChmdW5jdGlvbiByZWN1cnNlKGFnZ0JyYW5jaCkgewogICAgICAgICAgICBpZiAoIWFnZ0JyYW5jaCkgcmV0dXJuOwogICAgICAgICAgICBPYmplY3Qua2V5cyhhZ2dCcmFuY2gpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICAgICAgdmFyIGFnZyA9IGFnZ0JyYW5jaFtpZF07CgogICAgICAgICAgICAgIGlmIChhZ2cuZmlsdGVycykgewogICAgICAgICAgICAgICAgLy8gdHJhbnNsYXRlIGZpbHRlcnMgYWdncmVnYXRpb25zCiAgICAgICAgICAgICAgICB2YXIgZmlsdGVycyA9IGFnZy5maWx0ZXJzLmZpbHRlcnM7CiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhmaWx0ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChmaWx0ZXJJZCkgewogICAgICAgICAgICAgICAgICBmaWx0ZXJzW2ZpbHRlcklkXSA9IHRyYW5zbGF0ZVRvUXVlcnkoZmlsdGVyc1tmaWx0ZXJJZF0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZWN1cnNlKGFnZy5hZ2dzIHx8IGFnZy5hZ2dyZWdhdGlvbnMpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKGZsYXREYXRhLmJvZHkuYWdncyB8fCBmbGF0RGF0YS5ib2R5LmFnZ3JlZ2F0aW9ucyk7CgogICAgICAgICAgcmV0dXJuIGZsYXREYXRhOwogICAgICAgIH0pOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIFNlYXJjaFNvdXJjZTsKICB9KCk7CgogIHJldHVybiBTZWFyY2hTb3VyY2U7Cn0="},null]}