{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/dashboard/dashboard_app_controller.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/dashboard/dashboard_app_controller.js","mtime":1572296410048},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkRhc2hib2FyZEFwcENvbnRyb2xsZXIgPSB2b2lkIDA7Cgp2YXIgX2xvZGFzaCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX2FuZ3VsYXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImFuZ3VsYXIiKSk7Cgp2YXIgX2Nocm9tZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgidWkvY2hyb21lIikpOwoKdmFyIF9zdWJzY3JpYmVfd2l0aF9zY29wZSA9IHJlcXVpcmUoInVpL3V0aWxzL3N1YnNjcmliZV93aXRoX3Njb3BlIik7Cgp2YXIgX25vdGlmeSA9IHJlcXVpcmUoInVpL25vdGlmeSIpOwoKdmFyIF9jb25maXJtX21vZGFsID0gcmVxdWlyZSgidWkvbW9kYWxzL2NvbmZpcm1fbW9kYWwiKTsKCnZhciBfcXVlcnlfZmlsdGVyID0gcmVxdWlyZSgidWkvZmlsdGVyX21hbmFnZXIvcXVlcnlfZmlsdGVyIik7Cgp2YXIgX2RvY190aXRsZSA9IHJlcXVpcmUoInVpL2RvY190aXRsZS9kb2NfdGl0bGUiKTsKCnZhciBfc2hvd19zYXZlZF9vYmplY3Rfc2F2ZV9tb2RhbCA9IHJlcXVpcmUoInVpL3NhdmVkX29iamVjdHMvc2hvd19zYXZlZF9vYmplY3Rfc2F2ZV9tb2RhbCIpOwoKdmFyIF9zaGFyZSA9IHJlcXVpcmUoInVpL3NoYXJlIik7Cgp2YXIgX21pZ3JhdGVfbGVnYWN5X3F1ZXJ5ID0gcmVxdWlyZSgidWkvdXRpbHMvbWlncmF0ZV9sZWdhY3lfcXVlcnkiKTsKCnZhciBfdGltZWZpbHRlciA9IHJlcXVpcmUoInVpL3RpbWVmaWx0ZXIiKTsKCnZhciBfZ2V0X3VuaGFzaGFibGVfc3RhdGVzX3Byb3ZpZGVyID0gcmVxdWlyZSgidWkvc3RhdGVfbWFuYWdlbWVudC9zdGF0ZV9oYXNoaW5nL2dldF91bmhhc2hhYmxlX3N0YXRlc19wcm92aWRlciIpOwoKdmFyIF9jYXBhYmlsaXRpZXMgPSByZXF1aXJlKCJ1aS9jYXBhYmlsaXRpZXMiKTsKCnZhciBfcnhqcyA9IHJlcXVpcmUoInJ4anMiKTsKCnZhciBfbmV3X3BsYXRmb3JtID0gcmVxdWlyZSgidWkvbmV3X3BsYXRmb3JtIik7Cgp2YXIgX3NhdmVkX29iamVjdF9maW5kZXIgPSByZXF1aXJlKCJ1aS9zYXZlZF9vYmplY3RzL2NvbXBvbmVudHMvc2F2ZWRfb2JqZWN0X2ZpbmRlciIpOwoKdmFyIF9zZXR1cCA9IHJlcXVpcmUoIi4uLy4uLy4uL2RhdGEvcHVibGljL3NldHVwIik7Cgp2YXIgX3B1YmxpYyA9IHJlcXVpcmUoIi4uLy4uLy4uL2Rhc2hib2FyZF9lbWJlZGRhYmxlX2NvbnRhaW5lci9wdWJsaWMvbnBfcmVhZHkvcHVibGljIik7Cgp2YXIgX3B1YmxpYzIgPSByZXF1aXJlKCIuLi8uLi8uLi9lbWJlZGRhYmxlX2FwaS9wdWJsaWMvbnBfcmVhZHkvcHVibGljIik7Cgp2YXIgX2xlZ2FjeSA9IHJlcXVpcmUoIi4uLy4uLy4uL2VtYmVkZGFibGVfYXBpL3B1YmxpYy9ucF9yZWFkeS9wdWJsaWMvbGVnYWN5Iik7Cgp2YXIgX3Nob3dfb3B0aW9uc19wb3BvdmVyID0gcmVxdWlyZSgiLi90b3BfbmF2L3Nob3dfb3B0aW9uc19wb3BvdmVyIik7Cgp2YXIgX3NhdmVfbW9kYWwgPSByZXF1aXJlKCIuL3RvcF9uYXYvc2F2ZV9tb2RhbCIpOwoKdmFyIF9zaG93X2Nsb25lX21vZGFsID0gcmVxdWlyZSgiLi90b3BfbmF2L3Nob3dfY2xvbmVfbW9kYWwiKTsKCnZhciBfbGliID0gcmVxdWlyZSgiLi9saWIiKTsKCnZhciBfZGFzaGJvYXJkX3N0YXRlX21hbmFnZXIgPSByZXF1aXJlKCIuL2Rhc2hib2FyZF9zdGF0ZV9tYW5hZ2VyIik7Cgp2YXIgX2Rhc2hib2FyZF9jb25zdGFudHMgPSByZXF1aXJlKCIuL2Rhc2hib2FyZF9jb25zdGFudHMiKTsKCnZhciBfZ2V0X3RvcF9uYXZfY29uZmlnID0gcmVxdWlyZSgiLi90b3BfbmF2L2dldF90b3BfbmF2X2NvbmZpZyIpOwoKdmFyIF90b3BfbmF2X2lkcyA9IHJlcXVpcmUoIi4vdG9wX25hdi90b3BfbmF2X2lkcyIpOwoKdmFyIF9kYXNoYm9hcmRfc3RyaW5ncyA9IHJlcXVpcmUoIi4vZGFzaGJvYXJkX3N0cmluZ3MiKTsKCnZhciBfZW1iZWRkYWJsZSA9IHJlcXVpcmUoIi4uL3Zpc3VhbGl6ZS9lbWJlZGRhYmxlIik7Cgp2YXIgX2VtYmVkZGFibGVfc2F2ZWRfb2JqZWN0X2NvbnZlcnRlcnMgPSByZXF1aXJlKCIuL2xpYi9lbWJlZGRhYmxlX3NhdmVkX29iamVjdF9jb252ZXJ0ZXJzIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsKICBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7CiAgICByZXR1cm4gb2JqOwogIH0gZWxzZSB7CiAgICB2YXIgbmV3T2JqID0ge307CgogICAgaWYgKG9iaiAhPSBudWxsKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgewogICAgICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307CgogICAgICAgICAgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdPYmpba2V5XSA9IG9ialtrZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIG5ld09iai5kZWZhdWx0ID0gb2JqOwogICAgcmV0dXJuIG5ld09iajsKICB9Cn0KCmZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsKICB0cnkgewogICAgdmFyIGluZm8gPSBnZW5ba2V5XShhcmcpOwogICAgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsKICB9IGNhdGNoIChlcnJvcikgewogICAgcmVqZWN0KGVycm9yKTsKICAgIHJldHVybjsKICB9CgogIGlmIChpbmZvLmRvbmUpIHsKICAgIHJlc29sdmUodmFsdWUpOwogIH0gZWxzZSB7CiAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7CiAgfQp9CgpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgewogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsKCiAgICAgIGZ1bmN0aW9uIF9uZXh0KHZhbHVlKSB7CiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gX3Rocm93KGVycikgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsKICAgICAgfQoKICAgICAgX25leHQodW5kZWZpbmVkKTsKICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewogIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsKCiAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgIHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOwogICAgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgewogICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsKICAgIH0pOwogICAga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwogIH0KCiAgcmV0dXJuIGtleXM7Cn0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7CiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OwoKICAgIGlmIChpICUgMikgewogICAgICBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOwogICAgfSBlbHNlIHsKICAgICAgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICB9KTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsKICByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7CiAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7CiAgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBhcnIyW2ldID0gYXJyW2ldOwogICAgfQoKICAgIHJldHVybiBhcnIyOwogIH0KfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICB9Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9Cgp2YXIgc2F2ZWRRdWVyeVNlcnZpY2UgPSBfc2V0dXAuZGF0YS5zZWFyY2guc2VydmljZXMuc2F2ZWRRdWVyeVNlcnZpY2U7Cgp2YXIgRGFzaGJvYXJkQXBwQ29udHJvbGxlciA9IC8vIFBhcnQgb2YgdGhlIGV4cG9zZWQgcGx1Z2luIEFQSSAtIGRvIG5vdCByZW1vdmUgd2l0aG91dCBjYXJlZnVsIGNvbnNpZGVyYXRpb24uCmZ1bmN0aW9uIERhc2hib2FyZEFwcENvbnRyb2xsZXIoX3JlZikgewogIHZhciBfdGhpcyA9IHRoaXM7CgogIHZhciAkc2NvcGUgPSBfcmVmLiRzY29wZSwKICAgICAgJHJvdXRlID0gX3JlZi4kcm91dGUsCiAgICAgICRyb3V0ZVBhcmFtcyA9IF9yZWYuJHJvdXRlUGFyYW1zLAogICAgICBnZXRBcHBTdGF0ZSA9IF9yZWYuZ2V0QXBwU3RhdGUsCiAgICAgIGRhc2hib2FyZENvbmZpZyA9IF9yZWYuZGFzaGJvYXJkQ29uZmlnLAogICAgICBsb2NhbFN0b3JhZ2UgPSBfcmVmLmxvY2FsU3RvcmFnZSwKICAgICAgUHJpdmF0ZSA9IF9yZWYuUHJpdmF0ZSwKICAgICAga2JuVXJsID0gX3JlZi5rYm5VcmwsCiAgICAgIEFwcFN0YXRlQ2xhc3MgPSBfcmVmLkFwcFN0YXRlQ2xhc3MsCiAgICAgIGluZGV4UGF0dGVybnMgPSBfcmVmLmluZGV4UGF0dGVybnMsCiAgICAgIGNvbmZpZyA9IF9yZWYuY29uZmlnLAogICAgICBjb25maXJtTW9kYWwgPSBfcmVmLmNvbmZpcm1Nb2RhbCwKICAgICAgY291cmllciA9IF9yZWYuY291cmllcjsKCiAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERhc2hib2FyZEFwcENvbnRyb2xsZXIpOwoKICBfZGVmaW5lUHJvcGVydHkodGhpcywgImFwcFN0YXR1cyIsIHZvaWQgMCk7CgogIHZhciBxdWVyeUZpbHRlciA9IFByaXZhdGUoX3F1ZXJ5X2ZpbHRlci5GaWx0ZXJCYXJRdWVyeUZpbHRlclByb3ZpZGVyKTsKICB2YXIgZ2V0VW5oYXNoYWJsZVN0YXRlcyA9IFByaXZhdGUoX2dldF91bmhhc2hhYmxlX3N0YXRlc19wcm92aWRlci5nZXRVbmhhc2hhYmxlU3RhdGVzUHJvdmlkZXIpOwogIHZhciBzaGFyZUNvbnRleHRNZW51RXh0ZW5zaW9ucyA9IFByaXZhdGUoX3NoYXJlLlNoYXJlQ29udGV4dE1lbnVFeHRlbnNpb25zUmVnaXN0cnlQcm92aWRlcik7CiAgdmFyIGxhc3RSZWxvYWRSZXF1ZXN0VGltZSA9IDA7CiAgdmFyIGRhc2ggPSAkc2NvcGUuZGFzaCA9ICRyb3V0ZS5jdXJyZW50LmxvY2Fscy5kYXNoOwoKICBpZiAoZGFzaC5pZCkgewogICAgX2RvY190aXRsZS5kb2NUaXRsZS5jaGFuZ2UoZGFzaC50aXRsZSk7CiAgfQoKICB2YXIgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyID0gbmV3IF9kYXNoYm9hcmRfc3RhdGVfbWFuYWdlci5EYXNoYm9hcmRTdGF0ZU1hbmFnZXIoewogICAgc2F2ZWREYXNoYm9hcmQ6IGRhc2gsCiAgICBBcHBTdGF0ZUNsYXNzOiBBcHBTdGF0ZUNsYXNzLAogICAgaGlkZVdyaXRlQ29udHJvbHM6IGRhc2hib2FyZENvbmZpZy5nZXRIaWRlV3JpdGVDb250cm9scygpCiAgfSk7CiAgJHNjb3BlLmFwcFN0YXRlID0gZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldEFwcFN0YXRlKCk7IC8vIFRoZSAncHJldmlvdXNseVN0b3JlZCcgY2hlY2sgaXMgc28gd2Ugb25seSB1cGRhdGUgdGhlIHRpbWUgZmlsdGVyIG9uIGRhc2hib2FyZCBvcGVuLCBub3QgZHVyaW5nCiAgLy8gbm9ybWFsIGNyb3NzIGFwcCBuYXZpZ2F0aW9uLgoKICBpZiAoZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldElzVGltZVNhdmVkV2l0aERhc2hib2FyZCgpICYmICFnZXRBcHBTdGF0ZS5wcmV2aW91c2x5U3RvcmVkKCkpIHsKICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zeW5jVGltZWZpbHRlcldpdGhEYXNoYm9hcmQoX3RpbWVmaWx0ZXIudGltZWZpbHRlcik7CiAgfQoKICAkc2NvcGUuc2hvd1NhdmVRdWVyeSA9IF9jYXBhYmlsaXRpZXMuY2FwYWJpbGl0aWVzLmdldCgpLmRhc2hib2FyZC5zYXZlUXVlcnk7CgogIHZhciB1cGRhdGVJbmRleFBhdHRlcm5zID0gZnVuY3Rpb24gdXBkYXRlSW5kZXhQYXR0ZXJucyhjb250YWluZXIpIHsKICAgIGlmICghY29udGFpbmVyIHx8ICgwLCBfcHVibGljMi5pc0Vycm9yRW1iZWRkYWJsZSkoY29udGFpbmVyKSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHBhbmVsSW5kZXhQYXR0ZXJucyA9IFtdOwogICAgT2JqZWN0LnZhbHVlcyhjb250YWluZXIuZ2V0Q2hpbGRJZHMoKSkuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHsKICAgICAgdmFyIF9wYW5lbEluZGV4UGF0dGVybnM7CgogICAgICB2YXIgZW1iZWRkYWJsZSA9IGNvbnRhaW5lci5nZXRDaGlsZChpZCk7CiAgICAgIGlmICgoMCwgX3B1YmxpYzIuaXNFcnJvckVtYmVkZGFibGUpKGVtYmVkZGFibGUpKSByZXR1cm47CiAgICAgIHZhciBlbWJlZGRhYmxlSW5kZXhQYXR0ZXJucyA9IGVtYmVkZGFibGUuZ2V0T3V0cHV0KCkuaW5kZXhQYXR0ZXJuczsKICAgICAgaWYgKCFlbWJlZGRhYmxlSW5kZXhQYXR0ZXJucykgcmV0dXJuOwoKICAgICAgKF9wYW5lbEluZGV4UGF0dGVybnMgPSBwYW5lbEluZGV4UGF0dGVybnMpLnB1c2guYXBwbHkoX3BhbmVsSW5kZXhQYXR0ZXJucywgX3RvQ29uc3VtYWJsZUFycmF5KGVtYmVkZGFibGVJbmRleFBhdHRlcm5zKSk7CiAgICB9KTsKICAgIHBhbmVsSW5kZXhQYXR0ZXJucyA9ICgwLCBfbG9kYXNoLnVuaXEpKHBhbmVsSW5kZXhQYXR0ZXJucywgJ2lkJyk7CgogICAgaWYgKHBhbmVsSW5kZXhQYXR0ZXJucyAmJiBwYW5lbEluZGV4UGF0dGVybnMubGVuZ3RoID4gMCkgewogICAgICAkc2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbiAoKSB7CiAgICAgICAgJHNjb3BlLmluZGV4UGF0dGVybnMgPSBwYW5lbEluZGV4UGF0dGVybnM7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgaW5kZXhQYXR0ZXJucy5nZXREZWZhdWx0KCkudGhlbihmdW5jdGlvbiAoZGVmYXVsdEluZGV4UGF0dGVybikgewogICAgICAgICRzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICRzY29wZS5pbmRleFBhdHRlcm5zID0gW2RlZmF1bHRJbmRleFBhdHRlcm5dOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9OwoKICB2YXIgZ2V0RGFzaGJvYXJkSW5wdXQgPSBmdW5jdGlvbiBnZXREYXNoYm9hcmRJbnB1dCgpIHsKICAgIHZhciBlbWJlZGRhYmxlc01hcCA9IHt9OwogICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFBhbmVscygpLmZvckVhY2goZnVuY3Rpb24gKHBhbmVsKSB7CiAgICAgIGVtYmVkZGFibGVzTWFwW3BhbmVsLnBhbmVsSW5kZXhdID0gKDAsIF9lbWJlZGRhYmxlX3NhdmVkX29iamVjdF9jb252ZXJ0ZXJzLmNvbnZlcnRTYXZlZERhc2hib2FyZFBhbmVsVG9QYW5lbFN0YXRlKShwYW5lbCwgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFVzZU1hcmdpbnMoKSk7CiAgICB9KTsKICAgIHZhciBleHBhbmRlZFBhbmVsSWQ7CgogICAgaWYgKGRhc2hib2FyZENvbnRhaW5lciAmJiAhKDAsIF9wdWJsaWMyLmlzRXJyb3JFbWJlZGRhYmxlKShkYXNoYm9hcmRDb250YWluZXIpKSB7CiAgICAgIGV4cGFuZGVkUGFuZWxJZCA9IGRhc2hib2FyZENvbnRhaW5lci5nZXRJbnB1dCgpLmV4cGFuZGVkUGFuZWxJZDsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBpZDogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNhdmVkRGFzaGJvYXJkLmlkIHx8ICcnLAogICAgICBmaWx0ZXJzOiBxdWVyeUZpbHRlci5nZXRGaWx0ZXJzKCksCiAgICAgIGhpZGVQYW5lbFRpdGxlczogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldEhpZGVQYW5lbFRpdGxlcygpLAogICAgICBxdWVyeTogJHNjb3BlLm1vZGVsLnF1ZXJ5LAogICAgICB0aW1lUmFuZ2U6IF9vYmplY3RTcHJlYWQoe30sIF9sb2Rhc2guZGVmYXVsdC5jbG9uZURlZXAoX3RpbWVmaWx0ZXIudGltZWZpbHRlci5nZXRUaW1lKCkpKSwKICAgICAgcmVmcmVzaENvbmZpZzogX3RpbWVmaWx0ZXIudGltZWZpbHRlci5nZXRSZWZyZXNoSW50ZXJ2YWwoKSwKICAgICAgdmlld01vZGU6IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRWaWV3TW9kZSgpLAogICAgICBwYW5lbHM6IGVtYmVkZGFibGVzTWFwLAogICAgICBpc0Z1bGxTY3JlZW5Nb2RlOiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0RnVsbFNjcmVlbk1vZGUoKSwKICAgICAgdXNlTWFyZ2luczogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFVzZU1hcmdpbnMoKSwKICAgICAgbGFzdFJlbG9hZFJlcXVlc3RUaW1lOiBsYXN0UmVsb2FkUmVxdWVzdFRpbWUsCiAgICAgIHRpdGxlOiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0VGl0bGUoKSwKICAgICAgZGVzY3JpcHRpb246IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXREZXNjcmlwdGlvbigpLAogICAgICBleHBhbmRlZFBhbmVsSWQ6IGV4cGFuZGVkUGFuZWxJZAogICAgfTsKICB9OwoKICB2YXIgdXBkYXRlU3RhdGUgPSBmdW5jdGlvbiB1cGRhdGVTdGF0ZSgpIHsKICAgIC8vIEZvbGxvd2luZyB0aGUgImJlc3QgcHJhY3RpY2UiIG9mIGFsd2F5cyBoYXZlIGEgJy4nIGluIHlvdXIgbmctbW9kZWxzIOKAkwogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci5qcy93aWtpL1VuZGVyc3RhbmRpbmctU2NvcGVzCiAgICAkc2NvcGUubW9kZWwgPSB7CiAgICAgIHF1ZXJ5OiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0UXVlcnkoKSwKICAgICAgZmlsdGVyczogcXVlcnlGaWx0ZXIuZ2V0RmlsdGVycygpLAogICAgICB0aW1lUmVzdG9yZTogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFRpbWVSZXN0b3JlKCksCiAgICAgIHRpdGxlOiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0VGl0bGUoKSwKICAgICAgZGVzY3JpcHRpb246IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXREZXNjcmlwdGlvbigpLAogICAgICB0aW1lUmFuZ2U6IF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIuZ2V0VGltZSgpLAogICAgICByZWZyZXNoSW50ZXJ2YWw6IF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIuZ2V0UmVmcmVzaEludGVydmFsKCkKICAgIH07CiAgICAkc2NvcGUucGFuZWxzID0gZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFBhbmVscygpOwogICAgJHNjb3BlLnNjcmVlblRpdGxlID0gZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFRpdGxlKCk7CiAgfTsKCiAgdXBkYXRlU3RhdGUoKTsKICB2YXIgZGFzaGJvYXJkQ29udGFpbmVyOwogIHZhciBpbnB1dFN1YnNjcmlwdGlvbjsKICB2YXIgb3V0cHV0U3Vic2NyaXB0aW9uOwogIHZhciBkYXNoYm9hcmREb20gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGFzaGJvYXJkVmlld3BvcnQnKTsKCiAgdmFyIGRhc2hib2FyZEZhY3RvcnkgPSBfbGVnYWN5LnN0YXJ0LmdldEVtYmVkZGFibGVGYWN0b3J5KF9wdWJsaWMuREFTSEJPQVJEX0NPTlRBSU5FUl9UWVBFKTsKCiAgZGFzaGJvYXJkRmFjdG9yeS5jcmVhdGUoZ2V0RGFzaGJvYXJkSW5wdXQoKSkudGhlbihmdW5jdGlvbiAoY29udGFpbmVyKSB7CiAgICBpZiAoISgwLCBfcHVibGljMi5pc0Vycm9yRW1iZWRkYWJsZSkoY29udGFpbmVyKSkgewogICAgICBkYXNoYm9hcmRDb250YWluZXIgPSBjb250YWluZXI7CiAgICAgIHVwZGF0ZUluZGV4UGF0dGVybnMoZGFzaGJvYXJkQ29udGFpbmVyKTsKICAgICAgb3V0cHV0U3Vic2NyaXB0aW9uID0gZGFzaGJvYXJkQ29udGFpbmVyLmdldE91dHB1dCQoKS5zdWJzY3JpYmUoZnVuY3Rpb24gKCkgewogICAgICAgIHVwZGF0ZUluZGV4UGF0dGVybnMoZGFzaGJvYXJkQ29udGFpbmVyKTsKICAgICAgfSk7CiAgICAgIGlucHV0U3Vic2NyaXB0aW9uID0gZGFzaGJvYXJkQ29udGFpbmVyLmdldElucHV0JCgpLnN1YnNjcmliZSgKICAgICAgLyojX19QVVJFX18qLwogICAgICBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciBkaXJ0eTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBkaXJ0eSA9IGZhbHNlOyAvLyBUaGlzIGhhcyB0byBiZSBmaXJzdCBiZWNhdXNlIGhhbmRsZURhc2hib2FyZENvbnRhaW5lckNoYW5nZXMgY2F1c2VzCiAgICAgICAgICAgICAgICAvLyBhcHBTdGF0ZS5zYXZlIHdoaWNoIHdpbGwgY2F1c2UgcmVmcmVzaERhc2hib2FyZENvbnRhaW5lciB0byBiZSBjYWxsZWQuCiAgICAgICAgICAgICAgICAvLyBBZGQgZmlsdGVycyBtb2RpZmllcyB0aGUgb2JqZWN0IHBhc3NlZCB0byBpdCwgaGVuY2UgdGhlIGNsb25lIGRlZXAuCgogICAgICAgICAgICAgICAgaWYgKF9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKGNvbnRhaW5lci5nZXRJbnB1dCgpLmZpbHRlcnMsIHF1ZXJ5RmlsdGVyLmdldEZpbHRlcnMoKSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5RmlsdGVyLmFkZEZpbHRlcnMoX2xvZGFzaC5kZWZhdWx0LmNsb25lRGVlcChjb250YWluZXIuZ2V0SW5wdXQoKS5maWx0ZXJzKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5hcHBseUZpbHRlcnMoJHNjb3BlLm1vZGVsLnF1ZXJ5LCBjb250YWluZXIuZ2V0SW5wdXQoKS5maWx0ZXJzKTsKICAgICAgICAgICAgICAgIGRpcnR5ID0gdHJ1ZTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgJHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuaGFuZGxlRGFzaGJvYXJkQ29udGFpbmVyQ2hhbmdlcyhjb250YWluZXIpOwoKICAgICAgICAgICAgICAgICAgaWYgKGRpcnR5KSB7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUpOwogICAgICB9KSkpOwogICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIucmVnaXN0ZXJDaGFuZ2VMaXN0ZW5lcihmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gd2UgYXJlbid0IGNoZWNraW5nIGRpcnR5IHN0YXRlIGJlY2F1c2UgdGhlcmUgYXJlIGNoYW5nZXMgdGhlIGNvbnRhaW5lciBuZWVkcyB0byBrbm93IGFib3V0CiAgICAgICAgLy8gdGhhdCB3b24ndCBtYWtlIHRoZSBkYXNoYm9hcmQgImRpcnR5IiAtIGxpa2UgYSB2aWV3IG1vZGUgY2hhbmdlLgogICAgICAgIHJlZnJlc2hEYXNoYm9hcmRDb250YWluZXIoKTsKICAgICAgfSk7IC8vIFRoaXMgY29kZSBuZWVkcyB0byBiZSByZXBsYWNlZCB3aXRoIGEgYmV0dGVyIG1lY2hhbmlzbSBmb3IgYWRkaW5nIG5ldyBlbWJlZGRhYmxlcyBvZgogICAgICAvLyBhbnkgdHlwZSBmcm9tIHRoZSBhZGQgcGFuZWwuIExpa2VseSB0aGlzIHdpbGwgaGFwcGVuIHZpYSBjcmVhdGluZyBhIHZpc3VhbGl6YXRpb24gImlubGluZSIsCiAgICAgIC8vIHdpdGhvdXQgbmF2aWdhdGluZyBhd2F5IGZyb20gdGhlIFVYLgoKICAgICAgaWYgKCRyb3V0ZVBhcmFtc1tfZGFzaGJvYXJkX2NvbnN0YW50cy5EYXNoYm9hcmRDb25zdGFudHMuTkVXX1ZJU1VBTElaQVRJT05fSURfUEFSQU1dKSB7CiAgICAgICAgY29udGFpbmVyLmFkZFNhdmVkT2JqZWN0RW1iZWRkYWJsZShfZW1iZWRkYWJsZS5WSVNVQUxJWkVfRU1CRUREQUJMRV9UWVBFLCAkcm91dGVQYXJhbXNbX2Rhc2hib2FyZF9jb25zdGFudHMuRGFzaGJvYXJkQ29uc3RhbnRzLk5FV19WSVNVQUxJWkFUSU9OX0lEX1BBUkFNXSk7CiAgICAgICAga2JuVXJsLnJlbW92ZVBhcmFtKF9kYXNoYm9hcmRfY29uc3RhbnRzLkRhc2hib2FyZENvbnN0YW50cy5BRERfVklTVUFMSVpBVElPTl9UT19EQVNIQk9BUkRfTU9ERV9QQVJBTSk7CiAgICAgICAga2JuVXJsLnJlbW92ZVBhcmFtKF9kYXNoYm9hcmRfY29uc3RhbnRzLkRhc2hib2FyZENvbnN0YW50cy5ORVdfVklTVUFMSVpBVElPTl9JRF9QQVJBTSk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoZGFzaGJvYXJkRG9tKSB7CiAgICAgIGNvbnRhaW5lci5yZW5kZXIoZGFzaGJvYXJkRG9tKTsKICAgIH0KICB9KTsgLy8gUGFydCBvZiB0aGUgZXhwb3NlZCBwbHVnaW4gQVBJIC0gZG8gbm90IHJlbW92ZSB3aXRob3V0IGNhcmVmdWwgY29uc2lkZXJhdGlvbi4KCiAgdGhpcy5hcHBTdGF0dXMgPSB7CiAgICBkaXJ0eTogIWRhc2guaWQKICB9OwogIGRhc2hib2FyZFN0YXRlTWFuYWdlci5yZWdpc3RlckNoYW5nZUxpc3RlbmVyKGZ1bmN0aW9uIChzdGF0dXMpIHsKICAgIF90aGlzLmFwcFN0YXR1cy5kaXJ0eSA9IHN0YXR1cy5kaXJ0eSB8fCAhZGFzaC5pZDsKICAgIHVwZGF0ZVN0YXRlKCk7CiAgfSk7CiAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmFwcGx5RmlsdGVycyhkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0UXVlcnkoKSB8fCB7CiAgICBxdWVyeTogJycsCiAgICBsYW5ndWFnZTogbG9jYWxTdG9yYWdlLmdldCgna2liYW5hLnVzZXJRdWVyeUxhbmd1YWdlJykgfHwgY29uZmlnLmdldCgnc2VhcmNoOnF1ZXJ5TGFuZ3VhZ2UnKQogIH0sIHF1ZXJ5RmlsdGVyLmdldEZpbHRlcnMoKSk7CgogIF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIuZGlzYWJsZVRpbWVSYW5nZVNlbGVjdG9yKCk7CgogIF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIuZGlzYWJsZUF1dG9SZWZyZXNoU2VsZWN0b3IoKTsKCiAgdmFyIGxhbmRpbmdQYWdlVXJsID0gZnVuY3Rpb24gbGFuZGluZ1BhZ2VVcmwoKSB7CiAgICByZXR1cm4gIiMiLmNvbmNhdChfZGFzaGJvYXJkX2NvbnN0YW50cy5EYXNoYm9hcmRDb25zdGFudHMuTEFORElOR19QQUdFX1BBVEgpOwogIH07CgogIHZhciBnZXREYXNoVGl0bGUgPSBmdW5jdGlvbiBnZXREYXNoVGl0bGUoKSB7CiAgICByZXR1cm4gKDAsIF9kYXNoYm9hcmRfc3RyaW5ncy5nZXREYXNoYm9hcmRUaXRsZSkoZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFRpdGxlKCksIGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRWaWV3TW9kZSgpLCBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0SXNEaXJ0eShfdGltZWZpbHRlci50aW1lZmlsdGVyKSk7CiAgfTsgLy8gUHVzaCBicmVhZGNydW1icyB0byBuZXcgaGVhZGVyIG5hdmlnYXRpb24KCgogIHZhciB1cGRhdGVCcmVhZGNydW1icyA9IGZ1bmN0aW9uIHVwZGF0ZUJyZWFkY3J1bWJzKCkgewogICAgX2Nocm9tZS5kZWZhdWx0LmJyZWFkY3J1bWJzLnNldChbewogICAgICB0ZXh0OiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLmRhc2hib2FyZC5kYXNoYm9hcmRBcHBCcmVhZGNydW1ic1RpdGxlJywgewogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRGFzaGJvYXJkJwogICAgICB9KSwKICAgICAgaHJlZjogbGFuZGluZ1BhZ2VVcmwoKQogICAgfSwgewogICAgICB0ZXh0OiBnZXREYXNoVGl0bGUoKQogICAgfV0pOwogIH07CgogIHVwZGF0ZUJyZWFkY3J1bWJzKCk7CiAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnJlZ2lzdGVyQ2hhbmdlTGlzdGVuZXIodXBkYXRlQnJlYWRjcnVtYnMpOwoKICAkc2NvcGUuZ2V0U2hvdWxkU2hvd0VkaXRIZWxwID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuICFkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0UGFuZWxzKCkubGVuZ3RoICYmIGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRJc0VkaXRNb2RlKCkgJiYgIWRhc2hib2FyZENvbmZpZy5nZXRIaWRlV3JpdGVDb250cm9scygpOwogIH07CgogICRzY29wZS5nZXRTaG91bGRTaG93Vmlld0hlbHAgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gIWRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRQYW5lbHMoKS5sZW5ndGggJiYgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldElzVmlld01vZGUoKSAmJiAhZGFzaGJvYXJkQ29uZmlnLmdldEhpZGVXcml0ZUNvbnRyb2xzKCk7CiAgfTsKCiAgdmFyIGdldENoYW5nZXNGcm9tQXBwU3RhdGVGb3JDb250YWluZXJTdGF0ZSA9IGZ1bmN0aW9uIGdldENoYW5nZXNGcm9tQXBwU3RhdGVGb3JDb250YWluZXJTdGF0ZSgpIHsKICAgIHZhciBhcHBTdGF0ZURhc2hib2FyZElucHV0ID0gZ2V0RGFzaGJvYXJkSW5wdXQoKTsKCiAgICBpZiAoIWRhc2hib2FyZENvbnRhaW5lciB8fCAoMCwgX3B1YmxpYzIuaXNFcnJvckVtYmVkZGFibGUpKGRhc2hib2FyZENvbnRhaW5lcikpIHsKICAgICAgcmV0dXJuIGFwcFN0YXRlRGFzaGJvYXJkSW5wdXQ7CiAgICB9CgogICAgdmFyIGNvbnRhaW5lcklucHV0ID0gZGFzaGJvYXJkQ29udGFpbmVyLmdldElucHV0KCk7CiAgICB2YXIgZGlmZmVyZW5jZXMgPSB7fTsKICAgIE9iamVjdC5rZXlzKGNvbnRhaW5lcklucHV0KS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgdmFyIGNvbnRhaW5lclZhbHVlID0gY29udGFpbmVySW5wdXRba2V5XTsKICAgICAgdmFyIGFwcFN0YXRlVmFsdWUgPSBhcHBTdGF0ZURhc2hib2FyZElucHV0W2tleV07CgogICAgICBpZiAoIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKGNvbnRhaW5lclZhbHVlLCBhcHBTdGF0ZVZhbHVlKSkgewogICAgICAgIGRpZmZlcmVuY2VzW2tleV0gPSBhcHBTdGF0ZVZhbHVlOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBPYmplY3QudmFsdWVzKGRpZmZlcmVuY2VzKS5sZW5ndGggPT09IDAgPyB1bmRlZmluZWQgOiBkaWZmZXJlbmNlczsKICB9OwoKICB2YXIgcmVmcmVzaERhc2hib2FyZENvbnRhaW5lciA9IGZ1bmN0aW9uIHJlZnJlc2hEYXNoYm9hcmRDb250YWluZXIoKSB7CiAgICB2YXIgY2hhbmdlcyA9IGdldENoYW5nZXNGcm9tQXBwU3RhdGVGb3JDb250YWluZXJTdGF0ZSgpOwoKICAgIGlmIChjaGFuZ2VzICYmIGRhc2hib2FyZENvbnRhaW5lcikgewogICAgICBkYXNoYm9hcmRDb250YWluZXIudXBkYXRlSW5wdXQoY2hhbmdlcyk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZVF1ZXJ5QW5kRmV0Y2ggPSBmdW5jdGlvbiAoX3JlZjMpIHsKICAgIHZhciBxdWVyeSA9IF9yZWYzLnF1ZXJ5LAogICAgICAgIGRhdGVSYW5nZSA9IF9yZWYzLmRhdGVSYW5nZTsKCiAgICBpZiAoZGF0ZVJhbmdlKSB7CiAgICAgIF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIuc2V0VGltZShkYXRlUmFuZ2UpOwogICAgfQoKICAgIHZhciBvbGRRdWVyeSA9ICRzY29wZS5tb2RlbC5xdWVyeTsKCiAgICBpZiAoX2xvZGFzaC5kZWZhdWx0LmlzRXF1YWwob2xkUXVlcnksIHF1ZXJ5KSkgewogICAgICAvLyBUaGUgdXNlciBjYW4gc3RpbGwgcmVxdWVzdCBhIHJlbG9hZCBpbiB0aGUgcXVlcnkgYmFyLCBldmVuIGlmIHRoZQogICAgICAvLyBxdWVyeSBpcyB0aGUgc2FtZSwgYW5kIGluIHRoYXQgY2FzZSwgd2UgaGF2ZSB0byBleHBsaWNpdGx5IGFzayBmb3IKICAgICAgLy8gYSByZWxvYWQsIHNpbmNlIG5vIHN0YXRlIGNoYW5nZXMgd2lsbCBjYXVzZSBpdC4KICAgICAgbGFzdFJlbG9hZFJlcXVlc3RUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgIHJlZnJlc2hEYXNoYm9hcmRDb250YWluZXIoKTsKICAgIH0gZWxzZSB7CiAgICAgICRzY29wZS5tb2RlbC5xdWVyeSA9IHF1ZXJ5OwogICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuYXBwbHlGaWx0ZXJzKCRzY29wZS5tb2RlbC5xdWVyeSwgJHNjb3BlLm1vZGVsLmZpbHRlcnMpOwogICAgfQogIH07CgogICRzY29wZS5vblJlZnJlc2hDaGFuZ2UgPSBmdW5jdGlvbiAoX3JlZjQpIHsKICAgIHZhciBpc1BhdXNlZCA9IF9yZWY0LmlzUGF1c2VkLAogICAgICAgIHJlZnJlc2hJbnRlcnZhbCA9IF9yZWY0LnJlZnJlc2hJbnRlcnZhbDsKCiAgICBfdGltZWZpbHRlci50aW1lZmlsdGVyLnNldFJlZnJlc2hJbnRlcnZhbCh7CiAgICAgIHBhdXNlOiBpc1BhdXNlZCwKICAgICAgdmFsdWU6IHJlZnJlc2hJbnRlcnZhbCA/IHJlZnJlc2hJbnRlcnZhbCA6ICRzY29wZS5tb2RlbC5yZWZyZXNoSW50ZXJ2YWwudmFsdWUKICAgIH0pOwogIH07CgogICRzY29wZS5vbkZpbHRlcnNVcGRhdGVkID0gZnVuY3Rpb24gKGZpbHRlcnMpIHsKICAgIC8vIFRoZSBmaWx0ZXJzIHdpbGwgYXV0b21hdGljYWxseSBiZSBzZXQgd2hlbiB0aGUgcXVlcnlGaWx0ZXIgZW1pdHMgYW4gdXBkYXRlIGV2ZW50IChzZWUgYmVsb3cpCiAgICBxdWVyeUZpbHRlci5zZXRGaWx0ZXJzKGZpbHRlcnMpOwogIH07CgogICRzY29wZS5vbkNhbmNlbEFwcGx5RmlsdGVycyA9IGZ1bmN0aW9uICgpIHsKICAgICRzY29wZS5hcHBTdGF0ZS4kbmV3RmlsdGVycyA9IFtdOwogIH07CgogICRzY29wZS5vbkFwcGx5RmlsdGVycyA9IGZ1bmN0aW9uIChmaWx0ZXJzKSB7CiAgICBxdWVyeUZpbHRlci5hZGRGaWx0ZXJzQW5kQ2hhbmdlVGltZUZpbHRlcihmaWx0ZXJzKTsKICAgICRzY29wZS5hcHBTdGF0ZS4kbmV3RmlsdGVycyA9IFtdOwogIH07CgogICRzY29wZS5vblF1ZXJ5U2F2ZWQgPSBmdW5jdGlvbiAoc2F2ZWRRdWVyeSkgewogICAgJHNjb3BlLnNhdmVkUXVlcnkgPSBzYXZlZFF1ZXJ5OwogIH07CgogICRzY29wZS5vblNhdmVkUXVlcnlVcGRhdGVkID0gZnVuY3Rpb24gKHNhdmVkUXVlcnkpIHsKICAgICRzY29wZS5zYXZlZFF1ZXJ5ID0gX29iamVjdFNwcmVhZCh7fSwgc2F2ZWRRdWVyeSk7CiAgfTsKCiAgJHNjb3BlLm9uQ2xlYXJTYXZlZFF1ZXJ5ID0gZnVuY3Rpb24gKCkgewogICAgZGVsZXRlICRzY29wZS5zYXZlZFF1ZXJ5OwogICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldFNhdmVkUXVlcnlJZCh1bmRlZmluZWQpOwogICAgcXVlcnlGaWx0ZXIucmVtb3ZlQWxsKCk7CiAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuYXBwbHlGaWx0ZXJzKHsKICAgICAgcXVlcnk6ICcnLAogICAgICBsYW5ndWFnZTogbG9jYWxTdG9yYWdlLmdldCgna2liYW5hLnVzZXJRdWVyeUxhbmd1YWdlJykgfHwgY29uZmlnLmdldCgnc2VhcmNoOnF1ZXJ5TGFuZ3VhZ2UnKQogICAgfSwgW10pOwogIH07CgogIHZhciB1cGRhdGVTdGF0ZUZyb21TYXZlZFF1ZXJ5ID0gZnVuY3Rpb24gdXBkYXRlU3RhdGVGcm9tU2F2ZWRRdWVyeShzYXZlZFF1ZXJ5KSB7CiAgICBxdWVyeUZpbHRlci5zZXRGaWx0ZXJzKHNhdmVkUXVlcnkuYXR0cmlidXRlcy5maWx0ZXJzIHx8IFtdKTsKICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5hcHBseUZpbHRlcnMoc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnF1ZXJ5LCBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMuZmlsdGVycyB8fCBbXSk7CgogICAgaWYgKHNhdmVkUXVlcnkuYXR0cmlidXRlcy50aW1lZmlsdGVyKSB7CiAgICAgIF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIuc2V0VGltZSh7CiAgICAgICAgZnJvbTogc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIuZnJvbSwKICAgICAgICB0bzogc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIudG8KICAgICAgfSk7CgogICAgICBpZiAoc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIucmVmcmVzaEludGVydmFsKSB7CiAgICAgICAgX3RpbWVmaWx0ZXIudGltZWZpbHRlci5zZXRSZWZyZXNoSW50ZXJ2YWwoc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIucmVmcmVzaEludGVydmFsKTsKICAgICAgfQogICAgfQogIH07CgogICRzY29wZS4kd2F0Y2goJ3NhdmVkUXVlcnknLCBmdW5jdGlvbiAobmV3U2F2ZWRRdWVyeSwgb2xkU2F2ZWRRdWVyeSkgewogICAgaWYgKCFuZXdTYXZlZFF1ZXJ5KSByZXR1cm47CiAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2V0U2F2ZWRRdWVyeUlkKG5ld1NhdmVkUXVlcnkuaWQpOwoKICAgIGlmIChuZXdTYXZlZFF1ZXJ5LmlkID09PSAob2xkU2F2ZWRRdWVyeSAmJiBvbGRTYXZlZFF1ZXJ5LmlkKSkgewogICAgICB1cGRhdGVTdGF0ZUZyb21TYXZlZFF1ZXJ5KG5ld1NhdmVkUXVlcnkpOwogICAgfQogIH0pOwogICRzY29wZS4kd2F0Y2goZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRTYXZlZFF1ZXJ5SWQoKTsKICB9LCBmdW5jdGlvbiAobmV3U2F2ZWRRdWVyeUlkKSB7CiAgICBpZiAoIW5ld1NhdmVkUXVlcnlJZCkgewogICAgICAkc2NvcGUuc2F2ZWRRdWVyeSA9IHVuZGVmaW5lZDsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHNhdmVkUXVlcnlTZXJ2aWNlLmdldFNhdmVkUXVlcnkobmV3U2F2ZWRRdWVyeUlkKS50aGVuKGZ1bmN0aW9uIChzYXZlZFF1ZXJ5KSB7CiAgICAgICRzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHsKICAgICAgICAkc2NvcGUuc2F2ZWRRdWVyeSA9IHNhdmVkUXVlcnk7CiAgICAgICAgdXBkYXRlU3RhdGVGcm9tU2F2ZWRRdWVyeShzYXZlZFF1ZXJ5KTsKICAgICAgfSk7CiAgICB9KTsKICB9KTsKICAkc2NvcGUuJHdhdGNoKCdhcHBTdGF0ZS4kbmV3RmlsdGVycycsIGZ1bmN0aW9uICgpIHsKICAgIHZhciBmaWx0ZXJzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTsKCiAgICBpZiAoZmlsdGVycy5sZW5ndGggPT09IDEpIHsKICAgICAgJHNjb3BlLm9uQXBwbHlGaWx0ZXJzKGZpbHRlcnMpOwogICAgfQogIH0pOwogICRzY29wZS5pbmRleFBhdHRlcm5zID0gW107CiAgJHNjb3BlLiR3YXRjaCgnbW9kZWwucXVlcnknLCBmdW5jdGlvbiAobmV3UXVlcnkpIHsKICAgIHZhciBxdWVyeSA9ICgwLCBfbWlncmF0ZV9sZWdhY3lfcXVlcnkubWlncmF0ZUxlZ2FjeVF1ZXJ5KShuZXdRdWVyeSk7CiAgICAkc2NvcGUudXBkYXRlUXVlcnlBbmRGZXRjaCh7CiAgICAgIHF1ZXJ5OiBxdWVyeQogICAgfSk7CiAgfSk7CiAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gX2NhcGFiaWxpdGllcy5jYXBhYmlsaXRpZXMuZ2V0KCkuZGFzaGJvYXJkLnNhdmVRdWVyeTsKICB9LCBmdW5jdGlvbiAobmV3Q2FwYWJpbGl0eSkgewogICAgJHNjb3BlLnNob3dTYXZlUXVlcnkgPSBuZXdDYXBhYmlsaXR5OwogIH0pOwogICRzY29wZS50aW1lZmlsdGVyU3Vic2NyaXB0aW9ucyQgPSBuZXcgX3J4anMuU3Vic2NyaXB0aW9uKCk7CiAgJHNjb3BlLnRpbWVmaWx0ZXJTdWJzY3JpcHRpb25zJC5hZGQoKDAsIF9zdWJzY3JpYmVfd2l0aF9zY29wZS5zdWJzY3JpYmVXaXRoU2NvcGUpKCRzY29wZSwgX3RpbWVmaWx0ZXIudGltZWZpbHRlci5nZXRSZWZyZXNoSW50ZXJ2YWxVcGRhdGUkKCksIHsKICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgIHVwZGF0ZVN0YXRlKCk7CiAgICAgIHJlZnJlc2hEYXNoYm9hcmRDb250YWluZXIoKTsKICAgIH0KICB9KSk7CiAgJHNjb3BlLnRpbWVmaWx0ZXJTdWJzY3JpcHRpb25zJC5hZGQoKDAsIF9zdWJzY3JpYmVfd2l0aF9zY29wZS5zdWJzY3JpYmVXaXRoU2NvcGUpKCRzY29wZSwgX3RpbWVmaWx0ZXIudGltZWZpbHRlci5nZXRUaW1lVXBkYXRlJCgpLCB7CiAgICBuZXh0OiBmdW5jdGlvbiBuZXh0KCkgewogICAgICB1cGRhdGVTdGF0ZSgpOwogICAgICByZWZyZXNoRGFzaGJvYXJkQ29udGFpbmVyKCk7CiAgICB9CiAgfSkpOwoKICBmdW5jdGlvbiB1cGRhdGVWaWV3TW9kZShuZXdNb2RlKSB7CiAgICAkc2NvcGUudG9wTmF2TWVudSA9ICgwLCBfZ2V0X3RvcF9uYXZfY29uZmlnLmdldFRvcE5hdkNvbmZpZykobmV3TW9kZSwgbmF2QWN0aW9ucywgZGFzaGJvYXJkQ29uZmlnLmdldEhpZGVXcml0ZUNvbnRyb2xzKCkpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVzZS1iZWZvcmUtZGVmaW5lCgogICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnN3aXRjaFZpZXdNb2RlKG5ld01vZGUpOwogIH0KCiAgdmFyIG9uQ2hhbmdlVmlld01vZGUgPSBmdW5jdGlvbiBvbkNoYW5nZVZpZXdNb2RlKG5ld01vZGUpIHsKICAgIHZhciBpc1BhZ2VSZWZyZXNoID0gbmV3TW9kZSA9PT0gZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFZpZXdNb2RlKCk7CiAgICB2YXIgaXNMZWF2aW5nRWRpdE1vZGUgPSAhaXNQYWdlUmVmcmVzaCAmJiBuZXdNb2RlID09PSBfcHVibGljMi5WaWV3TW9kZS5WSUVXOwogICAgdmFyIHdpbGxMb3NlQ2hhbmdlcyA9IGlzTGVhdmluZ0VkaXRNb2RlICYmIGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRJc0RpcnR5KF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIpOwoKICAgIGlmICghd2lsbExvc2VDaGFuZ2VzKSB7CiAgICAgIHVwZGF0ZVZpZXdNb2RlKG5ld01vZGUpOwogICAgICByZXR1cm47CiAgICB9CgogICAgZnVuY3Rpb24gcmV2ZXJ0Q2hhbmdlc0FuZEV4aXRFZGl0TW9kZSgpIHsKICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnJlc2V0U3RhdGUoKTsKICAgICAga2JuVXJsLmNoYW5nZShkYXNoLmlkID8gKDAsIF9kYXNoYm9hcmRfY29uc3RhbnRzLmNyZWF0ZURhc2hib2FyZEVkaXRVcmwpKGRhc2guaWQpIDogX2Rhc2hib2FyZF9jb25zdGFudHMuRGFzaGJvYXJkQ29uc3RhbnRzLkNSRUFURV9ORVdfREFTSEJPQVJEX1VSTCk7IC8vIFRoaXMgaXMgb25seSBuZWNlc3NhcnkgZm9yIG5ldyBkYXNoYm9hcmRzLCB3aGljaCB3aWxsIGRlZmF1bHQgdG8gRWRpdCBtb2RlLgoKICAgICAgdXBkYXRlVmlld01vZGUoX3B1YmxpYzIuVmlld01vZGUuVklFVyk7IC8vIFdlIG5lZWQgdG8gZG8gYSBoYXJkIHJlc2V0IG9mIHRoZSB0aW1lcGlja2VyLiBhcHBTdGF0ZSB3aWxsIG5vdCByZWxvYWQgbGlrZQogICAgICAvLyBpdCBkb2VzIG9uICdvcGVuJyBiZWNhdXNlIGl0J3MgYmVlbiBzYXZlZCB0byB0aGUgdXJsIGFuZCB0aGUgZ2V0QXBwU3RhdGUucHJldmlvdXNseVN0b3JlZCgpIGNoZWNrIG9uCiAgICAgIC8vIHJlbG9hZCB3aWxsIGNhdXNlIGl0IG5vdCB0byBzeW5jLgoKICAgICAgaWYgKGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRJc1RpbWVTYXZlZFdpdGhEYXNoYm9hcmQoKSkgewogICAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zeW5jVGltZWZpbHRlcldpdGhEYXNoYm9hcmQoX3RpbWVmaWx0ZXIudGltZWZpbHRlcik7CiAgICAgIH0KICAgIH0KCiAgICBjb25maXJtTW9kYWwoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5kYXNoYm9hcmQuY2hhbmdlVmlld01vZGVDb25maXJtTW9kYWwuZGlzY2FyZENoYW5nZXNEZXNjcmlwdGlvbicsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJPbmNlIHlvdSBkaXNjYXJkIHlvdXIgY2hhbmdlcywgdGhlcmUncyBubyBnZXR0aW5nIHRoZW0gYmFjay4iCiAgICB9KSwgewogICAgICBvbkNvbmZpcm06IHJldmVydENoYW5nZXNBbmRFeGl0RWRpdE1vZGUsCiAgICAgIG9uQ2FuY2VsOiBfbG9kYXNoLmRlZmF1bHQubm9vcCwKICAgICAgY29uZmlybUJ1dHRvblRleHQ6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4uZGFzaGJvYXJkLmNoYW5nZVZpZXdNb2RlQ29uZmlybU1vZGFsLmNvbmZpcm1CdXR0b25MYWJlbCcsIHsKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0Rpc2NhcmQgY2hhbmdlcycKICAgICAgfSksCiAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4uZGFzaGJvYXJkLmNoYW5nZVZpZXdNb2RlQ29uZmlybU1vZGFsLmNhbmNlbEJ1dHRvbkxhYmVsJywgewogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQ29udGludWUgZWRpdGluZycKICAgICAgfSksCiAgICAgIGRlZmF1bHRGb2N1c2VkQnV0dG9uOiBfY29uZmlybV9tb2RhbC5Db25maXJtYXRpb25CdXR0b25UeXBlcy5DQU5DRUwsCiAgICAgIHRpdGxlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLmRhc2hib2FyZC5jaGFuZ2VWaWV3TW9kZUNvbmZpcm1Nb2RhbC5kaXNjYXJkQ2hhbmdlc1RpdGxlJywgewogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRGlzY2FyZCBjaGFuZ2VzIHRvIGRhc2hib2FyZD8nCiAgICAgIH0pCiAgICB9KTsKICB9OwogIC8qKgogICAqIFNhdmVzIHRoZSBkYXNoYm9hcmQuCiAgICoKICAgKiBAcGFyYW0ge29iamVjdH0gW3NhdmVPcHRpb25zPXt9XQogICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW3NhdmVPcHRpb25zLmNvbmZpcm1PdmVyd3JpdGU9ZmFsc2VdIC0gSWYgdHJ1ZSwgYXR0ZW1wdHMgdG8gY3JlYXRlIHRoZSBzb3VyY2Ugc28gaXQKICAgKiBjYW4gY29uZmlybSBhbiBvdmVyd3JpdGUgaWYgYSBkb2N1bWVudCB3aXRoIHRoZSBpZCBhbHJlYWR5IGV4aXN0cy4KICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtzYXZlT3B0aW9ucy5pc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkPWZhbHNlXSAtIElmIHRydWUsIHNhdmUgYWxsb3dlZCB3aXRoIGR1cGxpY2F0ZSB0aXRsZQogICAqIEBwcm9wZXJ0eSB7ZnVuY30gW3NhdmVPcHRpb25zLm9uVGl0bGVEdXBsaWNhdGVdIC0gZnVuY3Rpb24gY2FsbGVkIGlmIGR1cGxpY2F0ZSB0aXRsZSBleGlzdHMuCiAgICogV2hlbiBub3QgcHJvdmlkZWQsIGNvbmZpcm0gbW9kYWwgd2lsbCBiZSBkaXNwbGF5ZWQgYXNraW5nIHVzZXIgdG8gY29uZmlybSBvciBjYW5jZWwgc2F2ZS4KICAgKiBAcmV0dXJuIHtQcm9taXNlfQogICAqIEByZXNvbHZlZCB7U3RyaW5nfSAtIFRoZSBpZCBvZiB0aGUgZG9jCiAgICovCgoKICBmdW5jdGlvbiBzYXZlKHNhdmVPcHRpb25zKSB7CiAgICByZXR1cm4gKDAsIF9saWIuc2F2ZURhc2hib2FyZCkoX2FuZ3VsYXIuZGVmYXVsdC50b0pzb24sIF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIsIGRhc2hib2FyZFN0YXRlTWFuYWdlciwgc2F2ZU9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKGlkKSB7CiAgICAgIGlmIChpZCkgewogICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZFN1Y2Nlc3MoewogICAgICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4uZGFzaGJvYXJkLmRhc2hib2FyZFdhc1NhdmVkU3VjY2Vzc01lc3NhZ2UnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRGFzaGJvYXJkICd7ZGFzaFRpdGxlfScgd2FzIHNhdmVkIiwKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgZGFzaFRpdGxlOiBkYXNoLnRpdGxlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLAogICAgICAgICAgJ2RhdGEtdGVzdC1zdWJqJzogJ3NhdmVEYXNoYm9hcmRTdWNjZXNzJwogICAgICAgIH0pOwoKICAgICAgICBpZiAoZGFzaC5pZCAhPT0gJHJvdXRlUGFyYW1zLmlkKSB7CiAgICAgICAgICBrYm5VcmwuY2hhbmdlKCgwLCBfZGFzaGJvYXJkX2NvbnN0YW50cy5jcmVhdGVEYXNoYm9hcmRFZGl0VXJsKShkYXNoLmlkKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF9kb2NfdGl0bGUuZG9jVGl0bGUuY2hhbmdlKGRhc2gubGFzdFNhdmVkVGl0bGUpOwoKICAgICAgICAgIHVwZGF0ZVZpZXdNb2RlKF9wdWJsaWMyLlZpZXdNb2RlLlZJRVcpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICBpZDogaWQKICAgICAgfTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGREYW5nZXIoewogICAgICAgIHRpdGxlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLmRhc2hib2FyZC5kYXNoYm9hcmRXYXNOb3RTYXZlZERhbmdlck1lc3NhZ2UnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRhc2hib2FyZCAne2Rhc2hUaXRsZX0nIHdhcyBub3Qgc2F2ZWQuIEVycm9yOiB7ZXJyb3JNZXNzYWdlfSIsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgZGFzaFRpdGxlOiBkYXNoLnRpdGxlLAogICAgICAgICAgICBlcnJvck1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICAnZGF0YS10ZXN0LXN1YmonOiAnc2F2ZURhc2hib2FyZEZhaWx1cmUnCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHsKICAgICAgICBlcnJvcjogZXJyb3IKICAgICAgfTsKICAgIH0pOwogIH0KCiAgJHNjb3BlLnNob3dGaWx0ZXJCYXIgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gJHNjb3BlLm1vZGVsLmZpbHRlcnMubGVuZ3RoID4gMCB8fCAhZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldEZ1bGxTY3JlZW5Nb2RlKCk7CiAgfTsKCiAgJHNjb3BlLnNob3dBZGRQYW5lbCA9IGZ1bmN0aW9uICgpIHsKICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRGdWxsU2NyZWVuTW9kZShmYWxzZSk7CiAgICAvKgogICAgICogVGVtcCBzb2x1dGlvbiBmb3IgdHJpZ2dlcmluZyBtZW51IGNsaWNrLgogICAgICogV2hlbiBkZS1hbmd1bGFyaXppbmcgdGhpcyBjb2RlLCBwbGVhc2UgY2FsbCB0aGUgdW5kZXJsYXlpbmcgYWN0aW9uIGZ1bmN0aW9uCiAgICAgKiBkaXJlY3RseSBhbmQgbm90IHZpYSB0aGUgdG9wIG5hdiBvYmplY3QuCiAgICAgKiovCgogICAgbmF2QWN0aW9uc1tfdG9wX25hdl9pZHMuVG9wTmF2SWRzLkFERF0oKTsKICB9OwoKICAkc2NvcGUuZW50ZXJFZGl0TW9kZSA9IGZ1bmN0aW9uICgpIHsKICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRGdWxsU2NyZWVuTW9kZShmYWxzZSk7CiAgICAvKgogICAgICogVGVtcCBzb2x1dGlvbiBmb3IgdHJpZ2dlcmluZyBtZW51IGNsaWNrLgogICAgICogV2hlbiBkZS1hbmd1bGFyaXppbmcgdGhpcyBjb2RlLCBwbGVhc2UgY2FsbCB0aGUgdW5kZXJsYXlpbmcgYWN0aW9uIGZ1bmN0aW9uCiAgICAgKiBkaXJlY3RseSBhbmQgbm90IHZpYSB0aGUgdG9wIG5hdiBvYmplY3QuCiAgICAgKiovCgogICAgbmF2QWN0aW9uc1tfdG9wX25hdl9pZHMuVG9wTmF2SWRzLkVOVEVSX0VESVRfTU9ERV0oKTsKICB9OwoKICB2YXIgbmF2QWN0aW9ucyA9IHt9OwoKICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuRlVMTF9TQ1JFRU5dID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRGdWxsU2NyZWVuTW9kZSh0cnVlKTsKICB9OwoKICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuRVhJVF9FRElUX01PREVdID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIG9uQ2hhbmdlVmlld01vZGUoX3B1YmxpYzIuVmlld01vZGUuVklFVyk7CiAgfTsKCiAgbmF2QWN0aW9uc1tfdG9wX25hdl9pZHMuVG9wTmF2SWRzLkVOVEVSX0VESVRfTU9ERV0gPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gb25DaGFuZ2VWaWV3TW9kZShfcHVibGljMi5WaWV3TW9kZS5FRElUKTsKICB9OwoKICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuU0FWRV0gPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgY3VycmVudFRpdGxlID0gZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFRpdGxlKCk7CiAgICB2YXIgY3VycmVudERlc2NyaXB0aW9uID0gZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldERlc2NyaXB0aW9uKCk7CiAgICB2YXIgY3VycmVudFRpbWVSZXN0b3JlID0gZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFRpbWVSZXN0b3JlKCk7CgogICAgdmFyIG9uU2F2ZSA9IGZ1bmN0aW9uIG9uU2F2ZShfcmVmNSkgewogICAgICB2YXIgbmV3VGl0bGUgPSBfcmVmNS5uZXdUaXRsZSwKICAgICAgICAgIG5ld0Rlc2NyaXB0aW9uID0gX3JlZjUubmV3RGVzY3JpcHRpb24sCiAgICAgICAgICBuZXdDb3B5T25TYXZlID0gX3JlZjUubmV3Q29weU9uU2F2ZSwKICAgICAgICAgIG5ld1RpbWVSZXN0b3JlID0gX3JlZjUubmV3VGltZVJlc3RvcmUsCiAgICAgICAgICBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkID0gX3JlZjUuaXNUaXRsZUR1cGxpY2F0ZUNvbmZpcm1lZCwKICAgICAgICAgIG9uVGl0bGVEdXBsaWNhdGUgPSBfcmVmNS5vblRpdGxlRHVwbGljYXRlOwogICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2V0VGl0bGUobmV3VGl0bGUpOwogICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2V0RGVzY3JpcHRpb24obmV3RGVzY3JpcHRpb24pOwogICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2F2ZWREYXNoYm9hcmQuY29weU9uU2F2ZSA9IG5ld0NvcHlPblNhdmU7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRUaW1lUmVzdG9yZShuZXdUaW1lUmVzdG9yZSk7CiAgICAgIHZhciBzYXZlT3B0aW9ucyA9IHsKICAgICAgICBjb25maXJtT3ZlcndyaXRlOiBmYWxzZSwKICAgICAgICBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkOiBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkLAogICAgICAgIG9uVGl0bGVEdXBsaWNhdGU6IG9uVGl0bGVEdXBsaWNhdGUKICAgICAgfTsKICAgICAgcmV0dXJuIHNhdmUoc2F2ZU9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gSWYgdGhlIHNhdmUgd2Fzbid0IHN1Y2Nlc3NmdWwsIHB1dCB0aGUgb3JpZ2luYWwgdmFsdWVzIGJhY2suCiAgICAgICAgaWYgKCFyZXNwb25zZS5pZCkgewogICAgICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldFRpdGxlKGN1cnJlbnRUaXRsZSk7CiAgICAgICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2V0RGVzY3JpcHRpb24oY3VycmVudERlc2NyaXB0aW9uKTsKICAgICAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRUaW1lUmVzdG9yZShjdXJyZW50VGltZVJlc3RvcmUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICB9KTsKICAgIH07CgogICAgdmFyIGRhc2hib2FyZFNhdmVNb2RhbCA9IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3NhdmVfbW9kYWwuRGFzaGJvYXJkU2F2ZU1vZGFsLCB7CiAgICAgIG9uU2F2ZTogb25TYXZlLAogICAgICBvbkNsb3NlOiBmdW5jdGlvbiBvbkNsb3NlKCkge30sCiAgICAgIHRpdGxlOiBjdXJyZW50VGl0bGUsCiAgICAgIGRlc2NyaXB0aW9uOiBjdXJyZW50RGVzY3JpcHRpb24sCiAgICAgIHRpbWVSZXN0b3JlOiBjdXJyZW50VGltZVJlc3RvcmUsCiAgICAgIHNob3dDb3B5T25TYXZlOiBkYXNoLmlkID8gdHJ1ZSA6IGZhbHNlCiAgICB9KTsKCiAgICAoMCwgX3Nob3dfc2F2ZWRfb2JqZWN0X3NhdmVfbW9kYWwuc2hvd1NhdmVNb2RhbCkoZGFzaGJvYXJkU2F2ZU1vZGFsKTsKICB9OwoKICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuQ0xPTkVdID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGN1cnJlbnRUaXRsZSA9IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRUaXRsZSgpOwoKICAgIHZhciBvbkNsb25lID0gZnVuY3Rpb24gb25DbG9uZShuZXdUaXRsZSwgaXNUaXRsZUR1cGxpY2F0ZUNvbmZpcm1lZCwgb25UaXRsZUR1cGxpY2F0ZSkgewogICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2F2ZWREYXNoYm9hcmQuY29weU9uU2F2ZSA9IHRydWU7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRUaXRsZShuZXdUaXRsZSk7CiAgICAgIHZhciBzYXZlT3B0aW9ucyA9IHsKICAgICAgICBjb25maXJtT3ZlcndyaXRlOiBmYWxzZSwKICAgICAgICBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkOiBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkLAogICAgICAgIG9uVGl0bGVEdXBsaWNhdGU6IG9uVGl0bGVEdXBsaWNhdGUKICAgICAgfTsKICAgICAgcmV0dXJuIHNhdmUoc2F2ZU9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gSWYgdGhlIHNhdmUgd2Fzbid0IHN1Y2Nlc3NmdWwsIHB1dCB0aGUgb3JpZ2luYWwgdGl0bGUgYmFjay4KICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsKICAgICAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRUaXRsZShjdXJyZW50VGl0bGUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICB9KTsKICAgIH07CgogICAgKDAsIF9zaG93X2Nsb25lX21vZGFsLnNob3dDbG9uZU1vZGFsKShvbkNsb25lLCBjdXJyZW50VGl0bGUpOwogIH07CgogIG5hdkFjdGlvbnNbX3RvcF9uYXZfaWRzLlRvcE5hdklkcy5BRERdID0gZnVuY3Rpb24gKCkgewogICAgaWYgKGRhc2hib2FyZENvbnRhaW5lciAmJiAhKDAsIF9wdWJsaWMyLmlzRXJyb3JFbWJlZGRhYmxlKShkYXNoYm9hcmRDb250YWluZXIpKSB7CiAgICAgICgwLCBfcHVibGljMi5vcGVuQWRkUGFuZWxGbHlvdXQpKHsKICAgICAgICBlbWJlZGRhYmxlOiBkYXNoYm9hcmRDb250YWluZXIsCiAgICAgICAgZ2V0QWxsRmFjdG9yaWVzOiBfbGVnYWN5LnN0YXJ0LmdldEVtYmVkZGFibGVGYWN0b3JpZXMsCiAgICAgICAgZ2V0RmFjdG9yeTogX2xlZ2FjeS5zdGFydC5nZXRFbWJlZGRhYmxlRmFjdG9yeSwKICAgICAgICBub3RpZmljYXRpb25zOiBfbmV3X3BsYXRmb3JtLm5wU3RhcnQuY29yZS5ub3RpZmljYXRpb25zLAogICAgICAgIG92ZXJsYXlzOiBfbmV3X3BsYXRmb3JtLm5wU3RhcnQuY29yZS5vdmVybGF5cywKICAgICAgICBTYXZlZE9iamVjdEZpbmRlcjogX3NhdmVkX29iamVjdF9maW5kZXIuU2F2ZWRPYmplY3RGaW5kZXIKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgbmF2QWN0aW9uc1tfdG9wX25hdl9pZHMuVG9wTmF2SWRzLk9QVElPTlNdID0gZnVuY3Rpb24gKGFuY2hvckVsZW1lbnQpIHsKICAgICgwLCBfc2hvd19vcHRpb25zX3BvcG92ZXIuc2hvd09wdGlvbnNQb3BvdmVyKSh7CiAgICAgIGFuY2hvckVsZW1lbnQ6IGFuY2hvckVsZW1lbnQsCiAgICAgIHVzZU1hcmdpbnM6IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRVc2VNYXJnaW5zKCksCiAgICAgIG9uVXNlTWFyZ2luc0NoYW5nZTogZnVuY3Rpb24gb25Vc2VNYXJnaW5zQ2hhbmdlKGlzQ2hlY2tlZCkgewogICAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRVc2VNYXJnaW5zKGlzQ2hlY2tlZCk7CiAgICAgIH0sCiAgICAgIGhpZGVQYW5lbFRpdGxlczogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldEhpZGVQYW5lbFRpdGxlcygpLAogICAgICBvbkhpZGVQYW5lbFRpdGxlc0NoYW5nZTogZnVuY3Rpb24gb25IaWRlUGFuZWxUaXRsZXNDaGFuZ2UoaXNDaGVja2VkKSB7CiAgICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldEhpZGVQYW5lbFRpdGxlcyhpc0NoZWNrZWQpOwogICAgICB9CiAgICB9KTsKICB9OwoKICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuU0hBUkVdID0gZnVuY3Rpb24gKGFuY2hvckVsZW1lbnQpIHsKICAgICgwLCBfc2hhcmUuc2hvd1NoYXJlQ29udGV4dE1lbnUpKHsKICAgICAgYW5jaG9yRWxlbWVudDogYW5jaG9yRWxlbWVudCwKICAgICAgYWxsb3dFbWJlZDogdHJ1ZSwKICAgICAgYWxsb3dTaG9ydFVybDogIWRhc2hib2FyZENvbmZpZy5nZXRIaWRlV3JpdGVDb250cm9scygpLAogICAgICBnZXRVbmhhc2hhYmxlU3RhdGVzOiBnZXRVbmhhc2hhYmxlU3RhdGVzLAogICAgICBvYmplY3RJZDogZGFzaC5pZCwKICAgICAgb2JqZWN0VHlwZTogJ2Rhc2hib2FyZCcsCiAgICAgIHNoYXJlQ29udGV4dE1lbnVFeHRlbnNpb25zOiBzaGFyZUNvbnRleHRNZW51RXh0ZW5zaW9ucy5yYXcsCiAgICAgIHNoYXJpbmdEYXRhOiB7CiAgICAgICAgdGl0bGU6IGRhc2gudGl0bGUKICAgICAgfSwKICAgICAgaXNEaXJ0eTogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldElzRGlydHkoKQogICAgfSk7CiAgfTsKCiAgdXBkYXRlVmlld01vZGUoZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFZpZXdNb2RlKCkpOyAvLyB1cGRhdGUgcm9vdCBzb3VyY2Ugd2hlbiBmaWx0ZXJzIHVwZGF0ZQoKICB2YXIgdXBkYXRlU3Vic2NyaXB0aW9uID0gcXVlcnlGaWx0ZXIuZ2V0VXBkYXRlcyQoKS5zdWJzY3JpYmUoewogICAgbmV4dDogZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgJHNjb3BlLm1vZGVsLmZpbHRlcnMgPSBxdWVyeUZpbHRlci5nZXRGaWx0ZXJzKCk7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5hcHBseUZpbHRlcnMoJHNjb3BlLm1vZGVsLnF1ZXJ5LCAkc2NvcGUubW9kZWwuZmlsdGVycyk7CgogICAgICBpZiAoZGFzaGJvYXJkQ29udGFpbmVyKSB7CiAgICAgICAgZGFzaGJvYXJkQ29udGFpbmVyLnVwZGF0ZUlucHV0KHsKICAgICAgICAgIGZpbHRlcnM6ICRzY29wZS5tb2RlbC5maWx0ZXJzCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9KTsKICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHsKICAgIHVwZGF0ZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwogICAgJHNjb3BlLnRpbWVmaWx0ZXJTdWJzY3JpcHRpb25zJC51bnN1YnNjcmliZSgpOwogICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmRlc3Ryb3koKTsKCiAgICBpZiAoaW5wdXRTdWJzY3JpcHRpb24pIHsKICAgICAgaW5wdXRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTsKICAgIH0KCiAgICBpZiAob3V0cHV0U3Vic2NyaXB0aW9uKSB7CiAgICAgIG91dHB1dFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwogICAgfQoKICAgIGlmIChkYXNoYm9hcmRDb250YWluZXIpIHsKICAgICAgZGFzaGJvYXJkQ29udGFpbmVyLmRlc3Ryb3koKTsKICAgIH0KICB9KTsKfTsKCmV4cG9ydHMuRGFzaGJvYXJkQXBwQ29udHJvbGxlciA9IERhc2hib2FyZEFwcENvbnRyb2xsZXI7"},null]}