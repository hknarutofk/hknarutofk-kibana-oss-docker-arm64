{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/management/sections/settings/components/field/field.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/management/sections/settings/components/field/field.js","mtime":1572296410744},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkZpZWxkID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9wcm9wVHlwZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInByb3AtdHlwZXMiKSk7CgpyZXF1aXJlKCJicmFjZS90aGVtZS90ZXh0bWF0ZSIpOwoKcmVxdWlyZSgiYnJhY2UvbW9kZS9tYXJrZG93biIpOwoKdmFyIF9ub3RpZnkgPSByZXF1aXJlKCJ1aS9ub3RpZnkiKTsKCnZhciBfZXVpID0gcmVxdWlyZSgiQGVsYXN0aWMvZXVpIik7Cgp2YXIgX2xpYiA9IHJlcXVpcmUoIi4uLy4uL2xpYiIpOwoKdmFyIF9yZWFjdDIgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OyBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgcmV0dXJuIG5ld09iajsgfSB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCmZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsgdHJ5IHsgdmFyIGluZm8gPSBnZW5ba2V5XShhcmcpOyB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOyB9IGNhdGNoIChlcnJvcikgeyByZWplY3QoZXJyb3IpOyByZXR1cm47IH0gaWYgKGluZm8uZG9uZSkgeyByZXNvbHZlKHZhbHVlKTsgfSBlbHNlIHsgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOyB9IH0KCmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHZhciBzZWxmID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOyBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOyB9IGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOyB9IF9uZXh0KHVuZGVmaW5lZCk7IH0pOyB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCnZhciBGaWVsZFVJID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1B1cmVDb21wb25lbnQpIHsKICBfaW5oZXJpdHMoRmllbGRVSSwgX1B1cmVDb21wb25lbnQpOwoKICBmdW5jdGlvbiBGaWVsZFVJKHByb3BzKSB7CiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEZpZWxkVUkpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEZpZWxkVUkpLmNhbGwodGhpcywgcHJvcHMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkNvZGVFZGl0b3JDaGFuZ2UiLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgdmFyIHR5cGUgPSBfdGhpcy5wcm9wcy5zZXR0aW5nLnR5cGU7CiAgICAgIHZhciBpc0pzb25BcnJheSA9IF90aGlzLnN0YXRlLmlzSnNvbkFycmF5OwogICAgICB2YXIgbmV3VW5zYXZlZFZhbHVlID0gdW5kZWZpbmVkOwogICAgICB2YXIgaXNJbnZhbGlkID0gZmFsc2U7CiAgICAgIHZhciBlcnJvciA9IG51bGw7CgogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlICdqc29uJzoKICAgICAgICAgIG5ld1Vuc2F2ZWRWYWx1ZSA9IHZhbHVlLnRyaW0oKSB8fCAoaXNKc29uQXJyYXkgPyAnW10nIDogJ3t9Jyk7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgSlNPTi5wYXJzZShuZXdVbnNhdmVkVmFsdWUpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBpc0ludmFsaWQgPSB0cnVlOwogICAgICAgICAgICBlcnJvciA9IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5jb2RlRWRpdG9yU3ludGF4RXJyb3JNZXNzYWdlIiwKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkludmFsaWQgSlNPTiBzeW50YXgiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgbmV3VW5zYXZlZFZhbHVlID0gdmFsdWU7CiAgICAgIH0KCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBlcnJvcjogZXJyb3IsCiAgICAgICAgaXNJbnZhbGlkOiBpc0ludmFsaWQsCiAgICAgICAgdW5zYXZlZFZhbHVlOiBuZXdVbnNhdmVkVmFsdWUKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkZpZWxkQ2hhbmdlIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHZhbHVlID0gZS50YXJnZXQudmFsdWU7CiAgICAgIHZhciB0eXBlID0gX3RoaXMucHJvcHMuc2V0dGluZy50eXBlOwogICAgICB2YXIgdW5zYXZlZFZhbHVlID0gX3RoaXMuc3RhdGUudW5zYXZlZFZhbHVlOwogICAgICB2YXIgbmV3VW5zYXZlZFZhbHVlID0gdW5kZWZpbmVkOwoKICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSAnYm9vbGVhbic6CiAgICAgICAgICBuZXdVbnNhdmVkVmFsdWUgPSAhdW5zYXZlZFZhbHVlOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ251bWJlcic6CiAgICAgICAgICBuZXdVbnNhdmVkVmFsdWUgPSBOdW1iZXIodmFsdWUpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBuZXdVbnNhdmVkVmFsdWUgPSB2YWx1ZTsKICAgICAgfQoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHVuc2F2ZWRWYWx1ZTogbmV3VW5zYXZlZFZhbHVlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25GaWVsZEtleURvd24iLCBmdW5jdGlvbiAoX3JlZikgewogICAgICB2YXIga2V5Q29kZSA9IF9yZWYua2V5Q29kZTsKCiAgICAgIGlmIChrZXlDb2RlID09PSBfZXVpLmtleUNvZGVzLkVOVEVSKSB7CiAgICAgICAgX3RoaXMuc2F2ZUVkaXQoKTsKICAgICAgfQoKICAgICAgaWYgKGtleUNvZGUgPT09IF9ldWkua2V5Q29kZXMuRVNDQVBFKSB7CiAgICAgICAgX3RoaXMuY2FuY2VsRWRpdCgpOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkZpZWxkRXNjYXBlIiwgZnVuY3Rpb24gKF9yZWYyKSB7CiAgICAgIHZhciBrZXlDb2RlID0gX3JlZjIua2V5Q29kZTsKCiAgICAgIGlmIChrZXlDb2RlID09PSBfZXVpLmtleUNvZGVzLkVTQ0FQRSkgewogICAgICAgIF90aGlzLmNhbmNlbEVkaXQoKTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25JbWFnZUNoYW5nZSIsCiAgICAvKiNfX1BVUkVfXyovCiAgICBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVmMyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoZmlsZXMpIHsKICAgICAgICB2YXIgZmlsZSwgbWF4U2l6ZSwgYmFzZTY0SW1hZ2UsIGlzSW52YWxpZDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAoZmlsZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpcy5jbGVhckVycm9yKCk7CgogICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICB1bnNhdmVkVmFsdWU6IG51bGwKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBmaWxlID0gZmlsZXNbMF07CiAgICAgICAgICAgICAgICBtYXhTaXplID0gX3RoaXMucHJvcHMuc2V0dGluZy5vcHRpb25zLm1heFNpemU7CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gNjsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmdldEltYWdlQXNCYXNlNjQoZmlsZSk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIGJhc2U2NEltYWdlID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIGlzSW52YWxpZCA9ICEhKG1heFNpemUgJiYgbWF4U2l6ZS5sZW5ndGggJiYgYmFzZTY0SW1hZ2UubGVuZ3RoID4gbWF4U2l6ZS5sZW5ndGgpOwoKICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgaXNJbnZhbGlkOiBpc0ludmFsaWQsCiAgICAgICAgICAgICAgICAgIGVycm9yOiBpc0ludmFsaWQgPyBfdGhpcy5wcm9wcy5pbnRsLmZvcm1hdHRlZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICAgIGlkOiAna2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQuaW1hZ2VUb29MYXJnZUVycm9yTWVzc2FnZScsCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdJbWFnZSBpcyB0b28gbGFyZ2UsIG1heGltdW0gc2l6ZSBpcyB7bWF4U2l6ZURlc2NyaXB0aW9ufScKICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG1heFNpemVEZXNjcmlwdGlvbjogbWF4U2l6ZS5kZXNjcmlwdGlvbgogICAgICAgICAgICAgICAgICB9KSA6IG51bGwsCiAgICAgICAgICAgICAgICAgIGNoYW5nZUltYWdlOiB0cnVlLAogICAgICAgICAgICAgICAgICB1bnNhdmVkVmFsdWU6IGJhc2U2NEltYWdlCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxNDsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oNik7CgogICAgICAgICAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkRGFuZ2VyKF90aGlzLnByb3BzLmludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIGlkOiAna2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQuaW1hZ2VDaGFuZ2VFcnJvck1lc3NhZ2UnLAogICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0ltYWdlIGNvdWxkIG5vdCBiZSBzYXZlZCcKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICBfdGhpcy5jYW5jZWxDaGFuZ2VJbWFnZSgpOwoKICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgbnVsbCwgW1s2LCAxNF1dKTsKICAgICAgfSkpOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgICAgIHJldHVybiBfcmVmMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJjaGFuZ2VJbWFnZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGNoYW5nZUltYWdlOiB0cnVlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiY2FuY2VsQ2hhbmdlSW1hZ2UiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBzYXZlZFZhbHVlID0gX3RoaXMuc3RhdGUuc2F2ZWRWYWx1ZTsKCiAgICAgIGlmIChfdGhpcy5jaGFuZ2VJbWFnZUZvcm0pIHsKICAgICAgICBfdGhpcy5jaGFuZ2VJbWFnZUZvcm0uZmlsZUlucHV0LnZhbHVlID0gbnVsbDsKCiAgICAgICAgX3RoaXMuY2hhbmdlSW1hZ2VGb3JtLmhhbmRsZUNoYW5nZSgpOwogICAgICB9CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgY2hhbmdlSW1hZ2U6IGZhbHNlLAogICAgICAgIHVuc2F2ZWRWYWx1ZTogc2F2ZWRWYWx1ZQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImNhbmNlbEVkaXQiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBzYXZlZFZhbHVlID0gX3RoaXMuc3RhdGUuc2F2ZWRWYWx1ZTsKCiAgICAgIF90aGlzLmNsZWFyRXJyb3IoKTsKCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICB1bnNhdmVkVmFsdWU6IHNhdmVkVmFsdWUKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzaG93UGFnZVJlbG9hZFRvYXN0IiwgZnVuY3Rpb24gKCkgewogICAgICBpZiAoX3RoaXMucHJvcHMuc2V0dGluZy5yZXF1aXJlc1BhZ2VSZWxvYWQpIHsKICAgICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGQoewogICAgICAgICAgdGl0bGU6IF90aGlzLnByb3BzLmludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiAna2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQucmVxdWlyZXNQYWdlUmVsb2FkVG9hc3REZXNjcmlwdGlvbicsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUGxlYXNlIHJlbG9hZCB0aGUgcGFnZSBmb3IgdGhlICJ7c2V0dGluZ05hbWV9IiBzZXR0aW5nIHRvIHRha2UgZWZmZWN0LicKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgc2V0dGluZ05hbWU6IF90aGlzLnByb3BzLnNldHRpbmcuZGlzcGxheU5hbWUgfHwgX3RoaXMucHJvcHMuc2V0dGluZy5uYW1lCiAgICAgICAgICB9KSwKICAgICAgICAgIHRleHQ6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LmRlZmF1bHQuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6ICJmbGV4RW5kIiwKICAgICAgICAgICAgZ3V0dGVyU2l6ZTogInMiCiAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b24sIHsKICAgICAgICAgICAgc2l6ZTogInMiLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIHJldHVybiB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF90aGlzLnByb3BzLmludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiAna2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQucmVxdWlyZXNQYWdlUmVsb2FkVG9hc3RCdXR0b25MYWJlbCcsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVsb2FkIHBhZ2UnCiAgICAgICAgICB9KSkpKSksCiAgICAgICAgICBjb2xvcjogJ3N1Y2Nlc3MnCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNhdmVFZGl0IiwKICAgIC8qI19fUFVSRV9fKi8KICAgIF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wcyRzZXR0aW5nLCBuYW1lLCBkZWZWYWwsIHR5cGUsIF90aGlzJHN0YXRlLCBjaGFuZ2VJbWFnZSwgc2F2ZWRWYWx1ZSwgdW5zYXZlZFZhbHVlLCBpc0pzb25BcnJheSwgdmFsdWVUb1NhdmUsIGlzU2FtZVZhbHVlOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfdGhpcyRwcm9wcyRzZXR0aW5nID0gX3RoaXMucHJvcHMuc2V0dGluZywgbmFtZSA9IF90aGlzJHByb3BzJHNldHRpbmcubmFtZSwgZGVmVmFsID0gX3RoaXMkcHJvcHMkc2V0dGluZy5kZWZWYWwsIHR5cGUgPSBfdGhpcyRwcm9wcyRzZXR0aW5nLnR5cGU7CiAgICAgICAgICAgICAgX3RoaXMkc3RhdGUgPSBfdGhpcy5zdGF0ZSwgY2hhbmdlSW1hZ2UgPSBfdGhpcyRzdGF0ZS5jaGFuZ2VJbWFnZSwgc2F2ZWRWYWx1ZSA9IF90aGlzJHN0YXRlLnNhdmVkVmFsdWUsIHVuc2F2ZWRWYWx1ZSA9IF90aGlzJHN0YXRlLnVuc2F2ZWRWYWx1ZSwgaXNKc29uQXJyYXkgPSBfdGhpcyRzdGF0ZS5pc0pzb25BcnJheTsKCiAgICAgICAgICAgICAgaWYgKCEoc2F2ZWRWYWx1ZSA9PT0gdW5zYXZlZFZhbHVlKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgdmFsdWVUb1NhdmUgPSB1bnNhdmVkVmFsdWU7CiAgICAgICAgICAgICAgaXNTYW1lVmFsdWUgPSBmYWxzZTsKICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSB0eXBlOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gX2NvbnRleHQyLnQwID09PSAnYXJyYXknID8gOSA6IF9jb250ZXh0Mi50MCA9PT0gJ2pzb24nID8gMTIgOiAxNDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICB2YWx1ZVRvU2F2ZSA9IHZhbHVlVG9TYXZlLnNwbGl0KCcsJykubWFwKGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiB2YWwudHJpbSgpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGlzU2FtZVZhbHVlID0gdmFsdWVUb1NhdmUuam9pbignLCcpID09PSBkZWZWYWwuam9pbignLCcpOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJicmVhayIsIDE1KTsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgdmFsdWVUb1NhdmUgPSB2YWx1ZVRvU2F2ZS50cmltKCk7CiAgICAgICAgICAgICAgdmFsdWVUb1NhdmUgPSB2YWx1ZVRvU2F2ZSB8fCAoaXNKc29uQXJyYXkgPyAnW10nIDogJ3t9Jyk7CgogICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgIGlzU2FtZVZhbHVlID0gdmFsdWVUb1NhdmUgPT09IGRlZlZhbDsKCiAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgX3RoaXMuc2V0TG9hZGluZyh0cnVlKTsKCiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAxNjsKCiAgICAgICAgICAgICAgaWYgKCFpc1NhbWVWYWx1ZSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyMDsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMucHJvcHMuY2xlYXIobmFtZSk7CgogICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnByb3BzLnNhdmUobmFtZSwgdmFsdWVUb1NhdmUpOwoKICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICBfdGhpcy5zaG93UGFnZVJlbG9hZFRvYXN0KCk7CgogICAgICAgICAgICAgIGlmIChjaGFuZ2VJbWFnZSkgewogICAgICAgICAgICAgICAgX3RoaXMuY2FuY2VsQ2hhbmdlSW1hZ2UoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzE7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDI4OgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMjg7CiAgICAgICAgICAgICAgX2NvbnRleHQyLnQxID0gX2NvbnRleHQyWyJjYXRjaCJdKDE2KTsKCiAgICAgICAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkRGFuZ2VyKF90aGlzLnByb3BzLmludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBpZDogJ2tibi5tYW5hZ2VtZW50LnNldHRpbmdzLmZpZWxkLnNhdmVGaWVsZEVycm9yTWVzc2FnZScsCiAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1VuYWJsZSB0byBzYXZlIHtuYW1lfScKICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lCiAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgICBfdGhpcy5zZXRMb2FkaW5nKGZhbHNlKTsKCiAgICAgICAgICAgIGNhc2UgMzI6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMiwgbnVsbCwgW1sxNiwgMjhdXSk7CiAgICB9KSkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlc2V0RmllbGQiLAogICAgLyojX19QVVJFX18qLwogICAgX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAvKiNfX1BVUkVfXyovCiAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgdmFyIG5hbWU7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgbmFtZSA9IF90aGlzLnByb3BzLnNldHRpbmcubmFtZTsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0TG9hZGluZyh0cnVlKTsKCiAgICAgICAgICAgICAgX2NvbnRleHQzLnByZXYgPSAyOwogICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMucHJvcHMuY2xlYXIobmFtZSk7CgogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgX3RoaXMuc2hvd1BhZ2VSZWxvYWRUb2FzdCgpOwoKICAgICAgICAgICAgICBfdGhpcy5jYW5jZWxDaGFuZ2VJbWFnZSgpOwoKICAgICAgICAgICAgICBfdGhpcy5jbGVhckVycm9yKCk7CgogICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gMTA7CiAgICAgICAgICAgICAgX2NvbnRleHQzLnQwID0gX2NvbnRleHQzWyJjYXRjaCJdKDIpOwoKICAgICAgICAgICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGREYW5nZXIoX3RoaXMucHJvcHMuaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgICAgIGlkOiAna2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQucmVzZXRGaWVsZEVycm9yTWVzc2FnZScsCiAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1VuYWJsZSB0byByZXNldCB7bmFtZX0nCiAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogbmFtZQogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgX3RoaXMuc2V0TG9hZGluZyhmYWxzZSk7CgogICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTMsIG51bGwsIFtbMiwgMTBdXSk7CiAgICB9KSkpOwoKICAgIHZhciBfdGhpcyRwcm9wcyRzZXR0aW5nMiA9IF90aGlzLnByb3BzLnNldHRpbmcsCiAgICAgICAgX3R5cGUgPSBfdGhpcyRwcm9wcyRzZXR0aW5nMi50eXBlLAogICAgICAgIF92YWx1ZSA9IF90aGlzJHByb3BzJHNldHRpbmcyLnZhbHVlLAogICAgICAgIF9kZWZWYWwgPSBfdGhpcyRwcm9wcyRzZXR0aW5nMi5kZWZWYWw7CgogICAgdmFyIGVkaXRhYmxlVmFsdWUgPSBfdGhpcy5nZXRFZGl0YWJsZVZhbHVlKF90eXBlLCBfdmFsdWUsIF9kZWZWYWwpOwoKICAgIF90aGlzLnN0YXRlID0gewogICAgICBpc0ludmFsaWQ6IGZhbHNlLAogICAgICBlcnJvcjogbnVsbCwKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIGNoYW5nZUltYWdlOiBmYWxzZSwKICAgICAgc2F2ZWRWYWx1ZTogZWRpdGFibGVWYWx1ZSwKICAgICAgdW5zYXZlZFZhbHVlOiBlZGl0YWJsZVZhbHVlLAogICAgICBpc0pzb25BcnJheTogX3R5cGUgPT09ICdqc29uJyA/IEFycmF5LmlzQXJyYXkoSlNPTi5wYXJzZShfZGVmVmFsIHx8ICd7fScpKSA6IGZhbHNlCiAgICB9OwogICAgX3RoaXMuY2hhbmdlSW1hZ2VGb3JtID0gbnVsbDsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhGaWVsZFVJLCBbewogICAga2V5OiAiY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHsKICAgICAgdmFyIHVuc2F2ZWRWYWx1ZSA9IHRoaXMuc3RhdGUudW5zYXZlZFZhbHVlOwogICAgICB2YXIgX25leHRQcm9wcyRzZXR0aW5nID0gbmV4dFByb3BzLnNldHRpbmcsCiAgICAgICAgICB0eXBlID0gX25leHRQcm9wcyRzZXR0aW5nLnR5cGUsCiAgICAgICAgICB2YWx1ZSA9IF9uZXh0UHJvcHMkc2V0dGluZy52YWx1ZSwKICAgICAgICAgIGRlZlZhbCA9IF9uZXh0UHJvcHMkc2V0dGluZy5kZWZWYWw7CiAgICAgIHZhciBlZGl0YWJsZVZhbHVlID0gdGhpcy5nZXRFZGl0YWJsZVZhbHVlKHR5cGUsIHZhbHVlLCBkZWZWYWwpOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBzYXZlZFZhbHVlOiBlZGl0YWJsZVZhbHVlLAogICAgICAgIHVuc2F2ZWRWYWx1ZTogdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCA/IGVkaXRhYmxlVmFsdWUgOiB1bnNhdmVkVmFsdWUKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RWRpdGFibGVWYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RWRpdGFibGVWYWx1ZSh0eXBlLCB2YWx1ZSwgZGVmVmFsKSB7CiAgICAgIHZhciB2YWwgPSB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gZGVmVmFsIDogdmFsdWU7CgogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlICdhcnJheSc6CiAgICAgICAgICByZXR1cm4gdmFsLmpvaW4oJywgJyk7CgogICAgICAgIGNhc2UgJ2Jvb2xlYW4nOgogICAgICAgICAgcmV0dXJuICEhdmFsOwoKICAgICAgICBjYXNlICdudW1iZXInOgogICAgICAgICAgcmV0dXJuIE51bWJlcih2YWwpOwoKICAgICAgICBjYXNlICdpbWFnZSc6CiAgICAgICAgICByZXR1cm4gdmFsOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIHZhbCB8fCAnJzsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImdldERpc3BsYXllZERlZmF1bHRWYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGlzcGxheWVkRGVmYXVsdFZhbHVlKHR5cGUsIGRlZlZhbCkgewogICAgICB2YXIgb3B0aW9uTGFiZWxzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fTsKCiAgICAgIGlmIChkZWZWYWwgPT09IHVuZGVmaW5lZCB8fCBkZWZWYWwgPT09IG51bGwgfHwgZGVmVmFsID09PSAnJykgewogICAgICAgIHJldHVybiAnbnVsbCc7CiAgICAgIH0KCiAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgJ2FycmF5JzoKICAgICAgICAgIHJldHVybiBkZWZWYWwuam9pbignLCAnKTsKCiAgICAgICAgY2FzZSAnc2VsZWN0JzoKICAgICAgICAgIHJldHVybiBvcHRpb25MYWJlbHMuaGFzT3duUHJvcGVydHkoZGVmVmFsKSA/IG9wdGlvbkxhYmVsc1tkZWZWYWxdIDogU3RyaW5nKGRlZlZhbCk7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gU3RyaW5nKGRlZlZhbCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRMb2FkaW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRMb2FkaW5nKGxvYWRpbmcpIHsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgbG9hZGluZzogbG9hZGluZwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjbGVhckVycm9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhckVycm9yKCkgewogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBpc0ludmFsaWQ6IGZhbHNlLAogICAgICAgIGVycm9yOiBudWxsCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEltYWdlQXNCYXNlNjQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEltYWdlQXNCYXNlNjQoZmlsZSkgewogICAgICBpZiAoIWZpbGUgaW5zdGFuY2VvZiBGaWxlKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmVzb2x2ZShyZWFkZXIucmVzdWx0KTsKICAgICAgICB9OwoKICAgICAgICByZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgIHJlamVjdChlcnIpOwogICAgICAgIH07CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckZpZWxkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJGaWVsZChzZXR0aW5nKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIGVuYWJsZVNhdmluZyA9IHRoaXMucHJvcHMuZW5hYmxlU2F2aW5nOwogICAgICB2YXIgX3RoaXMkc3RhdGUyID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGxvYWRpbmcgPSBfdGhpcyRzdGF0ZTIubG9hZGluZywKICAgICAgICAgIGNoYW5nZUltYWdlID0gX3RoaXMkc3RhdGUyLmNoYW5nZUltYWdlLAogICAgICAgICAgdW5zYXZlZFZhbHVlID0gX3RoaXMkc3RhdGUyLnVuc2F2ZWRWYWx1ZTsKICAgICAgdmFyIG5hbWUgPSBzZXR0aW5nLm5hbWUsCiAgICAgICAgICB2YWx1ZSA9IHNldHRpbmcudmFsdWUsCiAgICAgICAgICB0eXBlID0gc2V0dGluZy50eXBlLAogICAgICAgICAgb3B0aW9ucyA9IHNldHRpbmcub3B0aW9ucywKICAgICAgICAgIF9zZXR0aW5nJG9wdGlvbkxhYmVscyA9IHNldHRpbmcub3B0aW9uTGFiZWxzLAogICAgICAgICAgb3B0aW9uTGFiZWxzID0gX3NldHRpbmckb3B0aW9uTGFiZWxzID09PSB2b2lkIDAgPyB7fSA6IF9zZXR0aW5nJG9wdGlvbkxhYmVscywKICAgICAgICAgIGlzT3ZlcnJpZGRlbiA9IHNldHRpbmcuaXNPdmVycmlkZGVuLAogICAgICAgICAgYXJpYU5hbWUgPSBzZXR0aW5nLmFyaWFOYW1lOwoKICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSAnYm9vbGVhbic6CiAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVN3aXRjaCwgewogICAgICAgICAgICBsYWJlbDogISF1bnNhdmVkVmFsdWUgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQub25MYWJlbCIsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJPbiIKICAgICAgICAgICAgfSkgOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQub2ZmTGFiZWwiLAogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiT2ZmIgogICAgICAgICAgICB9KSwKICAgICAgICAgICAgY2hlY2tlZDogISF1bnNhdmVkVmFsdWUsCiAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uRmllbGRDaGFuZ2UsCiAgICAgICAgICAgIGRpc2FibGVkOiBsb2FkaW5nIHx8IGlzT3ZlcnJpZGRlbiB8fCAhZW5hYmxlU2F2aW5nLAogICAgICAgICAgICBvbktleURvd246IHRoaXMub25GaWVsZEtleURvd24sCiAgICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhZHZhbmNlZFNldHRpbmctZWRpdEZpZWxkLSIuY29uY2F0KG5hbWUpLAogICAgICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFOYW1lCiAgICAgICAgICB9KTsKCiAgICAgICAgY2FzZSAnbWFya2Rvd24nOgogICAgICAgIGNhc2UgJ2pzb24nOgogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImFkdmFuY2VkU2V0dGluZy1lZGl0RmllbGQtIi5jb25jYXQobmFtZSkKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb2RlRWRpdG9yLCB7CiAgICAgICAgICAgICJhcmlhLWxhYmVsIjogYXJpYU5hbWUsCiAgICAgICAgICAgIG1vZGU6IHR5cGUsCiAgICAgICAgICAgIHRoZW1lOiAidGV4dG1hdGUiLAogICAgICAgICAgICB2YWx1ZTogdW5zYXZlZFZhbHVlLAogICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5vbkNvZGVFZGl0b3JDaGFuZ2UsCiAgICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICAgIGhlaWdodDogImF1dG8iLAogICAgICAgICAgICBtaW5MaW5lczogNiwKICAgICAgICAgICAgbWF4TGluZXM6IDMwLAogICAgICAgICAgICBpc1JlYWRPbmx5OiBpc092ZXJyaWRkZW4gfHwgIWVuYWJsZVNhdmluZywKICAgICAgICAgICAgc2V0T3B0aW9uczogewogICAgICAgICAgICAgIHNob3dMaW5lTnVtYmVyczogZmFsc2UsCiAgICAgICAgICAgICAgdGFiU2l6ZTogMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlZGl0b3JQcm9wczogewogICAgICAgICAgICAgICRibG9ja1Njcm9sbGluZzogSW5maW5pdHkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2hvd0d1dHRlcjogZmFsc2UKICAgICAgICAgIH0pKTsKCiAgICAgICAgY2FzZSAnaW1hZ2UnOgogICAgICAgICAgaWYgKCEoMCwgX2xpYi5pc0RlZmF1bHRWYWx1ZSkoc2V0dGluZykgJiYgIWNoYW5nZUltYWdlKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSW1hZ2UsIHsKICAgICAgICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFOYW1lLAogICAgICAgICAgICAgIGFsbG93RnVsbFNjcmVlbjogdHJ1ZSwKICAgICAgICAgICAgICB1cmw6IHZhbHVlLAogICAgICAgICAgICAgIGFsdDogbmFtZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmlsZVBpY2tlciwgewogICAgICAgICAgICAgIGRpc2FibGVkOiBsb2FkaW5nIHx8IGlzT3ZlcnJpZGRlbiB8fCAhZW5hYmxlU2F2aW5nLAogICAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uSW1hZ2VDaGFuZ2UsCiAgICAgICAgICAgICAgYWNjZXB0OiAiLmpwZywuanBlZywucG5nIiwKICAgICAgICAgICAgICByZWY6IGZ1bmN0aW9uIHJlZihpbnB1dCkgewogICAgICAgICAgICAgICAgX3RoaXMyLmNoYW5nZUltYWdlRm9ybSA9IGlucHV0OwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb25LZXlEb3duOiB0aGlzLm9uRmllbGRFc2NhcGUsCiAgICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImFkdmFuY2VkU2V0dGluZy1lZGl0RmllbGQtIi5jb25jYXQobmFtZSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgIGNhc2UgJ3NlbGVjdCc6CiAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNlbGVjdCwgewogICAgICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFOYW1lLAogICAgICAgICAgICB2YWx1ZTogdW5zYXZlZFZhbHVlLAogICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zLm1hcChmdW5jdGlvbiAob3B0aW9uKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHRleHQ6IG9wdGlvbkxhYmVscy5oYXNPd25Qcm9wZXJ0eShvcHRpb24pID8gb3B0aW9uTGFiZWxzW29wdGlvbl0gOiBvcHRpb24sCiAgICAgICAgICAgICAgICB2YWx1ZTogb3B0aW9uCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uRmllbGRDaGFuZ2UsCiAgICAgICAgICAgIGlzTG9hZGluZzogbG9hZGluZywKICAgICAgICAgICAgZGlzYWJsZWQ6IGxvYWRpbmcgfHwgaXNPdmVycmlkZGVuIHx8ICFlbmFibGVTYXZpbmcsCiAgICAgICAgICAgIG9uS2V5RG93bjogdGhpcy5vbkZpZWxkS2V5RG93biwKICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImFkdmFuY2VkU2V0dGluZy1lZGl0RmllbGQtIi5jb25jYXQobmFtZSkKICAgICAgICAgIH0pOwoKICAgICAgICBjYXNlICdudW1iZXInOgogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGaWVsZE51bWJlciwgewogICAgICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFOYW1lLAogICAgICAgICAgICB2YWx1ZTogdW5zYXZlZFZhbHVlLAogICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5vbkZpZWxkQ2hhbmdlLAogICAgICAgICAgICBpc0xvYWRpbmc6IGxvYWRpbmcsCiAgICAgICAgICAgIGRpc2FibGVkOiBsb2FkaW5nIHx8IGlzT3ZlcnJpZGRlbiB8fCAhZW5hYmxlU2F2aW5nLAogICAgICAgICAgICBvbktleURvd246IHRoaXMub25GaWVsZEtleURvd24sCiAgICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhZHZhbmNlZFNldHRpbmctZWRpdEZpZWxkLSIuY29uY2F0KG5hbWUpCiAgICAgICAgICB9KTsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmllbGRUZXh0LCB7CiAgICAgICAgICAgICJhcmlhLWxhYmVsIjogYXJpYU5hbWUsCiAgICAgICAgICAgIHZhbHVlOiB1bnNhdmVkVmFsdWUsCiAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uRmllbGRDaGFuZ2UsCiAgICAgICAgICAgIGlzTG9hZGluZzogbG9hZGluZywKICAgICAgICAgICAgZGlzYWJsZWQ6IGxvYWRpbmcgfHwgaXNPdmVycmlkZGVuIHx8ICFlbmFibGVTYXZpbmcsCiAgICAgICAgICAgIG9uS2V5RG93bjogdGhpcy5vbkZpZWxkS2V5RG93biwKICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImFkdmFuY2VkU2V0dGluZy1lZGl0RmllbGQtIi5jb25jYXQobmFtZSkKICAgICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyTGFiZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckxhYmVsKHNldHRpbmcpIHsKICAgICAgcmV0dXJuIHNldHRpbmcubmFtZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJIZWxwVGV4dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVySGVscFRleHQoc2V0dGluZykgewogICAgICBpZiAoc2V0dGluZy5pc092ZXJyaWRkZW4pIHsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRleHQsIHsKICAgICAgICAgIHNpemU6ICJ4cyIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5oZWxwVGV4dCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlRoaXMgc2V0dGluZyBpcyBvdmVycmlkZGVuIGJ5IHRoZSBLaWJhbmEgc2VydmVyIGFuZCBjYW4gbm90IGJlIGNoYW5nZWQuIgogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgdmFyIGNhblVwZGF0ZVNldHRpbmcgPSB0aGlzLnByb3BzLmVuYWJsZVNhdmluZzsKICAgICAgdmFyIGRlZmF1bHRMaW5rID0gdGhpcy5yZW5kZXJSZXNldFRvRGVmYXVsdExpbmsoc2V0dGluZyk7CiAgICAgIHZhciBpbWFnZUxpbmsgPSB0aGlzLnJlbmRlckNoYW5nZUltYWdlTGluayhzZXR0aW5nKTsKCiAgICAgIGlmIChjYW5VcGRhdGVTZXR0aW5nICYmIChkZWZhdWx0TGluayB8fCBpbWFnZUxpbmspKSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBkZWZhdWx0TGluaywgaW1hZ2VMaW5rKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyVGl0bGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclRpdGxlKHNldHRpbmcpIHsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImgzIiwgbnVsbCwgc2V0dGluZy5kaXNwbGF5TmFtZSB8fCBzZXR0aW5nLm5hbWUsIHNldHRpbmcuaXNDdXN0b20gPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSWNvblRpcCwgewogICAgICAgIHR5cGU6ICJhc3RlcmlzayIsCiAgICAgICAgY29sb3I6ICJwcmltYXJ5IiwKICAgICAgICAiYXJpYS1sYWJlbCI6IHRoaXMucHJvcHMuaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAna2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQuY3VzdG9tU2V0dGluZ0FyaWFMYWJlbCcsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0N1c3RvbSBzZXR0aW5nJwogICAgICAgIH0pLAogICAgICAgIGNvbnRlbnQ6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogImtibi5tYW5hZ2VtZW50LnNldHRpbmdzLmZpZWxkLmN1c3RvbVNldHRpbmdUb29sdGlwIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ3VzdG9tIHNldHRpbmciCiAgICAgICAgfSkKICAgICAgfSkgOiAnJyk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyRGVzY3JpcHRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckRlc2NyaXB0aW9uKHNldHRpbmcpIHsKICAgICAgdmFyIGRlc2NyaXB0aW9uOwoKICAgICAgaWYgKF9yZWFjdC5kZWZhdWx0LmlzVmFsaWRFbGVtZW50KHNldHRpbmcuZGVzY3JpcHRpb24pKSB7CiAgICAgICAgZGVzY3JpcHRpb24gPSBzZXR0aW5nLmRlc2NyaXB0aW9uOwogICAgICB9IGVsc2UgewogICAgICAgIGRlc2NyaXB0aW9uID0gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgLyoKICAgICAgICAgICAqIEp1c3RpZmljYXRpb24gZm9yIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MOgogICAgICAgICAgICogU2V0dGluZyBkZXNjcmlwdGlvbiBtYXkgY29udGFpbiBmb3JtYXR0aW5nIGFuZCBsaW5rcyB0byBkb2N1bWVudGF0aW9uLgogICAgICAgICAgICovCiAgICAgICAgICBkYW5nZXJvdXNseVNldElubmVySFRNTDogewogICAgICAgICAgICBfX2h0bWw6IHNldHRpbmcuZGVzY3JpcHRpb24KICAgICAgICAgIH0gLy9lc2xpbnQtZGlzYWJsZS1saW5lIHJlYWN0L25vLWRhbmdlcgoKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBkZXNjcmlwdGlvbiwgdGhpcy5yZW5kZXJEZWZhdWx0VmFsdWUoc2V0dGluZykpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckRlZmF1bHRWYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyRGVmYXVsdFZhbHVlKHNldHRpbmcpIHsKICAgICAgdmFyIHR5cGUgPSBzZXR0aW5nLnR5cGUsCiAgICAgICAgICBkZWZWYWwgPSBzZXR0aW5nLmRlZlZhbCwKICAgICAgICAgIG9wdGlvbkxhYmVscyA9IHNldHRpbmcub3B0aW9uTGFiZWxzOwoKICAgICAgaWYgKCgwLCBfbGliLmlzRGVmYXVsdFZhbHVlKShzZXR0aW5nKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogInMiCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGV4dCwgewogICAgICAgIHNpemU6ICJ4cyIKICAgICAgfSwgdHlwZSA9PT0gJ2pzb24nID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5kZWZhdWx0VmFsdWVUeXBlSnNvblRleHQiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRGVmYXVsdDoge3ZhbHVlfSIsCiAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICB2YWx1ZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNvZGVCbG9jaywgewogICAgICAgICAgICBsYW5ndWFnZTogImpzb24iLAogICAgICAgICAgICBwYWRkaW5nU2l6ZTogInMiLAogICAgICAgICAgICBvdmVyZmxvd0hlaWdodDogZGVmVmFsLmxlbmd0aCA+PSA1MDAgPyAzMDAgOiBudWxsCiAgICAgICAgICB9LCB0aGlzLmdldERpc3BsYXllZERlZmF1bHRWYWx1ZSh0eXBlLCBkZWZWYWwpKQogICAgICAgIH0KICAgICAgfSkpIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5kZWZhdWx0VmFsdWVUZXh0IiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRlZmF1bHQ6IHt2YWx1ZX0iLAogICAgICAgIHZhbHVlczogewogICAgICAgICAgdmFsdWU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb2RlLCBudWxsLCB0aGlzLmdldERpc3BsYXllZERlZmF1bHRWYWx1ZSh0eXBlLCBkZWZWYWwsIG9wdGlvbkxhYmVscykpCiAgICAgICAgfQogICAgICB9KSkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJSZXNldFRvRGVmYXVsdExpbmsiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclJlc2V0VG9EZWZhdWx0TGluayhzZXR0aW5nKSB7CiAgICAgIHZhciBhcmlhTmFtZSA9IHNldHRpbmcuYXJpYU5hbWUsCiAgICAgICAgICBuYW1lID0gc2V0dGluZy5uYW1lOwoKICAgICAgaWYgKCgwLCBfbGliLmlzRGVmYXVsdFZhbHVlKShzZXR0aW5nKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTGluaywgewogICAgICAgICJhcmlhLWxhYmVsIjogdGhpcy5wcm9wcy5pbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICdrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5yZXNldFRvRGVmYXVsdExpbmtBcmlhTGFiZWwnLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdSZXNldCB7YXJpYU5hbWV9IHRvIGRlZmF1bHQnCiAgICAgICAgfSwgewogICAgICAgICAgYXJpYU5hbWU6IGFyaWFOYW1lCiAgICAgICAgfSksCiAgICAgICAgb25DbGljazogdGhpcy5yZXNldEZpZWxkLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhZHZhbmNlZFNldHRpbmctcmVzZXRGaWVsZC0iLmNvbmNhdChuYW1lKQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQucmVzZXRUb0RlZmF1bHRMaW5rVGV4dCIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJSZXNldCB0byBkZWZhdWx0IgogICAgICB9KSksICJceEEwXHhBMFx4QTAiKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJDaGFuZ2VJbWFnZUxpbmsiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckNoYW5nZUltYWdlTGluayhzZXR0aW5nKSB7CiAgICAgIHZhciBjaGFuZ2VJbWFnZSA9IHRoaXMuc3RhdGUuY2hhbmdlSW1hZ2U7CiAgICAgIHZhciB0eXBlID0gc2V0dGluZy50eXBlLAogICAgICAgICAgdmFsdWUgPSBzZXR0aW5nLnZhbHVlLAogICAgICAgICAgYXJpYU5hbWUgPSBzZXR0aW5nLmFyaWFOYW1lLAogICAgICAgICAgbmFtZSA9IHNldHRpbmcubmFtZTsKCiAgICAgIGlmICh0eXBlICE9PSAnaW1hZ2UnIHx8ICF2YWx1ZSB8fCBjaGFuZ2VJbWFnZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTGluaywgewogICAgICAgICJhcmlhLWxhYmVsIjogdGhpcy5wcm9wcy5pbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICdrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5jaGFuZ2VJbWFnZUxpbmtBcmlhTGFiZWwnLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDaGFuZ2Uge2FyaWFOYW1lfScKICAgICAgICB9LCB7CiAgICAgICAgICBhcmlhTmFtZTogYXJpYU5hbWUKICAgICAgICB9KSwKICAgICAgICBvbkNsaWNrOiB0aGlzLmNoYW5nZUltYWdlLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhZHZhbmNlZFNldHRpbmctY2hhbmdlSW1hZ2UtIi5jb25jYXQobmFtZSkKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImtibi5tYW5hZ2VtZW50LnNldHRpbmdzLmZpZWxkLmNoYW5nZUltYWdlTGlua1RleHQiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ2hhbmdlIGltYWdlIgogICAgICB9KSkpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckFjdGlvbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckFjdGlvbnMoc2V0dGluZykgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBhcmlhTmFtZSA9IHNldHRpbmcuYXJpYU5hbWUsCiAgICAgICAgICBuYW1lID0gc2V0dGluZy5uYW1lOwogICAgICB2YXIgX3RoaXMkc3RhdGUzID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGxvYWRpbmcgPSBfdGhpcyRzdGF0ZTMubG9hZGluZywKICAgICAgICAgIGlzSW52YWxpZCA9IF90aGlzJHN0YXRlMy5pc0ludmFsaWQsCiAgICAgICAgICBjaGFuZ2VJbWFnZSA9IF90aGlzJHN0YXRlMy5jaGFuZ2VJbWFnZSwKICAgICAgICAgIHNhdmVkVmFsdWUgPSBfdGhpcyRzdGF0ZTMuc2F2ZWRWYWx1ZSwKICAgICAgICAgIHVuc2F2ZWRWYWx1ZSA9IF90aGlzJHN0YXRlMy51bnNhdmVkVmFsdWU7CiAgICAgIHZhciBpc0Rpc2FibGVkID0gbG9hZGluZyB8fCBzZXR0aW5nLmlzT3ZlcnJpZGRlbjsKICAgICAgdmFyIGludGwgPSB0aGlzLnByb3BzLmludGw7CgogICAgICBpZiAoc2F2ZWRWYWx1ZSA9PT0gdW5zYXZlZFZhbHVlICYmICFjaGFuZ2VJbWFnZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgY2xhc3NOYW1lOiAibWd0QWR2YW5jZWRTZXR0aW5nc19fZmllbGRBY3Rpb25zIiwKICAgICAgICBoYXNFbXB0eUxhYmVsU3BhY2U6IHRydWUKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbiwgewogICAgICAgIGZpbGw6IHRydWUsCiAgICAgICAgImFyaWEtbGFiZWwiOiBpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICdrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5zYXZlQnV0dG9uQXJpYUxhYmVsJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU2F2ZSB7YXJpYU5hbWV9JwogICAgICAgIH0sIHsKICAgICAgICAgIGFyaWFOYW1lOiBhcmlhTmFtZQogICAgICAgIH0pLAogICAgICAgIG9uQ2xpY2s6IHRoaXMuc2F2ZUVkaXQsCiAgICAgICAgZGlzYWJsZWQ6IGlzRGlzYWJsZWQgfHwgaXNJbnZhbGlkLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhZHZhbmNlZFNldHRpbmctc2F2ZUVkaXRGaWVsZC0iLmNvbmNhdChuYW1lKQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQuc2F2ZUJ1dHRvbkxhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmUiCiAgICAgIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IGZhbHNlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b25FbXB0eSwgewogICAgICAgICJhcmlhLWxhYmVsIjogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAna2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQuY2FuY2VsRWRpdGluZ0J1dHRvbkFyaWFMYWJlbCcsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0NhbmNlbCBlZGl0aW5nIHthcmlhTmFtZX0nCiAgICAgICAgfSwgewogICAgICAgICAgYXJpYU5hbWU6IGFyaWFOYW1lCiAgICAgICAgfSksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHJldHVybiBjaGFuZ2VJbWFnZSA/IF90aGlzMy5jYW5jZWxDaGFuZ2VJbWFnZSgpIDogX3RoaXMzLmNhbmNlbEVkaXQoKTsKICAgICAgICB9LAogICAgICAgIGRpc2FibGVkOiBpc0Rpc2FibGVkLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhZHZhbmNlZFNldHRpbmctY2FuY2VsRWRpdEZpZWxkLSIuY29uY2F0KG5hbWUpCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5jYW5jZWxFZGl0aW5nQnV0dG9uTGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ2FuY2VsIgogICAgICB9KSkpKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBzZXR0aW5nID0gdGhpcy5wcm9wcy5zZXR0aW5nOwogICAgICB2YXIgX3RoaXMkc3RhdGU0ID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGVycm9yID0gX3RoaXMkc3RhdGU0LmVycm9yLAogICAgICAgICAgaXNJbnZhbGlkID0gX3RoaXMkc3RhdGU0LmlzSW52YWxpZDsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICBjbGFzc05hbWU6ICJtZ3RBZHZhbmNlZFNldHRpbmdzX19maWVsZCIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aURlc2NyaWJlZEZvcm1Hcm91cCwgewogICAgICAgIGNsYXNzTmFtZTogIm1ndEFkdmFuY2VkU2V0dGluZ3NfX2ZpZWxkV3JhcHBlciIsCiAgICAgICAgdGl0bGU6IHRoaXMucmVuZGVyVGl0bGUoc2V0dGluZyksCiAgICAgICAgZGVzY3JpcHRpb246IHRoaXMucmVuZGVyRGVzY3JpcHRpb24oc2V0dGluZyksCiAgICAgICAgaWRBcmlhOiAiIi5jb25jYXQoc2V0dGluZy5uYW1lLCAiLWFyaWEiKQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGlzSW52YWxpZDogaXNJbnZhbGlkLAogICAgICAgIGVycm9yOiBlcnJvciwKICAgICAgICBsYWJlbDogdGhpcy5yZW5kZXJMYWJlbChzZXR0aW5nKSwKICAgICAgICBoZWxwVGV4dDogdGhpcy5yZW5kZXJIZWxwVGV4dChzZXR0aW5nKSwKICAgICAgICBkZXNjcmliZWRCeUlkczogWyIiLmNvbmNhdChzZXR0aW5nLm5hbWUsICItYXJpYSIpXSwKICAgICAgICBjbGFzc05hbWU6ICJtZ3RBZHZhbmNlZFNldHRpbmdzX19maWVsZFJvdyIKICAgICAgfSwgdGhpcy5yZW5kZXJGaWVsZChzZXR0aW5nKSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgdGhpcy5yZW5kZXJBY3Rpb25zKHNldHRpbmcpKSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRmllbGRVSTsKfShfcmVhY3QuUHVyZUNvbXBvbmVudCk7CgpfZGVmaW5lUHJvcGVydHkoRmllbGRVSSwgInByb3BUeXBlcyIsIHsKICBzZXR0aW5nOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LmlzUmVxdWlyZWQsCiAgc2F2ZTogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCwKICBjbGVhcjogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCwKICBlbmFibGVTYXZpbmc6IF9wcm9wVHlwZXMuZGVmYXVsdC5ib29sLmlzUmVxdWlyZWQKfSk7Cgp2YXIgRmllbGQgPSAoMCwgX3JlYWN0Mi5pbmplY3RJMThuKShGaWVsZFVJKTsKZXhwb3J0cy5GaWVsZCA9IEZpZWxkOw=="},null]}