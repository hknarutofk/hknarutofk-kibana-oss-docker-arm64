{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/ui/public/field_editor/field_editor.js","dependencies":[{"path":"src/legacy/ui/public/field_editor/field_editor.js","mtime":1572296412624},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkZpZWxkRWRpdG9yID0gZXhwb3J0cy5GaWVsZEVkaXRvckNvbXBvbmVudCA9IHZvaWQgMDsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfcHJvcFR5cGVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJwcm9wLXR5cGVzIikpOwoKdmFyIF9sb2Rhc2ggPSByZXF1aXJlKCJsb2Rhc2giKTsKCnZhciBfc2NyaXB0aW5nX2xhbmd1YWdlcyA9IHJlcXVpcmUoInVpL3NjcmlwdGluZ19sYW5ndWFnZXMiKTsKCnZhciBfZmllbGRfZm9ybWF0cyA9IHJlcXVpcmUoInVpL3JlZ2lzdHJ5L2ZpZWxkX2Zvcm1hdHMiKTsKCnZhciBfZG9jdW1lbnRhdGlvbl9saW5rcyA9IHJlcXVpcmUoInVpL2RvY3VtZW50YXRpb25fbGlua3MiKTsKCnZhciBfbm90aWZ5ID0gcmVxdWlyZSgidWkvbm90aWZ5Iik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9zY3JpcHRpbmdfY2FsbF9vdXRzID0gcmVxdWlyZSgiLi9jb21wb25lbnRzL3NjcmlwdGluZ19jYWxsX291dHMiKTsKCnZhciBfc2NyaXB0aW5nX2hlbHAgPSByZXF1aXJlKCIuL2NvbXBvbmVudHMvc2NyaXB0aW5nX2hlbHAiKTsKCnZhciBfZmllbGRfZm9ybWF0X2VkaXRvciA9IHJlcXVpcmUoIi4vY29tcG9uZW50cy9maWVsZF9mb3JtYXRfZWRpdG9yIik7Cgp2YXIgX2NvbnN0YW50cyA9IHJlcXVpcmUoIi4vY29uc3RhbnRzIik7Cgp2YXIgX2xpYiA9IHJlcXVpcmUoIi4vbGliIik7Cgp2YXIgX3JlYWN0MiA9IHJlcXVpcmUoIkBrYm4vaTE4bi9yZWFjdCIpOwoKcmVxdWlyZSgiYnJhY2UvbW9kZS9ncm9vdnkiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OyBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgcmV0dXJuIG5ld09iajsgfSB9CgpmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsgfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOyB9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7IHZhciBfYXJyID0gW107IHZhciBfbiA9IHRydWU7IHZhciBfZCA9IGZhbHNlOyB2YXIgX2UgPSB1bmRlZmluZWQ7IHRyeSB7IGZvciAodmFyIF9pID0gYXJyW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3M7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsgX2Fyci5wdXNoKF9zLnZhbHVlKTsgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOyB9IH0gY2F0Y2ggKGVycikgeyBfZCA9IHRydWU7IF9lID0gZXJyOyB9IGZpbmFsbHkgeyB0cnkgeyBpZiAoIV9uICYmIF9pWyJyZXR1cm4iXSAhPSBudWxsKSBfaVsicmV0dXJuIl0oKTsgfSBmaW5hbGx5IHsgaWYgKF9kKSB0aHJvdyBfZTsgfSB9IHJldHVybiBfYXJyOyB9CgpmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7IH0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07IH0gcmV0dXJuIF90eXBlb2Yob2JqKTsgfQoKZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgeyB0cnkgeyB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7IHZhciB2YWx1ZSA9IGluZm8udmFsdWU7IH0gY2F0Y2ggKGVycm9yKSB7IHJlamVjdChlcnJvcik7IHJldHVybjsgfSBpZiAoaW5mby5kb25lKSB7IHJlc29sdmUodmFsdWUpOyB9IGVsc2UgeyBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7IH0gfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgdmFyIHNlbGYgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzOyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgeyB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7IGZ1bmN0aW9uIF9uZXh0KHZhbHVlKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7IH0gZnVuY3Rpb24gX3Rocm93KGVycikgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7IH0gX25leHQodW5kZWZpbmVkKTsgfSk7IH07IH0KCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTsgfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOyB9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7IH0KCmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsgcmV0dXJuIGNhbGw7IH0gcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7IH0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7IH07IHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7IH0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIHNlbGY7IH0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKdmFyIEZpZWxkRWRpdG9yQ29tcG9uZW50ID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1B1cmVDb21wb25lbnQpIHsKICBfaW5oZXJpdHMoRmllbGRFZGl0b3JDb21wb25lbnQsIF9QdXJlQ29tcG9uZW50KTsKCiAgZnVuY3Rpb24gRmllbGRFZGl0b3JDb21wb25lbnQocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRmllbGRFZGl0b3JDb21wb25lbnQpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEZpZWxkRWRpdG9yQ29tcG9uZW50KS5jYWxsKHRoaXMsIHByb3BzKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25GaWVsZENoYW5nZSIsIGZ1bmN0aW9uIChmaWVsZE5hbWUsIHZhbHVlKSB7CiAgICAgIHZhciBmaWVsZCA9IF90aGlzLnN0YXRlLmZpZWxkOwogICAgICBmaWVsZFtmaWVsZE5hbWVdID0gdmFsdWU7CgogICAgICBfdGhpcy5mb3JjZVVwZGF0ZSgpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25UeXBlQ2hhbmdlIiwgZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgdmFyIGdldENvbmZpZyA9IF90aGlzLnByb3BzLmhlbHBlcnMuZ2V0Q29uZmlnOwogICAgICB2YXIgZmllbGQgPSBfdGhpcy5zdGF0ZS5maWVsZDsKCiAgICAgIHZhciBEZWZhdWx0RmllbGRGb3JtYXQgPSBfZmllbGRfZm9ybWF0cy5maWVsZEZvcm1hdHMuZ2V0RGVmYXVsdFR5cGUodHlwZSk7CgogICAgICBmaWVsZC50eXBlID0gdHlwZTsKICAgICAgdmFyIGZpZWxkVHlwZUZvcm1hdHMgPSBbKDAsIF9saWIuZ2V0RGVmYXVsdEZvcm1hdCkoRGVmYXVsdEZpZWxkRm9ybWF0KV0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShfZmllbGRfZm9ybWF0cy5maWVsZEZvcm1hdHMuYnlGaWVsZFR5cGVbZmllbGQudHlwZV0pKTsKICAgICAgdmFyIEZpZWxkRm9ybWF0ID0gZmllbGRUeXBlRm9ybWF0c1swXTsKICAgICAgZmllbGQuZm9ybWF0ID0gbmV3IEZpZWxkRm9ybWF0KG51bGwsIGdldENvbmZpZyk7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZmllbGRUeXBlRm9ybWF0czogZmllbGRUeXBlRm9ybWF0cywKICAgICAgICBmaWVsZEZvcm1hdElkOiBGaWVsZEZvcm1hdC5pZCwKICAgICAgICBmaWVsZEZvcm1hdFBhcmFtczogZmllbGQuZm9ybWF0LnBhcmFtcygpCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25MYW5nQ2hhbmdlIiwgZnVuY3Rpb24gKGxhbmcpIHsKICAgICAgdmFyIGZpZWxkID0gX3RoaXMuc3RhdGUuZmllbGQ7CiAgICAgIHZhciBmaWVsZFR5cGVzID0gKDAsIF9sb2Rhc2guZ2V0KShfY29uc3RhbnRzLkZJRUxEX1RZUEVTX0JZX0xBTkcsIGxhbmcsIF9jb25zdGFudHMuREVGQVVMVF9GSUVMRF9UWVBFUyk7CiAgICAgIGZpZWxkLmxhbmcgPSBsYW5nOwogICAgICBmaWVsZC50eXBlID0gZmllbGRUeXBlcy5pbmNsdWRlcyhmaWVsZC50eXBlKSA/IGZpZWxkLnR5cGUgOiBmaWVsZFR5cGVzWzBdOwoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGZpZWxkVHlwZXM6IGZpZWxkVHlwZXMKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkZvcm1hdENoYW5nZSIsIGZ1bmN0aW9uIChmb3JtYXRJZCwgcGFyYW1zKSB7CiAgICAgIHZhciBnZXRDb25maWcgPSBfdGhpcy5wcm9wcy5oZWxwZXJzLmdldENvbmZpZzsKICAgICAgdmFyIF90aGlzJHN0YXRlID0gX3RoaXMuc3RhdGUsCiAgICAgICAgICBmaWVsZCA9IF90aGlzJHN0YXRlLmZpZWxkLAogICAgICAgICAgZmllbGRUeXBlRm9ybWF0cyA9IF90aGlzJHN0YXRlLmZpZWxkVHlwZUZvcm1hdHM7CiAgICAgIHZhciBGaWVsZEZvcm1hdCA9IGZpZWxkVHlwZUZvcm1hdHMuZmluZChmdW5jdGlvbiAoZm9ybWF0KSB7CiAgICAgICAgcmV0dXJuIGZvcm1hdC5pZCA9PT0gZm9ybWF0SWQ7CiAgICAgIH0pIHx8IGZpZWxkVHlwZUZvcm1hdHNbMF07CiAgICAgIGZpZWxkLmZvcm1hdCA9IG5ldyBGaWVsZEZvcm1hdChwYXJhbXMsIGdldENvbmZpZyk7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZmllbGRGb3JtYXRJZDogRmllbGRGb3JtYXQuaWQsCiAgICAgICAgZmllbGRGb3JtYXRQYXJhbXM6IGZpZWxkLmZvcm1hdC5wYXJhbXMoKQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uRm9ybWF0UGFyYW1zQ2hhbmdlIiwgZnVuY3Rpb24gKG5ld1BhcmFtcykgewogICAgICB2YXIgZmllbGRGb3JtYXRJZCA9IF90aGlzLnN0YXRlLmZpZWxkRm9ybWF0SWQ7CgogICAgICBfdGhpcy5vbkZvcm1hdENoYW5nZShmaWVsZEZvcm1hdElkLCBuZXdQYXJhbXMpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25Gb3JtYXRQYXJhbXNFcnJvciIsIGZ1bmN0aW9uIChlcnJvcikgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaGFzRm9ybWF0RXJyb3I6ICEhZXJyb3IKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblNjcmlwdENoYW5nZSIsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaGFzU2NyaXB0RXJyb3I6IGZhbHNlCiAgICAgIH0pOwoKICAgICAgX3RoaXMub25GaWVsZENoYW5nZSgnc2NyaXB0JywgdmFsdWUpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2hvd1NjcmlwdGluZ0hlbHAiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBzaG93U2NyaXB0aW5nSGVscDogdHJ1ZQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImhpZGVTY3JpcHRpbmdIZWxwIiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgc2hvd1NjcmlwdGluZ0hlbHA6IGZhbHNlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVuZGVyRGVsZXRlTW9kYWwiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBmaWVsZCA9IF90aGlzLnN0YXRlLmZpZWxkOwogICAgICB2YXIgaW50bCA9IF90aGlzLnByb3BzLmludGw7CiAgICAgIHJldHVybiBfdGhpcy5zdGF0ZS5zaG93RGVsZXRlTW9kYWwgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpT3ZlcmxheU1hc2ssIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb25maXJtTW9kYWwsIHsKICAgICAgICB0aXRsZTogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAnY29tbW9uLnVpLmZpZWxkRWRpdG9yLmRlbGV0ZUZpZWxkSGVhZGVyJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRGVsZXRlIGZpZWxkIFwne2ZpZWxkTmFtZX1cJycKICAgICAgICB9LCB7CiAgICAgICAgICBmaWVsZE5hbWU6IGZpZWxkLm5hbWUKICAgICAgICB9KSwKICAgICAgICBvbkNhbmNlbDogX3RoaXMuaGlkZURlbGV0ZU1vZGFsLAogICAgICAgIG9uQ29uZmlybTogZnVuY3Rpb24gb25Db25maXJtKCkgewogICAgICAgICAgX3RoaXMuaGlkZURlbGV0ZU1vZGFsKCk7CgogICAgICAgICAgX3RoaXMuZGVsZXRlRmllbGQoKTsKICAgICAgICB9LAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ2NvbW1vbi51aS5maWVsZEVkaXRvci5kZWxldGVGaWVsZC5jYW5jZWxCdXR0b24nLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDYW5jZWwnCiAgICAgICAgfSksCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ2NvbW1vbi51aS5maWVsZEVkaXRvci5kZWxldGVGaWVsZC5kZWxldGVCdXR0b24nLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEZWxldGUnCiAgICAgICAgfSksCiAgICAgICAgYnV0dG9uQ29sb3I6ICJkYW5nZXIiLAogICAgICAgIGRlZmF1bHRGb2N1c2VkQnV0dG9uOiBfZXVpLkVVSV9NT0RBTF9DT05GSVJNX0JVVFRPTgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5kZWxldGVGaWVsZExhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIllvdSBjYW4ndCByZWNvdmVyIGEgZGVsZXRlZCBmaWVsZC57c2VwYXJhdG9yfUFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkbyB0aGlzPyIsCiAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICBzZXBhcmF0b3I6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJiciIsIG51bGwpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJiciIsIG51bGwpKQogICAgICAgIH0KICAgICAgfSkpKSkgOiBudWxsOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2hvd0RlbGV0ZU1vZGFsIiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgc2hvd0RlbGV0ZU1vZGFsOiB0cnVlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGlkZURlbGV0ZU1vZGFsIiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgc2hvd0RlbGV0ZU1vZGFsOiBmYWxzZQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlbmRlclNjcmlwdGluZ1BhbmVscyIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlMiA9IF90aGlzLnN0YXRlLAogICAgICAgICAgc2NyaXB0aW5nTGFuZ3MgPSBfdGhpcyRzdGF0ZTIuc2NyaXB0aW5nTGFuZ3MsCiAgICAgICAgICBmaWVsZCA9IF90aGlzJHN0YXRlMi5maWVsZCwKICAgICAgICAgIHNob3dTY3JpcHRpbmdIZWxwID0gX3RoaXMkc3RhdGUyLnNob3dTY3JpcHRpbmdIZWxwOwoKICAgICAgaWYgKCFmaWVsZC5zY3JpcHRlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zY3JpcHRpbmdfY2FsbF9vdXRzLlNjcmlwdGluZ0Rpc2FibGVkQ2FsbE91dCwgewogICAgICAgIGlzVmlzaWJsZTogIXNjcmlwdGluZ0xhbmdzLmxlbmd0aAogICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc2NyaXB0aW5nX2NhbGxfb3V0cy5TY3JpcHRpbmdXYXJuaW5nQ2FsbE91dCwgewogICAgICAgIGlzVmlzaWJsZTogdHJ1ZQogICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc2NyaXB0aW5nX2hlbHAuU2NyaXB0aW5nSGVscEZseW91dCwgewogICAgICAgIGlzVmlzaWJsZTogc2hvd1NjcmlwdGluZ0hlbHAsCiAgICAgICAgb25DbG9zZTogX3RoaXMuaGlkZVNjcmlwdGluZ0hlbHAsCiAgICAgICAgaW5kZXhQYXR0ZXJuOiBfdGhpcy5wcm9wcy5pbmRleFBhdHRlcm4sCiAgICAgICAgbGFuZzogZmllbGQubGFuZywKICAgICAgICBuYW1lOiBmaWVsZC5uYW1lLAogICAgICAgIHNjcmlwdDogZmllbGQuc2NyaXB0LAogICAgICAgIGV4ZWN1dGVTY3JpcHQ6IF9saWIuZXhlY3V0ZVNjcmlwdAogICAgICB9KSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJkZWxldGVGaWVsZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHJlZGlyZWN0QXdheSA9IF90aGlzLnByb3BzLmhlbHBlcnMucmVkaXJlY3RBd2F5OwogICAgICB2YXIgX3RoaXMkcHJvcHMgPSBfdGhpcy5wcm9wcywKICAgICAgICAgIGluZGV4UGF0dGVybiA9IF90aGlzJHByb3BzLmluZGV4UGF0dGVybiwKICAgICAgICAgIGludGwgPSBfdGhpcyRwcm9wcy5pbnRsOwogICAgICB2YXIgZmllbGQgPSBfdGhpcy5zdGF0ZS5maWVsZDsKICAgICAgdmFyIHJlbW92ZSA9IGluZGV4UGF0dGVybi5yZW1vdmVTY3JpcHRlZEZpZWxkKGZpZWxkLm5hbWUpOwoKICAgICAgaWYgKHJlbW92ZSkgewogICAgICAgIHJlbW92ZS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBtZXNzYWdlID0gaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgaWQ6ICdjb21tb24udWkuZmllbGRFZGl0b3IuZGVsZXRlRmllbGQuZGVsZXRlZEhlYWRlcicsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRGVsZXRlZCBcJ3tmaWVsZE5hbWV9XCcnCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGZpZWxkTmFtZTogZmllbGQubmFtZQogICAgICAgICAgfSk7CgogICAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkU3VjY2VzcyhtZXNzYWdlKTsKCiAgICAgICAgICByZWRpcmVjdEF3YXkoKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZWRpcmVjdEF3YXkoKTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2F2ZUZpZWxkIiwKICAgIC8qI19fUFVSRV9fKi8KICAgIF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgdmFyIGZpZWxkLCBfdGhpcyRwcm9wczIsIGluZGV4UGF0dGVybiwgaW50bCwgZmllbGRGb3JtYXRJZCwgaXNWYWxpZCwgcmVkaXJlY3RBd2F5LCBpbmRleDsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBmaWVsZCA9IF90aGlzLnN0YXRlLmZpZWxkLnRvQWN0dWFsRmllbGQoKTsKICAgICAgICAgICAgICBfdGhpcyRwcm9wczIgPSBfdGhpcy5wcm9wcywgaW5kZXhQYXR0ZXJuID0gX3RoaXMkcHJvcHMyLmluZGV4UGF0dGVybiwgaW50bCA9IF90aGlzJHByb3BzMi5pbnRsOwogICAgICAgICAgICAgIGZpZWxkRm9ybWF0SWQgPSBfdGhpcy5zdGF0ZS5maWVsZEZvcm1hdElkOwoKICAgICAgICAgICAgICBpZiAoIWZpZWxkLnNjcmlwdGVkKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGlzU2F2aW5nOiB0cnVlCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgIHJldHVybiAoMCwgX2xpYi5pc1NjcmlwdFZhbGlkKSh7CiAgICAgICAgICAgICAgICBuYW1lOiBmaWVsZC5uYW1lLAogICAgICAgICAgICAgICAgbGFuZzogZmllbGQubGFuZywKICAgICAgICAgICAgICAgIHNjcmlwdDogZmllbGQuc2NyaXB0LAogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuVGl0bGU6IGluZGV4UGF0dGVybi50aXRsZQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIGlzVmFsaWQgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgICBpZiAoaXNWYWxpZCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBoYXNTY3JpcHRFcnJvcjogdHJ1ZSwKICAgICAgICAgICAgICAgIGlzU2F2aW5nOiBmYWxzZQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgcmVkaXJlY3RBd2F5ID0gX3RoaXMucHJvcHMuaGVscGVycy5yZWRpcmVjdEF3YXk7CiAgICAgICAgICAgICAgaW5kZXggPSBpbmRleFBhdHRlcm4uZmllbGRzLmZpbmRJbmRleChmdW5jdGlvbiAoZikgewogICAgICAgICAgICAgICAgcmV0dXJuIGYubmFtZSA9PT0gZmllbGQubmFtZTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybi5maWVsZHMuc3BsaWNlKGluZGV4LCAxLCBmaWVsZCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybi5maWVsZHMucHVzaChmaWVsZCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoIWZpZWxkRm9ybWF0SWQpIHsKICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybi5maWVsZEZvcm1hdE1hcFtmaWVsZC5uYW1lXSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuLmZpZWxkRm9ybWF0TWFwW2ZpZWxkLm5hbWVdID0gZmllbGQuZm9ybWF0OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgaW5kZXhQYXR0ZXJuLnNhdmUoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgaWQ6ICdjb21tb24udWkuZmllbGRFZGl0b3IuZGVsZXRlRmllbGQuc2F2ZWRIZWFkZXInLAogICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1NhdmVkIFwne2ZpZWxkTmFtZX1cJycKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgZmllbGROYW1lOiBmaWVsZC5uYW1lCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGRTdWNjZXNzKG1lc3NhZ2UpOwoKICAgICAgICAgICAgICAgIHJlZGlyZWN0QXdheSgpOwogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUpOwogICAgfSkpKTsKCiAgICB2YXIgX2ZpZWxkID0gcHJvcHMuZmllbGQsCiAgICAgICAgX2luZGV4UGF0dGVybiA9IHByb3BzLmluZGV4UGF0dGVybiwKICAgICAgICBGaWVsZCA9IHByb3BzLmhlbHBlcnMuRmllbGQ7CiAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgaXNSZWFkeTogZmFsc2UsCiAgICAgIGlzQ3JlYXRpbmc6IGZhbHNlLAogICAgICBpc0RlcHJlY2F0ZWRMYW5nOiBmYWxzZSwKICAgICAgc2NyaXB0aW5nTGFuZ3M6IFtdLAogICAgICBmaWVsZFR5cGVzOiBbXSwKICAgICAgZmllbGRUeXBlRm9ybWF0czogW10sCiAgICAgIGV4aXN0aW5nRmllbGROYW1lczogX2luZGV4UGF0dGVybi5maWVsZHMubWFwKGZ1bmN0aW9uIChmKSB7CiAgICAgICAgcmV0dXJuIGYubmFtZTsKICAgICAgfSksCiAgICAgIGZpZWxkOiAoMCwgX2xpYi5jb3B5RmllbGQpKF9maWVsZCwgX2luZGV4UGF0dGVybiwgRmllbGQpLAogICAgICBmaWVsZEZvcm1hdElkOiB1bmRlZmluZWQsCiAgICAgIGZpZWxkRm9ybWF0UGFyYW1zOiB7fSwKICAgICAgc2hvd1NjcmlwdGluZ0hlbHA6IGZhbHNlLAogICAgICBzaG93RGVsZXRlTW9kYWw6IGZhbHNlLAogICAgICBoYXNGb3JtYXRFcnJvcjogZmFsc2UsCiAgICAgIGhhc1NjcmlwdEVycm9yOiBmYWxzZSwKICAgICAgaXNTYXZpbmc6IGZhbHNlCiAgICB9OwogICAgX3RoaXMuc3VwcG9ydGVkTGFuZ3MgPSAoMCwgX3NjcmlwdGluZ19sYW5ndWFnZXMuZ2V0U3VwcG9ydGVkU2NyaXB0aW5nTGFuZ3VhZ2VzKSgpOwogICAgX3RoaXMuZGVwcmVjYXRlZExhbmdzID0gKDAsIF9zY3JpcHRpbmdfbGFuZ3VhZ2VzLmdldERlcHJlY2F0ZWRTY3JpcHRpbmdMYW5ndWFnZXMpKCk7CgogICAgX3RoaXMuaW5pdCgpOwoKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhGaWVsZEVkaXRvckNvbXBvbmVudCwgW3sKICAgIGtleTogImluaXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9pbml0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgdmFyICRodHRwLCBmaWVsZCwgaW5kZXhQYXR0ZXJuLCBnZXRFbmFibGVkU2NyaXB0aW5nTGFuZ3VhZ2VzLCBlbmFibGVkTGFuZ3MsIHNjcmlwdGluZ0xhbmdzLCBmaWVsZFR5cGVzLCBEZWZhdWx0RmllbGRGb3JtYXQsIGZpZWxkVHlwZUZvcm1hdHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICRodHRwID0gdGhpcy5wcm9wcy5oZWxwZXJzLiRodHRwOwogICAgICAgICAgICAgICAgZmllbGQgPSB0aGlzLnN0YXRlLmZpZWxkOwogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuID0gdGhpcy5wcm9wcy5pbmRleFBhdHRlcm47CiAgICAgICAgICAgICAgICBnZXRFbmFibGVkU2NyaXB0aW5nTGFuZ3VhZ2VzID0gbmV3IF9zY3JpcHRpbmdfbGFuZ3VhZ2VzLkdldEVuYWJsZWRTY3JpcHRpbmdMYW5ndWFnZXNQcm92aWRlcigkaHR0cCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDY7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RW5hYmxlZFNjcmlwdGluZ0xhbmd1YWdlcygpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBlbmFibGVkTGFuZ3MgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIHNjcmlwdGluZ0xhbmdzID0gKDAsIF9sb2Rhc2guaW50ZXJzZWN0aW9uKShlbmFibGVkTGFuZ3MsICgwLCBfbG9kYXNoLnVuaW9uKSh0aGlzLnN1cHBvcnRlZExhbmdzLCB0aGlzLmRlcHJlY2F0ZWRMYW5ncykpOwogICAgICAgICAgICAgICAgZmllbGQubGFuZyA9IHNjcmlwdGluZ0xhbmdzLmluY2x1ZGVzKGZpZWxkLmxhbmcpID8gZmllbGQubGFuZyA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIGZpZWxkVHlwZXMgPSAoMCwgX2xvZGFzaC5nZXQpKF9jb25zdGFudHMuRklFTERfVFlQRVNfQllfTEFORywgZmllbGQubGFuZywgX2NvbnN0YW50cy5ERUZBVUxUX0ZJRUxEX1RZUEVTKTsKICAgICAgICAgICAgICAgIGZpZWxkLnR5cGUgPSBmaWVsZFR5cGVzLmluY2x1ZGVzKGZpZWxkLnR5cGUpID8gZmllbGQudHlwZSA6IGZpZWxkVHlwZXNbMF07CiAgICAgICAgICAgICAgICBEZWZhdWx0RmllbGRGb3JtYXQgPSBfZmllbGRfZm9ybWF0cy5maWVsZEZvcm1hdHMuZ2V0RGVmYXVsdFR5cGUoZmllbGQudHlwZSwgZmllbGQuZXNUeXBlcyk7CiAgICAgICAgICAgICAgICBmaWVsZFR5cGVGb3JtYXRzID0gWygwLCBfbGliLmdldERlZmF1bHRGb3JtYXQpKERlZmF1bHRGaWVsZEZvcm1hdCldLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoX2ZpZWxkX2Zvcm1hdHMuZmllbGRGb3JtYXRzLmJ5RmllbGRUeXBlW2ZpZWxkLnR5cGVdKSk7CiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgaXNSZWFkeTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgaXNDcmVhdGluZzogIWluZGV4UGF0dGVybi5maWVsZHMuYnlOYW1lW2ZpZWxkLm5hbWVdLAogICAgICAgICAgICAgICAgICBpc0RlcHJlY2F0ZWRMYW5nOiB0aGlzLmRlcHJlY2F0ZWRMYW5ncy5pbmNsdWRlcyhmaWVsZC5sYW5nKSwKICAgICAgICAgICAgICAgICAgZXJyb3JzOiBbXSwKICAgICAgICAgICAgICAgICAgc2NyaXB0aW5nTGFuZ3M6IHNjcmlwdGluZ0xhbmdzLAogICAgICAgICAgICAgICAgICBmaWVsZFR5cGVzOiBmaWVsZFR5cGVzLAogICAgICAgICAgICAgICAgICBmaWVsZFR5cGVGb3JtYXRzOiBmaWVsZFR5cGVGb3JtYXRzLAogICAgICAgICAgICAgICAgICBmaWVsZEZvcm1hdElkOiAoMCwgX2xvZGFzaC5nZXQpKGluZGV4UGF0dGVybiwgWydmaWVsZEZvcm1hdE1hcCcsIGZpZWxkLm5hbWUsICd0eXBlJywgJ2lkJ10pLAogICAgICAgICAgICAgICAgICBmaWVsZEZvcm1hdFBhcmFtczogZmllbGQuZm9ybWF0LnBhcmFtcygpCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgcmV0dXJuIF9pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBpbml0OwogICAgfSgpCiAgfSwgewogICAga2V5OiAiaXNEdXBsaWNhdGVOYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc0R1cGxpY2F0ZU5hbWUoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTMgPSB0aGlzLnN0YXRlLAogICAgICAgICAgaXNDcmVhdGluZyA9IF90aGlzJHN0YXRlMy5pc0NyZWF0aW5nLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZTMuZmllbGQsCiAgICAgICAgICBleGlzdGluZ0ZpZWxkTmFtZXMgPSBfdGhpcyRzdGF0ZTMuZXhpc3RpbmdGaWVsZE5hbWVzOwogICAgICByZXR1cm4gaXNDcmVhdGluZyAmJiBleGlzdGluZ0ZpZWxkTmFtZXMuaW5jbHVkZXMoZmllbGQubmFtZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyTmFtZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyTmFtZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgX3RoaXMkc3RhdGU0ID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGlzQ3JlYXRpbmcgPSBfdGhpcyRzdGF0ZTQuaXNDcmVhdGluZywKICAgICAgICAgIGZpZWxkID0gX3RoaXMkc3RhdGU0LmZpZWxkOwogICAgICB2YXIgaW50bCA9IHRoaXMucHJvcHMuaW50bDsKICAgICAgdmFyIGlzSW52YWxpZCA9ICFmaWVsZC5uYW1lIHx8ICFmaWVsZC5uYW1lLnRyaW0oKTsKICAgICAgcmV0dXJuIGlzQ3JlYXRpbmcgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGxhYmVsOiBpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICdjb21tb24udWkuZmllbGRFZGl0b3IubmFtZUxhYmVsJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTmFtZScKICAgICAgICB9KSwKICAgICAgICBoZWxwVGV4dDogdGhpcy5pc0R1cGxpY2F0ZU5hbWUoKSA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSWNvbiwgewogICAgICAgICAgdHlwZTogImFsZXJ0IiwKICAgICAgICAgIGNvbG9yOiAid2FybmluZyIsCiAgICAgICAgICBzaXplOiAicyIKICAgICAgICB9KSwgIlx4QTAiLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3IubWFwcGluZ0NvbmZsaWN0TGFiZWwubWFwcGluZ0NvbmZsaWN0RGV0YWlsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAie21hcHBpbmdDb25mbGljdH0gWW91IGFscmVhZHkgaGF2ZSBhIGZpZWxkIHdpdGggdGhlIG5hbWUge2ZpZWxkTmFtZX0uIE5hbWluZyB5b3VyIHNjcmlwdGVkIGZpZWxkIHdpdGggdGhlIHNhbWUgbmFtZSBtZWFucyB5b3Ugd29uJ3QgYmUgYWJsZSB0byBxdWVyeSBib3RoIGZpZWxkcyBhdCB0aGUgc2FtZSB0aW1lLiIsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgbWFwcGluZ0NvbmZsaWN0OiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJzdHJvbmciLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgIGlkOiAiY29tbW9uLnVpLmZpZWxkRWRpdG9yLm1hcHBpbmdDb25mbGljdExhYmVsLm1hcHBpbmdDb25mbGljdExhYmVsIiwKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIk1hcHBpbmcgQ29uZmxpY3Q6IgogICAgICAgICAgICB9KSksCiAgICAgICAgICAgIGZpZWxkTmFtZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNvZGUsIG51bGwsIGZpZWxkLm5hbWUpCiAgICAgICAgICB9CiAgICAgICAgfSkpIDogbnVsbCwKICAgICAgICBpc0ludmFsaWQ6IGlzSW52YWxpZCwKICAgICAgICBlcnJvcjogaXNJbnZhbGlkID8gaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAnY29tbW9uLnVpLmZpZWxkRWRpdG9yLm5hbWVFcnJvck1lc3NhZ2UnLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdOYW1lIGlzIHJlcXVpcmVkJwogICAgICAgIH0pIDogbnVsbAogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmllbGRUZXh0LCB7CiAgICAgICAgdmFsdWU6IGZpZWxkLm5hbWUgfHwgJycsCiAgICAgICAgcGxhY2Vob2xkZXI6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ2NvbW1vbi51aS5maWVsZEVkaXRvci5uYW1lUGxhY2Vob2xkZXInLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdOZXcgc2NyaXB0ZWQgZmllbGQnCiAgICAgICAgfSksCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImVkaXRvckZpZWxkTmFtZSIsCiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHsKICAgICAgICAgIF90aGlzMi5vbkZpZWxkQ2hhbmdlKCduYW1lJywgZS50YXJnZXQudmFsdWUpOwogICAgICAgIH0sCiAgICAgICAgaXNJbnZhbGlkOiBpc0ludmFsaWQKICAgICAgfSkpIDogbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJMYW5ndWFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyTGFuZ3VhZ2UoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdmFyIF90aGlzJHN0YXRlNSA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBmaWVsZCA9IF90aGlzJHN0YXRlNS5maWVsZCwKICAgICAgICAgIHNjcmlwdGluZ0xhbmdzID0gX3RoaXMkc3RhdGU1LnNjcmlwdGluZ0xhbmdzLAogICAgICAgICAgaXNEZXByZWNhdGVkTGFuZyA9IF90aGlzJHN0YXRlNS5pc0RlcHJlY2F0ZWRMYW5nOwogICAgICB2YXIgaW50bCA9IHRoaXMucHJvcHMuaW50bDsKICAgICAgcmV0dXJuIGZpZWxkLnNjcmlwdGVkID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBsYWJlbDogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAnY29tbW9uLnVpLmZpZWxkRWRpdG9yLmxhbmd1YWdlTGFiZWwnLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdMYW5ndWFnZScKICAgICAgICB9KSwKICAgICAgICBoZWxwVGV4dDogaXNEZXByZWNhdGVkTGFuZyA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSWNvbiwgewogICAgICAgICAgdHlwZTogImFsZXJ0IiwKICAgICAgICAgIGNvbG9yOiAid2FybmluZyIsCiAgICAgICAgICBzaXplOiAicyIKICAgICAgICB9KSwgIlx4QTAiLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJzdHJvbmciLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3Iud2FybmluZ0hlYWRlciIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRlcHJlY2F0aW9uIFdhcm5pbmc6IgogICAgICAgIH0pKSwgIlx4QTAiLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3Iud2FybmluZ0xhYmVsLndhcm5pbmdEZXRhaWwiLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJ7bGFuZ3VhZ2V9IGlzIGRlcHJlY2F0ZWQgYW5kIHN1cHBvcnQgd2lsbCBiZSByZW1vdmVkIGluIHRoZSBuZXh0IG1ham9yIHZlcnNpb24gb2YgS2liYW5hIGFuZCBFbGFzdGljc2VhcmNoLiBXZSByZWNvbW1lbmQgdXNpbmcge3BhaW5sZXNzTGlua30gZm9yIG5ldyBzY3JpcHRlZCBmaWVsZHMuIiwKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBsYW5ndWFnZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNvZGUsIG51bGwsIGZpZWxkLmxhbmcpLAogICAgICAgICAgICBwYWlubGVzc0xpbms6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlMaW5rLCB7CiAgICAgICAgICAgICAgdGFyZ2V0OiAiX2JsYW5rIiwKICAgICAgICAgICAgICBocmVmOiAoMCwgX2RvY3VtZW50YXRpb25fbGlua3MuZ2V0RG9jTGluaykoJ3NjcmlwdGVkRmllbGRzLnBhaW5sZXNzJykKICAgICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci53YXJuaW5nTGFiZWwucGFpbmxlc3NMaW5rTGFiZWwiLAogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUGFpbmxlc3MiCiAgICAgICAgICAgIH0pKQogICAgICAgICAgfQogICAgICAgIH0pKSA6IG51bGwKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNlbGVjdCwgewogICAgICAgIHZhbHVlOiBmaWVsZC5sYW5nLAogICAgICAgIG9wdGlvbnM6IHNjcmlwdGluZ0xhbmdzLm1hcChmdW5jdGlvbiAobGFuZykgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdmFsdWU6IGxhbmcsCiAgICAgICAgICAgIHRleHQ6IGxhbmcKICAgICAgICAgIH07CiAgICAgICAgfSksCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImVkaXRvckZpZWxkTGFuZyIsCiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHsKICAgICAgICAgIF90aGlzMy5vbkxhbmdDaGFuZ2UoZS50YXJnZXQudmFsdWUpOwogICAgICAgIH0KICAgICAgfSkpIDogbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJUeXBlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJUeXBlKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHZhciBfdGhpcyRzdGF0ZTYgPSB0aGlzLnN0YXRlLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZTYuZmllbGQsCiAgICAgICAgICBmaWVsZFR5cGVzID0gX3RoaXMkc3RhdGU2LmZpZWxkVHlwZXM7CiAgICAgIHZhciBpbnRsID0gdGhpcy5wcm9wcy5pbnRsOwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBsYWJlbDogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAnY29tbW9uLnVpLmZpZWxkRWRpdG9yLnR5cGVMYWJlbCcsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1R5cGUnCiAgICAgICAgfSkKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNlbGVjdCwgewogICAgICAgIHZhbHVlOiBmaWVsZC50eXBlLAogICAgICAgIGRpc2FibGVkOiAhZmllbGQuc2NyaXB0ZWQsCiAgICAgICAgb3B0aW9uczogZmllbGRUeXBlcy5tYXAoZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHZhbHVlOiB0eXBlLAogICAgICAgICAgICB0ZXh0OiB0eXBlCiAgICAgICAgICB9OwogICAgICAgIH0pLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJlZGl0b3JGaWVsZFR5cGUiLAogICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7CiAgICAgICAgICBfdGhpczQub25UeXBlQ2hhbmdlKGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICB9CiAgICAgIH0pKTsKICAgIH0KICAgIC8qKgogICAgICogcmVuZGVycyBhIHdhcm5pbmcgYW5kIGEgdGFibGUgb2YgY29uZmxpY3RpbmcgaW5kaWNlcwogICAgICogaW4gY2FzZSB0aGVyZSBhcmUgaW5kaWNlcyB3aXRoIGRpZmZlcmVudCB0eXBlcwogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbmRlclR5cGVDb25mbGljdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyVHlwZUNvbmZsaWN0KCkgewogICAgICB2YXIgaW50bCA9IHRoaXMucHJvcHMuaW50bDsKICAgICAgdmFyIF90aGlzJHN0YXRlJGZpZWxkID0gdGhpcy5zdGF0ZS5maWVsZCwKICAgICAgICAgIGZpZWxkID0gX3RoaXMkc3RhdGUkZmllbGQgPT09IHZvaWQgMCA/IHt9IDogX3RoaXMkc3RhdGUkZmllbGQ7CgogICAgICBpZiAoIWZpZWxkLmNvbmZsaWN0RGVzY3JpcHRpb25zIHx8IF90eXBlb2YoZmllbGQuY29uZmxpY3REZXNjcmlwdGlvbnMpICE9PSAnb2JqZWN0JykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB2YXIgY29sdW1ucyA9IFt7CiAgICAgICAgZmllbGQ6ICd0eXBlJywKICAgICAgICBuYW1lOiBpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICdjb21tb24udWkuZmllbGRFZGl0b3IudHlwZUxhYmVsJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVHlwZScKICAgICAgICB9KSwKICAgICAgICB3aWR0aDogJzEwMHB4JwogICAgICB9LCB7CiAgICAgICAgZmllbGQ6ICdpbmRpY2VzJywKICAgICAgICBuYW1lOiBpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICdjb21tb24udWkuZmllbGRFZGl0b3IuaW5kZXhOYW1lTGFiZWwnLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdJbmRleCBuYW1lcycKICAgICAgICB9KQogICAgICB9XTsKICAgICAgdmFyIGl0ZW1zID0gT2JqZWN0LmVudHJpZXMoZmllbGQuY29uZmxpY3REZXNjcmlwdGlvbnMpLm1hcChmdW5jdGlvbiAoX3JlZjIpIHsKICAgICAgICB2YXIgX3JlZjMgPSBfc2xpY2VkVG9BcnJheShfcmVmMiwgMiksCiAgICAgICAgICAgIHR5cGUgPSBfcmVmM1swXSwKICAgICAgICAgICAgaW5kaWNlcyA9IF9yZWYzWzFdOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICAgIGluZGljZXM6IEFycmF5LmlzQXJyYXkoaW5kaWNlcykgPyBpbmRpY2VzLmpvaW4oJywgJykgOiAnSW5kZXggbmFtZXMgdW5hdmFpbGFibGUnCiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ2FsbE91dCwgewogICAgICAgIGNvbG9yOiAid2FybmluZyIsCiAgICAgICAgaWNvblR5cGU6ICJhbGVydCIsCiAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5maWVsZFR5cGVDb25mbGljdCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkZpZWxkIHR5cGUgY29uZmxpY3QiCiAgICAgICAgfSksCiAgICAgICAgc2l6ZTogInMiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3IubXVsdGlUeXBlTGFiZWxEZXNjIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlRoZSB0eXBlIG9mIHRoaXMgZmllbGQgY2hhbmdlcyBhY3Jvc3MgaW5kaWNlcy4gSXQgaXMgdW5hdmFpbGFibGUgZm9yIG1hbnkgYW5hbHlzaXMgZnVuY3Rpb25zLiBUaGUgaW5kaWNlcyBwZXIgdHlwZSBhcmUgYXMgZm9sbG93czoiCiAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJtIgogICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJhc2ljVGFibGUsIHsKICAgICAgICBpdGVtczogaXRlbXMsCiAgICAgICAgY29sdW1uczogY29sdW1ucwogICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJtIgogICAgICB9KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyRm9ybWF0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJGb3JtYXQoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdmFyIF90aGlzJHN0YXRlNyA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBmaWVsZCA9IF90aGlzJHN0YXRlNy5maWVsZCwKICAgICAgICAgIGZpZWxkVHlwZUZvcm1hdHMgPSBfdGhpcyRzdGF0ZTcuZmllbGRUeXBlRm9ybWF0cywKICAgICAgICAgIGZpZWxkRm9ybWF0SWQgPSBfdGhpcyRzdGF0ZTcuZmllbGRGb3JtYXRJZCwKICAgICAgICAgIGZpZWxkRm9ybWF0UGFyYW1zID0gX3RoaXMkc3RhdGU3LmZpZWxkRm9ybWF0UGFyYW1zOwogICAgICB2YXIgZmllbGRGb3JtYXRFZGl0b3JzID0gdGhpcy5wcm9wcy5oZWxwZXJzLmZpZWxkRm9ybWF0RWRpdG9yczsKICAgICAgdmFyIGRlZmF1bHRGb3JtYXQgPSBmaWVsZFR5cGVGb3JtYXRzWzBdICYmIGZpZWxkVHlwZUZvcm1hdHNbMF0ucmVzb2x2ZWRUaXRsZTsKICAgICAgdmFyIGxhYmVsID0gZGVmYXVsdEZvcm1hdCA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3IuZGVmYXVsdEZvcm1hdEhlYWRlciIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJGb3JtYXQgKERlZmF1bHQ6IHtkZWZhdWx0Rm9ybWF0fSkiLAogICAgICAgIHZhbHVlczogewogICAgICAgICAgZGVmYXVsdEZvcm1hdDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNvZGUsIG51bGwsIGRlZmF1bHRGb3JtYXQpCiAgICAgICAgfQogICAgICB9KSA6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3IuZm9ybWF0SGVhZGVyIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkZvcm1hdCIKICAgICAgfSk7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBsYWJlbDogbGFiZWwsCiAgICAgICAgaGVscFRleHQ6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5mb3JtYXRMYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkZvcm1hdHRpbmcgYWxsb3dzIHlvdSB0byBjb250cm9sIHRoZSB3YXkgdGhhdCBzcGVjaWZpYyB2YWx1ZXMgYXJlIGRpc3BsYXllZC4gSXQgY2FuIGFsc28gY2F1c2UgdmFsdWVzIHRvIGJlIGNvbXBsZXRlbHkgY2hhbmdlZCBhbmQgcHJldmVudCBoaWdobGlnaHRpbmcgaW4gRGlzY292ZXIgZnJvbSB3b3JraW5nLiIKICAgICAgICB9KQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU2VsZWN0LCB7CiAgICAgICAgdmFsdWU6IGZpZWxkRm9ybWF0SWQsCiAgICAgICAgb3B0aW9uczogZmllbGRUeXBlRm9ybWF0cy5tYXAoZnVuY3Rpb24gKGZvcm1hdCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdmFsdWU6IGZvcm1hdC5pZCB8fCAnJywKICAgICAgICAgICAgdGV4dDogZm9ybWF0LnRpdGxlCiAgICAgICAgICB9OwogICAgICAgIH0pLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJlZGl0b3JTZWxlY3RlZEZvcm1hdElkIiwKICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICAgICAgX3RoaXM1Lm9uRm9ybWF0Q2hhbmdlKGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICB9CiAgICAgIH0pKSwgZmllbGRGb3JtYXRJZCA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2ZpZWxkX2Zvcm1hdF9lZGl0b3IuRmllbGRGb3JtYXRFZGl0b3IsIHsKICAgICAgICBmaWVsZFR5cGU6IGZpZWxkLnR5cGUsCiAgICAgICAgZmllbGRGb3JtYXQ6IGZpZWxkLmZvcm1hdCwKICAgICAgICBmaWVsZEZvcm1hdElkOiBmaWVsZEZvcm1hdElkLAogICAgICAgIGZpZWxkRm9ybWF0UGFyYW1zOiBmaWVsZEZvcm1hdFBhcmFtcywKICAgICAgICBmaWVsZEZvcm1hdEVkaXRvcnM6IGZpZWxkRm9ybWF0RWRpdG9ycywKICAgICAgICBvbkNoYW5nZTogdGhpcy5vbkZvcm1hdFBhcmFtc0NoYW5nZSwKICAgICAgICBvbkVycm9yOiB0aGlzLm9uRm9ybWF0UGFyYW1zRXJyb3IKICAgICAgfSkgOiBudWxsKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJQb3B1bGFyaXR5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJQb3B1bGFyaXR5KCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHZhciBmaWVsZCA9IHRoaXMuc3RhdGUuZmllbGQ7CiAgICAgIHZhciBpbnRsID0gdGhpcy5wcm9wcy5pbnRsOwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBsYWJlbDogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAnY29tbW9uLnVpLmZpZWxkRWRpdG9yLnBvcHVsYXJpdHlMYWJlbCcsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1BvcHVsYXJpdHknLAogICAgICAgICAgZGVzY3JpcHRpb246ICciUG9wdWxhcml0eSIgcmVmZXJzIHRvIEtpYmFuYVwncyBtZWFzdXJlbWVudCBob3cgcG9wdWxhciBhIGZpZWxkIGlzIChpLmUuIGhvdyBjb21tb25seSBpdCBpcyB1c2VkKS4nCiAgICAgICAgfSkKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZpZWxkTnVtYmVyLCB7CiAgICAgICAgdmFsdWU6IGZpZWxkLmNvdW50LAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJlZGl0b3JGaWVsZENvdW50IiwKICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICAgICAgX3RoaXM2Lm9uRmllbGRDaGFuZ2UoJ2NvdW50JywgZS50YXJnZXQudmFsdWUgPyBOdW1iZXIoZS50YXJnZXQudmFsdWUpIDogJycpOwogICAgICAgIH0KICAgICAgfSkpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlclNjcmlwdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyU2NyaXB0KCkgewogICAgICB2YXIgX3RoaXMkc3RhdGU4ID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGZpZWxkID0gX3RoaXMkc3RhdGU4LmZpZWxkLAogICAgICAgICAgaGFzU2NyaXB0RXJyb3IgPSBfdGhpcyRzdGF0ZTguaGFzU2NyaXB0RXJyb3I7CiAgICAgIHZhciBpbnRsID0gdGhpcy5wcm9wcy5pbnRsOwogICAgICB2YXIgaXNJbnZhbGlkID0gIWZpZWxkLnNjcmlwdCB8fCAhZmllbGQuc2NyaXB0LnRyaW0oKSB8fCBoYXNTY3JpcHRFcnJvcjsKICAgICAgdmFyIGVycm9yTXNnID0gaGFzU2NyaXB0RXJyb3IgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgewogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJpbnZhbGlkU2NyaXB0RXJyb3IiCiAgICAgIH0sIGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgaWQ6ICdjb21tb24udWkuZmllbGRFZGl0b3Iuc2NyaXB0SW52YWxpZEVycm9yTWVzc2FnZScsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTY3JpcHQgaXMgaW52YWxpZC4gVmlldyBzY3JpcHQgcHJldmlldyBmb3IgZGV0YWlscycKICAgICAgfSkpIDogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICBpZDogJ2NvbW1vbi51aS5maWVsZEVkaXRvci5zY3JpcHRSZXF1aXJlZEVycm9yTWVzc2FnZScsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTY3JpcHQgaXMgcmVxdWlyZWQnCiAgICAgIH0pOwogICAgICByZXR1cm4gZmllbGQuc2NyaXB0ZWQgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBmdWxsV2lkdGg6IHRydWUsCiAgICAgICAgbGFiZWw6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ2NvbW1vbi51aS5maWVsZEVkaXRvci5zY3JpcHRMYWJlbCcsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1NjcmlwdCcKICAgICAgICB9KSwKICAgICAgICBpc0ludmFsaWQ6IGlzSW52YWxpZCwKICAgICAgICBlcnJvcjogaXNJbnZhbGlkID8gZXJyb3JNc2cgOiBudWxsCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb2RlRWRpdG9yLCB7CiAgICAgICAgdmFsdWU6IGZpZWxkLnNjcmlwdCwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiZWRpdG9yRmllbGRTY3JpcHQiLAogICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uU2NyaXB0Q2hhbmdlLAogICAgICAgIG1vZGU6ICJncm9vdnkiLAogICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgaGVpZ2h0OiAiMzAwcHgiCiAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGV4dCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5zY3JpcHQuYWNjZXNzV2l0aExhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkFjY2VzcyBmaWVsZHMgd2l0aCB7Y29kZX0uIiwKICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgIGNvZGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImNvZGUiLCBudWxsLCAiZG9jWydzb21lX2ZpZWxkJ10udmFsdWUiKQogICAgICAgIH0KICAgICAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJiciIsIG51bGwpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTGluaywgewogICAgICAgIG9uQ2xpY2s6IHRoaXMuc2hvd1NjcmlwdGluZ0hlbHAsCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInNjcmlwdGVkRmllbGRzSGVscExpbmsiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3Iuc2NyaXB0LmdldEhlbHBMYWJlbCIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJHZXQgaGVscCB3aXRoIHRoZSBzeW50YXggYW5kIHByZXZpZXcgdGhlIHJlc3VsdHMgb2YgeW91ciBzY3JpcHQuIgogICAgICB9KSkpKSkgOiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckFjdGlvbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckFjdGlvbnMoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTkgPSB0aGlzLnN0YXRlLAogICAgICAgICAgaXNDcmVhdGluZyA9IF90aGlzJHN0YXRlOS5pc0NyZWF0aW5nLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZTkuZmllbGQsCiAgICAgICAgICBpc1NhdmluZyA9IF90aGlzJHN0YXRlOS5pc1NhdmluZzsKICAgICAgdmFyIHJlZGlyZWN0QXdheSA9IHRoaXMucHJvcHMuaGVscGVycy5yZWRpcmVjdEF3YXk7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbiwgewogICAgICAgIGZpbGw6IHRydWUsCiAgICAgICAgb25DbGljazogdGhpcy5zYXZlRmllbGQsCiAgICAgICAgaXNEaXNhYmxlZDogdGhpcy5pc1NhdmluZ0Rpc2FibGVkKCksCiAgICAgICAgaXNMb2FkaW5nOiBpc1NhdmluZywKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiZmllbGRTYXZlQnV0dG9uIgogICAgICB9LCBpc0NyZWF0aW5nID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5hY3Rpb25zLmNyZWF0ZUJ1dHRvbiIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDcmVhdGUgZmllbGQiCiAgICAgIH0pIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5hY3Rpb25zLnNhdmVCdXR0b24iLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2F2ZSBmaWVsZCIKICAgICAgfSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbkVtcHR5LCB7CiAgICAgICAgb25DbGljazogcmVkaXJlY3RBd2F5LAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJmaWVsZENhbmNlbEJ1dHRvbiIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5hY3Rpb25zLmNhbmNlbEJ1dHRvbiIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDYW5jZWwiCiAgICAgIH0pKSksICFpc0NyZWF0aW5nICYmIGZpZWxkLnNjcmlwdGVkID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgICAganVzdGlmeUNvbnRlbnQ6ICJmbGV4RW5kIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiBmYWxzZQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uRW1wdHksIHsKICAgICAgICBjb2xvcjogImRhbmdlciIsCiAgICAgICAgb25DbGljazogdGhpcy5zaG93RGVsZXRlTW9kYWwKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5hY3Rpb25zLmRlbGV0ZUJ1dHRvbiIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJEZWxldGUiCiAgICAgIH0pKSkpKSA6IG51bGwpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc1NhdmluZ0Rpc2FibGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc1NhdmluZ0Rpc2FibGVkKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUxMCA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBmaWVsZCA9IF90aGlzJHN0YXRlMTAuZmllbGQsCiAgICAgICAgICBoYXNGb3JtYXRFcnJvciA9IF90aGlzJHN0YXRlMTAuaGFzRm9ybWF0RXJyb3IsCiAgICAgICAgICBoYXNTY3JpcHRFcnJvciA9IF90aGlzJHN0YXRlMTAuaGFzU2NyaXB0RXJyb3I7CgogICAgICBpZiAoaGFzRm9ybWF0RXJyb3IgfHwgaGFzU2NyaXB0RXJyb3IgfHwgIWZpZWxkLm5hbWUgfHwgIWZpZWxkLm5hbWUudHJpbSgpIHx8IGZpZWxkLnNjcmlwdGVkICYmICghZmllbGQuc2NyaXB0IHx8ICFmaWVsZC5zY3JpcHQudHJpbSgpKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTExID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGlzUmVhZHkgPSBfdGhpcyRzdGF0ZTExLmlzUmVhZHksCiAgICAgICAgICBpc0NyZWF0aW5nID0gX3RoaXMkc3RhdGUxMS5pc0NyZWF0aW5nLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZTExLmZpZWxkOwogICAgICByZXR1cm4gaXNSZWFkeSA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUZXh0LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJoMyIsIG51bGwsIGlzQ3JlYXRpbmcgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAiY29tbW9uLnVpLmZpZWxkRWRpdG9yLmNyZWF0ZUhlYWRlciIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDcmVhdGUgc2NyaXB0ZWQgZmllbGQiCiAgICAgIH0pIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5lZGl0SGVhZGVyIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkVkaXQge2ZpZWxkTmFtZX0iLAogICAgICAgIHZhbHVlczogewogICAgICAgICAgZmllbGROYW1lOiBmaWVsZC5uYW1lCiAgICAgICAgfQogICAgICB9KSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybSwgbnVsbCwgdGhpcy5yZW5kZXJTY3JpcHRpbmdQYW5lbHMoKSwgdGhpcy5yZW5kZXJOYW1lKCksIHRoaXMucmVuZGVyTGFuZ3VhZ2UoKSwgdGhpcy5yZW5kZXJUeXBlKCksIHRoaXMucmVuZGVyVHlwZUNvbmZsaWN0KCksIHRoaXMucmVuZGVyRm9ybWF0KCksIHRoaXMucmVuZGVyUG9wdWxhcml0eSgpLCB0aGlzLnJlbmRlclNjcmlwdCgpLCB0aGlzLnJlbmRlckFjdGlvbnMoKSwgdGhpcy5yZW5kZXJEZWxldGVNb2RhbCgpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJsIgogICAgICB9KSkgOiBudWxsOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEZpZWxkRWRpdG9yQ29tcG9uZW50Owp9KF9yZWFjdC5QdXJlQ29tcG9uZW50KTsKCmV4cG9ydHMuRmllbGRFZGl0b3JDb21wb25lbnQgPSBGaWVsZEVkaXRvckNvbXBvbmVudDsKCl9kZWZpbmVQcm9wZXJ0eShGaWVsZEVkaXRvckNvbXBvbmVudCwgInByb3BUeXBlcyIsIHsKICBpbmRleFBhdHRlcm46IF9wcm9wVHlwZXMuZGVmYXVsdC5vYmplY3QuaXNSZXF1aXJlZCwKICBmaWVsZDogX3Byb3BUeXBlcy5kZWZhdWx0Lm9iamVjdC5pc1JlcXVpcmVkLAogIGhlbHBlcnM6IF9wcm9wVHlwZXMuZGVmYXVsdC5zaGFwZSh7CiAgICBGaWVsZDogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCwKICAgIGdldENvbmZpZzogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCwKICAgICRodHRwOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYy5pc1JlcXVpcmVkLAogICAgZmllbGRGb3JtYXRFZGl0b3JzOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LmlzUmVxdWlyZWQsCiAgICByZWRpcmVjdEF3YXk6IF9wcm9wVHlwZXMuZGVmYXVsdC5mdW5jLmlzUmVxdWlyZWQKICB9KQp9KTsKCnZhciBGaWVsZEVkaXRvciA9ICgwLCBfcmVhY3QyLmluamVjdEkxOG4pKEZpZWxkRWRpdG9yQ29tcG9uZW50KTsKZXhwb3J0cy5GaWVsZEVkaXRvciA9IEZpZWxkRWRpdG9yOw=="},null]}