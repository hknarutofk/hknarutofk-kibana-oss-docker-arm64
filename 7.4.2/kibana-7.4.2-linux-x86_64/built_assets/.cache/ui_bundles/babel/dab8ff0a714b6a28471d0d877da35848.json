{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/ui/public/saved_objects/saved_object.js","dependencies":[{"path":"src/legacy/ui/public/saved_objects/saved_object.js","mtime":1572296412904},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1572297165884},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1572297178034},{"path":"node_modules/babel-loader/lib/index.js","mtime":1572297165764}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlNhdmVkT2JqZWN0UHJvdmlkZXIgPSBTYXZlZE9iamVjdFByb3ZpZGVyOwoKdmFyIF9hbmd1bGFyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJhbmd1bGFyIikpOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfZXJyb3JzID0gcmVxdWlyZSgiLi4vZXJyb3JzIik7Cgp2YXIgX21hcHBpbmdfc2V0dXAgPSByZXF1aXJlKCIuLi91dGlscy9tYXBwaW5nX3NldHVwIik7Cgp2YXIgX3NlYXJjaF9zb3VyY2UgPSByZXF1aXJlKCIuLi9jb3VyaWVyL3NlYXJjaF9zb3VyY2UiKTsKCnZhciBfZmluZF9vYmplY3RfYnlfdGl0bGUgPSByZXF1aXJlKCIuL2ZpbmRfb2JqZWN0X2J5X3RpdGxlIik7Cgp2YXIgX3NhdmVkX29iamVjdHNfY2xpZW50X3Byb3ZpZGVyID0gcmVxdWlyZSgiLi9zYXZlZF9vYmplY3RzX2NsaWVudF9wcm92aWRlciIpOwoKdmFyIF9taWdyYXRlX2xlZ2FjeV9xdWVyeSA9IHJlcXVpcmUoIi4uL3V0aWxzL21pZ3JhdGVfbGVnYWN5X3F1ZXJ5Iik7Cgp2YXIgX3BlcnNpc3RlZF9sb2cgPSByZXF1aXJlKCIuLi9wZXJzaXN0ZWRfbG9nIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCi8qKgogKiBBbiBlcnJvciBtZXNzYWdlIHRvIGJlIHVzZWQgd2hlbiB0aGUgdXNlciByZWplY3RzIGEgY29uZmlybSBvdmVyd3JpdGUuCiAqIEB0eXBlIHtzdHJpbmd9CiAqLwp2YXIgT1ZFUldSSVRFX1JFSkVDVEVEID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5zYXZlZE9iamVjdHMub3ZlcndyaXRlUmVqZWN0ZWREZXNjcmlwdGlvbicsIHsKICBkZWZhdWx0TWVzc2FnZTogJ092ZXJ3cml0ZSBjb25maXJtYXRpb24gd2FzIHJlamVjdGVkJwp9KTsKLyoqCiAqIEFuIGVycm9yIG1lc3NhZ2UgdG8gYmUgdXNlZCB3aGVuIHRoZSB1c2VyIHJlamVjdHMgYSBjb25maXJtIHNhdmUgd2l0aCBkdXBsaWNhdGUgdGl0bGUuCiAqIEB0eXBlIHtzdHJpbmd9CiAqLwoKCnZhciBTQVZFX0RVUExJQ0FURV9SRUpFQ1RFRCA9IF9pMThuLmkxOG4udHJhbnNsYXRlKCdjb21tb24udWkuc2F2ZWRPYmplY3RzLnNhdmVEdXBsaWNhdGVSZWplY3RlZERlc2NyaXB0aW9uJywgewogIGRlZmF1bHRNZXNzYWdlOiAnU2F2ZSB3aXRoIGR1cGxpY2F0ZSB0aXRsZSBjb25maXJtYXRpb24gd2FzIHJlamVjdGVkJwp9KTsKLyoqCiAqIEBwYXJhbSBlcnJvciB7RXJyb3J9IHRoZSBlcnJvcgogKiBAcmV0dXJuIHtib29sZWFufQogKi8KCgpmdW5jdGlvbiBpc0Vycm9yTm9uRmF0YWwoZXJyb3IpIHsKICBpZiAoIWVycm9yKSByZXR1cm4gZmFsc2U7CiAgcmV0dXJuIGVycm9yLm1lc3NhZ2UgPT09IE9WRVJXUklURV9SRUpFQ1RFRCB8fCBlcnJvci5tZXNzYWdlID09PSBTQVZFX0RVUExJQ0FURV9SRUpFQ1RFRDsKfQoKZnVuY3Rpb24gU2F2ZWRPYmplY3RQcm92aWRlcihQcm9taXNlLCBQcml2YXRlLCBjb25maXJtTW9kYWxQcm9taXNlLCBpbmRleFBhdHRlcm5zKSB7CiAgdmFyIHNhdmVkT2JqZWN0c0NsaWVudCA9IFByaXZhdGUoX3NhdmVkX29iamVjdHNfY2xpZW50X3Byb3ZpZGVyLlNhdmVkT2JqZWN0c0NsaWVudFByb3ZpZGVyKTsKICB2YXIgU2VhcmNoU291cmNlID0gUHJpdmF0ZShfc2VhcmNoX3NvdXJjZS5TZWFyY2hTb3VyY2VQcm92aWRlcik7CiAgLyoqCiAgICogVGhlIFNhdmVkT2JqZWN0IGNsYXNzIGlzIGEgYmFzZSBjbGFzcyBmb3Igc2F2ZWQgb2JqZWN0cyBsb2FkZWQgZnJvbSB0aGUgc2VydmVyIGFuZAogICAqIHByb3ZpZGVzIGFkZGl0aW9uYWwgZnVuY3Rpb25hbGl0eSBiZXNpZGVzIGxvYWRpbmcvc2F2aW5nL2RlbGV0aW5nL2V0Yy4KICAgKgogICAqIEl0IGlzIG92ZXJsb2FkZWQgYW5kIGNvbmZpZ3VyZWQgdG8gcHJvdmlkZSB0eXBlLWF3YXJlIGZ1bmN0aW9uYWxpdHkuCiAgICogVG8ganVzdCByZXRyaWV2ZSB0aGUgYXR0cmlidXRlcyBvZiBzYXZlZCBvYmplY3RzLCBpdCBpcyByZWNvbW1lbmRlZCB0byB1c2UgU2F2ZWRPYmplY3RMb2FkZXIKICAgKiB3aGljaCByZXR1cm5zIGluc3RhbmNlcyBvZiBTaW1wbGVTYXZlZE9iamVjdCB3aGljaCBkb24ndCBpbnRyb2R1Y2UgYWRkaXRpb25hbCB0eXBlLXNwZWNpZmljIGNvbXBsZXhpdHkuCiAgICogQHBhcmFtIHsqfSBjb25maWcKICAgKi8KCiAgZnVuY3Rpb24gU2F2ZWRPYmplY3QoY29uZmlnKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIGlmICghX2xvZGFzaC5kZWZhdWx0LmlzT2JqZWN0KGNvbmZpZykpIGNvbmZpZyA9IHt9OwogICAgLyoqKioqKioqKioqKgogICAgICogSW5pdGlhbGl6ZSBjb25maWcgdmFycwogICAgICoqKioqKioqKioqKi8KICAgIC8vIHR5cGUgbmFtZSBmb3IgdGhpcyBvYmplY3QsIHVzZWQgYXMgdGhlIEVTLXR5cGUKCiAgICB2YXIgZXNUeXBlID0gY29uZmlnLnR5cGU7CgogICAgdGhpcy5nZXREaXNwbGF5TmFtZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGVzVHlwZTsKICAgIH07IC8vIE5PVEU6IHRoaXMudHlwZSAobm90IHNldCBpbiB0aGlzIGZpbGUsIGJ1dCBzb21ld2hlcmUgZWxzZSkgaXMgdGhlIHN1YiB0eXBlLCBlLmcuICdhcmVhJyBvcgogICAgLy8gJ2RhdGEgdGFibGUnLCB3aGlsZSBlc1R5cGUgaXMgdGhlIG1vcmUgZ2VuZXJpYyB0eXBlIC0gZS5nLiAndmlzdWFsaXphdGlvbicgb3IgJ3NhdmVkIHNlYXJjaCcuCgoKICAgIHRoaXMuZ2V0RXNUeXBlID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gZXNUeXBlOwogICAgfTsKICAgIC8qKgogICAgICogRmxpcHMgdG8gdHJ1ZSBkdXJpbmcgYSBzYXZlIG9wZXJhdGlvbiwgYW5kIGJhY2sgdG8gZmFsc2Ugb25jZSB0aGUgc2F2ZSBvcGVyYXRpb24KICAgICAqIGNvbXBsZXRlcy4KICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICovCgoKICAgIHRoaXMuaXNTYXZpbmcgPSBmYWxzZTsKICAgIHRoaXMuZGVmYXVsdHMgPSBjb25maWcuZGVmYXVsdHMgfHwge307IC8vIG1hcHBpbmcgZGVmaW5pdGlvbiBmb3IgdGhlIGZpZWxkcyB0aGF0IHRoaXMgb2JqZWN0IHdpbGwgZXhwb3NlCgogICAgdmFyIG1hcHBpbmcgPSAoMCwgX21hcHBpbmdfc2V0dXAuZXhwYW5kU2hvcnRoYW5kKShjb25maWcubWFwcGluZyk7CiAgICB2YXIgYWZ0ZXJFU1Jlc3AgPSBjb25maWcuYWZ0ZXJFU1Jlc3AgfHwgX2xvZGFzaC5kZWZhdWx0Lm5vb3A7CiAgICB2YXIgY3VzdG9tSW5pdCA9IGNvbmZpZy5pbml0IHx8IF9sb2Rhc2guZGVmYXVsdC5ub29wOwogICAgdmFyIGV4dHJhY3RSZWZlcmVuY2VzID0gY29uZmlnLmV4dHJhY3RSZWZlcmVuY2VzOwogICAgdmFyIGluamVjdFJlZmVyZW5jZXMgPSBjb25maWcuaW5qZWN0UmVmZXJlbmNlczsgLy8gb3B0aW9uYWwgc2VhcmNoIHNvdXJjZSB3aGljaCB0aGlzIG9iamVjdCBjb25maWd1cmVzCgogICAgdGhpcy5zZWFyY2hTb3VyY2UgPSBjb25maWcuc2VhcmNoU291cmNlID8gbmV3IFNlYXJjaFNvdXJjZSgpIDogdW5kZWZpbmVkOyAvLyB0aGUgaWQgb2YgdGhlIGRvY3VtZW50CgogICAgdGhpcy5pZCA9IGNvbmZpZy5pZCB8fCB2b2lkIDA7IC8vIHRoZSBtaWdyYXRpb24gdmVyc2lvbiBvZiB0aGUgZG9jdW1lbnQsIHNob3VsZCBvbmx5IGJlIHNldCBvbiBpbXBvcnRzCgogICAgdGhpcy5taWdyYXRpb25WZXJzaW9uID0gY29uZmlnLm1pZ3JhdGlvblZlcnNpb247IC8vIFdoZXRoZXIgdG8gY3JlYXRlIGEgY29weSB3aGVuIHRoZSBvYmplY3QgaXMgc2F2ZWQuIFRoaXMgc2hvdWxkIGV2ZW50dWFsbHkgZ28gYXdheQogICAgLy8gaW4gZmF2b3Igb2YgYSBiZXR0ZXIgcmVuYW1lL3NhdmUgZmxvdy4KCiAgICB0aGlzLmNvcHlPblNhdmUgPSBmYWxzZTsKCiAgICB2YXIgcGFyc2VTZWFyY2hTb3VyY2UgPSBmdW5jdGlvbiBwYXJzZVNlYXJjaFNvdXJjZShzZWFyY2hTb3VyY2VKc29uLCByZWZlcmVuY2VzKSB7CiAgICAgIGlmICghX3RoaXMuc2VhcmNoU291cmNlKSByZXR1cm47IC8vIGlmIHdlIGhhdmUgYSBzZWFyY2hTb3VyY2UsIHNldCBpdHMgdmFsdWVzIGJhc2VkIG9uIHRoZSBzZWFyY2hTb3VyY2VKc29uIGZpZWxkCgogICAgICB2YXIgc2VhcmNoU291cmNlVmFsdWVzOwoKICAgICAgdHJ5IHsKICAgICAgICBzZWFyY2hTb3VyY2VWYWx1ZXMgPSBKU09OLnBhcnNlKHNlYXJjaFNvdXJjZUpzb24pOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgdGhyb3cgbmV3IF9lcnJvcnMuSW52YWxpZEpTT05Qcm9wZXJ0eSgiSW52YWxpZCBKU09OIGluICIuY29uY2F0KGVzVHlwZSwgIiBcIiIpLmNvbmNhdChfdGhpcy5pZCwgIlwiLiAiKS5jb25jYXQoZS5tZXNzYWdlLCAiIEpTT046ICIpLmNvbmNhdChzZWFyY2hTb3VyY2VKc29uKSk7CiAgICAgIH0gLy8gVGhpcyBkZXRlY3RzIGEgc2NlbmFyaW8gd2hlcmUgZG9jdW1lbnRzIHdpdGggaW52YWxpZCBKU09OIHByb3BlcnRpZXMgaGF2ZSBiZWVuIGltcG9ydGVkIGludG8gdGhlIHNhdmVkIG9iamVjdCBpbmRleC4KICAgICAgLy8gKFRoaXMgaGFwcGVuZWQgaW4gaXNzdWUgIzIwMzA4KQoKCiAgICAgIGlmICghc2VhcmNoU291cmNlVmFsdWVzIHx8IF90eXBlb2Yoc2VhcmNoU291cmNlVmFsdWVzKSAhPT0gJ29iamVjdCcpIHsKICAgICAgICB0aHJvdyBuZXcgX2Vycm9ycy5JbnZhbGlkSlNPTlByb3BlcnR5KCJJbnZhbGlkIHNlYXJjaFNvdXJjZUpTT04gaW4gIi5jb25jYXQoZXNUeXBlLCAiIFwiIikuY29uY2F0KF90aGlzLmlkLCAiXCIuIikpOwogICAgICB9IC8vIEluamVjdCBpbmRleCBpZCBpZiBhIHJlZmVyZW5jZSBpcyBzYXZlZAoKCiAgICAgIGlmIChzZWFyY2hTb3VyY2VWYWx1ZXMuaW5kZXhSZWZOYW1lKSB7CiAgICAgICAgdmFyIHJlZmVyZW5jZSA9IHJlZmVyZW5jZXMuZmluZChmdW5jdGlvbiAocmVmZXJlbmNlKSB7CiAgICAgICAgICByZXR1cm4gcmVmZXJlbmNlLm5hbWUgPT09IHNlYXJjaFNvdXJjZVZhbHVlcy5pbmRleFJlZk5hbWU7CiAgICAgICAgfSk7CgogICAgICAgIGlmICghcmVmZXJlbmNlKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNvdWxkIG5vdCBmaW5kIHJlZmVyZW5jZSBmb3IgIi5jb25jYXQoc2VhcmNoU291cmNlVmFsdWVzLmluZGV4UmVmTmFtZSwgIiBvbiAiKS5jb25jYXQoX3RoaXMuZ2V0RXNUeXBlKCksICIgIikuY29uY2F0KF90aGlzLmlkKSk7CiAgICAgICAgfQoKICAgICAgICBzZWFyY2hTb3VyY2VWYWx1ZXMuaW5kZXggPSByZWZlcmVuY2UuaWQ7CiAgICAgICAgZGVsZXRlIHNlYXJjaFNvdXJjZVZhbHVlcy5pbmRleFJlZk5hbWU7CiAgICAgIH0KCiAgICAgIGlmIChzZWFyY2hTb3VyY2VWYWx1ZXMuZmlsdGVyKSB7CiAgICAgICAgc2VhcmNoU291cmNlVmFsdWVzLmZpbHRlci5mb3JFYWNoKGZ1bmN0aW9uIChmaWx0ZXJSb3cpIHsKICAgICAgICAgIGlmICghZmlsdGVyUm93Lm1ldGEgfHwgIWZpbHRlclJvdy5tZXRhLmluZGV4UmVmTmFtZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJlZmVyZW5jZSA9IHJlZmVyZW5jZXMuZmluZChmdW5jdGlvbiAocmVmZXJlbmNlKSB7CiAgICAgICAgICAgIHJldHVybiByZWZlcmVuY2UubmFtZSA9PT0gZmlsdGVyUm93Lm1ldGEuaW5kZXhSZWZOYW1lOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKCFyZWZlcmVuY2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDb3VsZCBub3QgZmluZCByZWZlcmVuY2UgZm9yICIuY29uY2F0KGZpbHRlclJvdy5tZXRhLmluZGV4UmVmTmFtZSwgIiBvbiAiKS5jb25jYXQoX3RoaXMuZ2V0RXNUeXBlKCkpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmaWx0ZXJSb3cubWV0YS5pbmRleCA9IHJlZmVyZW5jZS5pZDsKICAgICAgICAgIGRlbGV0ZSBmaWx0ZXJSb3cubWV0YS5pbmRleFJlZk5hbWU7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciBzZWFyY2hTb3VyY2VGaWVsZHMgPSBfdGhpcy5zZWFyY2hTb3VyY2UuZ2V0RmllbGRzKCk7CgogICAgICB2YXIgZm5Qcm9wcyA9IF9sb2Rhc2guZGVmYXVsdC50cmFuc2Zvcm0oc2VhcmNoU291cmNlRmllbGRzLCBmdW5jdGlvbiAoZHluYW1pYywgdmFsLCBuYW1lKSB7CiAgICAgICAgaWYgKF9sb2Rhc2guZGVmYXVsdC5pc0Z1bmN0aW9uKHZhbCkpIGR5bmFtaWNbbmFtZV0gPSB2YWw7CiAgICAgIH0sIHt9KTsKCiAgICAgIF90aGlzLnNlYXJjaFNvdXJjZS5zZXRGaWVsZHMoX2xvZGFzaC5kZWZhdWx0LmRlZmF1bHRzKHNlYXJjaFNvdXJjZVZhbHVlcywgZm5Qcm9wcykpOwoKICAgICAgaWYgKCFfbG9kYXNoLmRlZmF1bHQuaXNVbmRlZmluZWQoX3RoaXMuc2VhcmNoU291cmNlLmdldE93bkZpZWxkKCdxdWVyeScpKSkgewogICAgICAgIF90aGlzLnNlYXJjaFNvdXJjZS5zZXRGaWVsZCgncXVlcnknLCAoMCwgX21pZ3JhdGVfbGVnYWN5X3F1ZXJ5Lm1pZ3JhdGVMZWdhY3lRdWVyeSkoX3RoaXMuc2VhcmNoU291cmNlLmdldE93bkZpZWxkKCdxdWVyeScpKSk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEFmdGVyIGNyZWF0aW9uIG9yIGZldGNoaW5nIGZyb20gRVMsIGVuc3VyZSB0aGF0IHRoZSBzZWFyY2hTb3VyY2VzIGluZGV4IGluZGV4UGF0dGVybgogICAgICogaXMgYW4gYm9uYWZpZGUgSW5kZXhQYXR0ZXJuIG9iamVjdC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPEluZGV4UGF0dGVybiB8IG51bGw+fQogICAgICovCgoKICAgIHRoaXMuaHlkcmF0ZUluZGV4UGF0dGVybiA9IGZ1bmN0aW9uIChpZCkgewogICAgICBpZiAoIV90aGlzLnNlYXJjaFNvdXJjZSkgewogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7CiAgICAgIH0KCiAgICAgIGlmIChjb25maWcuY2xlYXJTYXZlZEluZGV4UGF0dGVybikgewogICAgICAgIF90aGlzLnNlYXJjaFNvdXJjZS5zZXRGaWVsZCgnaW5kZXgnLCBudWxsKTsKCiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTsKICAgICAgfQoKICAgICAgdmFyIGluZGV4ID0gaWQgfHwgY29uZmlnLmluZGV4UGF0dGVybiB8fCBfdGhpcy5zZWFyY2hTb3VyY2UuZ2V0T3duRmllbGQoJ2luZGV4Jyk7CgogICAgICBpZiAoIWluZGV4KSB7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTsKICAgICAgfSAvLyBJZiBpbmRleCBpcyBub3QgYW4gSW5kZXhQYXR0ZXJuIG9iamVjdCBhdCB0aGlzIHBvaW50LCB0aGVuIGl0J3MgYSBzdHJpbmcgaWQgb2YgYW4gaW5kZXguCgoKICAgICAgaWYgKHR5cGVvZiBpbmRleCA9PT0gJ3N0cmluZycpIHsKICAgICAgICBpbmRleCA9IGluZGV4UGF0dGVybnMuZ2V0KGluZGV4KTsKICAgICAgfSAvLyBBdCB0aGlzIHBvaW50IGluZGV4IHdpbGwgZWl0aGVyIGJlIGFuIEluZGV4UGF0dGVybiwgaWYgY2FjaGVkLCBvciBhIHByb21pc2UgdGhhdAogICAgICAvLyB3aWxsIHJldHVybiBhbiBJbmRleFBhdHRlcm4sIGlmIG5vdCBjYWNoZWQuCgoKICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShpbmRleCkudGhlbihmdW5jdGlvbiAoaW5kZXhQYXR0ZXJuKSB7CiAgICAgICAgX3RoaXMuc2VhcmNoU291cmNlLnNldEZpZWxkKCdpbmRleCcsIGluZGV4UGF0dGVybik7CiAgICAgIH0pOwogICAgfTsKICAgIC8qKgogICAgICogQXN5bmNocm9ub3VzbHkgaW5pdGlhbGl6ZSB0aGlzIG9iamVjdCAtIHdpbGwgb25seSBydW4KICAgICAqIG9uY2UgZXZlbiBpZiBjYWxsZWQgbXVsdGlwbGUgdGltZXMuCiAgICAgKgogICAgICogQHJldHVybiB7UHJvbWlzZX0KICAgICAqIEByZXNvbHZlZCB7U2F2ZWRPYmplY3R9CiAgICAgKi8KCgogICAgdGhpcy5pbml0ID0gX2xvZGFzaC5kZWZhdWx0Lm9uY2UoZnVuY3Rpb24gKCkgewogICAgICAvLyBlbnN1cmUgdGhhdCB0aGUgZXNUeXBlIGlzIGRlZmluZWQKICAgICAgaWYgKCFlc1R5cGUpIHRocm93IG5ldyBFcnJvcignWW91IG11c3QgZGVmaW5lIGEgdHlwZSBuYW1lIHRvIHVzZSBTYXZlZE9iamVjdCBvYmplY3RzLicpOwogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm90IGlkLCB0aGVuIHRoZXJlIGlzIG5vIGRvY3VtZW50IHRvIGZldGNoIGZyb20gZWxhc3RpY3NlYXJjaAogICAgICAgIGlmICghX3RoaXMuaWQpIHsKICAgICAgICAgIC8vIGp1c3QgYXNzaWduIHRoZSBkZWZhdWx0cyBhbmQgYmUgZG9uZQogICAgICAgICAgX2xvZGFzaC5kZWZhdWx0LmFzc2lnbihfdGhpcywgX3RoaXMuZGVmYXVsdHMpOwoKICAgICAgICAgIHJldHVybiBfdGhpcy5oeWRyYXRlSW5kZXhQYXR0ZXJuKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBhZnRlckVTUmVzcC5jYWxsKF90aGlzKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gLy8gZmV0Y2ggdGhlIG9iamVjdCBmcm9tIEVTCgoKICAgICAgICByZXR1cm4gc2F2ZWRPYmplY3RzQ2xpZW50LmdldChlc1R5cGUsIF90aGlzLmlkKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgICAvLyB0ZW1wb3JhcnkgY29tcGF0YWJpbGl0eSBmb3Igc2F2ZWRPYmplY3RzQ2xpZW50CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBfaWQ6IHJlc3AuaWQsCiAgICAgICAgICAgIF90eXBlOiByZXNwLnR5cGUsCiAgICAgICAgICAgIF9zb3VyY2U6IF9sb2Rhc2guZGVmYXVsdC5jbG9uZURlZXAocmVzcC5hdHRyaWJ1dGVzKSwKICAgICAgICAgICAgcmVmZXJlbmNlczogcmVzcC5yZWZlcmVuY2VzLAogICAgICAgICAgICBmb3VuZDogcmVzcC5fdmVyc2lvbiA/IHRydWUgOiBmYWxzZQogICAgICAgICAgfTsKICAgICAgICB9KS50aGVuKF90aGlzLmFwcGx5RVNSZXNwKS5jYXRjaChfdGhpcy5hcHBseUVzUmVzcCk7CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBjdXN0b21Jbml0LmNhbGwoX3RoaXMpOwogICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgIH0pOwogICAgfSk7CgogICAgdGhpcy5hcHBseUVTUmVzcCA9IGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgIF90aGlzLl9zb3VyY2UgPSBfbG9kYXNoLmRlZmF1bHQuY2xvbmVEZWVwKHJlc3AuX3NvdXJjZSk7CgogICAgICBpZiAocmVzcC5mb3VuZCAhPSBudWxsICYmICFyZXNwLmZvdW5kKSB7CiAgICAgICAgdGhyb3cgbmV3IF9lcnJvcnMuU2F2ZWRPYmplY3ROb3RGb3VuZChlc1R5cGUsIF90aGlzLmlkKTsKICAgICAgfQoKICAgICAgdmFyIG1ldGEgPSByZXNwLl9zb3VyY2Uua2liYW5hU2F2ZWRPYmplY3RNZXRhIHx8IHt9OwogICAgICBkZWxldGUgcmVzcC5fc291cmNlLmtpYmFuYVNhdmVkT2JqZWN0TWV0YTsKCiAgICAgIGlmICghY29uZmlnLmluZGV4UGF0dGVybiAmJiBfdGhpcy5fc291cmNlLmluZGV4UGF0dGVybikgewogICAgICAgIGNvbmZpZy5pbmRleFBhdHRlcm4gPSBfdGhpcy5fc291cmNlLmluZGV4UGF0dGVybjsKICAgICAgICBkZWxldGUgX3RoaXMuX3NvdXJjZS5pbmRleFBhdHRlcm47CiAgICAgIH0gLy8gYXNzaWduIHRoZSBkZWZhdWx0cyB0byB0aGUgcmVzcG9uc2UKCgogICAgICBfbG9kYXNoLmRlZmF1bHQuZGVmYXVsdHMoX3RoaXMuX3NvdXJjZSwgX3RoaXMuZGVmYXVsdHMpOyAvLyB0cmFuc2Zvcm0gdGhlIHNvdXJjZSB1c2luZyBfZGVzZXJpYWxpemVycwoKCiAgICAgIF9sb2Rhc2guZGVmYXVsdC5mb3JPd24obWFwcGluZywgZnVuY3Rpb24gKGZpZWxkTWFwcGluZywgZmllbGROYW1lKSB7CiAgICAgICAgaWYgKGZpZWxkTWFwcGluZy5fZGVzZXJpYWxpemUpIHsKICAgICAgICAgIF90aGlzLl9zb3VyY2VbZmllbGROYW1lXSA9IGZpZWxkTWFwcGluZy5fZGVzZXJpYWxpemUoX3RoaXMuX3NvdXJjZVtmaWVsZE5hbWVdLCByZXNwLCBmaWVsZE5hbWUsIGZpZWxkTWFwcGluZyk7CiAgICAgICAgfQogICAgICB9KTsgLy8gR2l2ZSBvYmogYWxsIG9mIHRoZSB2YWx1ZXMgaW4gX3NvdXJjZS5maWVsZHMKCgogICAgICBfbG9kYXNoLmRlZmF1bHQuYXNzaWduKF90aGlzLCBfdGhpcy5fc291cmNlKTsKCiAgICAgIF90aGlzLmxhc3RTYXZlZFRpdGxlID0gX3RoaXMudGl0bGU7CiAgICAgIHJldHVybiBQcm9taXNlLnRyeShmdW5jdGlvbiAoKSB7CiAgICAgICAgcGFyc2VTZWFyY2hTb3VyY2UobWV0YS5zZWFyY2hTb3VyY2VKU09OLCByZXNwLnJlZmVyZW5jZXMpOwogICAgICAgIHJldHVybiBfdGhpcy5oeWRyYXRlSW5kZXhQYXR0ZXJuKCk7CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChpbmplY3RSZWZlcmVuY2VzICYmIHJlc3AucmVmZXJlbmNlcyAmJiByZXNwLnJlZmVyZW5jZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgaW5qZWN0UmVmZXJlbmNlcyhfdGhpcywgcmVzcC5yZWZlcmVuY2VzKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfdGhpczsKICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIFByb21pc2UuY2FzdChhZnRlckVTUmVzcC5jYWxsKF90aGlzLCByZXNwKSk7CiAgICAgIH0pOwogICAgfTsKICAgIC8qKgogICAgICogU2VyaWFsaXplIHRoaXMgb2JqZWN0CiAgICAgKgogICAgICogQHJldHVybiB7T2JqZWN0fQogICAgICovCgoKICAgIHRoaXMuX3NlcmlhbGl6ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGF0dHJpYnV0ZXMgPSB7fTsKICAgICAgdmFyIHJlZmVyZW5jZXMgPSBbXTsKCiAgICAgIF9sb2Rhc2guZGVmYXVsdC5mb3JPd24obWFwcGluZywgZnVuY3Rpb24gKGZpZWxkTWFwcGluZywgZmllbGROYW1lKSB7CiAgICAgICAgaWYgKF90aGlzW2ZpZWxkTmFtZV0gIT0gbnVsbCkgewogICAgICAgICAgYXR0cmlidXRlc1tmaWVsZE5hbWVdID0gZmllbGRNYXBwaW5nLl9zZXJpYWxpemUgPyBmaWVsZE1hcHBpbmcuX3NlcmlhbGl6ZShfdGhpc1tmaWVsZE5hbWVdKSA6IF90aGlzW2ZpZWxkTmFtZV07CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGlmIChfdGhpcy5zZWFyY2hTb3VyY2UpIHsKICAgICAgICB2YXIgc2VhcmNoU291cmNlRmllbGRzID0gX2xvZGFzaC5kZWZhdWx0Lm9taXQoX3RoaXMuc2VhcmNoU291cmNlLmdldEZpZWxkcygpLCBbJ3NvcnQnLCAnc2l6ZSddKTsKCiAgICAgICAgaWYgKHNlYXJjaFNvdXJjZUZpZWxkcy5pbmRleCkgewogICAgICAgICAgLy8gc2VhcmNoU291cmNlRmllbGRzLmluZGV4IHdpbGwgbm9ybWFsbHkgYmUgYW4gSW5kZXhQYXR0ZXJuLCBidXQgY2FuIGJlIGEgc3RyaW5nIGluIHR3byBzY2VuYXJpb3M6CiAgICAgICAgICAvLyAoMSkgYGluaXQoKWAgKGFuZCBieSBleHRlbnNpb24gYGh5ZHJhdGVJbmRleFBhdHRlcm4oKWApIGhhc24ndCBiZWVuIGNhbGxlZCBvbiB0aGlzIFNhdmVkIE9iamVjdAogICAgICAgICAgLy8gKDIpIFRoZSBJbmRleFBhdHRlcm4gZG9lc24ndCBleGlzdCwgc28gd2UgZmFpbCB0byByZXNvbHZlIGl0IGluIGBoeWRyYXRlSW5kZXhQYXR0ZXJuKClgCiAgICAgICAgICB2YXIgaW5kZXhJZCA9IHR5cGVvZiBzZWFyY2hTb3VyY2VGaWVsZHMuaW5kZXggPT09ICdzdHJpbmcnID8gc2VhcmNoU291cmNlRmllbGRzLmluZGV4IDogc2VhcmNoU291cmNlRmllbGRzLmluZGV4LmlkOwogICAgICAgICAgdmFyIHJlZk5hbWUgPSAna2liYW5hU2F2ZWRPYmplY3RNZXRhLnNlYXJjaFNvdXJjZUpTT04uaW5kZXgnOwogICAgICAgICAgcmVmZXJlbmNlcy5wdXNoKHsKICAgICAgICAgICAgbmFtZTogcmVmTmFtZSwKICAgICAgICAgICAgdHlwZTogJ2luZGV4LXBhdHRlcm4nLAogICAgICAgICAgICBpZDogaW5kZXhJZAogICAgICAgICAgfSk7CiAgICAgICAgICBzZWFyY2hTb3VyY2VGaWVsZHMgPSBfb2JqZWN0U3ByZWFkKHt9LCBzZWFyY2hTb3VyY2VGaWVsZHMsIHsKICAgICAgICAgICAgaW5kZXhSZWZOYW1lOiByZWZOYW1lLAogICAgICAgICAgICBpbmRleDogdW5kZWZpbmVkCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChzZWFyY2hTb3VyY2VGaWVsZHMuZmlsdGVyKSB7CiAgICAgICAgICBzZWFyY2hTb3VyY2VGaWVsZHMgPSBfb2JqZWN0U3ByZWFkKHt9LCBzZWFyY2hTb3VyY2VGaWVsZHMsIHsKICAgICAgICAgICAgZmlsdGVyOiBzZWFyY2hTb3VyY2VGaWVsZHMuZmlsdGVyLm1hcChmdW5jdGlvbiAoZmlsdGVyUm93LCBpKSB7CiAgICAgICAgICAgICAgaWYgKCFmaWx0ZXJSb3cubWV0YSB8fCAhZmlsdGVyUm93Lm1ldGEuaW5kZXgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmaWx0ZXJSb3c7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgcmVmTmFtZSA9ICJraWJhbmFTYXZlZE9iamVjdE1ldGEuc2VhcmNoU291cmNlSlNPTi5maWx0ZXJbIi5jb25jYXQoaSwgIl0ubWV0YS5pbmRleCIpOwogICAgICAgICAgICAgIHJlZmVyZW5jZXMucHVzaCh7CiAgICAgICAgICAgICAgICBuYW1lOiByZWZOYW1lLAogICAgICAgICAgICAgICAgdHlwZTogJ2luZGV4LXBhdHRlcm4nLAogICAgICAgICAgICAgICAgaWQ6IGZpbHRlclJvdy5tZXRhLmluZGV4CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIGZpbHRlclJvdywgewogICAgICAgICAgICAgICAgbWV0YTogX29iamVjdFNwcmVhZCh7fSwgZmlsdGVyUm93Lm1ldGEsIHsKICAgICAgICAgICAgICAgICAgaW5kZXhSZWZOYW1lOiByZWZOYW1lLAogICAgICAgICAgICAgICAgICBpbmRleDogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBhdHRyaWJ1dGVzLmtpYmFuYVNhdmVkT2JqZWN0TWV0YSA9IHsKICAgICAgICAgIHNlYXJjaFNvdXJjZUpTT046IF9hbmd1bGFyLmRlZmF1bHQudG9Kc29uKHNlYXJjaFNvdXJjZUZpZWxkcykKICAgICAgICB9OwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGF0dHJpYnV0ZXM6IGF0dHJpYnV0ZXMsCiAgICAgICAgcmVmZXJlbmNlczogcmVmZXJlbmNlcwogICAgICB9OwogICAgfTsKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBvYmplY3QncyBvcmlnaW5hbCB0aXRsZSBoYXMgYmVlbiBjaGFuZ2VkLiBOZXcgb2JqZWN0cyByZXR1cm4gZmFsc2UuCiAgICAgKiBAcmV0dXJuIHtib29sZWFufQogICAgICovCgoKICAgIHRoaXMuaXNUaXRsZUNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfdGhpcy5fc291cmNlICYmIF90aGlzLl9zb3VyY2UudGl0bGUgIT09IF90aGlzLnRpdGxlOwogICAgfTsKCiAgICB0aGlzLmNyZWF0aW9uT3B0cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7CiAgICAgICAgaWQ6IF90aGlzLmlkLAogICAgICAgIG1pZ3JhdGlvblZlcnNpb246IF90aGlzLm1pZ3JhdGlvblZlcnNpb24KICAgICAgfSwgb3B0cyk7CiAgICB9OwogICAgLyoqCiAgICAgKiBBdHRlbXB0cyB0byBjcmVhdGUgdGhlIGN1cnJlbnQgb2JqZWN0IHVzaW5nIHRoZSBzZXJpYWxpemVkIHNvdXJjZS4gSWYgYW4gb2JqZWN0IGFscmVhZHkKICAgICAqIGV4aXN0cywgYSB3YXJuaW5nIG1lc3NhZ2UgcmVxdWVzdHMgYW4gb3ZlcndyaXRlIGNvbmZpcm1hdGlvbi4KICAgICAqIEBwYXJhbSBzb3VyY2UgLSBzZXJpYWxpemVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QgKHJldHVybiB2YWx1ZSBmcm9tIHRoaXMuX3NlcmlhbGl6ZSgpKQogICAgICogV2hhdCB3aWxsIGJlIGluZGV4ZWQgaW50byBlbGFzdGljc2VhcmNoLgogICAgICogQHBhcmFtIG9wdGlvbnMgLSBvcHRpb25zIHRvIHBhc3MgdG8gdGhlIHNhdmVkIG9iamVjdCBjcmVhdGUgbWV0aG9kCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gLSBBIHByb21pc2UgdGhhdCBpcyByZXNvbHZlZCB3aXRoIHRoZSBvYmplY3RzIGlkIGlmIHRoZSBvYmplY3QgaXMKICAgICAqIHN1Y2Nlc3NmdWxseSBpbmRleGVkLiBJZiB0aGUgb3ZlcndyaXRlIGNvbmZpcm1hdGlvbiB3YXMgcmVqZWN0ZWQsIGFuIGVycm9yIGlzIHRocm93biB3aXRoCiAgICAgKiBhIGNvbmZpcm1SZWplY3RlZCA9IHRydWUgcGFyYW1ldGVyIHNvIHRoYXQgY2FzZSBjYW4gYmUgaGFuZGxlZCBkaWZmZXJlbnRseSB0aGFuCiAgICAgKiBhIGNyZWF0ZSBvciBpbmRleCBlcnJvci4KICAgICAqIEByZXNvbHZlZCB7U2F2ZWRPYmplY3R9CiAgICAgKi8KCgogICAgdmFyIGNyZWF0ZVNvdXJjZSA9IGZ1bmN0aW9uIGNyZWF0ZVNvdXJjZShzb3VyY2UpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICByZXR1cm4gc2F2ZWRPYmplY3RzQ2xpZW50LmNyZWF0ZShlc1R5cGUsIHNvdXJjZSwgb3B0aW9ucykuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgIC8vIHJlY29yZCBleGlzdHMsIGNvbmZpcm0gb3ZlcndyaXRpbmcKICAgICAgICBpZiAoX2xvZGFzaC5kZWZhdWx0LmdldChlcnIsICdyZXMuc3RhdHVzJykgPT09IDQwOSkgewogICAgICAgICAgdmFyIGNvbmZpcm1NZXNzYWdlID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5zYXZlZE9iamVjdHMuY29uZmlybU1vZGFsLm92ZXJ3cml0ZUNvbmZpcm1hdGlvbk1lc3NhZ2UnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIG92ZXJ3cml0ZSB7dGl0bGV9PycsCiAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgIHRpdGxlOiBfdGhpcy50aXRsZQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm4gY29uZmlybU1vZGFsUHJvbWlzZShjb25maXJtTWVzc2FnZSwgewogICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5zYXZlZE9iamVjdHMuY29uZmlybU1vZGFsLm92ZXJ3cml0ZUJ1dHRvbkxhYmVsJywgewogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnT3ZlcndyaXRlJwogICAgICAgICAgICB9KSwKICAgICAgICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdjb21tb24udWkuc2F2ZWRPYmplY3RzLmNvbmZpcm1Nb2RhbC5vdmVyd3JpdGVUaXRsZScsIHsKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ092ZXJ3cml0ZSB7bmFtZX0/JywKICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgIG5hbWU6IF90aGlzLmdldERpc3BsYXlOYW1lKCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHNhdmVkT2JqZWN0c0NsaWVudC5jcmVhdGUoZXNUeXBlLCBzb3VyY2UsIF90aGlzLmNyZWF0aW9uT3B0cyhfb2JqZWN0U3ByZWFkKHsKICAgICAgICAgICAgICBvdmVyd3JpdGU6IHRydWUKICAgICAgICAgICAgfSwgb3B0aW9ucykpKTsKICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihPVkVSV1JJVEVfUkVKRUNURUQpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7CiAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgZGlzcGxheUR1cGxpY2F0ZVRpdGxlQ29uZmlybU1vZGFsID0gZnVuY3Rpb24gZGlzcGxheUR1cGxpY2F0ZVRpdGxlQ29uZmlybU1vZGFsKCkgewogICAgICB2YXIgY29uZmlybU1lc3NhZ2UgPSBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnY29tbW9uLnVpLnNhdmVkT2JqZWN0cy5jb25maXJtTW9kYWwuc2F2ZUR1cGxpY2F0ZUNvbmZpcm1hdGlvbk1lc3NhZ2UnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJBIHtuYW1lfSB3aXRoIHRoZSB0aXRsZSAne3RpdGxlfScgYWxyZWFkeSBleGlzdHMuIFdvdWxkIHlvdSBsaWtlIHRvIHNhdmUgYW55d2F5PyIsCiAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICB0aXRsZTogX3RoaXMudGl0bGUsCiAgICAgICAgICBuYW1lOiBfdGhpcy5nZXREaXNwbGF5TmFtZSgpCiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHJldHVybiBjb25maXJtTW9kYWxQcm9taXNlKGNvbmZpcm1NZXNzYWdlLCB7CiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdjb21tb24udWkuc2F2ZWRPYmplY3RzLmNvbmZpcm1Nb2RhbC5zYXZlRHVwbGljYXRlQnV0dG9uTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1NhdmUge25hbWV9JywKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBuYW1lOiBfdGhpcy5nZXREaXNwbGF5TmFtZSgpCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoU0FWRV9EVVBMSUNBVEVfUkVKRUNURUQpKTsKICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBjaGVja0ZvckR1cGxpY2F0ZVRpdGxlID0gZnVuY3Rpb24gY2hlY2tGb3JEdXBsaWNhdGVUaXRsZShpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkLCBvblRpdGxlRHVwbGljYXRlKSB7CiAgICAgIC8vIERvbid0IGNoZWNrIGZvciBkdXBsaWNhdGVzIGlmIHVzZXIgaGFzIGFscmVhZHkgY29uZmlybWVkIHNhdmUgd2l0aCBkdXBsaWNhdGUgdGl0bGUKICAgICAgaWYgKGlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQpIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgIH0gLy8gRG9uJ3QgY2hlY2sgaWYgdGhlIHVzZXIgaXNuJ3QgdXBkYXRpbmcgdGhlIHRpdGxlLCBvdGhlcndpc2UgdGhhdCB3b3VsZCBiZWNvbWUgdmVyeSBhbm5veWluZyB0byBoYXZlCiAgICAgIC8vIHRvIGNvbmZpcm0gdGhlIHNhdmUgZXZlcnkgdGltZSwgZXhjZXB0IHdoZW4gY29weU9uU2F2ZSBpcyB0cnVlLCB0aGVuIHdlIGRvIHdhbnQgdG8gY2hlY2suCgoKICAgICAgaWYgKF90aGlzLnRpdGxlID09PSBfdGhpcy5sYXN0U2F2ZWRUaXRsZSAmJiAhX3RoaXMuY29weU9uU2F2ZSkgewogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgfQoKICAgICAgcmV0dXJuICgwLCBfZmluZF9vYmplY3RfYnlfdGl0bGUuZmluZE9iamVjdEJ5VGl0bGUpKHNhdmVkT2JqZWN0c0NsaWVudCwgX3RoaXMuZ2V0RXNUeXBlKCksIF90aGlzLnRpdGxlKS50aGVuKGZ1bmN0aW9uIChkdXBsaWNhdGUpIHsKICAgICAgICBpZiAoIWR1cGxpY2F0ZSkgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKGR1cGxpY2F0ZS5pZCA9PT0gX3RoaXMuaWQpIHJldHVybiB0cnVlOwoKICAgICAgICBpZiAob25UaXRsZUR1cGxpY2F0ZSkgewogICAgICAgICAgb25UaXRsZUR1cGxpY2F0ZSgpOwogICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihTQVZFX0RVUExJQ0FURV9SRUpFQ1RFRCkpOwogICAgICAgIH0gLy8gVE9ETzogbWFrZSBvblRpdGxlRHVwbGljYXRlIGEgcmVxdWlyZWQgcHJvcCBhbmQgcmVtb3ZlIFVJIGNvbXBvbmVudHMgZnJvbSB0aGlzIGNsYXNzCiAgICAgICAgLy8gTmVlZCB0byBsZWF2ZSBoZXJlIHVudGlsIGFsbCB1c2VycyBwYXNzIG9uVGl0bGVEdXBsaWNhdGUuCgoKICAgICAgICByZXR1cm4gZGlzcGxheUR1cGxpY2F0ZVRpdGxlQ29uZmlybU1vZGFsKCk7CiAgICAgIH0pOwogICAgfTsKICAgIC8qKgogICAgICogU2F2ZXMgdGhpcyBvYmplY3QuCiAgICAgKgogICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zPXt9XQogICAgICogQHByb3BlcnR5IHtib29sZWFufSBbb3B0aW9ucy5jb25maXJtT3ZlcndyaXRlPWZhbHNlXSAtIElmIHRydWUsIGF0dGVtcHRzIHRvIGNyZWF0ZSB0aGUgc291cmNlIHNvIGl0CiAgICAgKiBjYW4gY29uZmlybSBhbiBvdmVyd3JpdGUgaWYgYSBkb2N1bWVudCB3aXRoIHRoZSBpZCBhbHJlYWR5IGV4aXN0cy4KICAgICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW29wdGlvbnMuaXNUaXRsZUR1cGxpY2F0ZUNvbmZpcm1lZD1mYWxzZV0gLSBJZiB0cnVlLCBzYXZlIGFsbG93ZWQgd2l0aCBkdXBsaWNhdGUgdGl0bGUKICAgICAqIEBwcm9wZXJ0eSB7ZnVuY30gW29wdGlvbnMub25UaXRsZUR1cGxpY2F0ZV0gLSBmdW5jdGlvbiBjYWxsZWQgaWYgZHVwbGljYXRlIHRpdGxlIGV4aXN0cy4KICAgICAqIFdoZW4gbm90IHByb3ZpZGVkLCBjb25maXJtIG1vZGFsIHdpbGwgYmUgZGlzcGxheWVkIGFza2luZyB1c2VyIHRvIGNvbmZpcm0gb3IgY2FuY2VsIHNhdmUuCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfQogICAgICogQHJlc29sdmVkIHtTdHJpbmd9IC0gVGhlIGlkIG9mIHRoZSBkb2MKICAgICAqLwoKCiAgICB0aGlzLnNhdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVmID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fSwKICAgICAgICAgIF9yZWYkY29uZmlybU92ZXJ3cml0ZSA9IF9yZWYuY29uZmlybU92ZXJ3cml0ZSwKICAgICAgICAgIGNvbmZpcm1PdmVyd3JpdGUgPSBfcmVmJGNvbmZpcm1PdmVyd3JpdGUgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZiRjb25maXJtT3ZlcndyaXRlLAogICAgICAgICAgX3JlZiRpc1RpdGxlRHVwbGljYXRlID0gX3JlZi5pc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkLAogICAgICAgICAgaXNUaXRsZUR1cGxpY2F0ZUNvbmZpcm1lZCA9IF9yZWYkaXNUaXRsZUR1cGxpY2F0ZSA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmJGlzVGl0bGVEdXBsaWNhdGUsCiAgICAgICAgICBvblRpdGxlRHVwbGljYXRlID0gX3JlZi5vblRpdGxlRHVwbGljYXRlOwoKICAgICAgLy8gU2F2ZSB0aGUgb3JpZ2luYWwgaWQgaW4gY2FzZSB0aGUgc2F2ZSBmYWlscy4KICAgICAgdmFyIG9yaWdpbmFsSWQgPSBfdGhpcy5pZDsgLy8gUmVhZCBodHRwczovL2dpdGh1Yi5jb20vZWxhc3RpYy9raWJhbmEvaXNzdWVzLzkwNTYgYW5kCiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGFzdGljL2tpYmFuYS9pc3N1ZXMvOTAxMiBmb3Igc29tZSBiYWNrZ3JvdW5kIGludG8gd2h5IHRoaXMgY29weU9uU2F2ZSB2YXJpYWJsZQogICAgICAvLyBleGlzdHMuCiAgICAgIC8vIFRoZSBnb2FsIGlzIHRvIG1vdmUgdG93YXJkcyBhIGJldHRlciByZW5hbWUgZmxvdywgYnV0IHNpbmNlIG91ciB1c2VycyBoYXZlIGJlZW4gY29uZGl0aW9uZWQKICAgICAgLy8gdG8gZXhwZWN0IGEgJ3NhdmUgYXMnIGZsb3cgZHVyaW5nIGEgcmVuYW1lLCB3ZSBhcmUga2VlcGluZyB0aGUgbG9naWMgdGhlIHNhbWUgdW50aWwgYSBiZXR0ZXIKICAgICAgLy8gVUkvVVggY2FuIGJlIHdvcmtlZCBvdXQuCgogICAgICBpZiAoX3RoaXMuY29weU9uU2F2ZSkgewogICAgICAgIF90aGlzLmlkID0gbnVsbDsKICAgICAgfSAvLyBIZXJlIHdlIHdhbnQgdG8gZXh0cmFjdCByZWZlcmVuY2VzIGFuZCBzZXQgdGhlbSB3aXRoaW4gInJlZmVyZW5jZXMiIGF0dHJpYnV0ZQoKCiAgICAgIHZhciBfdGhpcyRfc2VyaWFsaXplID0gX3RoaXMuX3NlcmlhbGl6ZSgpLAogICAgICAgICAgYXR0cmlidXRlcyA9IF90aGlzJF9zZXJpYWxpemUuYXR0cmlidXRlcywKICAgICAgICAgIHJlZmVyZW5jZXMgPSBfdGhpcyRfc2VyaWFsaXplLnJlZmVyZW5jZXM7CgogICAgICBpZiAoZXh0cmFjdFJlZmVyZW5jZXMpIHsKICAgICAgICB2YXIgX2V4dHJhY3RSZWZlcmVuY2VzID0gZXh0cmFjdFJlZmVyZW5jZXMoewogICAgICAgICAgYXR0cmlidXRlczogYXR0cmlidXRlcywKICAgICAgICAgIHJlZmVyZW5jZXM6IHJlZmVyZW5jZXMKICAgICAgICB9KTsKCiAgICAgICAgYXR0cmlidXRlcyA9IF9leHRyYWN0UmVmZXJlbmNlcy5hdHRyaWJ1dGVzOwogICAgICAgIHJlZmVyZW5jZXMgPSBfZXh0cmFjdFJlZmVyZW5jZXMucmVmZXJlbmNlczsKICAgICAgfQoKICAgICAgaWYgKCFyZWZlcmVuY2VzKSB0aHJvdyBuZXcgRXJyb3IoJ1JlZmVyZW5jZXMgbm90IHJldHVybmVkIGZyb20gZXh0cmFjdFJlZmVyZW5jZXMnKTsKICAgICAgX3RoaXMuaXNTYXZpbmcgPSB0cnVlOwogICAgICByZXR1cm4gY2hlY2tGb3JEdXBsaWNhdGVUaXRsZShpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkLCBvblRpdGxlRHVwbGljYXRlKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoY29uZmlybU92ZXJ3cml0ZSkgewogICAgICAgICAgcmV0dXJuIGNyZWF0ZVNvdXJjZShhdHRyaWJ1dGVzLCBfdGhpcy5jcmVhdGlvbk9wdHMoewogICAgICAgICAgICByZWZlcmVuY2VzOiByZWZlcmVuY2VzCiAgICAgICAgICB9KSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBzYXZlZE9iamVjdHNDbGllbnQuY3JlYXRlKGVzVHlwZSwgYXR0cmlidXRlcywgX3RoaXMuY3JlYXRpb25PcHRzKHsKICAgICAgICAgICAgcmVmZXJlbmNlczogcmVmZXJlbmNlcywKICAgICAgICAgICAgb3ZlcndyaXRlOiB0cnVlCiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgX3RoaXMuaWQgPSByZXNwLmlkOwogICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoX3RoaXMuc2hvd0luUmVjZW50bHlBY2Nlc3NlZCAmJiBfdGhpcy5nZXRGdWxsUGF0aCkgewogICAgICAgICAgX3BlcnNpc3RlZF9sb2cucmVjZW50bHlBY2Nlc3NlZC5hZGQoX3RoaXMuZ2V0RnVsbFBhdGgoKSwgX3RoaXMudGl0bGUsIF90aGlzLmlkKTsKICAgICAgICB9CgogICAgICAgIF90aGlzLmlzU2F2aW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXMubGFzdFNhdmVkVGl0bGUgPSBfdGhpcy50aXRsZTsKICAgICAgICByZXR1cm4gX3RoaXMuaWQ7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBfdGhpcy5pc1NhdmluZyA9IGZhbHNlOwogICAgICAgIF90aGlzLmlkID0gb3JpZ2luYWxJZDsKCiAgICAgICAgaWYgKGlzRXJyb3JOb25GYXRhbChlcnIpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTsKICAgICAgfSk7CiAgICB9OwoKICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKF90aGlzLnNlYXJjaFNvdXJjZSkgewogICAgICAgIF90aGlzLnNlYXJjaFNvdXJjZS5jYW5jZWxRdWV1ZWQoKTsKICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogRGVsZXRlIHRoaXMgb2JqZWN0IGZyb20gRWxhc3RpY3NlYXJjaAogICAgICogQHJldHVybiB7cHJvbWlzZX0KICAgICAqLwoKCiAgICB0aGlzLmRlbGV0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHNhdmVkT2JqZWN0c0NsaWVudC5kZWxldGUoZXNUeXBlLCBfdGhpcy5pZCk7CiAgICB9OwogIH0KCiAgcmV0dXJuIFNhdmVkT2JqZWN0Owp9"},null]}