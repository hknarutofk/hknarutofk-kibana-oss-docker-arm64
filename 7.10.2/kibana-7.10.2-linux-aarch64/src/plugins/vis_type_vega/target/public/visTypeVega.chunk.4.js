(window["visTypeVega_bundle_jsonpfunction"]=window["visTypeVega_bundle_jsonpfunction"]||[]).push([[4],{69:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"VegaMapView",(function(){return vega_map_view_VegaMapView}));var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var vega=__webpack_require__(52);var vega_base_view=__webpack_require__(53);var public_=__webpack_require__(50);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var VegaMapLayer=function(_KibanaMapLayer){_inherits(VegaMapLayer,_KibanaMapLayer);var _super=_createSuper(VegaMapLayer);function VegaMapLayer(spec,options,leaflet){var _this;_classCallCheck(this,VegaMapLayer);_this=_super.call(this);_this._attribution=options.attribution;delete options.attribution;_this._leafletLayer=leaflet.vega(spec,options);return _this}_createClass(VegaMapLayer,[{key:"getVegaView",value:function getVegaView(){return this._leafletLayer._view}},{key:"getVegaSpec",value:function getVegaSpec(){return this._leafletLayer._spec}}]);return VegaMapLayer}(public_["KibanaMapLayer"]);var services=__webpack_require__(3);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function vega_map_view_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function vega_map_view_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function vega_map_view_createClass(Constructor,protoProps,staticProps){if(protoProps)vega_map_view_defineProperties(Constructor.prototype,protoProps);if(staticProps)vega_map_view_defineProperties(Constructor,staticProps);return Constructor}function vega_map_view_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)vega_map_view_setPrototypeOf(subClass,superClass)}function vega_map_view_setPrototypeOf(o,p){vega_map_view_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return vega_map_view_setPrototypeOf(o,p)}function vega_map_view_createSuper(Derived){var hasNativeReflectConstruct=vega_map_view_isNativeReflectConstruct();return function _createSuperInternal(){var Super=vega_map_view_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=vega_map_view_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return vega_map_view_possibleConstructorReturn(this,result)}}function vega_map_view_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return vega_map_view_assertThisInitialized(self)}function vega_map_view_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function vega_map_view_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function vega_map_view_getPrototypeOf(o){vega_map_view_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return vega_map_view_getPrototypeOf(o)}var vega_map_view_VegaMapView=function(_VegaBaseView){vega_map_view_inherits(VegaMapView,_VegaBaseView);var _super=vega_map_view_createSuper(VegaMapView);function VegaMapView(opts){vega_map_view_classCallCheck(this,VegaMapView);return _super.call(this,opts)}vega_map_view_createClass(VegaMapView,[{key:"_initViewCustomizations",value:function(){var _initViewCustomizations2=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var _this=this;var mapConfig,baseMapOpts,limitMinZ,limitMaxZ,tmsServices,emsTileLayerId,mapStyle,isDarkMode,validate,minZoom,maxZoom,_ref,zoom,modules,vegaMapLayer,vegaView;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:mapConfig=this._parser.mapConfig;limitMinZ=0;limitMaxZ=25;if(!(mapConfig.mapStyle!==false)){_context.next=20;break}_context.next=6;return this._serviceSettings.getTMSServices();case 6:tmsServices=_context.sent;if(this._$container){_context.next=9;break}return _context.abrupt("return");case 9:emsTileLayerId=Object(services["b"])();mapStyle=mapConfig.mapStyle==="default"?emsTileLayerId.bright:mapConfig.mapStyle;isDarkMode=Object(services["f"])().get("theme:darkMode");baseMapOpts=tmsServices.find((function(s){return s.id===mapStyle}));_context.t0=_objectSpread;_context.t1=_objectSpread({},baseMapOpts);_context.next=17;return this._serviceSettings.getAttributesForTMSLayer(baseMapOpts,true,isDarkMode);case 17:_context.t2=_context.sent;baseMapOpts=(0,_context.t0)(_context.t1,_context.t2);if(!baseMapOpts){this.onWarn(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.mapView.mapStyleNotFoundWarningMessage",{defaultMessage:"{mapStyleParam} was not found",values:{mapStyleParam:'"mapStyle": '.concat(JSON.stringify(mapStyle))}}))}else{limitMinZ=baseMapOpts.minZoom;limitMaxZ=baseMapOpts.maxZoom}case 20:validate=function validate(name,value,dflt,min,max){if(value===undefined){value=dflt}else if(value<min){_this.onWarn(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.mapView.resettingPropertyToMinValueWarningMessage",{defaultMessage:"Resetting {name} to {min}",values:{name:'"'.concat(name,'"'),min:min}}));value=min}else if(value>max){_this.onWarn(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.mapView.resettingPropertyToMaxValueWarningMessage",{defaultMessage:"Resetting {name} to {max}",values:{name:'"'.concat(name,'"'),max:max}}));value=max}return value};minZoom=validate("minZoom",mapConfig.minZoom,limitMinZ,limitMinZ,limitMaxZ);maxZoom=validate("maxZoom",mapConfig.maxZoom,limitMaxZ,limitMinZ,limitMaxZ);if(minZoom>maxZoom){this.onWarn(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.mapView.minZoomAndMaxZoomHaveBeenSwappedWarningMessage",{defaultMessage:"{minZoomPropertyName} and {maxZoomPropertyName} have been swapped",values:{minZoomPropertyName:'"minZoom"',maxZoomPropertyName:'"maxZoom"'}}));_ref=[maxZoom,minZoom];minZoom=_ref[0];maxZoom=_ref[1]}zoom=validate("zoom",mapConfig.zoom,2,minZoom,maxZoom);_context.next=27;return Object(public_["lazyLoadMapsLegacyModules"])();case 27:modules=_context.sent;this._kibanaMap=new modules.KibanaMap(this._$container.get(0),{zoom:zoom,minZoom:minZoom,maxZoom:maxZoom,center:[mapConfig.latitude,mapConfig.longitude],zoomControl:mapConfig.zoomControl,scrollWheelZoom:mapConfig.scrollWheelZoom});if(baseMapOpts){this._kibanaMap.setBaseLayer({baseLayerType:"tms",options:baseMapOpts})}vegaMapLayer=new VegaMapLayer(this._parser.spec,{vega:vega["a"],bindingsContainer:this._$controls.get(0),delayRepaint:mapConfig.delayRepaint,viewConfig:this._vegaViewConfig,onWarning:this.onWarn.bind(this),onError:this.onError.bind(this)},modules.L);this._kibanaMap.addLayer(vegaMapLayer);this._addDestroyHandler((function(){_this._kibanaMap.removeLayer(vegaMapLayer);if(baseMapOpts){_this._kibanaMap.setBaseLayer(null)}_this._kibanaMap.destroy()}));vegaView=vegaMapLayer.getVegaView();_context.next=36;return this.setView(vegaView);case 36:this.setDebugValues(vegaView,this._parser.spec,this._parser.vlspec);case 37:case"end":return _context.stop()}}}),_callee,this)})));function _initViewCustomizations(){return _initViewCustomizations2.apply(this,arguments)}return _initViewCustomizations}()}]);return VegaMapView}(vega_base_view["a"])}}]);