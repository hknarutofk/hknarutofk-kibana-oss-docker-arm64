(window["visTypeVega_bundle_jsonpfunction"]=window["visTypeVega_bundle_jsonpfunction"]||[]).push([[3],{58:function(module,exports){module.exports=function(e){const[n,o]=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:n,version:o}}},59:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(root,factory){if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_FACTORY__=factory,__WEBPACK_AMD_DEFINE_RESULT__=typeof __WEBPACK_AMD_DEFINE_FACTORY__==="function"?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{}})(this,(function(){var semver=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function indexOrEnd(str,q){return str.indexOf(q)===-1?str.length:str.indexOf(q)}function split(v){var c=v.replace(/^v/,"").replace(/\+.*$/,"");var patchIndex=indexOrEnd(c,"-");var arr=c.substring(0,patchIndex).split(".");arr.push(c.substring(patchIndex+1));return arr}function tryParse(v){return isNaN(Number(v))?v:Number(v)}function validate(version){if(typeof version!=="string"){throw new TypeError("Invalid argument expected string")}if(!semver.test(version)){throw new Error("Invalid argument not valid semver ('"+version+"' received)")}}function compareVersions(v1,v2){[v1,v2].forEach(validate);var s1=split(v1);var s2=split(v2);for(var i=0;i<Math.max(s1.length-1,s2.length-1);i++){var n1=parseInt(s1[i]||0,10);var n2=parseInt(s2[i]||0,10);if(n1>n2)return 1;if(n2>n1)return-1}var sp1=s1[s1.length-1];var sp2=s2[s2.length-1];if(sp1&&sp2){var p1=sp1.split(".").map(tryParse);var p2=sp2.split(".").map(tryParse);for(i=0;i<Math.max(p1.length,p2.length);i++){if(p1[i]===undefined||typeof p2[i]==="string"&&typeof p1[i]==="number")return-1;if(p2[i]===undefined||typeof p1[i]==="string"&&typeof p2[i]==="number")return 1;if(p1[i]>p2[i])return 1;if(p2[i]>p1[i])return-1}}else if(sp1||sp2){return sp1?-1:1}return 0}var allowedOperators=[">",">=","=","<","<="];var operatorResMap={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function validateOperator(op){if(typeof op!=="string"){throw new TypeError("Invalid operator type, expected string but got "+typeof op)}if(allowedOperators.indexOf(op)===-1){throw new TypeError("Invalid operator, expected one of "+allowedOperators.join("|"))}}compareVersions.compare=function(v1,v2,operator){validateOperator(operator);var res=compareVersions(v1,v2);return operatorResMap[operator].indexOf(res)>-1};return compareVersions}))},68:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"VegaParser",(function(){return vega_parser_VegaParser}));var external_kbnSharedDeps_Lodash_=__webpack_require__(12);var external_kbnSharedDeps_Lodash_default=__webpack_require__.n(external_kbnSharedDeps_Lodash_);var dist_parser=__webpack_require__(58);var parser_default=__webpack_require__.n(dist_parser);var compare_versions=__webpack_require__(59);var compare_versions_default=__webpack_require__.n(compare_versions);var hjson=__webpack_require__(10);var hjson_default=__webpack_require__.n(hjson);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(1);var external_kbnSharedDeps_Theme_=__webpack_require__(51);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var vega=__webpack_require__(52);var external_kbnSharedDeps_Moment_=__webpack_require__(48);var external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_);function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var TIMEFILTER="%timefilter%";var AUTOINTERVAL="%autointerval%";var MUST_CLAUSE="%dashboard_context-must_clause%";var MUST_NOT_CLAUSE="%dashboard_context-must_not_clause%";var FILTER_CLAUSE="%dashboard_context-filter_clause%";var LEGACY_CONTEXT="%context_query%";var CONTEXT="%context%";var TIMEFIELD="%timefield%";var es_query_parser_getRequestName=function getRequestName(request,index){return request.dataObject.name||external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.esQueryParser.unnamedRequest",{defaultMessage:"Unnamed request #{index}",values:{index:index}})};var es_query_parser_EsQueryParser=function(){function EsQueryParser(timeCache,searchAPI,filters,onWarning){_classCallCheck(this,EsQueryParser);_defineProperty(this,"_timeCache",void 0);_defineProperty(this,"_searchAPI",void 0);_defineProperty(this,"_filters",void 0);_defineProperty(this,"_onWarning",void 0);this._timeCache=timeCache;this._searchAPI=searchAPI;this._filters=filters;this._onWarning=onWarning}_createClass(EsQueryParser,[{key:"parseUrl",value:function parseUrl(dataObject,url){var body=url.body;var context=url[CONTEXT];delete url[CONTEXT];var timefield=url[TIMEFIELD];delete url[TIMEFIELD];var usesContext=context!==undefined||timefield!==undefined;if(body===undefined){url.body=body={}}else if(!Object(external_kbnSharedDeps_Lodash_["isPlainObject"])(body)){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.esQueryParser.urlBodyValueTypeErrorMessage",{defaultMessage:"{configName} must be an object",values:{configName:"url.body"}}))}var legacyContext=url[LEGACY_CONTEXT];delete url[LEGACY_CONTEXT];if(legacyContext!==undefined){if(body.query!==undefined){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.esQueryParser.dataUrlMustNotHaveLegacyAndBodyQueryValuesAtTheSameTimeErrorMessage",{defaultMessage:"{dataUrlParam} must not have legacy {legacyContext} and {bodyQueryConfigName} values at the same time",values:{legacyContext:'"'.concat(LEGACY_CONTEXT,'"'),bodyQueryConfigName:'"body.query"',dataUrlParam:'"data.url"'}}))}else if(usesContext){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.esQueryParser.dataUrlMustNotHaveLegacyContextTogetherWithContextOrTimefieldErrorMessage",{defaultMessage:"{dataUrlParam} must not have {legacyContext} together with {context} or {timefield}",values:{legacyContext:'"'.concat(LEGACY_CONTEXT,'"'),context:'"'.concat(CONTEXT,'"'),timefield:'"'.concat(TIMEFIELD,'"'),dataUrlParam:'"data.url"'}}))}else if(legacyContext!==true&&(typeof legacyContext!=="string"||legacyContext.length===0)){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.esQueryParser.legacyContextCanBeTrueErrorMessage",{defaultMessage:"Legacy {legacyContext} can either be {trueValue} (ignores time range picker), or it can be the name of the time field, e.g. {timestampParam}",values:{legacyContext:'"'.concat(LEGACY_CONTEXT,'"'),trueValue:"true",timestampParam:'"@timestamp"'}}))}usesContext=true;context=true;var result='"url": {"'.concat(CONTEXT,'": true');if(typeof legacyContext==="string"){timefield=legacyContext;result+=', "'.concat(TIMEFIELD,'": ').concat(JSON.stringify(timefield))}result+="}";this._onWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.esQueryParser.legacyUrlShouldChangeToWarningMessage",{defaultMessage:"Legacy {urlParam}: {legacyUrl} should change to {result}",values:{legacyUrl:'"'.concat(LEGACY_CONTEXT,'": ').concat(JSON.stringify(legacyContext)),result:result,urlParam:'"url"'}}))}if(body.query!==undefined){if(usesContext){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.esQueryParser.urlContextAndUrlTimefieldMustNotBeUsedErrorMessage",{defaultMessage:"{urlContext} and {timefield} must not be used when {queryParam} is set",values:{timefield:"url.".concat(TIMEFIELD),urlContext:"url.".concat(CONTEXT),queryParam:"url.body.query"}}))}this._injectContextVars(body.query,true)}else if(usesContext){if(timefield){body.query={range:{[timefield]:this._createRangeFilter({[TIMEFILTER]:true})}}}if(context){var newQuery=Object(external_kbnSharedDeps_Lodash_["cloneDeep"])(this._filters);if(timefield){newQuery.bool.must.push(body.query)}body.query=newQuery}}this._injectContextVars(body.aggs,false);return{dataObject:dataObject,url:url}}},{key:"populateData",value:function(){var _populateData=_asyncToGenerator(regeneratorRuntime.mark((function _callee(requests){var esSearches,data$,results;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:esSearches=requests.map((function(r,index){return _objectSpread(_objectSpread({},r.url),{},{name:es_query_parser_getRequestName(r,index)})}));data$=this._searchAPI.search(esSearches);_context.next=4;return data$.toPromise();case 4:results=_context.sent;results.forEach((function(data,index){var requestObject=requests.find((function(item){return es_query_parser_getRequestName(item,index)===data.name}));if(requestObject){requestObject.dataObject.url=requestObject.url;requestObject.dataObject.values=data.rawResponse}}));case 6:case"end":return _context.stop()}}}),_callee,this)})));function populateData(_x){return _populateData.apply(this,arguments)}return populateData}()},{key:"_injectContextVars",value:function _injectContextVars(obj,isQuery){if(obj&&typeof obj==="object"){if(Array.isArray(obj)){for(var pos=0;pos<obj.length;){var item=obj[pos];if(isQuery&&(item===FILTER_CLAUSE||item===MUST_CLAUSE||item===MUST_NOT_CLAUSE)){var ctxTag="";switch(item){case FILTER_CLAUSE:ctxTag="filter";break;case MUST_CLAUSE:ctxTag="must";break;case MUST_NOT_CLAUSE:ctxTag="must_not";break}var ctx=Object(external_kbnSharedDeps_Lodash_["cloneDeep"])(this._filters);if(ctx&&ctx.bool&&ctx.bool[ctxTag]){if(Array.isArray(ctx.bool[ctxTag])){obj.splice.apply(obj,[pos,1].concat(_toConsumableArray(ctx.bool[ctxTag])));pos+=ctx.bool[ctxTag].length}else{obj[pos++]=ctx.bool[ctxTag]}}else{obj.splice(pos,1)}}else{this._injectContextVars(item,isQuery);pos++}}}else{for(var _i=0,_Object$keys=Object.keys(obj);_i<_Object$keys.length;_i++){var prop=_Object$keys[_i];var subObj=obj[prop];if(!subObj||typeof obj!=="object")continue;if(prop==="interval"&&subObj[AUTOINTERVAL]){var size=subObj[AUTOINTERVAL];if(size===true){size=50}else if(typeof size!=="number"){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.esQueryParser.autointervalValueTypeErrorMessage",{defaultMessage:"{autointerval} must be either {trueValue} or a number",values:{autointerval:'"'.concat(AUTOINTERVAL,'"'),trueValue:"true"}}))}var bounds=this._timeCache.getTimeBounds();obj.interval=EsQueryParser._roundInterval((bounds.max-bounds.min)/size);continue}switch(subObj[TIMEFILTER]){case"min":case"max":obj[prop]=this._getTimeBound(subObj,subObj[TIMEFILTER]);continue;case true:this._createRangeFilter(subObj);continue;case undefined:this._injectContextVars(subObj,isQuery);continue;default:throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.esQueryParser.timefilterValueErrorMessage",{defaultMessage:"{timefilter} property must be set to {trueValue}, {minValue}, or {maxValue}",values:{timefilter:'"'.concat(TIMEFILTER,'"'),trueValue:"true",minValue:'"min"',maxValue:'"max"'}}))}}}}}},{key:"_createRangeFilter",value:function _createRangeFilter(obj){obj.gte=external_kbnSharedDeps_Moment_default()(this._getTimeBound(obj,"min")).toISOString();obj.lte=external_kbnSharedDeps_Moment_default()(this._getTimeBound(obj,"max")).toISOString();obj.format="strict_date_optional_time";delete obj[TIMEFILTER];delete obj.shift;delete obj.unit;return obj}},{key:"_getTimeBound",value:function _getTimeBound(opts,type){var _bounds$type;var bounds=this._timeCache.getTimeBounds();var result=((_bounds$type=bounds[type])===null||_bounds$type===void 0?void 0:_bounds$type.valueOf())||0;if(opts.shift){var shift=opts.shift;if(typeof shift!=="number"){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.esQueryParser.shiftMustValueTypeErrorMessage",{defaultMessage:"{shiftParam} must be a numeric value",values:{shiftParam:'"shift"'}}))}var multiplier;switch(opts.unit||"d"){case"w":case"week":multiplier=1e3*60*60*24*7;break;case"d":case"day":multiplier=1e3*60*60*24;break;case"h":case"hour":multiplier=1e3*60*60;break;case"m":case"minute":multiplier=1e3*60;break;case"s":case"second":multiplier=1e3;break;default:throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.esQueryParser.unknownUnitValueErrorMessage",{defaultMessage:"Unknown {unitParamName} value. Must be one of: [{unitParamValues}]",values:{unitParamName:'"unit"',unitParamValues:'"week", "day", "hour", "minute", "second"'}}))}result+=shift*multiplier}return result}}],[{key:"_roundInterval",value:function _roundInterval(interval){switch(true){case interval<=500:return"100ms";case interval<=5e3:return"1s";case interval<=7500:return"5s";case interval<=15e3:return"10s";case interval<=45e3:return"30s";case interval<=18e4:return"1m";case interval<=45e4:return"5m";case interval<=12e5:return"10m";case interval<=27e5:return"30m";case interval<=72e5:return"1h";case interval<=216e5:return"3h";case interval<=864e5:return"12h";case interval<=6048e5:return"24h";case interval<=18144e5:return"1w";case interval<36288e5:return"30d";default:return"1y"}}}]);return EsQueryParser}();var utils=__webpack_require__(57);var vega_base_view=__webpack_require__(53);function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=ems_file_parser_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function ems_file_parser_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return ems_file_parser_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ems_file_parser_arrayLikeToArray(o,minLen)}function ems_file_parser_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function ems_file_parser_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function ems_file_parser_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){ems_file_parser_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){ems_file_parser_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function ems_file_parser_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function ems_file_parser_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function ems_file_parser_createClass(Constructor,protoProps,staticProps){if(protoProps)ems_file_parser_defineProperties(Constructor.prototype,protoProps);if(staticProps)ems_file_parser_defineProperties(Constructor,staticProps);return Constructor}function ems_file_parser_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var ems_file_parser_EmsFileParser=function(){function EmsFileParser(serviceSettings){ems_file_parser_classCallCheck(this,EmsFileParser);ems_file_parser_defineProperty(this,"_serviceSettings",void 0);ems_file_parser_defineProperty(this,"_fileLayersP",void 0);this._serviceSettings=serviceSettings}ems_file_parser_createClass(EmsFileParser,[{key:"parseUrl",value:function parseUrl(obj,url){if(typeof url.name!=="string"){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.emsFileParser.missingNameOfFileErrorMessage",{defaultMessage:"{dataUrlParam} with {dataUrlParamValue} requires {nameParam} parameter (name of the file)",values:{dataUrlParam:'"data.url"',dataUrlParamValue:'{"%type%": "emsfile"}',nameParam:'"name"'}}))}if(!this._fileLayersP){this._fileLayersP=this._serviceSettings.getFileLayers()}return{obj:obj,name:url.name}}},{key:"populateData",value:function(){var _populateData=ems_file_parser_asyncToGenerator(regeneratorRuntime.mark((function _callee(requests){var _this=this;var layers,_iterator,_step,_loop;return regeneratorRuntime.wrap((function _callee$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(requests.length===0)){_context2.next=2;break}return _context2.abrupt("return");case 2:_context2.next=4;return this._fileLayersP;case 4:layers=_context2.sent;_iterator=_createForOfIteratorHelper(requests);_context2.prev=6;_loop=regeneratorRuntime.mark((function _loop(){var _step$value,obj,name,foundLayer,url;return regeneratorRuntime.wrap((function _loop$(_context){while(1){switch(_context.prev=_context.next){case 0:_step$value=_step.value,obj=_step$value.obj,name=_step$value.name;foundLayer=layers===null||layers===void 0?void 0:layers.find((function(v){return v.name===name}));if(foundLayer){_context.next=4;break}throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.emsFileParser.emsFileNameDoesNotExistErrorMessage",{defaultMessage:"{emsfile} {emsfileName} does not exist",values:{emsfileName:JSON.stringify(name),emsfile:"emsfile"}}));case 4:_context.next=6;return _this._serviceSettings.getUrlForRegionLayer(foundLayer);case 6:url=_context.sent;obj.url=Object(vega_base_view["b"])(url);case 8:case"end":return _context.stop()}}}),_loop)}));_iterator.s();case 9:if((_step=_iterator.n()).done){_context2.next=13;break}return _context2.delegateYield(_loop(),"t0",11);case 11:_context2.next=9;break;case 13:_context2.next=18;break;case 15:_context2.prev=15;_context2.t1=_context2["catch"](6);_iterator.e(_context2.t1);case 18:_context2.prev=18;_iterator.f();return _context2.finish(18);case 21:case"end":return _context2.stop()}}}),_callee,this,[[6,15,18,21]])})));function populateData(_x){return _populateData.apply(this,arguments)}return populateData}()}]);return EmsFileParser}();var external_kbnSharedDeps_Jquery_=__webpack_require__(49);var external_kbnSharedDeps_Jquery_default=__webpack_require__.n(external_kbnSharedDeps_Jquery_);function url_parser_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function url_parser_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function url_parser_createClass(Constructor,protoProps,staticProps){if(protoProps)url_parser_defineProperties(Constructor.prototype,protoProps);if(staticProps)url_parser_defineProperties(Constructor,staticProps);return Constructor}function url_parser_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var url_parser_UrlParser=function(){function UrlParser(onWarning){url_parser_classCallCheck(this,UrlParser);url_parser_defineProperty(this,"_onWarning",void 0);this._onWarning=onWarning}url_parser_createClass(UrlParser,[{key:"parseUrl",value:function parseUrl(obj,urlObj){var url=urlObj.url;if(!url){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.urlParser.dataUrlRequiresUrlParameterInFormErrorMessage",{defaultMessage:'{dataUrlParam} requires a {urlParam} parameter in a form "{formLink}"',values:{dataUrlParam:'"data.url"',urlParam:'"url"',formLink:"https://example.org/path/subpath"}}))}var query=urlObj.query;if(!query){this._onWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.urlParser.urlShouldHaveQuerySubObjectWarningMessage",{defaultMessage:"Using a {urlObject} should have a {subObjectName} sub-object",values:{urlObject:'"url": {"%type%": "url", "url": ...}',subObjectName:'"query"'}}))}else{url+=(url.includes("?")?"&":"?")+external_kbnSharedDeps_Jquery_default.a.param(query)}obj.url=url}},{key:"populateData",value:function populateData(){}}]);return UrlParser}();function vega_parser_createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=vega_parser_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function vega_parser_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return vega_parser_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vega_parser_arrayLikeToArray(o,minLen)}function vega_parser_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function vega_parser_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function vega_parser_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){vega_parser_ownKeys(Object(source),true).forEach((function(key){vega_parser_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{vega_parser_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function vega_parser_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function vega_parser_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){vega_parser_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){vega_parser_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function vega_parser_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function vega_parser_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function vega_parser_createClass(Constructor,protoProps,staticProps){if(protoProps)vega_parser_defineProperties(Constructor.prototype,protoProps);if(staticProps)vega_parser_defineProperties(Constructor,staticProps);return Constructor}function vega_parser_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var defaultColor=Object(external_kbnSharedDeps_ElasticEui_["euiPaletteColorBlind"])()[0];var locToDirMap={left:"row-reverse",right:"row",top:"column-reverse",bottom:"column"};var DEFAULT_PARSER="elasticsearch";var vega_parser_VegaParser=function(){function VegaParser(spec,searchAPI,timeCache,filters,getServiceSettings){vega_parser_classCallCheck(this,VegaParser);vega_parser_defineProperty(this,"spec",void 0);vega_parser_defineProperty(this,"hideWarnings",void 0);vega_parser_defineProperty(this,"error",void 0);vega_parser_defineProperty(this,"warnings",void 0);vega_parser_defineProperty(this,"_urlParsers",void 0);vega_parser_defineProperty(this,"isVegaLite",void 0);vega_parser_defineProperty(this,"useHover",void 0);vega_parser_defineProperty(this,"_config",void 0);vega_parser_defineProperty(this,"useMap",void 0);vega_parser_defineProperty(this,"renderer",void 0);vega_parser_defineProperty(this,"tooltips",void 0);vega_parser_defineProperty(this,"mapConfig",void 0);vega_parser_defineProperty(this,"vlspec",void 0);vega_parser_defineProperty(this,"useResize",void 0);vega_parser_defineProperty(this,"containerDir",void 0);vega_parser_defineProperty(this,"controlsDir",void 0);vega_parser_defineProperty(this,"searchAPI",void 0);vega_parser_defineProperty(this,"getServiceSettings",void 0);vega_parser_defineProperty(this,"filters",void 0);vega_parser_defineProperty(this,"timeCache",void 0);this.spec=spec;this.hideWarnings=false;this.error=undefined;this.warnings=[];this.searchAPI=searchAPI;this.getServiceSettings=getServiceSettings;this.filters=filters;this.timeCache=timeCache}vega_parser_createClass(VegaParser,[{key:"parseAsync",value:function(){var _parseAsync2=vega_parser_asyncToGenerator(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return this._parseAsync();case 3:_context.next=8;break;case 5:_context.prev=5;_context.t0=_context["catch"](0);this.error=utils["a"].formatErrorToStr(_context.t0);case 8:return _context.abrupt("return",this);case 9:case"end":return _context.stop()}}}),_callee,this,[[0,5]])})));function parseAsync(){return _parseAsync2.apply(this,arguments)}return parseAsync}()},{key:"_parseAsync",value:function(){var _parseAsync3=vega_parser_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var spec;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(this.isVegaLite!==undefined)){_context2.next=2;break}throw new Error;case 2:if(!(typeof this.spec==="string")){_context2.next=7;break}spec=hjson_default.a.parse(this.spec,{legacyRoot:false});if(spec.$schema){_context2.next=6;break}throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.inputSpecDoesNotSpecifySchemaErrorMessage",{defaultMessage:"Your specification requires a {schemaParam} field with a valid URL for\nVega (see {vegaSchemaUrl}) or\nVega-Lite (see {vegaLiteSchemaUrl}).\nThe URL is an identifier only. Kibana and your browser will never access this URL.",values:{schemaParam:'"$schema"',vegaLiteSchemaUrl:"https://vega.github.io/vega-lite/docs/spec.html#top-level",vegaSchemaUrl:"https://vega.github.io/vega/docs/specification/#top-level-specification-properties"}}));case 6:this.spec=spec;case 7:if(external_kbnSharedDeps_Lodash_default.a.isPlainObject(this.spec)){_context2.next=9;break}throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.invalidVegaSpecErrorMessage",{defaultMessage:"Invalid Vega specification"}));case 9:this.isVegaLite=this.parseSchema(this.spec).isVegaLite;this.useHover=!this.isVegaLite;this._config=this._parseConfig();this.hideWarnings=!!this._config.hideWarnings;this.useMap=this._config.type==="map";this.renderer=this._config.renderer==="svg"?"svg":"canvas";this.tooltips=this._parseTooltips();this._setDefaultColors();this._parseControlPlacement();if(this.useMap){this.mapConfig=this._parseMapConfig();this.useResize=false}else if(this.spec){this._compileWithAutosize()}_context2.next=21;return this._resolveDataUrls();case 21:if(this.isVegaLite){this._compileVegaLite()}case 22:case"end":return _context2.stop()}}}),_callee2,this)})));function _parseAsync(){return _parseAsync3.apply(this,arguments)}return _parseAsync}()},{key:"_compileWithAutosize",value:function _compileWithAutosize(){var defaultAutosize={type:"fit",contains:"padding"};var autosize=this.spec.autosize;var useResize=true;if(!this.isVegaLite&&autosize&&typeof autosize==="object"&&"signal"in autosize){return}if(!autosize&&typeof autosize!=="undefined"){this._onWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.autoSizeDoesNotAllowFalse",{defaultMessage:"{autoSizeParam} is enabled, it can only be disabled by setting {autoSizeParam} to {noneParam}",values:{autoSizeParam:'"autosize"',noneParam:'"none"'}}))}if(typeof autosize==="string"){useResize=autosize!=="none";autosize=vega_parser_objectSpread(vega_parser_objectSpread({},defaultAutosize),{},{type:autosize})}else if(typeof autosize==="object"){var _autosize,_autosize2;autosize=vega_parser_objectSpread(vega_parser_objectSpread({},defaultAutosize),autosize);useResize=Boolean(((_autosize=autosize)===null||_autosize===void 0?void 0:_autosize.type)&&((_autosize2=autosize)===null||_autosize2===void 0?void 0:_autosize2.type)!=="none")}else{autosize=defaultAutosize}if(useResize&&(this.spec.width&&this.spec.width!=="container"||this.spec.height&&this.spec.height!=="container")){this._onWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.widthAndHeightParamsAreIgnored",{defaultMessage:"{widthParam} and {heightParam} params are ignored because {autoSizeParam} is enabled. Set {autoSizeParam}: {noneParam} to disable",values:{widthParam:'"width"',heightParam:'"height"',autoSizeParam:'"autosize"',noneParam:'"none"'}}))}if(useResize){this.spec.width="container";this.spec.height="container"}this.spec.autosize=autosize;this.useResize=useResize}},{key:"_compileVegaLite",value:function _compileVegaLite(){this.vlspec=this.spec;var logger=vega["a"].logger(vega["a"].Warn);logger.warn=this._onWarning.bind(this);this.spec=vega["b"].compile(this.vlspec,logger).spec;if(this.useMap){if(!this.spec||!this.vlspec)return;var hasConfig=external_kbnSharedDeps_Lodash_default.a.isPlainObject(this.vlspec.config);if(this.vlspec.config===undefined||hasConfig&&!this.vlspec.config.projection){if(!Array.isArray(this.spec.projections)||this.spec.projections.length!==1||this.spec.projections[0].name!=="projection"){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.VLCompilerShouldHaveGeneratedSingleProtectionObjectErrorMessage",{defaultMessage:"Internal error: Vega-Lite compiler should have generated a single projection object"}))}delete this.spec.projections}if(!this.vlspec.width)delete this.spec.width;if(!this.vlspec.height)delete this.spec.height;if(!this.vlspec.padding&&(this.vlspec.config===undefined||hasConfig&&!this.vlspec.config.padding)){delete this.spec.padding}if(!this.vlspec.autosize&&(this.vlspec.config===undefined||hasConfig&&!this.vlspec.config.autosize)){delete this.spec.autosize}}}},{key:"_parseControlPlacement",value:function _parseControlPlacement(){var _this$_config,_this$_config2;this.containerDir=((_this$_config=this._config)===null||_this$_config===void 0?void 0:_this$_config.controlsLocation)?locToDirMap[this._config.controlsLocation]:undefined;if(this.containerDir===undefined){if(this._config&&this._config.controlsLocation===undefined){this.containerDir="column"}else{throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.unrecognizedControlsLocationValueErrorMessage",{defaultMessage:"Unrecognized {controlsLocationParam} value. Expecting one of [{locToDirMap}]",values:{locToDirMap:'"'.concat(Object.keys(locToDirMap).join('", "'),'"'),controlsLocationParam:"controlsLocation"}}))}}var dir=(_this$_config2=this._config)===null||_this$_config2===void 0?void 0:_this$_config2.controlsDirection;if(dir!==undefined&&dir!=="horizontal"&&dir!=="vertical"){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.unrecognizedDirValueErrorMessage",{defaultMessage:"Unrecognized {dirParam} value. Expecting one of [{expectedValues}]",values:{expectedValues:'"horizontal", "vertical"',dirParam:"dir"}}))}this.controlsDir=dir==="horizontal"?"row":"column"}},{key:"_parseConfig",value:function _parseConfig(){var result=null;if(this.spec){if(this.spec._hostConfig!==undefined){result=this.spec._hostConfig;delete this.spec._hostConfig;if(!external_kbnSharedDeps_Lodash_default.a.isPlainObject(result)){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.hostConfigValueTypeErrorMessage",{defaultMessage:"If present, {configName} must be an object",values:{configName:'"_hostConfig"'}}))}this._onWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.hostConfigIsDeprecatedWarningMessage",{defaultMessage:"{deprecatedConfigName} has been deprecated. Use {newConfigName} instead.",values:{deprecatedConfigName:'"_hostConfig"',newConfigName:"config.kibana"}}))}if(external_kbnSharedDeps_Lodash_default.a.isPlainObject(this.spec.config)&&this.spec.config.kibana!==undefined){result=this.spec.config.kibana;delete this.spec.config.kibana;if(!external_kbnSharedDeps_Lodash_default.a.isPlainObject(result)){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.kibanaConfigValueTypeErrorMessage",{defaultMessage:"If present, {configName} must be an object",values:{configName:"config.kibana"}}))}}}return result||{}}},{key:"_parseTooltips",value:function _parseTooltips(){var _this$_config3;if(this._config&&this._config.tooltips===false){return false}var result=((_this$_config3=this._config)===null||_this$_config3===void 0?void 0:_this$_config3.tooltips)||{};if(result.position===undefined){result.position="top"}else if(["top","right","bottom","left"].indexOf(result.position)===-1){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.unexpectedValueForPositionConfigurationErrorMessage",{defaultMessage:"Unexpected value for the {configurationName} configuration",values:{configurationName:"result.position"}}))}if(result.padding===undefined){result.padding=16}else if(typeof result.padding!=="number"){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.paddingConfigValueTypeErrorMessage",{defaultMessage:"{configName} is expected to be a number",values:{configName:"config.kibana.result.padding"}}))}if(result.centerOnMark===undefined){result.centerOnMark=50}else if(typeof result.centerOnMark==="boolean"){result.centerOnMark=result.centerOnMark?Number.MAX_VALUE:-1}else if(typeof result.centerOnMark!=="number"){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.centerOnMarkConfigValueTypeErrorMessage",{defaultMessage:"{configName} is expected to be {trueValue}, {falseValue}, or a number",values:{configName:"config.kibana.result.centerOnMark",trueValue:"true",falseValue:"false"}}))}return result}},{key:"_parseMapConfig",value:function _parseMapConfig(){var _this$_config4,_this=this,_this$_config5,_this$_config6;var res={delayRepaint:((_this$_config4=this._config)===null||_this$_config4===void 0?void 0:_this$_config4.delayRepaint)===undefined?true:this._config.delayRepaint};var validate=function validate(name,isZoom){var val=_this._config?_this._config[name]:undefined;if(val!==undefined){var parsed=parseFloat(val);if(Number.isFinite(parsed)&&(!isZoom||parsed>=0&&parsed<=30)){res[name]=parsed;return}_this._onWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.someKibanaConfigurationIsNoValidWarningMessage",{defaultMessage:"{configName} is not valid",values:{configName:"config.kibana.".concat(name)}}))}if(!isZoom)res[name]=0};validate("latitude",false);validate("longitude",false);validate("zoom",true);validate("minZoom",true);validate("maxZoom",true);res.mapStyle=((_this$_config5=this._config)===null||_this$_config5===void 0?void 0:_this$_config5.mapStyle)===undefined?"default":this._config.mapStyle;if(res.mapStyle!=="default"&&res.mapStyle!==false){this._onWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.mapStyleValueTypeWarningMessage",{defaultMessage:"{mapStyleConfigName} may either be {mapStyleConfigFirstAllowedValue} or {mapStyleConfigSecondAllowedValue}",values:{mapStyleConfigName:"config.kibana.mapStyle",mapStyleConfigFirstAllowedValue:"false",mapStyleConfigSecondAllowedValue:'"default"'}}));res.mapStyle="default"}this._parseBool("zoomControl",res,true);this._parseBool("scrollWheelZoom",res,false);var maxBounds=(_this$_config6=this._config)===null||_this$_config6===void 0?void 0:_this$_config6.maxBounds;if(maxBounds!==undefined){if(!Array.isArray(maxBounds)||maxBounds.length!==4||!maxBounds.every((function(v){return typeof v==="number"&&Number.isFinite(v)}))){this._onWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.maxBoundsValueTypeWarningMessage",{defaultMessage:"{maxBoundsConfigName} must be an array with four numbers",values:{maxBoundsConfigName:"config.kibana.maxBounds"}}))}else{res.maxBounds=maxBounds}}return res}},{key:"_parseBool",value:function _parseBool(paramName,dstObj,dflt){var val=this._config?this._config[paramName]:undefined;if(val===undefined){dstObj[paramName]=dflt}else if(typeof val!=="boolean"){this._onWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.someKibanaParamValueTypeWarningMessage",{defaultMessage:"{configName} must be a boolean value",values:{configName:"config.kibana.".concat(paramName)}}));dstObj[paramName]=dflt}else{dstObj[paramName]=val}}},{key:"parseSchema",value:function parseSchema(spec){var schema=parser_default()(spec.$schema);var isVegaLite=schema.library==="vega-lite";var libVersion=isVegaLite?vega["b"].version:vega["a"].version;if(compare_versions_default()(schema.version,libVersion)>0){this._onWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.notValidLibraryVersionForInputSpecWarningMessage",{defaultMessage:"The input spec uses {schemaLibrary} {schemaVersion}, but current version of {schemaLibrary} is {libraryVersion}.",values:{schemaLibrary:schema.library,schemaVersion:schema.version,libraryVersion:libVersion}}))}return{isVegaLite:isVegaLite,libVersion:libVersion}}},{key:"_resolveDataUrls",value:function(){var _resolveDataUrls2=vega_parser_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var _this2=this;var serviceSettings,onWarn,pending,pendingParsers;return regeneratorRuntime.wrap((function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(this._urlParsers){_context3.next=6;break}_context3.next=3;return this.getServiceSettings();case 3:serviceSettings=_context3.sent;onWarn=this._onWarning.bind(this);this._urlParsers={elasticsearch:new es_query_parser_EsQueryParser(this.timeCache,this.searchAPI,this.filters,onWarn),emsfile:new ems_file_parser_EmsFileParser(serviceSettings),url:new url_parser_UrlParser(onWarn)};case 6:pending={};this.searchAPI.resetSearchStats();this._findObjectDataUrls(this.spec,(function(obj){var url=obj.url;delete obj.url;var type=url["%type%"];delete url["%type%"];if(type===undefined){type=DEFAULT_PARSER}var parser=_this2._urlParsers[type];if(parser===undefined){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.notSupportedUrlTypeErrorMessage",{defaultMessage:"{urlObject} is not supported",values:{urlObject:'url: {"%type%": "${type}"}'}}))}var pendingArr=pending[type];if(pendingArr===undefined){pending[type]=pendingArr=[]}pendingArr.push(parser.parseUrl(obj,url))}));pendingParsers=Object.keys(pending);if(!(pendingParsers.length>0)){_context3.next=13;break}_context3.next=13;return Promise.all(pendingParsers.map((function(type){return _this2._urlParsers[type].populateData(pending[type])})));case 13:case"end":return _context3.stop()}}}),_callee3,this)})));function _resolveDataUrls(){return _resolveDataUrls2.apply(this,arguments)}return _resolveDataUrls}()},{key:"_findObjectDataUrls",value:function _findObjectDataUrls(obj,onFind,key){if(Array.isArray(obj)){var _iterator=vega_parser_createForOfIteratorHelper(obj),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var elem=_step.value;this._findObjectDataUrls(elem,onFind,key)}}catch(err){_iterator.e(err)}finally{_iterator.f()}}else if(external_kbnSharedDeps_Lodash_default.a.isPlainObject(obj)){if(key==="data"&&external_kbnSharedDeps_Lodash_default.a.isPlainObject(obj.url)){if(obj.values!==undefined||obj.source!==undefined){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.vegaParser.dataExceedsSomeParamsUseTimesLimitErrorMessage",{defaultMessage:"Data must not have more than one of {urlParam}, {valuesParam}, and {sourceParam}",values:{urlParam:'"url"',valuesParam:'"values"',sourceParam:'"source"'}}))}onFind(obj)}else{for(var _i=0,_Object$keys=Object.keys(obj);_i<_Object$keys.length;_i++){var k=_Object$keys[_i];this._findObjectDataUrls(obj[k],onFind,k)}}}}},{key:"_setDefaultColors",value:function _setDefaultColors(){this._setDefaultValue({scheme:"elastic"},"config","range","category");if(this.isVegaLite){this._setDefaultValue(defaultColor,"config","mark","color")}else{var _this$spec;if(!((_this$spec=this.spec)===null||_this$spec===void 0?void 0:_this$spec.config.mark)||this.spec.config.mark.color===undefined&&this.spec.config.mark.fill===undefined){this._setDefaultValue(defaultColor,"config","arc","fill");this._setDefaultValue(defaultColor,"config","area","fill");this._setDefaultValue(defaultColor,"config","line","stroke");this._setDefaultValue(defaultColor,"config","path","stroke");this._setDefaultValue(defaultColor,"config","rect","fill");this._setDefaultValue(defaultColor,"config","rule","stroke");this._setDefaultValue(defaultColor,"config","shape","stroke");this._setDefaultValue(defaultColor,"config","symbol","fill");this._setDefaultValue(defaultColor,"config","trail","fill")}}this._setDefaultValue(external_kbnSharedDeps_Theme_["euiThemeVars"].euiColorDarkestShade,"config","title","color");this._setDefaultValue(external_kbnSharedDeps_Theme_["euiThemeVars"].euiColorDarkShade,"config","style","guide-label","fill");this._setDefaultValue(external_kbnSharedDeps_Theme_["euiThemeVars"].euiColorDarkestShade,"config","style","guide-title","fill");this._setDefaultValue(external_kbnSharedDeps_Theme_["euiThemeVars"].euiColorDarkestShade,"config","style","group-title","fill");this._setDefaultValue(external_kbnSharedDeps_Theme_["euiThemeVars"].euiColorDarkestShade,"config","style","group-subtitle","fill");this._setDefaultValue(external_kbnSharedDeps_Theme_["euiThemeVars"].euiColorChartLines,"config","axis","tickColor");this._setDefaultValue(external_kbnSharedDeps_Theme_["euiThemeVars"].euiColorChartLines,"config","axis","domainColor");this._setDefaultValue(external_kbnSharedDeps_Theme_["euiThemeVars"].euiColorChartLines,"config","axis","gridColor");this._setDefaultValue("transparent","config","background")}},{key:"_setDefaultValue",value:function _setDefaultValue(value){var _ref;var o=this.spec;for(var i=0;i<(arguments.length<=1?0:arguments.length-1)-1;i++){var field=i+1<1||arguments.length<=i+1?undefined:arguments[i+1];var subObj=o[field];if(subObj===undefined){o[field]={}}else if(!external_kbnSharedDeps_Lodash_default.a.isPlainObject(subObj)){return}o=o[field]}var lastField=(_ref=(arguments.length<=1?0:arguments.length-1)-1+1,_ref<1||arguments.length<=_ref?undefined:arguments[_ref]);if(o[lastField]===undefined){o[lastField]=value}}},{key:"_onWarning",value:function _onWarning(){if(!this.hideWarnings){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this.warnings.push(utils["a"].formatWarningToStr(args));return utils["a"].formatWarningToStr(args)}}}]);return VegaParser}()}}]);