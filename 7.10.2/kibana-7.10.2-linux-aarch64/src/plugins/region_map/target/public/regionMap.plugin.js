(function(modules){function webpackJsonpCallback(data){var chunkIds=data[0];var moreModules=data[1];var moduleId,chunkId,i=0,resolves=[];for(;i<chunkIds.length;i++){chunkId=chunkIds[i];if(Object.prototype.hasOwnProperty.call(installedChunks,chunkId)&&installedChunks[chunkId]){resolves.push(installedChunks[chunkId][0])}installedChunks[chunkId]=0}for(moduleId in moreModules){if(Object.prototype.hasOwnProperty.call(moreModules,moduleId)){modules[moduleId]=moreModules[moduleId]}}if(parentJsonpFunction)parentJsonpFunction(data);while(resolves.length){resolves.shift()()}}var installedModules={};var installedChunks={0:0};function jsonpScriptSrc(chunkId){return __webpack_require__.p+"regionMap.chunk."+chunkId+".js"}function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.e=function requireEnsure(chunkId){var promises=[];var installedChunkData=installedChunks[chunkId];if(installedChunkData!==0){if(installedChunkData){promises.push(installedChunkData[2])}else{var promise=new Promise((function(resolve,reject){installedChunkData=installedChunks[chunkId]=[resolve,reject]}));promises.push(installedChunkData[2]=promise);var script=document.createElement("script");var onScriptComplete;script.charset="utf-8";script.timeout=120;if(__webpack_require__.nc){script.setAttribute("nonce",__webpack_require__.nc)}script.src=jsonpScriptSrc(chunkId);var error=new Error;onScriptComplete=function(event){script.onerror=script.onload=null;clearTimeout(timeout);var chunk=installedChunks[chunkId];if(chunk!==0){if(chunk){var errorType=event&&(event.type==="load"?"missing":event.type);var realSrc=event&&event.target&&event.target.src;error.message="Loading chunk "+chunkId+" failed.\n("+errorType+": "+realSrc+")";error.name="ChunkLoadError";error.type=errorType;error.request=realSrc;chunk[1](error)}installedChunks[chunkId]=undefined}};var timeout=setTimeout((function(){onScriptComplete({type:"timeout",target:script})}),12e4);script.onerror=script.onload=onScriptComplete;document.head.appendChild(script)}}return Promise.all(promises)};__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";__webpack_require__.oe=function(err){console.error(err);throw err};var jsonpArray=window["regionMap_bundle_jsonpfunction"]=window["regionMap_bundle_jsonpfunction"]||[];var oldJsonpFunction=jsonpArray.push.bind(jsonpArray);jsonpArray.push=webpackJsonpCallback;jsonpArray=jsonpArray.slice();for(var i=0;i<jsonpArray.length;i++)webpackJsonpCallback(jsonpArray[i]);var parentJsonpFunction=oldJsonpFunction;return __webpack_require__(__webpack_require__.s=9)})([function(module,exports){module.exports=__kbnSharedDeps__.React},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18n},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return getCoreService}));__webpack_require__.d(__webpack_exports__,"g",(function(){return setCoreService}));__webpack_require__.d(__webpack_exports__,"b",(function(){return getFormatService}));__webpack_require__.d(__webpack_exports__,"h",(function(){return setFormatService}));__webpack_require__.d(__webpack_exports__,"d",(function(){return getNotifications}));__webpack_require__.d(__webpack_exports__,"j",(function(){return setNotifications}));__webpack_require__.d(__webpack_exports__,"e",(function(){return getQueryService}));__webpack_require__.d(__webpack_exports__,"k",(function(){return setQueryService}));__webpack_require__.d(__webpack_exports__,"f",(function(){return getShareService}));__webpack_require__.d(__webpack_exports__,"l",(function(){return setShareService}));__webpack_require__.d(__webpack_exports__,"c",(function(){return getKibanaLegacy}));__webpack_require__.d(__webpack_exports__,"i",(function(){return setKibanaLegacy}));var _kibana_utils_public__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6);var _kibana_utils_public__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_kibana_utils_public__WEBPACK_IMPORTED_MODULE_0__);function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}var _createGetterSetter=Object(_kibana_utils_public__WEBPACK_IMPORTED_MODULE_0__["createGetterSetter"])("Core"),_createGetterSetter2=_slicedToArray(_createGetterSetter,2),getCoreService=_createGetterSetter2[0],setCoreService=_createGetterSetter2[1];var _createGetterSetter3=Object(_kibana_utils_public__WEBPACK_IMPORTED_MODULE_0__["createGetterSetter"])("data.fieldFormats"),_createGetterSetter4=_slicedToArray(_createGetterSetter3,2),getFormatService=_createGetterSetter4[0],setFormatService=_createGetterSetter4[1];var _createGetterSetter5=Object(_kibana_utils_public__WEBPACK_IMPORTED_MODULE_0__["createGetterSetter"])("Notifications"),_createGetterSetter6=_slicedToArray(_createGetterSetter5,2),getNotifications=_createGetterSetter6[0],setNotifications=_createGetterSetter6[1];var _createGetterSetter7=Object(_kibana_utils_public__WEBPACK_IMPORTED_MODULE_0__["createGetterSetter"])("Query"),_createGetterSetter8=_slicedToArray(_createGetterSetter7,2),getQueryService=_createGetterSetter8[0],setQueryService=_createGetterSetter8[1];var _createGetterSetter9=Object(_kibana_utils_public__WEBPACK_IMPORTED_MODULE_0__["createGetterSetter"])("Share"),_createGetterSetter10=_slicedToArray(_createGetterSetter9,2),getShareService=_createGetterSetter10[0],setShareService=_createGetterSetter10[1];var _createGetterSetter11=Object(_kibana_utils_public__WEBPACK_IMPORTED_MODULE_0__["createGetterSetter"])("KibanaLegacy"),_createGetterSetter12=_slicedToArray(_createGetterSetter11,2),getKibanaLegacy=_createGetterSetter12[0],setKibanaLegacy=_createGetterSetter12[1]},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/mapsLegacy/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.ElasticEui},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/charts/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18nReact},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/visDefaultEditor/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_val_loader_dist_cjs_js_key_regionMap_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10);var _node_modules_val_loader_dist_cjs_js_key_regionMap_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_val_loader_dist_cjs_js_key_regionMap_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__);__kbnBundles__.define("plugin/regionMap/public",__webpack_require__,11)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__kbnPublicPath__["regionMap"]},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin}));var external_kbnSharedDeps_KbnI18n_=__webpack_require__(1);var region_map_fn_createRegionMapFn=function createRegionMapFn(){return{name:"regionmap",type:"render",context:{types:["kibana_datatable"]},help:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.function.help",{defaultMessage:"Regionmap visualization"}),args:{visConfig:{types:["string","null"],default:'"{}"'}},fn(context,args){var visConfig=JSON.parse(args.visConfig);return{type:"render",as:"visualization",value:{visData:context,visType:"region_map",visConfig:visConfig,params:{listenOnChange:true}}}}}};var external_kbnSharedDeps_React_=__webpack_require__(0);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var public_=__webpack_require__(3);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var util_mapToLayerWithId=function mapToLayerWithId(prefix,layer){return _objectSpread(_objectSpread({},layer),{},{layerId:"".concat(prefix,".").concat(layer.name),isEMS:public_["ORIGIN"].EMS===prefix})};var kibana_services=__webpack_require__(2);var charts_public_=__webpack_require__(5);function tooltipFormatter(metric,fieldFormatter,fieldName,metricName){if(!metric){return""}var details=[];if(fieldName&&metric){details.push({label:fieldName,value:metric.term})}if(metric){details.push({label:metricName,value:fieldFormatter?fieldFormatter.convert(metric.value,"text"):metric.value})}return details}function region_map_visualization_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function region_map_visualization_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){region_map_visualization_ownKeys(Object(source),true).forEach((function(key){region_map_visualization_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{region_map_visualization_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function region_map_visualization_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function createRegionMapVisualization(_ref){var regionmapsConfig=_ref.regionmapsConfig,uiSettings=_ref.uiSettings,BaseMapsVisualization=_ref.BaseMapsVisualization,getServiceSettings=_ref.getServiceSettings;return function(_BaseMapsVisualizatio){_inherits(RegionMapsVisualization,_BaseMapsVisualizatio);var _super=_createSuper(RegionMapsVisualization);function RegionMapsVisualization(container,vis){var _this;_classCallCheck(this,RegionMapsVisualization);_this=_super.call(this,container,vis);_this._vis=_this.vis;_this._choroplethLayer=null;_this._tooltipFormatter=Object(public_["mapTooltipProvider"])(container,tooltipFormatter);return _this}_createClass(RegionMapsVisualization,[{key:"render",value:function(){var _render=_asyncToGenerator(regeneratorRuntime.mark((function _callee(esResponse,visParams){return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:Object(kibana_services["c"])().loadFontAwesome();_context.next=3;return _get(_getPrototypeOf(RegionMapsVisualization.prototype),"render",this).call(this,esResponse,visParams);case 3:if(!this._choroplethLayer){_context.next=6;break}_context.next=6;return this._choroplethLayer.whenDataLoaded();case 6:case"end":return _context.stop()}}}),_callee,this)})));function render(_x,_x2){return _render.apply(this,arguments)}return render}()},{key:"_updateData",value:function(){var _updateData2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(table){var termColumn,valueColumn,results,selectedLayer,metricFieldFormatter;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:this._chartData=table;termColumn=this._params.bucket?table.columns[this._params.bucket.accessor]:null;valueColumn=table.columns[this._params.metric.accessor];if(!this._hasColumns()||!table.rows.length){results=[]}else{results=table.rows.map((function(row){var term=row[termColumn.id];var value=row[valueColumn.id];return{term:term,value:value}}))}_context2.next=6;return this._loadConfig(this._params.selectedLayer);case 6:selectedLayer=_context2.sent;if(!this._params.selectedJoinField&&selectedLayer){this._params.selectedJoinField=selectedLayer.fields[0]}if(selectedLayer){_context2.next=10;break}return _context2.abrupt("return");case 10:_context2.next=12;return this._updateChoroplethLayerForNewMetrics(selectedLayer.name,selectedLayer.attribution,this._params.showAllShapes,results);case 12:metricFieldFormatter=Object(kibana_services["b"])().deserialize(this._params.metric.format);this._choroplethLayer.setMetrics(results,metricFieldFormatter,valueColumn.name);if(termColumn&&valueColumn){this._choroplethLayer.setTooltipFormatter(this._tooltipFormatter,metricFieldFormatter,termColumn.name,valueColumn.name)}this._kibanaMap.useUiStateFromVisualization(this._vis);case 16:case"end":return _context2.stop()}}}),_callee2,this)})));function _updateData(_x3){return _updateData2.apply(this,arguments)}return _updateData}()},{key:"_loadConfig",value:function(){var _loadConfig2=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(fileLayerConfig){var _yield$import,escape,serviceSettings,configuredLayer;return regeneratorRuntime.wrap((function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return Promise.resolve().then(__webpack_require__.t.bind(null,12,7));case 2:_yield$import=_context3.sent;escape=_yield$import.escape;if(!(fileLayerConfig.isEMS||fileLayerConfig.layerId&&fileLayerConfig.layerId.startsWith("".concat(public_["ORIGIN"].EMS,".")))){_context3.next=11;break}_context3.next=7;return getServiceSettings();case 7:serviceSettings=_context3.sent;_context3.next=10;return serviceSettings.loadFileLayerConfig(fileLayerConfig);case 10:return _context3.abrupt("return",_context3.sent);case 11:configuredLayer=regionmapsConfig.layers.find((function(layer){return layer.name===fileLayerConfig.name}));if(!configuredLayer){_context3.next=14;break}return _context3.abrupt("return",region_map_visualization_objectSpread(region_map_visualization_objectSpread({},configuredLayer),{},{attribution:escape(configuredLayer.attribution?configuredLayer.attribution:"")}));case 14:return _context3.abrupt("return",null);case 15:case"end":return _context3.stop()}}}),_callee3)})));function _loadConfig(_x4){return _loadConfig2.apply(this,arguments)}return _loadConfig}()},{key:"_updateParams",value:function(){var _updateParams2=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(){var selectedLayer,metricFieldFormatter;return regeneratorRuntime.wrap((function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _get(_getPrototypeOf(RegionMapsVisualization.prototype),"_updateParams",this).call(this);case 2:_context4.next=4;return this._loadConfig(this._params.selectedLayer);case 4:selectedLayer=_context4.sent;if(!this._params.selectedJoinField&&selectedLayer){this._params.selectedJoinField=selectedLayer.fields[0]}if(!(!this._params.selectedJoinField||!selectedLayer)){_context4.next=8;break}return _context4.abrupt("return");case 8:_context4.next=10;return this._updateChoroplethLayerForNewProperties(selectedLayer.name,selectedLayer.attribution,this._params.showAllShapes);case 10:metricFieldFormatter=Object(kibana_services["b"])().deserialize(this._params.metric.format);this._choroplethLayer.setJoinField(this._params.selectedJoinField.name);this._choroplethLayer.setColorRamp(charts_public_["truncatedColorMaps"][this._params.colorSchema].value);this._choroplethLayer.setLineWeight(this._params.outlineWeight);this._choroplethLayer.setTooltipFormatter(this._tooltipFormatter,metricFieldFormatter,this._metricLabel);case 15:case"end":return _context4.stop()}}}),_callee4,this)})));function _updateParams(){return _updateParams2.apply(this,arguments)}return _updateParams}()},{key:"_updateChoroplethLayerForNewMetrics",value:function(){var _updateChoroplethLayerForNewMetrics2=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(name,attribution,showAllData,newMetrics){return regeneratorRuntime.wrap((function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!(this._choroplethLayer&&this._choroplethLayer.canReuseInstanceForNewMetrics(name,showAllData,newMetrics))){_context5.next=2;break}return _context5.abrupt("return");case 2:_context5.next=4;return this._recreateChoroplethLayer(name,attribution,showAllData);case 4:case"end":return _context5.stop()}}}),_callee5,this)})));function _updateChoroplethLayerForNewMetrics(_x5,_x6,_x7,_x8){return _updateChoroplethLayerForNewMetrics2.apply(this,arguments)}return _updateChoroplethLayerForNewMetrics}()},{key:"_updateChoroplethLayerForNewProperties",value:function(){var _updateChoroplethLayerForNewProperties2=_asyncToGenerator(regeneratorRuntime.mark((function _callee6(name,attribution,showAllData){return regeneratorRuntime.wrap((function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!(this._choroplethLayer&&this._choroplethLayer.canReuseInstance(name,showAllData))){_context6.next=2;break}return _context6.abrupt("return");case 2:_context6.next=4;return this._recreateChoroplethLayer(name,attribution,showAllData);case 4:case"end":return _context6.stop()}}}),_callee6,this)})));function _updateChoroplethLayerForNewProperties(_x9,_x10,_x11){return _updateChoroplethLayerForNewProperties2.apply(this,arguments)}return _updateChoroplethLayerForNewProperties}()},{key:"_recreateChoroplethLayer",value:function(){var _recreateChoroplethLayer2=_asyncToGenerator(regeneratorRuntime.mark((function _callee7(name,attribution,showAllData){var _this2=this;var selectedLayer,_yield$import2,ChoroplethLayer;return regeneratorRuntime.wrap((function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return this._loadConfig(this._params.selectedLayer);case 2:selectedLayer=_context7.sent;this._kibanaMap.removeLayer(this._choroplethLayer);if(!this._choroplethLayer){_context7.next=21;break}_context7.t0=this._choroplethLayer;_context7.t1=name;_context7.t2=attribution;_context7.t3=selectedLayer.format;_context7.t4=showAllData;_context7.t5=selectedLayer.meta;_context7.t6=selectedLayer;_context7.next=14;return getServiceSettings();case 14:_context7.t7=_context7.sent;_context7.next=17;return Object(public_["lazyLoadMapsLegacyModules"])();case 17:_context7.t8=_context7.sent.L;this._choroplethLayer=_context7.t0.cloneChoroplethLayerForNewData.call(_context7.t0,_context7.t1,_context7.t2,_context7.t3,_context7.t4,_context7.t5,_context7.t6,_context7.t7,_context7.t8);_context7.next=39;break;case 21:_context7.next=23;return Promise.all([__webpack_require__.e(1),__webpack_require__.e(2)]).then(__webpack_require__.bind(null,16));case 23:_yield$import2=_context7.sent;ChoroplethLayer=_yield$import2.ChoroplethLayer;_context7.t9=ChoroplethLayer;_context7.t10=name;_context7.t11=attribution;_context7.t12=selectedLayer.format;_context7.t13=showAllData;_context7.t14=selectedLayer.meta;_context7.t15=selectedLayer;_context7.next=34;return getServiceSettings();case 34:_context7.t16=_context7.sent;_context7.next=37;return Object(public_["lazyLoadMapsLegacyModules"])();case 37:_context7.t17=_context7.sent.L;this._choroplethLayer=new _context7.t9(_context7.t10,_context7.t11,_context7.t12,_context7.t13,_context7.t14,_context7.t15,_context7.t16,_context7.t17);case 39:this._choroplethLayer.on("select",(function(event){var _this2$_chartData=_this2._chartData,rows=_this2$_chartData.rows,columns=_this2$_chartData.columns;var rowIndex=rows.findIndex((function(row){return row[columns[0].id]===event}));_this2._vis.API.events.filter({table:_this2._chartData,column:0,row:rowIndex,value:event})}));this._choroplethLayer.on("styleChanged",(function(event){var shouldShowWarning=_this2._params.isDisplayWarning&&uiSettings.get("visualization:regionmap:showWarnings");if(event.mismatches.length>0&&shouldShowWarning){Object(kibana_services["d"])().toasts.addWarning({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.visualization.unableToShowMismatchesWarningTitle",{defaultMessage:"Unable to show {mismatchesLength} {oneMismatch, plural, one {result} other {results}} on map",values:{mismatchesLength:event.mismatches.length,oneMismatch:event.mismatches.length>1?0:1}}),text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.visualization.unableToShowMismatchesWarningText",{defaultMessage:"Ensure that each of these term matches a shape on that shape's join field: {mismatches}",values:{mismatches:event.mismatches?event.mismatches.join(", "):""}})})}}));this._kibanaMap.addLayer(this._choroplethLayer);case 42:case"end":return _context7.stop()}}}),_callee7,this)})));function _recreateChoroplethLayer(_x12,_x13,_x14){return _recreateChoroplethLayer2.apply(this,arguments)}return _recreateChoroplethLayer}()},{key:"_hasColumns",value:function _hasColumns(){return this._chartData&&this._chartData.columns.length===2}}]);return RegionMapsVisualization}(BaseMapsVisualization)}var external_kbnSharedDeps_ElasticEui_=__webpack_require__(4);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(7);function region_map_options_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function region_map_options_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){region_map_options_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){region_map_options_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}var mapLayerForOption=function mapLayerForOption(_ref){var layerId=_ref.layerId,name=_ref.name;return{text:name,value:layerId}};var mapFieldForOption=function mapFieldForOption(_ref2){var description=_ref2.description,name=_ref2.name;return{text:description,value:name}};function RegionMapOptions(props){var getServiceSettings=props.getServiceSettings,stateParams=props.stateParams,vis=props.vis,setValue=props.setValue;var vectorLayers=vis.type.editorConfig.collections.vectorLayers;var vectorLayerOptions=Object(external_kbnSharedDeps_React_["useMemo"])((function(){return vectorLayers.map(mapLayerForOption)}),[vectorLayers]);var fieldOptions=Object(external_kbnSharedDeps_React_["useMemo"])((function(){return(stateParams.selectedLayer&&stateParams.selectedLayer.fields||[]).map(mapFieldForOption)}),[stateParams.selectedLayer]);var setEmsHotLink=Object(external_kbnSharedDeps_React_["useCallback"])(function(){var _ref3=region_map_options_asyncToGenerator(regeneratorRuntime.mark((function _callee(layer){var serviceSettings,emsHotLink;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getServiceSettings();case 2:serviceSettings=_context.sent;_context.next=5;return serviceSettings.getEMSHotLink(layer);case 5:emsHotLink=_context.sent;setValue("emsHotLink",emsHotLink);case 7:case"end":return _context.stop()}}}),_callee)})));return function(_x){return _ref3.apply(this,arguments)}}(),[setValue,getServiceSettings]);var setLayer=Object(external_kbnSharedDeps_React_["useCallback"])(function(){var _ref4=region_map_options_asyncToGenerator(regeneratorRuntime.mark((function _callee2(paramName,value){var newLayer;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:newLayer=vectorLayers.find((function(_ref5){var layerId=_ref5.layerId;return layerId===value}));if(newLayer){setValue(paramName,newLayer);setValue("selectedJoinField",newLayer.fields[0]);setEmsHotLink(newLayer)}case 2:case"end":return _context2.stop()}}}),_callee2)})));return function(_x2,_x3){return _ref4.apply(this,arguments)}}(),[vectorLayers,setEmsHotLink,setValue]);var setField=Object(external_kbnSharedDeps_React_["useCallback"])((function(paramName,value){if(stateParams.selectedLayer){setValue(paramName,stateParams.selectedLayer.fields.find((function(f){return f.name===value})))}}),[setValue,stateParams.selectedLayer]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"regionMap.visParams.layerSettingsTitle",defaultMessage:"Layer settings"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(charts_public_["SelectOption"],{id:"regionMapOptionsSelectLayer",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.visParams.vectorMapLabel",{defaultMessage:"Vector map"}),labelAppend:stateParams.emsHotLink&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:stateParams.emsHotLink,target:"_blank",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.visParams.previewOnEMSLinkTitle",{defaultMessage:"Preview {selectedLayerName} on the Elastic Maps Service",values:{selectedLayerName:stateParams.selectedLayer&&stateParams.selectedLayer.name}})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"regionMap.visParams.previewOnEMSLinkText",defaultMessage:"Preview on EMS"})," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"popout",size:"s"}))),options:vectorLayerOptions,paramName:"selectedLayer",value:stateParams.selectedLayer&&stateParams.selectedLayer.layerId,setValue:setLayer}),external_kbnSharedDeps_React_default.a.createElement(charts_public_["SelectOption"],{id:"regionMapOptionsSelectJoinField",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.visParams.joinFieldLabel",{defaultMessage:"Join field"}),options:fieldOptions,paramName:"selectedJoinField",value:stateParams.selectedJoinField&&stateParams.selectedJoinField.name,setValue:setField}),external_kbnSharedDeps_React_default.a.createElement(charts_public_["SwitchOption"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.visParams.displayWarningsLabel",{defaultMessage:"Display warnings"}),tooltip:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.visParams.switchWarningsTipText",{defaultMessage:"Turns on/off warnings. When turned on, warning will be shown for each term that cannot be matched to a shape in the vector layer based on the join field. When turned off, these warnings will be turned off."}),paramName:"isDisplayWarning",value:stateParams.isDisplayWarning,setValue:setValue}),external_kbnSharedDeps_React_default.a.createElement(charts_public_["SwitchOption"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.visParams.showAllShapesLabel",{defaultMessage:"Show all shapes"}),tooltip:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.visParams.turnOffShowingAllShapesTipText",{defaultMessage:"Turning this off only shows the shapes that were matched with a corresponding term."}),paramName:"showAllShapes",value:stateParams.showAllShapes,setValue:setValue})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"regionMap.visParams.styleSettingsLabel",defaultMessage:"Style settings"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(charts_public_["SelectOption"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.visParams.colorSchemaLabel",{defaultMessage:"Color schema"}),options:vis.type.editorConfig.collections.colorSchemas,paramName:"colorSchema",value:stateParams.colorSchema,setValue:setValue}),external_kbnSharedDeps_React_default.a.createElement(charts_public_["NumberInputOption"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.visParams.outlineWeightLabel",{defaultMessage:"Border thickness"}),min:0,paramName:"outlineWeight",value:stateParams.outlineWeight,setValue:setValue})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(public_["WmsOptions"],props))}var visDefaultEditor_public_=__webpack_require__(8);function get_deprecation_message_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function get_deprecation_message_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){get_deprecation_message_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){get_deprecation_message_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function getEmsLayerId(id,layerId){if(typeof id==="string"){return id}var split=layerId.split(".");return split.length===2?split[1]:undefined}function getDeprecationMessage(vis){var mapsRegionMapUrlGenerator;try{mapsRegionMapUrlGenerator=Object(kibana_services["f"])().urlGenerators.getUrlGenerator("MAPS_APP_REGION_MAP_URL_GENERATOR")}catch(error){}var title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.mapVis.regionMapTitle",{defaultMessage:"Region Map"});function onClick(_x){return _onClick.apply(this,arguments)}function _onClick(){_onClick=get_deprecation_message_asyncToGenerator(regeneratorRuntime.mark((function _callee(e){var _vis$data$indexPatter,_vis$data$indexPatter2,_vis$data,_vis$data$aggs,_vis$data2,_vis$data2$aggs;var query,createUrlParams,bucketAggs,_bucketAggs$0$getFiel,metricAggs,_metricAggs$0$getFiel,url;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();query=Object(kibana_services["e"])();createUrlParams={label:vis.title?vis.title:title,emsLayerId:vis.params.selectedLayer.isEMS?getEmsLayerId(vis.params.selectedLayer.id,vis.params.selectedLayer.layerId):undefined,leftFieldName:vis.params.selectedLayer.isEMS?vis.params.selectedJoinField.name:undefined,colorSchema:vis.params.colorSchema,indexPatternId:(_vis$data$indexPatter=vis.data.indexPattern)===null||_vis$data$indexPatter===void 0?void 0:_vis$data$indexPatter.id,indexPatternTitle:(_vis$data$indexPatter2=vis.data.indexPattern)===null||_vis$data$indexPatter2===void 0?void 0:_vis$data$indexPatter2.title,metricAgg:"count",filters:query.filterManager.getFilters(),query:query.queryString.getQuery(),timeRange:query.timefilter.timefilter.getTime()};bucketAggs=(_vis$data=vis.data)===null||_vis$data===void 0?void 0:(_vis$data$aggs=_vis$data.aggs)===null||_vis$data$aggs===void 0?void 0:_vis$data$aggs.byType("buckets");if((bucketAggs===null||bucketAggs===void 0?void 0:bucketAggs.length)&&bucketAggs[0].type.dslName==="terms"){createUrlParams.termsFieldName=(_bucketAggs$0$getFiel=bucketAggs[0].getField())===null||_bucketAggs$0$getFiel===void 0?void 0:_bucketAggs$0$getFiel.name}metricAggs=(_vis$data2=vis.data)===null||_vis$data2===void 0?void 0:(_vis$data2$aggs=_vis$data2.aggs)===null||_vis$data2$aggs===void 0?void 0:_vis$data2$aggs.byType("metrics");if(metricAggs===null||metricAggs===void 0?void 0:metricAggs.length){createUrlParams.metricAgg=metricAggs[0].type.dslName;createUrlParams.metricFieldName=(_metricAggs$0$getFiel=metricAggs[0].getField())===null||_metricAggs$0$getFiel===void 0?void 0:_metricAggs$0$getFiel.name}_context.next=9;return mapsRegionMapUrlGenerator.createUrl(createUrlParams);case 9:url=_context.sent;Object(kibana_services["a"])().application.navigateToUrl(url);case 11:case"end":return _context.stop()}}}),_callee)})));return _onClick.apply(this,arguments)}return external_kbnSharedDeps_React_default.a.createElement(public_["LegacyMapDeprecationMessage"],{isMapsAvailable:!!mapsRegionMapUrlGenerator,onClick:onClick,visualizationLabel:title})}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function region_map_type_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function region_map_type_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){region_map_type_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){region_map_type_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function createRegionMapTypeDefinition(dependencies){var uiSettings=dependencies.uiSettings,regionmapsConfig=dependencies.regionmapsConfig,getServiceSettings=dependencies.getServiceSettings;var visualization=createRegionMapVisualization(dependencies);return{name:"region_map",getInfoMessage:getDeprecationMessage,title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.mapVis.regionMapTitle",{defaultMessage:"Region Map"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.mapVis.regionMapDescription",{defaultMessage:"Show metrics on a thematic map. Use one of the provided base maps, or add your own. Darker colors represent higher values."}),icon:"visMapRegion",visConfig:{defaults:{legendPosition:"bottomright",addTooltip:true,colorSchema:"Yellow to Red",emsHotLink:"",isDisplayWarning:true,wms:uiSettings.get("visualization:tileMap:WMSdefaults"),mapZoom:2,mapCenter:[0,0],outlineWeight:1,showAllShapes:true}},visualization:visualization,editorConfig:{optionsTemplate:function optionsTemplate(props){return external_kbnSharedDeps_React_default.a.createElement(RegionMapOptions,_extends({},props,{getServiceSettings:getServiceSettings}))},collections:{colorSchemas:charts_public_["truncatedColorSchemas"],vectorLayers:[],tmsLayers:[]},schemas:new visDefaultEditor_public_["Schemas"]([{group:"metrics",name:"metric",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.mapVis.regionMapEditorConfig.schemas.metricTitle",{defaultMessage:"Value"}),min:1,max:1,aggFilter:["count","avg","sum","min","max","cardinality","top_hits","sum_bucket","min_bucket","max_bucket","avg_bucket"],defaults:[{schema:"metric",type:"count"}]},{group:"buckets",name:"segment",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.mapVis.regionMapEditorConfig.schemas.segmentTitle",{defaultMessage:"Shape field"}),min:1,max:1,aggFilter:["terms"]}])},setup:function(){var _setup=region_map_type_asyncToGenerator(regeneratorRuntime.mark((function _callee(vis){var serviceSettings,tmsLayers,vectorLayers,selectedLayer,selectedJoinField,layers,newLayers,_vis$type$editorConfi;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getServiceSettings();case 2:serviceSettings=_context.sent;_context.next=5;return serviceSettings.getTMSServices();case 5:tmsLayers=_context.sent;vis.type.editorConfig.collections.tmsLayers=tmsLayers;if(!vis.params.wms.selectedTmsLayer&&tmsLayers.length){vis.params.wms.selectedTmsLayer=tmsLayers[0]}vectorLayers=regionmapsConfig.layers.map(util_mapToLayerWithId.bind(null,public_["ORIGIN"].KIBANA_YML));selectedLayer=vectorLayers[0];selectedJoinField=selectedLayer?selectedLayer.fields[0]:null;if(!regionmapsConfig.includeElasticMapsService){_context.next=25;break}_context.next=14;return serviceSettings.getFileLayers();case 14:layers=_context.sent;newLayers=layers.map(util_mapToLayerWithId.bind(null,public_["ORIGIN"].EMS)).filter((function(layer){return!vectorLayers.some((function(vectorLayer){return vectorLayer.layerId===layer.layerId}))}));newLayers.forEach((function(layer){if(layer.format==="geojson"){layer.format={type:"geojson"}}}));vis.type.editorConfig.collections.vectorLayers=[].concat(_toConsumableArray(vectorLayers),_toConsumableArray(newLayers));_vis$type$editorConfi=_slicedToArray(vis.type.editorConfig.collections.vectorLayers,1);selectedLayer=_vis$type$editorConfi[0];selectedJoinField=selectedLayer?selectedLayer.fields[0]:null;if(!(selectedLayer&&!vis.params.selectedLayer&&selectedLayer.isEMS)){_context.next=25;break}_context.next=24;return serviceSettings.getEMSHotLink(selectedLayer);case 24:vis.params.emsHotLink=_context.sent;case 25:if(!vis.params.selectedLayer){vis.params.selectedLayer=selectedLayer;vis.params.selectedJoinField=selectedJoinField}return _context.abrupt("return",vis);case 27:case"end":return _context.stop()}}}),_callee)})));function setup(_x){return _setup.apply(this,arguments)}return setup}()}}function plugin_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function plugin_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){plugin_ownKeys(Object(source),true).forEach((function(key){plugin_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{plugin_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function plugin_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function plugin_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function plugin_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function plugin_createClass(Constructor,protoProps,staticProps){if(protoProps)plugin_defineProperties(Constructor.prototype,protoProps);if(staticProps)plugin_defineProperties(Constructor,staticProps);return Constructor}function plugin_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var plugin_RegionMapPlugin=function(){function RegionMapPlugin(initializerContext){plugin_classCallCheck(this,RegionMapPlugin);plugin_defineProperty(this,"_initializerContext",void 0);this._initializerContext=initializerContext}plugin_createClass(RegionMapPlugin,[{key:"setup",value:function(){var _setup=plugin_asyncToGenerator(regeneratorRuntime.mark((function _callee(core,_ref){var expressions,visualizations,mapsLegacy,config,visualizationDependencies;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:expressions=_ref.expressions,visualizations=_ref.visualizations,mapsLegacy=_ref.mapsLegacy;config=plugin_objectSpread(plugin_objectSpread({},this._initializerContext.config.get()),mapsLegacy.config.regionmap);visualizationDependencies={uiSettings:core.uiSettings,regionmapsConfig:config,getServiceSettings:mapsLegacy.getServiceSettings,BaseMapsVisualization:mapsLegacy.getBaseMapsVis()};expressions.registerFunction(region_map_fn_createRegionMapFn);visualizations.createBaseVisualization(createRegionMapTypeDefinition(visualizationDependencies));return _context.abrupt("return",{config:config});case 6:case"end":return _context.stop()}}}),_callee,this)})));function setup(_x,_x2){return _setup.apply(this,arguments)}return setup}()},{key:"start",value:function start(core,plugins){Object(kibana_services["g"])(core);Object(kibana_services["h"])(plugins.data.fieldFormats);Object(kibana_services["k"])(plugins.data.query);Object(kibana_services["j"])(core.notifications);Object(kibana_services["i"])(plugins.kibanaLegacy);Object(kibana_services["l"])(plugins.share);return{}}}]);return RegionMapPlugin}();function public_plugin(initializerContext){return new plugin_RegionMapPlugin(initializerContext)}},function(module,exports){module.exports=__kbnSharedDeps__.Lodash},function(module,exports){module.exports=__kbnSharedDeps__.Jquery}]);