(window["visTypeVislib_bundle_jsonpfunction"]=window["visTypeVislib_bundle_jsonpfunction"]||[]).push([[2],{107:function(module,exports,__webpack_require__){var baseSet=__webpack_require__(50);function setWith(object,path,value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return object==null?object:baseSet(object,path,value,customizer)}module.exports=setWith},164:function(module,exports,__webpack_require__){function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}var moment=__webpack_require__(16);var unitsMap={ms:{weight:1,type:"fixed",base:1},s:{weight:2,type:"fixed",base:1e3},m:{weight:3,type:"mixed",base:1e3*60},h:{weight:4,type:"mixed",base:1e3*60*60},d:{weight:5,type:"mixed",base:1e3*60*60*24},w:{weight:6,type:"calendar",base:NaN},M:{weight:7,type:"calendar",base:NaN},y:{weight:9,type:"calendar",base:NaN}};var units=Object.keys(unitsMap).sort((function(a,b){return unitsMap[b].weight-unitsMap[a].weight}));var unitsDesc=_toConsumableArray(units);var unitsAsc=_toConsumableArray(units).reverse();var isDate=function isDate(d){return Object.prototype.toString.call(d)==="[object Date]"};var isValidDate=function isValidDate(d){return isDate(d)&&!isNaN(d.valueOf())};function parse(text){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref$roundUp=_ref.roundUp,roundUp=_ref$roundUp===void 0?false:_ref$roundUp,_ref$momentInstance=_ref.momentInstance,momentInstance=_ref$momentInstance===void 0?moment:_ref$momentInstance,forceNow=_ref.forceNow;if(!text)return undefined;if(momentInstance.isMoment(text))return text;if(isDate(text))return momentInstance(text);if(forceNow!==undefined&&!isValidDate(forceNow)){throw new Error("forceNow must be a valid Date")}var time;var mathString="";var index;var parseString;if(text.substring(0,3)==="now"){time=momentInstance(forceNow);mathString=text.substring("now".length)}else{index=text.indexOf("||");if(index===-1){parseString=text;mathString=""}else{parseString=text.substring(0,index);mathString=text.substring(index+2)}time=momentInstance(parseString)}if(!mathString.length){return time}return parseDateMath(mathString,time,roundUp)}function parseDateMath(mathString,time,roundUp){var dateTime=time;var len=mathString.length;var i=0;while(i<len){var c=mathString.charAt(i++);var type=void 0;var num=void 0;var unit=void 0;if(c==="/"){type=0}else if(c==="+"){type=1}else if(c==="-"){type=2}else{return}if(isNaN(mathString.charAt(i))){num=1}else if(mathString.length===2){num=mathString.charAt(i)}else{var numFrom=i;while(!isNaN(mathString.charAt(i))){i++;if(i>=len)return}num=parseInt(mathString.substring(numFrom,i),10)}if(type===0){if(num!==1){return}}unit=mathString.charAt(i++);for(var j=i;j<len;j++){var unitChar=mathString.charAt(i);if(/[a-z]/i.test(unitChar)){unit+=unitChar;i++}else{break}}if(units.indexOf(unit)===-1){return}else{if(type===0){if(roundUp)dateTime.endOf(unit);else dateTime.startOf(unit)}else if(type===1){dateTime.add(num,unit)}else if(type===2){dateTime.subtract(num,unit)}}}return dateTime}module.exports={parse:parse,unitsMap:Object.freeze(unitsMap),units:Object.freeze(units),unitsAsc:Object.freeze(unitsAsc),unitsDesc:Object.freeze(unitsDesc)}},165:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"Vis",(function(){return vis_Vis}));var external_kbnSharedDeps_Lodash_=__webpack_require__(6);var external_kbnSharedDeps_Lodash_default=__webpack_require__.n(external_kbnSharedDeps_Lodash_);var d3=__webpack_require__(35);var d3_default=__webpack_require__.n(d3);var events_events=__webpack_require__(63);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(1);var public_=__webpack_require__(13);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var VislibError=function(_KbnError){_inherits(VislibError,_KbnError);var _super=_createSuper(VislibError);function VislibError(message){_classCallCheck(this,VislibError);return _super.call(this,message)}_createClass(VislibError,[{key:"displayToScreen",value:function displayToScreen(handler){handler.error(this.message)}}]);return VislibError}(public_["KbnError"]);var InvalidLogScaleValues=function(_VislibError){_inherits(InvalidLogScaleValues,_VislibError);var _super2=_createSuper(InvalidLogScaleValues);function InvalidLogScaleValues(){_classCallCheck(this,InvalidLogScaleValues);return _super2.call(this,"Values less than 1 cannot be displayed on a log scale")}return InvalidLogScaleValues}(VislibError);var ContainerTooSmall=function(_VislibError2){_inherits(ContainerTooSmall,_VislibError2);var _super3=_createSuper(ContainerTooSmall);function ContainerTooSmall(){_classCallCheck(this,ContainerTooSmall);return _super3.call(this,"This container is too small to render the visualization")}return ContainerTooSmall}(VislibError);var PieContainsAllZeros=function(_VislibError3){_inherits(PieContainsAllZeros,_VislibError3);var _super4=_createSuper(PieContainsAllZeros);function PieContainsAllZeros(){_classCallCheck(this,PieContainsAllZeros);return _super4.call(this,"No results displayed because all values equal 0.")}return PieContainsAllZeros}(VislibError);var errors_NoResults=function(_VislibError4){_inherits(NoResults,_VislibError4);var _super5=_createSuper(NoResults);function NoResults(){_classCallCheck(this,NoResults);return _super5.call(this,external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVislib.vislib.errors.noResultsFoundTitle",{defaultMessage:"No results found"}))}return NoResults}(VislibError);var elastic_safer_lodash_set=__webpack_require__(40);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function getSeriId(seri){if(!seri.id){return}var bracketsMarker=seri.id.indexOf("[");if(bracketsMarker>-1){return seri.id.substring(0,bracketsMarker)}if(seri.id.indexOf(".")>-1){return seri.id.split(".")[0]}return seri.id}var createSeriesFromParams=function createSeriesFromParams(cfg,seri){var seriId=getSeriId(seri);var matchingSeriesParams=cfg.seriesParams?cfg.seriesParams.find((function(seriConfig){return seriId===seriConfig.data.id})):null;var interpolate=cfg.smoothLines?"cardinal":cfg.interpolate;if(!matchingSeriesParams){var seriesParams0=Array.isArray(cfg.seriesParams)&&cfg.seriesParams[0]?cfg.seriesParams[0]:cfg;var stacked=["stacked","percentage","wiggle","silhouette"].includes(cfg.mode);return{show:true,type:cfg.type||"line",mode:stacked?"stacked":"normal",interpolate:interpolate,drawLinesBetweenPoints:seriesParams0.drawLinesBetweenPoints,showCircles:seriesParams0.showCircles,radiusRatio:cfg.radiusRatio,data:seri}}return _objectSpread(_objectSpread({},matchingSeriesParams),{},{data:seri,radiusRatio:cfg.radiusRatio})};var point_series_createSeries=function createSeries(cfg,series){return{type:"point_series",addTimeMarker:cfg.addTimeMarker,series:external_kbnSharedDeps_Lodash_default.a.map(series,(function(seri){return createSeriesFromParams(cfg,seri)}))}};var createCharts=function createCharts(cfg,data){if(data.rows||data.columns){var charts=data.rows?data.rows:data.columns;return charts.map((function(chart){return point_series_createSeries(cfg,chart.series)}))}return[point_series_createSeries(cfg,data.series)]};function create(opts){opts=opts||{};return function(cfg,data){var isUserDefinedYAxis=cfg.setYExtents;var defaultYExtents=cfg.defaultYExtents;var config=external_kbnSharedDeps_Lodash_default.a.cloneDeep(cfg);external_kbnSharedDeps_Lodash_default.a.defaultsDeep(config,{chartTitle:{},mode:"normal"},opts);config.type="point_series";if(!config.tooltip){config.tooltip={show:cfg.addTooltip}}if(!config.valueAxes){var mode=config.mode;if(["stacked","overlap"].includes(mode))mode="normal";config.valueAxes=[{id:"ValueAxis-1",type:"value",scale:{type:config.scale,setYExtents:config.setYExtents,defaultYExtents:config.defaultYExtents,boundsMargin:defaultYExtents?config.boundsMargin:0,min:isUserDefinedYAxis?config.yAxis.min:undefined,max:isUserDefinedYAxis?config.yAxis.max:undefined,mode:mode},labels:{axisFormatter:data.data.yAxisFormatter||data.get("yAxisFormatter")},title:{text:data.get("yAxisLabel")}}]}else{config.valueAxes.forEach((function(axis){if(axis.labels){axis.labels.axisFormatter=data.data.yAxisFormatter||data.get("yAxisFormatter");var seriesParams=config.seriesParams&&config.seriesParams.find((function(seriesParams){return seriesParams.valueAxis===axis.id}));if(seriesParams){var seriesDataId=seriesParams.data.id;var series=(data.data.series||data.get("series")).find((function(series){return getSeriId(series)===seriesDataId}));if(series){axis.labels.axisFormatter=series.yAxisFormatter}}}}))}if(!config.categoryAxes){config.categoryAxes=[{id:"CategoryAxis-1",type:"category",labels:{axisFormatter:data.data.xAxisFormatter||data.get("xAxisFormatter")},scale:{expandLastBucket:opts.expandLastBucket},title:{text:data.get("xAxisLabel")}}]}else{var categoryAxis1=config.categoryAxes.find((function(categoryAxis){return categoryAxis.id==="CategoryAxis-1"}));if(categoryAxis1){categoryAxis1.title.text=data.get("xAxisLabel")}}if(!config.charts){config.charts=createCharts(cfg,data.data)}if(typeof config.enableHover==="undefined")config.enableHover=true;return config}}var vislibPointSeriesTypes={line:create(),column:create({expandLastBucket:true}),area:create({alerts:[{type:"warning",msg:"Positive and negative values are not accurately represented by stacked "+'area charts. Either changing the chart mode to "overlap" or using a '+"bar chart is recommended.",test:function test(_,data){if(!data.shouldBeStacked()||data.maxNumberOfSeries()<2)return;var hasPos=data.getYMax(data._getY)>0;var hasNeg=data.getYMin(data._getY)<0;return hasPos&&hasNeg}},{type:"warning",msg:"Parts of or the entire area chart might not be displayed due to null "+"values in the data. A line chart is recommended when displaying data "+"with null values.",test:function test(_,data){return data.hasNullValues()}}]}),heatmap:function heatmap(cfg,data){var defaults=create()(cfg,data);var hasCharts=defaults.charts.length;var tooManySeries=defaults.charts.length&&defaults.charts[0].series.length>cfg.heatmapMaxBuckets;if(hasCharts&&tooManySeries){defaults.error=external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVislib.vislib.heatmap.maxBucketsText",{defaultMessage:"There are too many series defined ({nr}). The configured maximum is {max}.",values:{max:cfg.heatmapMaxBuckets,nr:defaults.charts[0].series.length},description:"This message appears at heatmap visualizations"})}defaults.valueAxes[0].show=false;defaults.categoryAxes[0].style={rangePadding:0,rangeOuterPadding:0};defaults.categoryAxes.push({id:"CategoryAxis-2",type:"category",position:"left",values:data.getLabels(),scale:{inverted:true},labels:{filter:false,axisFormatter:function axisFormatter(val){return val}},style:{rangePadding:0,rangeOuterPadding:0},title:{text:data.get("zAxisLabel")||""}});return defaults}};function vislibPieConfig(config){if(!config.chart){config.chart=external_kbnSharedDeps_Lodash_default.a.defaults({},config,{type:"pie",labels:{show:false,truncate:100}})}return config}function vislibGaugeConfig(config){return config}var vislibTypesConfig={histogram:vislibPointSeriesTypes.column,horizontal_bar:vislibPointSeriesTypes.column,line:vislibPointSeriesTypes.line,pie:vislibPieConfig,area:vislibPointSeriesTypes.area,point_series:vislibPointSeriesTypes.line,heatmap:vislibPointSeriesTypes.heatmap,gauge:vislibGaugeConfig,goal:vislibGaugeConfig,metric:vislibGaugeConfig};var external_kbnSharedDeps_Moment_=__webpack_require__(16);var external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_);function flattenData(obj){var charts;if(!external_kbnSharedDeps_Lodash_default.a.isObject(obj)||!obj.rows&&!obj.columns&&!obj.series){throw new TypeError("flattenData expects an object with a series, rows, or columns key")}if(!obj.series){charts=obj.rows?obj.rows:obj.columns}return external_kbnSharedDeps_Lodash_default()(charts?charts:[obj]).map("series").flattenDeep().map("values").flattenDeep().filter(Boolean).value()}function uniq_keys_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function uniq_keys_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){uniq_keys_ownKeys(Object(source),true).forEach((function(key){uniq_keys_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{uniq_keys_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function uniq_keys_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function getUniqKeys(obj){if(!Object(external_kbnSharedDeps_Lodash_["isObject"])(obj)){throw new TypeError("getUniqKeys expects an object")}var flattenedData=flattenData(obj);var uniqueXValues=new Map;var charts;if(!obj.series){charts=obj.rows?obj.rows:obj.columns}else{charts=[obj]}var isDate=charts.every((function(chart){return chart.ordered&&chart.ordered.date}));var isOrdered=charts.every((function(chart){return chart.ordered}));var initXValue=function initXValue(key,index){uniqueXValues.set(key,{index:index,isDate:isDate,isOrdered:isOrdered,isNumber:Object(external_kbnSharedDeps_Lodash_["isNumber"])(key),sum:0})};if(obj.xAxisOrderedValues){obj.xAxisOrderedValues.forEach(initXValue)}flattenedData.forEach((function(d){var key=d.x;var prev=uniqueXValues.get(key);if(!prev){initXValue(key,uniqueXValues.size);prev=uniqueXValues.get(key)}uniqueXValues.set(key,uniq_keys_objectSpread(uniq_keys_objectSpread({},prev),{},{sum:prev.sum+d.y}))}));return uniqueXValues}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function orderXValues(obj){var orderBucketsBySum=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!external_kbnSharedDeps_Lodash_default.a.isObject(obj)){throw new Error("orderXValues expects an object")}var uniqKeys=getUniqKeys(obj);var uniqKeysPairs=_toConsumableArray(uniqKeys.entries());var interval=external_kbnSharedDeps_Lodash_default.a.get(obj,"ordered.interval");var dateInterval=external_kbnSharedDeps_Moment_default.a.isDuration(interval)?interval:false;return external_kbnSharedDeps_Lodash_default()(uniqKeysPairs).sortBy((function(d){if(d[1].isDate||d[1].isOrdered){return+d[0]}return orderBucketsBySum?-d[1].sum:d[1].index})).map((function(d,i,list){if(!d[1].isNumber)return d[0];var val=+d[0];if(interval==null)return val;var gapEdge=parseFloat(external_kbnSharedDeps_Lodash_default.a.get(list,[i+1,0]));if(isNaN(gapEdge))return val;var vals=[];var next=val;if(dateInterval){next=external_kbnSharedDeps_Moment_default()(val);while(next<gapEdge){vals.push(next.valueOf());next.add(dateInterval)}}else{while(next<gapEdge){vals.push(next);next+=interval}}return vals})).flatten().value()}function createZeroFilledArray(arr,label){if(!Array.isArray(arr)){throw new Error("createZeroFilledArray expects an array of strings or numbers")}var zeroFilledArray=[];arr.forEach((function(val){zeroFilledArray.push({x:val,xi:Infinity,y:0,series:label})}));return zeroFilledArray}function zeroFillDataArray(arr1,arr2){if(!Array.isArray(arr1)||!Array.isArray(arr2)){throw new TypeError("zeroFillDataArray expects 2 arrays")}var i;var val;var index;var max=arr2.length;var getX=function getX(d){return d.x===val.x};for(i=0;i<max;i++){val=arr2[i];index=external_kbnSharedDeps_Lodash_default.a.findIndex(arr1,getX);arr1.splice(index,1,val)}return arr1}function inject_zeros_injectZeros(obj,data){var orderBucketsBySum=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var keys=orderXValues(data,orderBucketsBySum);obj.forEach((function(series){var zeroArray=createZeroFilledArray(keys,series.label);series.values=zeroFillDataArray(zeroArray,series.values)}));return obj}function flattenSeries(obj){if(!external_kbnSharedDeps_Lodash_default.a.isObject(obj)||!obj.rows&&!obj.columns){throw new TypeError("GetSeriesUtilService expects an object with either a rows or columns key")}obj=obj.rows?obj.rows:obj.columns;return external_kbnSharedDeps_Lodash_default.a.chain(obj).map("series").flattenDeep().value()}function dataArray(obj){if(!external_kbnSharedDeps_Lodash_default.a.isObject(obj)||!obj.rows&&!obj.columns&&!obj.series){throw new TypeError("GetArrayUtilService expects an object with a series, rows, or columns key")}if(!obj.series)return flattenSeries(obj);return obj.series}function uniqLabels(arr){if(!Array.isArray(arr)){throw new TypeError("UniqLabelUtil expects an array of objects")}return external_kbnSharedDeps_Lodash_default()(arr).map("label").uniq().value()}function labels_labels(obj){if(!external_kbnSharedDeps_Lodash_default.a.isObject(obj)){throw new TypeError("LabelUtil expects an object")}return uniqLabels(dataArray(obj))}var services=__webpack_require__(9);function data_toConsumableArray(arr){return data_arrayWithoutHoles(arr)||data_iterableToArray(arr)||data_unsupportedIterableToArray(arr)||data_nonIterableSpread()}function data_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function data_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return data_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return data_arrayLikeToArray(o,minLen)}function data_iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function data_arrayWithoutHoles(arr){if(Array.isArray(arr))return data_arrayLikeToArray(arr)}function data_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function data_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function data_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function data_createClass(Constructor,protoProps,staticProps){if(protoProps)data_defineProperties(Constructor.prototype,protoProps);if(staticProps)data_defineProperties(Constructor,staticProps);return Constructor}var D3MappableObject=function(){function D3MappableObject(data){data_classCallCheck(this,D3MappableObject);for(var key in data){if(data.hasOwnProperty(key)){this[key]=data[key]}}}data_createClass(D3MappableObject,[{key:"toString",value:function toString(){return JSON.stringify(this)}}]);return D3MappableObject}();var data_Data=function(){function Data(data,uiState,createColorLookupFunction){data_classCallCheck(this,Data);this.uiState=uiState;this.createColorLookupFunction=createColorLookupFunction;this.data=this.copyDataObj(data);this.type=this.getDataType();this._cleanVisData();this.labels=this._getLabels(this.data);this.color=this.labels?createColorLookupFunction(this.labels,uiState.get("vis.colors")):undefined;this._normalizeOrdered()}data_createClass(Data,[{key:"copyDataObj",value:function copyDataObj(data){var copyChart=function copyChart(data){var newData={};Object.keys(data).forEach((function(key){if(key==="xAxisOrderedValues"){newData[key]=data[key].map((function(val){if(typeof val==="object"){return new D3MappableObject(val)}return val}))}else if(key==="series"){newData[key]=data[key].map((function(seri){var converter=Object(services["b"])().deserialize(seri.format);var zConverter=Object(services["b"])().deserialize(seri.zFormat);return{id:seri.id,rawId:seri.rawId,label:seri.label,zLabel:seri.zLabel,values:seri.values.map((function(val){var newVal=external_kbnSharedDeps_Lodash_default.a.clone(val);newVal.extraMetrics=val.extraMetrics;newVal.series=val.series||seri.label;if(typeof newVal.x==="object"){newVal.x=new D3MappableObject(newVal.x)}return newVal})),yAxisFormatter:function yAxisFormatter(val){return converter.convert(val)},zAxisFormatter:function zAxisFormatter(val){return zConverter.convert(val)}}}))}else{newData[key]=data[key]}}));var xConverter=Object(services["b"])().deserialize(newData.xAxisFormat);var yConverter=Object(services["b"])().deserialize(newData.yAxisFormat);var zConverter=Object(services["b"])().deserialize(newData.zAxisFormat);newData.xAxisFormatter=function(val){return xConverter.convert(val)};newData.yAxisFormatter=function(val){return yConverter.convert(val)};newData.zAxisFormatter=function(val){return zConverter.convert(val)};return newData};if(!data.series){var newData={};Object.keys(data).forEach((function(key){if(!["rows","columns"].includes(key)){newData[key]=data[key]}else{newData[key]=data[key].map((function(chart){return copyChart(chart)}))}}));return newData}return copyChart(data)}},{key:"_getLabels",value:function _getLabels(data){if(this.type==="series"){return labels_labels(data)}return[]}},{key:"getDataType",value:function getDataType(){var data=this.getVisData();var type;data.forEach((function(obj){if(obj.series){type="series"}else if(obj.slices){type="slices"}else if(obj.geoJson){type="geoJson"}}));return type}},{key:"chartData",value:function chartData(){if(!this.data.series){var arr=this.data.rows?this.data.rows:this.data.columns;return external_kbnSharedDeps_Lodash_default.a.toArray(arr)}return[this.data]}},{key:"shouldBeStacked",value:function shouldBeStacked(seriesConfig){if(!seriesConfig)return false;return seriesConfig.mode==="stacked"}},{key:"getStackedSeries",value:function getStackedSeries(chartConfig,axis,series){var _this=this;var first=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var matchingSeries=[];chartConfig.series.forEach((function(seriArgs,i){var matchingAxis=seriArgs.valueAxis===axis.axisConfig.get("id")||!seriArgs.valueAxis&&first;if(matchingAxis&&(_this.shouldBeStacked(seriArgs)||axis.axisConfig.get("scale.stacked"))){matchingSeries.push(series[i])}}));return matchingSeries}},{key:"stackChartData",value:function stackChartData(handler,data,chartConfig){var _this2=this;var stackedData={};handler.valueAxes.forEach((function(axis,i){var id=axis.axisConfig.get("id");stackedData[id]=_this2.getStackedSeries(chartConfig,axis,data,i===0);stackedData[id]=_this2.injectZeros(stackedData[id],handler.visConfig.get("orderBucketsBySum",false));axis.axisConfig.set("stackedSeries",stackedData[id].length);axis.stack(external_kbnSharedDeps_Lodash_default.a.map(stackedData[id],"values"))}));return stackedData}},{key:"stackData",value:function stackData(handler){var _this3=this;var data=this.data;if(data.rows||data.columns){var charts=data.rows?data.rows:data.columns;charts.forEach((function(chart,i){_this3.stackChartData(handler,chart.series,handler.visConfig.get("charts[".concat(i,"]")))}))}else{this.stackChartData(handler,data.series,handler.visConfig.get("charts[0]"))}}},{key:"getVisData",value:function getVisData(){var visData;if(this.data.rows){visData=this.data.rows}else if(this.data.columns){visData=this.data.columns}else{visData=[this.data]}return visData}},{key:"getGeoExtents",value:function getGeoExtents(){var visData=this.getVisData();return external_kbnSharedDeps_Lodash_default.a.reduce(external_kbnSharedDeps_Lodash_default.a.map(visData,"geoJson.properties"),(function(minMax,props){return{min:Math.min(props.min,minMax.min),max:Math.max(props.max,minMax.max)}}),{min:Infinity,max:-Infinity})}},{key:"pieData",value:function pieData(){if(!this.data.slices){return this.data.rows?this.data.rows:this.data.columns}return[this.data]}},{key:"get",value:function get(thing,def){var source=(this.data.rows||this.data.columns||[this.data])[0];return external_kbnSharedDeps_Lodash_default.a.get(source,thing,def)}},{key:"hasNullValues",value:function hasNullValues(){var chartData=this.chartData();return chartData.some((function(chart){return chart.series.some((function(obj){return obj.values.some((function(d){return d.y===null}))}))}))}},{key:"flatten",value:function flatten(){return external_kbnSharedDeps_Lodash_default()(this.chartData()).map("series").flattenDeep().map("values").flattenDeep().value()}},{key:"validateUserDefinedYMin",value:function validateUserDefinedYMin(val){if(!external_kbnSharedDeps_Lodash_default.a.isNumber(val)){throw new Error("validateUserDefinedYMin expects a number")}return val}},{key:"returnNames",value:function returnNames(array,index,columns){var names=[];var self=this;external_kbnSharedDeps_Lodash_default.a.forEach(array,(function(obj){names.push({label:obj.name,values:[obj.rawData],index:index});if(obj.children){var plusIndex=index+1;external_kbnSharedDeps_Lodash_default.a.forEach(self.returnNames(obj.children,plusIndex,columns),(function(namedObj){names.push(namedObj)}))}}));return names}},{key:"getNames",value:function getNames(data,columns){var slices=data.slices;if(slices.children){var namedObj=this.returnNames(slices.children,0,columns);return external_kbnSharedDeps_Lodash_default()(namedObj).sortBy((function(obj){return obj.index})).uniqBy((function(d){return d.label})).value()}}},{key:"_cleanVisData",value:function _cleanVisData(){var visData=this.getVisData();if(this.type==="slices"){this._cleanPieChartData(visData)}}},{key:"_cleanPieChartData",value:function _cleanPieChartData(data){var _this4=this;external_kbnSharedDeps_Lodash_default.a.forEach(data,(function(obj){obj.slices=_this4._removeZeroSlices(obj.slices)}))}},{key:"_removeZeroSlices",value:function _removeZeroSlices(slices){var _this5=this;if(!slices.children){return slices}slices=external_kbnSharedDeps_Lodash_default.a.clone(slices);slices.children=slices.children.reduce((function(children,child){if(child.size!==0){return[].concat(data_toConsumableArray(children),[_this5._removeZeroSlices(child)])}return children}),[]);return slices}},{key:"pieNames",value:function pieNames(data){var self=this;var names=[];external_kbnSharedDeps_Lodash_default.a.forEach(data,(function(obj){var columns=obj.raw?obj.raw.columns:undefined;external_kbnSharedDeps_Lodash_default.a.forEach(self.getNames(obj,columns),(function(name){names.push(name)}))}));return external_kbnSharedDeps_Lodash_default.a.uniqBy(names,"label")}},{key:"injectZeros",value:function injectZeros(data){var orderBucketsBySum=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return inject_zeros_injectZeros(data,this.data,orderBucketsBySum)}},{key:"xValues",value:function xValues(){var orderBucketsBySum=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return orderXValues(this.data,orderBucketsBySum)}},{key:"getLabels",value:function getLabels(){return labels_labels(this.data)}},{key:"getColorFunc",value:function getColorFunc(){if(this.type==="slices"){return this.getPieColorFunc()}var defaultColors=this.uiState.get("vis.defaultColors");var overwriteColors=this.uiState.get("vis.colors");var colors=defaultColors?external_kbnSharedDeps_Lodash_default.a.defaults({},overwriteColors,defaultColors):overwriteColors;return this.createColorLookupFunction(this.getLabels(),colors)}},{key:"getPieColorFunc",value:function getPieColorFunc(){return this.createColorLookupFunction(this.pieNames(this.getVisData()).map((function(d){return d.label})),this.uiState.get("vis.colors"))}},{key:"_normalizeOrdered",value:function _normalizeOrdered(){var data=this.getVisData();var self=this;data.forEach((function(d){if(!d.ordered||!d.ordered.date)return;var missingMin=d.ordered.min==null;var missingMax=d.ordered.max==null;if(missingMax||missingMin){var extent=d3_default.a.extent(self.xValues());if(missingMin)d.ordered.min=extent[0];if(missingMax)d.ordered.max=extent[1]}}))}},{key:"mapDataExtents",value:function mapDataExtents(series){var values=external_kbnSharedDeps_Lodash_default.a.map(series.rows,(function(row){return row[row.length-1]}));return[external_kbnSharedDeps_Lodash_default.a.min(values),external_kbnSharedDeps_Lodash_default.a.max(values)]}},{key:"maxNumberOfSeries",value:function maxNumberOfSeries(){return this.chartData().reduce((function(max,chart){return Math.max(max,chart.series.length)}),0)}}]);return Data}();function vis_config_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function vis_config_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){vis_config_ownKeys(Object(source),true).forEach((function(key){vis_config_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{vis_config_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function vis_config_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function vis_config_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function vis_config_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function vis_config_createClass(Constructor,protoProps,staticProps){if(protoProps)vis_config_defineProperties(Constructor.prototype,protoProps);if(staticProps)vis_config_defineProperties(Constructor,staticProps);return Constructor}var DEFAULT_VIS_CONFIG={style:{margin:{top:10,right:3,bottom:5,left:3}},alerts:[],categoryAxes:[],valueAxes:[],grid:{}};var vis_config_VisConfig=function(){function VisConfig(visConfigArgs,data,uiState,el,createColorLookupFunction){vis_config_classCallCheck(this,VisConfig);this.data=new data_Data(data,uiState,createColorLookupFunction);var visType=vislibTypesConfig[visConfigArgs.type];var typeDefaults=visType(visConfigArgs,this.data);this._values=external_kbnSharedDeps_Lodash_default.a.defaultsDeep(vis_config_objectSpread({},typeDefaults),DEFAULT_VIS_CONFIG);this._values.el=el}vis_config_createClass(VisConfig,[{key:"get",value:function get(property,defaults){if(external_kbnSharedDeps_Lodash_default.a.has(this._values,property)||typeof defaults!=="undefined"){return external_kbnSharedDeps_Lodash_default.a.get(this._values,property,defaults)}else{throw new Error("Accessing invalid config property: ".concat(property));return defaults}}},{key:"set",value:function set(property,value){return Object(elastic_safer_lodash_set["set"])(this._values,property,value)}}]);return VisConfig}();var markdown_it=__webpack_require__(108);var markdown_it_default=__webpack_require__.n(markdown_it);var external_kbnSharedDeps_Jquery_=__webpack_require__(15);var external_kbnSharedDeps_Jquery_default=__webpack_require__.n(external_kbnSharedDeps_Jquery_);function chartSplit(selection,parent){selection.each((function(data){var div=d3_default.a.select(this).attr("class",(function(){if(data.rows){return"visWrapper__splitCharts--row"}else if(data.columns){return"visWrapper__splitCharts--column"}else{if(parent){return"visWrapper__chart--first visWrapper__chart--last visWrapper__chart"}return this.className+" visWrapper__chart"}}));var divClass="";var chartsNumber;var charts=div.selectAll("charts").append("div").data((function(d){if(d.rows){chartsNumber=d.rows.length;return d.rows}else if(d.columns){chartsNumber=d.columns.length;return d.columns}else{divClass="chart";chartsNumber=1;return[d]}})).enter().append("div").attr("class",(function(d,i){var fullDivClass=divClass;if(fullDivClass!=="chart"){if(chartsNumber>1){if(i===0){fullDivClass+=" visWrapper__chart--first"}else if(i===chartsNumber-1){fullDivClass+=" visWrapper__chart--last"}}else{fullDivClass+=" visWrapper__chart--first visWrapper__chart--last"}}return fullDivClass}));if(!data.series){charts.call(chartSplit)}}))}function yAxisSplit(selection){selection.each((function(){var div=d3_default.a.select(this);var rows;div.selectAll(".y-axis-div").append("div").data((function(d){rows=d.rows?d.rows.length:1;return d.rows?d.rows:[d]})).enter().append("div").attr("class",(function(d,i){var divClass="";if(i===0){divClass+=" visWrapper__chart--first"}if(i===rows-1){divClass+=" visWrapper__chart--last"}return"y-axis-div axis-div"+divClass}))}))}function xAxisSplit(selection){selection.each((function(){var div=d3_default.a.select(this);var columns;div.selectAll(".x-axis-div").append("div").data((function(d){columns=d.columns?d.columns.length:1;return d.columns?d.columns:[d]})).enter().append("div").attr("class",(function(d,i){var divClass="";if(i===0){divClass+=" visWrapper__chart--first"}if(i===columns-1){divClass+=" visWrapper__chart--last"}return"x-axis-div axis-div"+divClass}))}))}function chartTitleSplit(selection){selection.each((function(data){var div=d3_default.a.select(this);var parent=external_kbnSharedDeps_Jquery_default()(this).parents(".visWrapper");if(!data.series){div.selectAll(".chart-title").data((function(d){return d.rows?d.rows:d.columns})).enter().append("div").attr("class","chart-title");if(data.rows){parent.find(".visAxis__splitTitles--x").remove()}else{parent.find(".visAxis__splitTitles--y").remove()}return div}return d3_default.a.select(this).remove()}))}function columnLayout(el,data){if(!el||!data){throw new Error("Both an el and data need to be specified")}return[{parent:el,type:"div",class:"visWrapper",datum:data,children:[{type:"div",class:"visAxis--y",children:[{type:"div",class:"visAxis__spacer--y visAxis__spacer--y-top"},{type:"div",class:"visAxis__column--y visAxis__column--left",children:[{type:"div",class:"visAxis__splitTitles--y",splits:chartTitleSplit},{type:"div",class:"visAxis__splitAxes--y",splits:yAxisSplit}]},{type:"div",class:"visAxis__spacer--y visAxis__spacer--y-bottom"}]},{type:"div",class:"visWrapper__column",children:[{type:"div",class:"visAxis--x visAxis__column--top",children:[{type:"div",class:"visAxis__splitAxes--x",splits:xAxisSplit}]},{type:"div",class:"visWrapper__chart",splits:chartSplit},{type:"div",class:"visWrapper__alerts"},{type:"div",class:"visAxis--x visAxis__column--bottom",children:[{type:"div",class:"visAxis__splitAxes--x",splits:xAxisSplit},{type:"div",class:"visAxis__splitTitles--x",splits:chartTitleSplit}]}]},{type:"div",class:"visAxis--y",children:[{type:"div",class:"visAxis__spacer--y visAxis__spacer--y-top"},{type:"div",class:"visAxis__column--y visAxis__column--right",children:[{type:"div",class:"visAxis__splitAxes--y",splits:yAxisSplit}]},{type:"div",class:"visAxis__spacer--y visAxis__spacer--y-bottom"}]}]}]}function chart_split_chartSplit(selection){selection.each((function(data){var div=d3_default.a.select(this).attr("class",(function(){if(data.rows){return"visWrapper__splitCharts--row"}else if(data.columns){return"visWrapper__splitCharts--column"}else{return"visWrapper__chart"}}));var divClass;var charts=div.selectAll("charts").append("div").data((function(d){if(d.rows){divClass="chart-row";return d.rows}else if(d.columns){divClass="chart-column";return d.columns}else{divClass="chart";return[d]}})).enter().append("div").attr("class",(function(){return divClass}));if(!data.slices){charts.call(chart_split_chartSplit)}}))}function chart_title_split_chartTitleSplit(selection,parent){selection.each((function(data){var div=d3_default.a.select(this);if(!data.slices){div.selectAll(".chart-title").append("div").data((function(d){return d.rows?d.rows:d.columns})).enter().append("div").attr("class","chart-title");if(data.rows){d3_default.a.select(parent).select(".visAxis__splitTitles--x").remove()}else{d3_default.a.select(parent).select(".visAxis__splitTitles--y").remove()}return div}return d3_default.a.select(this).remove()}))}function pieLayout(el,data){if(!el||!data){throw new Error("Both an el and data need to be specified")}return[{parent:el,type:"div",class:"visWrapper",datum:data,children:[{type:"div",class:"visAxis__splitTitles--y",splits:chart_title_split_chartTitleSplit},{type:"div",class:"visWrapper__column",children:[{type:"div",class:"visWrapper__chart",splits:chart_split_chartSplit},{type:"div",class:"visAxis__splitTitles--x",splits:chart_title_split_chartTitleSplit}]}]}]}function gauge_chart_chart_split_chartSplit(selection){selection.each((function(data){var div=d3_default.a.select(this).attr("class",(function(){if(data.rows){return"visWrapper__splitCharts--row"}else if(data.columns){return"visWrapper__splitCharts--column"}else{return"visWrapper__chart"}}));var divClass;var charts=div.selectAll("charts").append("div").data((function(d){if(d.rows){divClass="chart-row";return d.rows}else if(d.columns){divClass="chart-column";return d.columns}else{divClass="chart";return[d]}})).enter().append("div").attr("class",(function(){return divClass}));if(!data.series){charts.call(gauge_chart_chart_split_chartSplit)}}))}function gaugeLayout(el,data){if(!el||!data){throw new Error("Both an el and data need to be specified")}return[{parent:el,type:"div",class:"visWrapper",datum:data,children:[{type:"div",class:"visAxis__splitTitles--y"},{type:"div",class:"visWrapper__column",children:[{type:"div",class:"visWrapper__chart",splits:gauge_chart_chart_split_chartSplit},{type:"div",class:"visWrapper__alerts"},{type:"div",class:"visAxis__splitTitles--x"}]}]}]}var layoutTypes={pie:pieLayout,gauge:gaugeLayout,goal:gaugeLayout,metric:gaugeLayout,point_series:columnLayout};function _error_handler_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _error_handler_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _error_handler_createClass(Constructor,protoProps,staticProps){if(protoProps)_error_handler_defineProperties(Constructor.prototype,protoProps);if(staticProps)_error_handler_defineProperties(Constructor,staticProps);return Constructor}var _error_handler_ErrorHandler=function(){function ErrorHandler(){_error_handler_classCallCheck(this,ErrorHandler)}_error_handler_createClass(ErrorHandler,[{key:"validateWidthandHeight",value:function validateWidthandHeight(width,height){var badWidth=external_kbnSharedDeps_Lodash_default.a.isNaN(width)||width<=0;var badHeight=external_kbnSharedDeps_Lodash_default.a.isNaN(height)||height<=0;if(badWidth||badHeight){throw new ContainerTooSmall}}}]);return ErrorHandler}();function axis_title_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function axis_title_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function axis_title_createClass(Constructor,protoProps,staticProps){if(protoProps)axis_title_defineProperties(Constructor.prototype,protoProps);if(staticProps)axis_title_defineProperties(Constructor,staticProps);return Constructor}var axis_title_AxisTitle=function(){function AxisTitle(axisConfig){axis_title_classCallCheck(this,AxisTitle);this.axisConfig=axisConfig;this.elSelector=this.axisConfig.get("title.elSelector").replace("{pos}",this.axisConfig.get("position"))}axis_title_createClass(AxisTitle,[{key:"render",value:function render(){d3_default.a.select(this.axisConfig.get("rootEl")).selectAll(this.elSelector).call(this.draw())}},{key:"destroy",value:function destroy(){external_kbnSharedDeps_Jquery_default()(this.axisConfig.get("rootEl")).find(this.elSelector).find("svg").remove()}},{key:"draw",value:function draw(){var config=this.axisConfig;return function(selection){selection.each((function(){if(!config.get("show")&&!config.get("title.show",false))return;var el=this;var div=d3_default.a.select(el);var width=external_kbnSharedDeps_Jquery_default()(el).width();var height=external_kbnSharedDeps_Jquery_default()(el).height();var axisPrefix=config.isHorizontal()?"x":"y";var svg=div.append("svg").attr("focusable","false").attr("width",width).attr("height",height).attr("class","axis-title ".concat(axisPrefix,"-axis-title"));var bbox=svg.append("text").attr("transform",(function(){if(config.isHorizontal()){return"translate(".concat(width/2,",0)")}return"translate(0,".concat(height/2,") rotate(270)")})).attr("text-anchor","middle").attr("dominant-baseline","hanging").text(config.get("title.text")).node().getBBox();if(config.isHorizontal()){svg.attr("height",Math.ceil(bbox.height))}else{svg.attr("width",Math.ceil(bbox.height))}}))}}}]);return AxisTitle}();var truncate_labels_truncateLabel=function truncateLabel(text,size){var node=d3_default.a.select(text).node();var str=external_kbnSharedDeps_Jquery_default()(node).text();if(size===0)return str;if(size>=str.length)return str;return str.substr(0,size)+"…"};function axis_labels_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function axis_labels_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function axis_labels_createClass(Constructor,protoProps,staticProps){if(protoProps)axis_labels_defineProperties(Constructor.prototype,protoProps);if(staticProps)axis_labels_defineProperties(Constructor,staticProps);return Constructor}var axis_labels_AxisLabels=function(){function AxisLabels(axisConfig,scale){axis_labels_classCallCheck(this,AxisLabels);this.axisConfig=axisConfig;this.axisScale=scale}axis_labels_createClass(AxisLabels,[{key:"render",value:function render(selection){selection.call(this.draw())}},{key:"rotateAxisLabels",value:function rotateAxisLabels(){var config=this.axisConfig;return function(selection){var text=selection.selectAll(".tick text");if(config.get("labels.rotate")){text.style("text-anchor",(function(){var currentValue=external_kbnSharedDeps_Jquery_default()(this).css("text-anchor");var rotateDeg=config.get("labels.rotate");if(!rotateDeg)return currentValue;else{var position=config.get("position");switch(position){case"top":return"end";case"bottom":return"end";default:if(rotateDeg===90||rotateDeg===-90)return"middle";return currentValue}}})).attr("dy",(function(){return config.isHorizontal()?"0.3em":"0"})).attr("transform",(function rotate(d,j){var position=config.get("position");var rotateDeg=position==="top"?config.get("labels.rotate"):-config.get("labels.rotate");if(external_kbnSharedDeps_Jquery_default()(this).css("text-anchor")==="middle"){var coord=text[0][j].getBBox();var transX=coord.x+coord.width/2;var transY=coord.y+coord.height/2;return"rotate(".concat(rotateDeg,", ").concat(transX,", ").concat(transY,")")}else{var _transX=this.attributes.x.nodeValue;var _transY=this.attributes.y.nodeValue;return"rotate(".concat(rotateDeg,", ").concat(_transX,", ").concat(_transY,")")}}))}}}},{key:"truncateLabels",value:function truncateLabels(){var config=this.axisConfig;return function(selection){if(!config.get("labels.truncate"))return;selection.selectAll(".tick text").text((function(){return truncate_labels_truncateLabel(this,config.get("labels.truncate"))}))}}},{key:"filterAxisLabels",value:function filterAxisLabels(){var self=this;var config=this.axisConfig;var padding=1.1;var lastTickStartEdge=Number.POSITIVE_INFINITY;var lastTickEndEdge=Number.NEGATIVE_INFINITY;return function(selection){if(!config.get("labels.filter"))return;var el=external_kbnSharedDeps_Jquery_default()(config.get("rootEl")).find(config.get("elSelector"));var upperBound=config.isHorizontal()?el.width():el.height();var lowerBound=0;var scaleRange=self.axisScale.scale.range();var scaleWidth=Math.abs(scaleRange[scaleRange.length-1]-scaleRange[0]);var scaleStartPad=.5*(upperBound-scaleWidth);selection.selectAll(".tick text").text((function(d){var parentNode=d3_default.a.select(this.parentNode).node();var currentTickCenter=config.isHorizontal()?scaleStartPad+self.axisScale.scale(d):upperBound-scaleStartPad-self.axisScale.scale(d);var currentTickSize=(config.isHorizontal()?parentNode.getBBox().width:parentNode.getBBox().height)*padding;var currentTickHalfSize=currentTickSize/2;var currentTickStartEdge=currentTickCenter-currentTickHalfSize;var currentTickEndEdge=currentTickCenter+currentTickHalfSize;var outsideUpperBound=currentTickEndEdge>upperBound;var outsideLowerBound=currentTickStartEdge<lowerBound;var overlapsLastTick=currentTickEndEdge>=lastTickStartEdge&&currentTickStartEdge<=lastTickEndEdge;if(outsideUpperBound||outsideLowerBound||overlapsLastTick){d3_default.a.select(this.parentNode).remove()}else{lastTickStartEdge=currentTickCenter-currentTickHalfSize;lastTickEndEdge=currentTickCenter+currentTickHalfSize;return this.textContent}}))}}},{key:"draw",value:function draw(){var self=this;var config=this.axisConfig;return function(selection){selection.each((function(){selection.selectAll("text").attr("style",(function(){var currentStyle=d3_default.a.select(this).attr("style");return"".concat(currentStyle," font-size: ").concat(config.get("labels.fontSize"),";")}));if(!config.get("labels.show"))selection.selectAll("text").attr("style","display: none;");selection.call(self.truncateLabels());selection.call(self.rotateAxisLabels());selection.call(self.filterAxisLabels())}))}}}]);return AxisLabels}();var time_ticks_timeTicks=function timeTicks(scale){var domain=scale.domain();var startOffset=external_kbnSharedDeps_Moment_default()(domain[0]).utcOffset();var shiftedDomain=domain.map((function(val){return external_kbnSharedDeps_Moment_default()(val).add(startOffset,"minute")}));var tickScale=scale.copy().domain(shiftedDomain);return function(n){var ticks=tickScale.ticks(n);var timePerTick=(domain[1]-domain[0])/ticks.length;var hourTicks=timePerTick<1e3*60*60*12;return ticks.map((function(d){var currentOffset=external_kbnSharedDeps_Moment_default()(d).utcOffset();return external_kbnSharedDeps_Moment_default()(d).subtract(hourTicks?startOffset:currentOffset,"minute").valueOf()}))}};function axis_scale_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function axis_scale_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function axis_scale_createClass(Constructor,protoProps,staticProps){if(protoProps)axis_scale_defineProperties(Constructor.prototype,protoProps);if(staticProps)axis_scale_defineProperties(Constructor,staticProps);return Constructor}var axis_scale_AxisScale=function(){function AxisScale(axisConfig,visConfig){axis_scale_classCallCheck(this,AxisScale);this.axisConfig=axisConfig;this.visConfig=visConfig;if(this.axisConfig.get("type")==="category"){this.values=this.axisConfig.values;this.ordered=this.axisConfig.ordered}}axis_scale_createClass(AxisScale,[{key:"getScaleType",value:function getScaleType(){return this.axisConfig.getScaleType()}},{key:"validateUserExtents",value:function validateUserExtents(domain){var config=this.axisConfig;return domain.map((function(val){val=parseFloat(val);if(isNaN(val))throw new Error(val+" is not a valid number");if(config.isPercentage()&&config.isUserDefined())return val/100;return val}))}},{key:"getTimeDomain",value:function getTimeDomain(data){return[this.minExtent(data),this.maxExtent(data)]}},{key:"minExtent",value:function minExtent(data){return this.calculateExtent(data||this.values,"min")}},{key:"maxExtent",value:function maxExtent(data){return this.calculateExtent(data||this.values,"max")}},{key:"calculateExtent",value:function calculateExtent(data,extent){var ordered=this.ordered;var opts=[ordered[extent]];var point=d3_default.a[extent](data);if(this.axisConfig.get("scale.expandLastBucket")&&extent==="max"){point=this.addInterval(point)}opts.push(point);return d3_default.a[extent](opts.reduce((function(opts,v){if(!external_kbnSharedDeps_Lodash_default.a.isNumber(v))v=+v;if(!isNaN(v))opts.push(v);return opts}),[]))}},{key:"addInterval",value:function addInterval(x){return this.modByInterval(x,+1)}},{key:"subtractInterval",value:function subtractInterval(x){return this.modByInterval(x,-1)}},{key:"modByInterval",value:function modByInterval(x,n){var ordered=this.ordered;if(!ordered)return x;var interval=ordered.interval;if(!interval)return x;if(!ordered.date){return x+=ordered.interval*n}var y=external_kbnSharedDeps_Moment_default()(x);var method=n>0?"add":"subtract";external_kbnSharedDeps_Lodash_default.a.times(Math.abs(n),(function(){y[method](interval)}));return y.valueOf()}},{key:"getAllPoints",value:function getAllPoints(){var _this=this;var config=this.axisConfig;var data=this.visConfig.data.chartData();var chartPoints=external_kbnSharedDeps_Lodash_default.a.reduce(data,(function(chartPoints,chart,chartIndex){var points=chart.series.reduce((function(points,seri,seriIndex){var seriConfig=_this.visConfig.get("charts[".concat(chartIndex,"].series[").concat(seriIndex,"]"));var matchingValueAxis=!!seriConfig.valueAxis&&seriConfig.valueAxis===config.get("id");var isFirstAxis=config.get("id")===_this.visConfig.get("valueAxes[0].id");if(matchingValueAxis||!seriConfig.valueAxis&&isFirstAxis){var axisPoints=seri.values.map((function(val){if(val.y0){return val.y0+val.y}return val.y}));return points.concat(axisPoints)}return points}),[]);return chartPoints.concat(points)}),[]);return chartPoints}},{key:"getYMin",value:function getYMin(){return d3_default.a.min(this.getAllPoints())}},{key:"getYMax",value:function getYMax(){return d3_default.a.max(this.getAllPoints())}},{key:"getExtents",value:function getExtents(){if(this.axisConfig.get("type")==="category"){if(this.axisConfig.isTimeDomain())return this.getTimeDomain(this.values);if(this.axisConfig.isOrdinal())return this.values}var min=this.axisConfig.get("scale.min",this.getYMin());var max=this.axisConfig.get("scale.max",this.getYMax());var domain=[min,max];if(this.axisConfig.isUserDefined())return this.validateUserExtents(domain);if(this.axisConfig.isLogScale())return this.logDomain(min,max);if(this.axisConfig.isYExtents()){var scaleBoundsMargin=this.axisConfig.get("scale.boundsMargin");if(scaleBoundsMargin===0){return domain}else{if(max<0){domain[1]=domain[1]+scaleBoundsMargin}if(min>0){domain[0]=domain[0]-scaleBoundsMargin}return domain}}return[Math.min(0,min),Math.max(0,max)]}},{key:"getDomain",value:function getDomain(length){var domain=this.getExtents();var pad=this.axisConfig.get("padForLabels");if(pad>0&&this.canApplyNice()){var domainLength=domain[1]-domain[0];var valuePerPixel=domainLength/length;var padValue=valuePerPixel*pad;if(domain[0]<0){domain[0]-=padValue}domain[1]+=padValue}return domain}},{key:"getRange",value:function getRange(length){if(this.axisConfig.isHorizontal()){return!this.axisConfig.get("scale.inverted")?[0,length]:[length,0]}else{return this.axisConfig.get("scale.inverted")?[0,length]:[length,0]}}},{key:"throwCustomError",value:function throwCustomError(message){throw new Error(message)}},{key:"throwLogScaleValuesError",value:function throwLogScaleValuesError(){throw new InvalidLogScaleValues}},{key:"logDomain",value:function logDomain(min,max){if(min<0||max<0)return this.throwLogScaleValuesError();return[1,max]}},{key:"getD3Scale",value:function getD3Scale(scaleTypeArg){var scaleType=scaleTypeArg||"linear";if(scaleType==="square root")scaleType="sqrt";if(this.axisConfig.isTimeDomain()){return d3_default.a.time.scale.utc()}if(this.axisConfig.isOrdinal())return d3_default.a.scale.ordinal();if(typeof d3_default.a.scale[scaleType]!=="function"){return this.throwCustomError("Axis.getScaleType: ".concat(scaleType," is not a function"))}return d3_default.a.scale[scaleType]()}},{key:"canApplyNice",value:function canApplyNice(){var config=this.axisConfig;return!config.isUserDefined()&&!config.isYExtents()&&!config.isOrdinal()&&!config.isTimeDomain()}},{key:"getScale",value:function getScale(length){var config=this.axisConfig;var scale=this.getD3Scale(config.getScaleType());var domain=this.getDomain(length);var range=this.getRange(length);var padding=config.get("style.rangePadding");var outerPadding=config.get("style.rangeOuterPadding");this.scale=scale.domain(domain);if(config.isOrdinal()){this.scale.rangeBands(range,padding,outerPadding)}else{this.scale.range(range)}if(this.canApplyNice())this.scale.nice();if(this.scale.clamp)this.scale.clamp(true);this.validateScale(this.scale);if(this.axisConfig.isTimeDomain()){this.scale.timezoneCorrectedTicks=time_ticks_timeTicks(scale)}return this.scale}},{key:"validateScale",value:function validateScale(scale){if(!scale||external_kbnSharedDeps_Lodash_default.a.isNaN(scale))throw new Error("scale is "+scale)}}]);return AxisScale}();var SCALE_MODES={NORMAL:"normal",PERCENTAGE:"percentage",WIGGLE:"wiggle",SILHOUETTE:"silhouette",GROUPED:"grouped",ALL:["normal","percentage","wiggle","silhouette"]};function axis_config_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function axis_config_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function axis_config_createClass(Constructor,protoProps,staticProps){if(protoProps)axis_config_defineProperties(Constructor.prototype,protoProps);if(staticProps)axis_config_defineProperties(Constructor,staticProps);return Constructor}var axis_config_defaults={show:true,type:"value",elSelector:".visAxis__column--{pos} .axis-div",position:"left",scale:{type:"linear",expandLastBucket:true,inverted:false,defaultYExtents:null,boundsMargin:0,setYExtents:null,min:null,max:null,mode:SCALE_MODES.NORMAL},style:{color:"#ddd",lineWidth:"1px",opacity:1,tickColor:"#ddd",tickWidth:"1px",tickLength:"6px",rangePadding:.1,rangeOuterPadding:0},labels:{axisFormatter:null,show:true,rotate:0,rotateAnchor:"center",filter:false,color:"#ddd",font:'"Open Sans", "Lato", "Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"8pt",truncate:100},title:{text:"",elSelector:".visAxis__column--{pos} .axis-div"},padForLabels:0};var padForLabelsX=40;var padForLabelsY=15;var categoryDefaults={type:"category",position:"bottom"};var valueDefaults={labels:{axisFormatter:d3_default.a.format("n")}};var horizontalDefaults={labels:{rotate:0,rotateAnchor:"end",filter:true,truncate:0}};var verticalDefaults={labels:{rotateAnchor:"middle"}};var axis_config_AxisConfig=function(){function AxisConfig(chartConfig,axisConfigArgs){axis_config_classCallCheck(this,AxisConfig);var isCategoryType=axisConfigArgs.type==="category";var typeDefaults=isCategoryType?external_kbnSharedDeps_Lodash_default.a.cloneDeep(categoryDefaults):external_kbnSharedDeps_Lodash_default.a.cloneDeep(valueDefaults);var axisConfigArgsClone=external_kbnSharedDeps_Lodash_default.a.cloneDeep(axisConfigArgs);var isCategoryAxis=axisConfigArgsClone.type==="category";var isHorizontal=axisConfigArgsClone.position&&["top","bottom"].includes(axisConfigArgsClone.position);external_kbnSharedDeps_Lodash_default.a.merge(typeDefaults,isHorizontal||isCategoryAxis?horizontalDefaults:verticalDefaults);this._values=external_kbnSharedDeps_Lodash_default.a.defaultsDeep({},axisConfigArgsClone,typeDefaults,axis_config_defaults);this._values.elSelector=this._values.elSelector.replace("{pos}",this._values.position);this._values.rootEl=chartConfig.get("el");this.data=chartConfig.data;if(isCategoryAxis){if(!this._values.values){this.values=this.data.xValues(chartConfig.get("orderBucketsBySum",false));this.ordered=this.data.get("ordered")}else{this.values=this._values.values}if(!this._values.labels.axisFormatter){this._values.labels.axisFormatter=this.data.data.xAxisFormatter||this.data.get("xAxisFormatter")}}if(this.get("type")==="value"){var isWiggleOrSilhouette=this.get("scale.mode")===SCALE_MODES.WIGGLE||this.get("scale.mode")===SCALE_MODES.SILHOUETTE;if(isWiggleOrSilhouette){this._values.scale.defaultYExtents=false;if(!axisConfigArgs.show){this._values.show=false;this._values.title.show=true}}if(this.isLogScale()){this._values.labels.filter=true}}if(axisConfigArgs.title==null||axisConfigArgs.title.text==null){var label=isCategoryAxis?"xAxisLabel":"yAxisLabel";this.set("title.text",this.data.get(label))}if(this.isHorizontal()&&this.isOrdinal()){this._values.labels.filter=external_kbnSharedDeps_Lodash_default.a.get(axisConfigArgs,"labels.filter",false);this._values.labels.rotate=external_kbnSharedDeps_Lodash_default.a.get(axisConfigArgs,"labels.rotate",90);this._values.labels.truncate=external_kbnSharedDeps_Lodash_default.a.get(axisConfigArgs,"labels.truncate",100)}if(this.get("type")==="category"&&!this.isHorizontal()){this._values.scale.inverted=external_kbnSharedDeps_Lodash_default.a.get(axisConfigArgs,"scale.inverted",true)}if(chartConfig.get("labels.show",false)&&!isCategoryAxis){this._values.padForLabels=isHorizontal?padForLabelsX:padForLabelsY}var offset;var stacked=true;switch(this.get("scale.mode")){case SCALE_MODES.NORMAL:offset="zero";stacked=false;break;case SCALE_MODES.GROUPED:offset="group";stacked=false;break;case SCALE_MODES.PERCENTAGE:offset=function expand(data){var n=data.length;var m=data[0].length;var y0=[];for(var j=0;j<m;++j){var o=0;for(var i=0;i<n;i++){o+=data[i][j][1]}if(o){for(var _i=0;_i<n;_i++){data[_i][j][1]/=o}}}for(var _j=0;_j<m;++_j){y0[_j]=0}return y0};break;default:offset=this.get("scale.mode")}this.set("scale.offset",external_kbnSharedDeps_Lodash_default.a.get(axisConfigArgs,"scale.offset",offset));this.set("scale.stacked",stacked)}axis_config_createClass(AxisConfig,[{key:"get",value:function get(property,defaults){if(typeof defaults==="undefined"&&!external_kbnSharedDeps_Lodash_default.a.has(this._values,property)){throw new Error("Accessing invalid config property: ".concat(property))}var val=external_kbnSharedDeps_Lodash_default.a.get(this._values,property,defaults);if(val==null&&defaults!=null)return defaults;return val}},{key:"set",value:function set(property,value){return Object(elastic_safer_lodash_set["set"])(this._values,property,value)}},{key:"isHorizontal",value:function isHorizontal(){return this._values.position==="top"||this._values.position==="bottom"}},{key:"isOrdinal",value:function isOrdinal(){return!!this.values&&!this.isTimeDomain()}},{key:"isTimeDomain",value:function isTimeDomain(){return this.ordered&&this.ordered.date}},{key:"isPercentage",value:function isPercentage(){return this._values.scale.mode===SCALE_MODES.PERCENTAGE}},{key:"isUserDefined",value:function isUserDefined(){return this._values.scale.setYExtents}},{key:"isYExtents",value:function isYExtents(){return this._values.scale.defaultYExtents}},{key:"isLogScale",value:function isLogScale(){return this.getScaleType()==="log"}},{key:"getScaleType",value:function getScaleType(){return this._values.scale.type}}]);return AxisConfig}();function axis_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function axis_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function axis_createClass(Constructor,protoProps,staticProps){if(protoProps)axis_defineProperties(Constructor.prototype,protoProps);if(staticProps)axis_defineProperties(Constructor,staticProps);return Constructor}function axis_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)axis_setPrototypeOf(subClass,superClass)}function axis_setPrototypeOf(o,p){axis_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return axis_setPrototypeOf(o,p)}function axis_createSuper(Derived){var hasNativeReflectConstruct=axis_isNativeReflectConstruct();return function _createSuperInternal(){var Super=axis_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=axis_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return axis_possibleConstructorReturn(this,result)}}function axis_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return axis_assertThisInitialized(self)}function axis_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function axis_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function axis_getPrototypeOf(o){axis_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return axis_getPrototypeOf(o)}var axis_Axis=function(_ErrorHandler){axis_inherits(Axis,_ErrorHandler);var _super=axis_createSuper(Axis);function Axis(visConfig,axisConfigArgs){var _this;axis_classCallCheck(this,Axis);_this=_super.call(this);_this.visConfig=visConfig;_this.axisConfig=new axis_config_AxisConfig(_this.visConfig,axisConfigArgs);if(_this.axisConfig.get("type")==="category"){_this.values=_this.axisConfig.values;_this.ordered=_this.axisConfig.ordered}_this.axisScale=new axis_scale_AxisScale(_this.axisConfig,visConfig);_this.axisTitle=new axis_title_AxisTitle(_this.axisConfig);_this.axisLabels=new axis_labels_AxisLabels(_this.axisConfig,_this.axisScale);_this.stack=d3_default.a.layout.stack().x((function(d){return d.x})).y((function(d){if(typeof _this.axisConfig.get("scale.offset")==="function"&&_this.axisConfig.get("scale.offset").name==="expand"){return Math.abs(d.y)}return d.y})).offset(_this.axisConfig.get("scale.offset","zero"));var stackedMode=["normal","grouped"].includes(_this.axisConfig.get("scale.mode"));if(stackedMode){_this.stack=_this._stackNegAndPosVals}return _this}axis_createClass(Axis,[{key:"_stackNegAndPosVals",value:function _stackNegAndPosVals(data){var cache={};data.forEach((function(series){series.forEach((function(value){if(!cache[value.x])cache[value.x]=[0,0];value.y0=cache[value.x][value.y<0?0:1];cache[value.x][value.y<0?0:1]+=value.y}))}));return data}},{key:"render",value:function render(){var elSelector=this.axisConfig.get("elSelector");var rootEl=this.axisConfig.get("rootEl");d3_default.a.select(rootEl).selectAll(elSelector).call(this.draw())}},{key:"destroy",value:function destroy(){var elSelector=this.axisConfig.get("elSelector");var rootEl=this.axisConfig.get("rootEl");external_kbnSharedDeps_Jquery_default()(rootEl).find(elSelector).find("svg").remove();this.axisTitle.destroy()}},{key:"getAxis",value:function getAxis(length){var scale=this.axisScale.getScale(length);var position=this.axisConfig.get("position");var axisFormatter=this.axisConfig.get("labels.axisFormatter");var d3Axis=d3_default.a.svg.axis().scale(scale).tickFormat(axisFormatter).orient(position);if(this.axisConfig.isTimeDomain()){d3Axis.tickValues(scale.timezoneCorrectedTicks(this.tickScale(length)))}else{d3Axis.ticks(this.tickScale(length))}return d3Axis}},{key:"getScale",value:function getScale(){return this.axisScale.scale}},{key:"addInterval",value:function addInterval(interval){return this.axisScale.addInterval(interval)}},{key:"substractInterval",value:function substractInterval(interval){return this.axisScale.substractInterval(interval)}},{key:"tickScale",value:function tickScale(length){var yTickScale=d3_default.a.scale.linear().clamp(true).domain([20,40,1e3]).range([0,3,11]);return Math.ceil(yTickScale(length))}},{key:"getLength",value:function getLength(el){if(this.axisConfig.isHorizontal()){return external_kbnSharedDeps_Jquery_default()(el).width()}else{return external_kbnSharedDeps_Jquery_default()(el).height()}}},{key:"adjustSize",value:function adjustSize(){var config=this.axisConfig;var style=config.get("style");var chartEl=this.visConfig.get("el");var position=config.get("position");var axisPadding=5;return function(selection){var text=selection.selectAll(".tick text");var lengths=[];text.each((function textWidths(){var _this2=this;lengths.push(function(){if(config.isHorizontal()){return d3_default.a.select(_this2.parentNode).node().getBBox().height}else{return d3_default.a.select(_this2.parentNode).node().getBBox().width}}())}));var length=lengths.length>0?external_kbnSharedDeps_Lodash_default.a.max(lengths):0;length+=axisPadding;if(config.isHorizontal()){selection.attr("height",Math.ceil(length));if(position==="top"){selection.select("g").attr("transform","translate(0, ".concat(length-parseInt(style.lineWidth),")"));selection.select("path").attr("transform","translate(1,0)")}if(config.get("type")==="value"){var spacerNodes=external_kbnSharedDeps_Jquery_default()(chartEl).find(".visAxis__spacer--y-".concat(position));var elHeight=external_kbnSharedDeps_Jquery_default()(chartEl).find(".visAxis__column--".concat(position)).height();spacerNodes.height(elHeight)}}else{var axisWidth=Math.ceil(length);selection.attr("width",axisWidth);if(position==="left"){selection.select("g").attr("transform","translate(".concat(axisWidth,",0)"))}}}}},{key:"validate",value:function validate(){if(this.axisConfig.isLogScale()&&this.axisConfig.isPercentage()){throw new VislibError("Can't mix percentage mode with log scale.")}}},{key:"draw",value:function draw(){var svgs=[];var self=this;var config=this.axisConfig;var style=config.get("style");return function(selection){var n=selection[0].length;if(config.get("show")&&self.axisTitle&&["left","top"].includes(config.get("position"))){self.axisTitle.render(selection)}selection.each((function(){var el=this;var div=d3_default.a.select(el);var width=external_kbnSharedDeps_Jquery_default()(el).width();var height=external_kbnSharedDeps_Jquery_default()(el).height();var length=self.getLength(el,n);self.validate();var axis=self.getAxis(length);if(config.get("show")){var svg=div.append("svg").attr("focusable","false").attr("width",width).attr("height",height);svgs.push(svg);var axisClass=self.axisConfig.isHorizontal()?"x":"y";svg.append("g").attr("class","".concat(axisClass," axis ").concat(config.get("id"))).call(axis);var container=svg.select("g.axis").node();if(container){svg.select("path").style("stroke",style.color).style("stroke-width",style.lineWidth).style("stroke-opacity",style.opacity);svg.selectAll("line").style("stroke",style.tickColor).style("stroke-width",style.tickWidth).style("stroke-opacity",style.opacity)}if(self.axisLabels)self.axisLabels.render(svg)}}));if(self.axisTitle&&["right","bottom"].includes(config.get("position"))){self.axisTitle.render(selection)}svgs.forEach((function(svg){return svg.call(self.adjustSize())}))}}}]);return Axis}(_error_handler_ErrorHandler);function binder_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function binder_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function binder_createClass(Constructor,protoProps,staticProps){if(protoProps)binder_defineProperties(Constructor.prototype,protoProps);if(staticProps)binder_defineProperties(Constructor,staticProps);return Constructor}function binder_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var binder_Binder=function(){function Binder($scope){var _this=this;binder_classCallCheck(this,Binder);binder_defineProperty(this,"disposal",[]);if($scope){$scope.$on("$destroy",(function(){return _this.destroy()}))}}binder_createClass(Binder,[{key:"on",value:function on(emitter){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}var on=emitter.on||emitter.addListener;var off=emitter.off||emitter.removeListener;on.apply(emitter,args);this.disposal.push((function(){return off.apply(emitter,args)}))}},{key:"destroy",value:function destroy(){var destroyers=this.disposal;this.disposal=[];destroyers.forEach((function(fn){return fn()}))}},{key:"jqOn",value:function jqOn(el){for(var _len2=arguments.length,args=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){args[_key2-1]=arguments[_key2]}var $el=external_kbnSharedDeps_Jquery_default()(el);$el.on.apply($el,args);this.disposal.push((function(){return $el.off.apply($el,args)}))}},{key:"fakeD3Bind",value:function fakeD3Bind(el,event,handler){var _this2=this;this.jqOn(el,event,(function(e){var o=d3_default.a.event;d3_default.a.event=e;try{handler.apply(_this2,[_this2.__data__])}finally{d3_default.a.event=o}}))}}]);return Binder}();var OFFSET=10;var $clone;var propDirs={top:"north",left:"west"};function positionTooltip(opts,html){if(!opts)return;var $chart=external_kbnSharedDeps_Jquery_default()(opts.$chart);var $el=external_kbnSharedDeps_Jquery_default()(opts.$el);var $window=external_kbnSharedDeps_Jquery_default()(opts.$window||window);var $sizer=external_kbnSharedDeps_Jquery_default()(opts.$sizer);var prev=$chart.data("previousPlacement")||{};var event=opts.event;if(!$chart.length||!$el.length)return;var size=getTtSize(html||$el.html(),$sizer);var pos=getBasePosition(size,event);var overflow=getOverflow(size,pos,[$chart,$window]);var placement=placeToAvoidOverflow(pos,prev,overflow);$chart.data("previousPlacement",placement);return placement}function getTtSize(ttHtml,$sizer){if($sizer.html()!==ttHtml){$sizer.html(ttHtml)}var size={width:$sizer.outerWidth(),height:$sizer.outerHeight()};return size}function getBasePosition(size,event){return{east:event.clientX+OFFSET,west:event.clientX-size.width-OFFSET,south:event.clientY+OFFSET,north:event.clientY-size.height-OFFSET}}function getBounds($el){var bounds=external_kbnSharedDeps_Jquery_default.a.isWindow($el[0])?{top:0,left:0}:$el.offset();bounds.top+=$el.scrollTop();bounds.left+=$el.scrollLeft();bounds.bottom=bounds.top+$el.outerHeight();bounds.right=bounds.left+$el.outerWidth();bounds.area=(bounds.bottom-bounds.top)*(bounds.right-bounds.left);return bounds}function getOverflow(size,pos,containers){var overflow={};containers.map(getBounds).sort((function(a,b){return a.area-b.area})).forEach((function(bounds){mergeOverflows(overflow,{north:bounds.top-pos.north,east:pos.east+size.width-bounds.right,south:pos.south+size.height-bounds.bottom,west:bounds.left-pos.west})}));(window.overflows||(window.overflows=[])).push(overflow);return overflow}function mergeOverflows(dest,src){external_kbnSharedDeps_Lodash_default.a.mergeWith(dest,src,(function(a,b){if(a==null||b==null)return a||b;if(a<0&&b<0)return Math.min(a,b);return Math.max(a,b)}));if(dest.east&&dest.west&&dest.east>0&&dest.west>0&&(src.east<0||src.west<0)){if(src.east<src.west){dest.east=src.east}else{dest.west=src.west}}}function pickPlacement(prop,pos,overflow,prev,pref,fallback,placement){var stash="_"+prop;var dirs=external_kbnSharedDeps_Lodash_default.a.uniq([prev[stash],pref,fallback].filter(Boolean));var dir;var value;for(var i=0;i<dirs.length;i++){dir=dirs[i];if(overflow[dir]>0)continue;value=pos[dir];break}if(value==null){dir=dirs[0];var offset=overflow[dir];if(propDirs[prop]===dir){offset=offset*-1}value=pos[dir]-offset}placement[prop]=value;placement[stash]=dir}function placeToAvoidOverflow(pos,prev,overflow){var placement={};pickPlacement("top",pos,overflow,prev,"south","north",placement);pickPlacement("left",pos,overflow,prev,"east","west",placement);return placement}positionTooltip.getTtSize=getTtSize;positionTooltip.getBasePosition=getBasePosition;positionTooltip.getOverflow=getOverflow;positionTooltip.getBounds=getBounds;positionTooltip.placeToAvoidOverflow=placeToAvoidOverflow;positionTooltip.removeClone=function(){$clone&&$clone.remove();$clone=null};var external_kbnSharedDeps_Theme_euiLightVars_=__webpack_require__(34);var external_kbnSharedDeps_Theme_euiLightVars_default=__webpack_require__.n(external_kbnSharedDeps_Theme_euiLightVars_);var allContents=[];var tooltipColumnPadding=parseInt(external_kbnSharedDeps_Theme_euiLightVars_default.a.euiSizeXS||0,10)*2;var tooltipTableMargin=parseInt(external_kbnSharedDeps_Theme_euiLightVars_default.a.euiSizeS||0,10)*2;var tooltipMaxWidth=parseInt(external_kbnSharedDeps_Theme_euiLightVars_default.a.euiSizeXL||0,10)*10;function Tooltip(id,el,formatter,events){if(!(this instanceof Tooltip)){return new Tooltip(id,el,formatter,events)}this.id=id;this.el=el;this.order=100;this.formatter=formatter;this.events=events;this.containerClass="visWrapper";this.tooltipClass="visTooltip";this.tooltipSizerClass="visTooltip__sizingClone";this.showCondition=external_kbnSharedDeps_Lodash_default.a.constant(true);this.binder=new binder_Binder}Tooltip.prototype.$get=external_kbnSharedDeps_Lodash_default.a.once((function(){return external_kbnSharedDeps_Jquery_default()("<div>").addClass(this.tooltipClass).appendTo(document.body)}));Tooltip.prototype.$getSizer=external_kbnSharedDeps_Lodash_default.a.once((function(){return this.$get().clone().removeClass(this.tooltipClass).addClass(this.tooltipSizerClass).appendTo(document.body)}));Tooltip.prototype.show=function(){var $tooltip=this.$get();var $chart=this.$getChart();var html=$tooltip.html();if(!$chart)return;var placement=positionTooltip({$window:external_kbnSharedDeps_Jquery_default()(window),$chart:$chart,$el:$tooltip,$sizer:this.$getSizer(),event:d3_default.a.event},html);$tooltip.css({visibility:"visible",left:placement.left,top:placement.top});var tooltipColumns=$tooltip.find("tbody > tr:nth-of-type(1) > td").length;if(tooltipColumns===2){var tooltipWidth=$tooltip.outerWidth();var valueColumn=$tooltip.find("tr:nth-of-type(1) > td:nth-child(2)");if(valueColumn.length!==1){return}var valueColumnSize=valueColumn.outerWidth();var isGratherThanHalf=valueColumnSize>tooltipWidth/2;var containerMaxWidth=isGratherThanHalf?tooltipWidth/2-tooltipTableMargin-tooltipColumnPadding*2:tooltipWidth-valueColumnSize-tooltipTableMargin-tooltipColumnPadding;$tooltip.find(".visTooltip__labelContainer").css({"max-width":containerMaxWidth});if(isGratherThanHalf&&tooltipWidth===tooltipMaxWidth){$tooltip.find(".visTooltip__valueContainer").css({"max-width":containerMaxWidth})}}else if(tooltipColumns===3){var _tooltipWidth=$tooltip.outerWidth();var _valueColumn=$tooltip.find("tr:nth-of-type(1) > td:nth-child(3)");if(_valueColumn.length!==1){return}var _valueColumnSize=_valueColumn.outerWidth();var _containerMaxWidth=(_tooltipWidth-_valueColumnSize-tooltipTableMargin)/2-tooltipColumnPadding;$tooltip.find(".visTooltip__labelContainer").css({"max-width":_containerMaxWidth})}};Tooltip.prototype.hide=function(){var $tooltip=this.$get();allContents=[];$tooltip.css({visibility:"hidden",left:"-500px",top:"-500px"})};Tooltip.prototype.$getChart=function(){var chart=external_kbnSharedDeps_Jquery_default()(this.container&&this.container.node());return chart.length?chart:false};Tooltip.prototype.render=function(){var self=this;return function(selection){var $tooltip=self.$get();var id=self.id;var order=self.order;if(self.container===undefined||self.container!==d3_default.a.select(self.el).select("."+self.containerClass)){self.container=d3_default.a.select(self.el).select("."+self.containerClass)}var $chart=self.$getChart();if($chart){self.binder.jqOn($chart,"mouseleave",(function(){$chart.removeData("previousPlacement")}))}selection.each((function(d,i){var element=d3_default.a.select(this);function render(html){allContents=external_kbnSharedDeps_Lodash_default.a.filter(allContents,(function(content){return content.id!==id}));if(html)allContents.push({id:id,html:html,order:order});var allHtml=external_kbnSharedDeps_Lodash_default()(allContents).sortBy("order").map("html").compact().join("\n");if(allHtml){$tooltip.html(allHtml);self.show()}else{self.hide()}}self.binder.fakeD3Bind(this,"mousemove",(function(){if(!self.showCondition.call(element,d,i)){return render()}var events=self.events?self.events.eventResponse(d,i):d;return render(self.formatter(events))}));self.binder.fakeD3Bind(this,"mouseleave",(function(){render()}))}))}};Tooltip.prototype.destroy=function(){this.hide();this.binder.destroy()};var external_kbnSharedDeps_React_=__webpack_require__(0);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticNumeral_=__webpack_require__(32);var external_kbnSharedDeps_ElasticNumeral_default=__webpack_require__.n(external_kbnSharedDeps_ElasticNumeral_);var external_kbnSharedDeps_ReactDomServer_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(5);function collectBranch(leaf){function walk(item,memo){var depth=item.depth-1;function getFieldName(i){if(i.rawData&&i.rawData.column>-1){var _i$rawData=i.rawData,column=_i$rawData.column,table=_i$rawData.table;return table.columns[column].name}return i.name||"level ".concat(i.depth)}memo.unshift({depth:depth,field:getFieldName(item),bucket:item.name,metric:item.size,item:item});if(item.parent&&item.parent.parent){return walk(item.parent,memo)}else{return memo}}return walk(leaf,[])}function hierarchicalTooltipFormatter(metricFieldFormatter){return function(_ref){var datum=_ref.datum;var rows=collectBranch(datum);external_kbnSharedDeps_Lodash_default.a.forEachRight(rows,(function(row){row.spacer=external_kbnSharedDeps_Lodash_default.a.escape(external_kbnSharedDeps_Lodash_default.a.repeat("&nbsp;",row.depth));var percent;if(row.item.percentOfGroup!==null&&row.item.percentOfGroup!==undefined){percent=row.item.percentOfGroup}row.metric=metricFieldFormatter?metricFieldFormatter.convert(row.metric):row.metric;if(percent!==null&&percent!==undefined){row.metric+=" ("+external_kbnSharedDeps_ElasticNumeral_default()(percent).format("0.[00]%")+")"}return row}));return Object(external_kbnSharedDeps_ReactDomServer_["renderToStaticMarkup"])(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["I18nProvider"],null,external_kbnSharedDeps_React_default.a.createElement("table",{className:"visTooltip__table"},external_kbnSharedDeps_React_default.a.createElement("thead",null,external_kbnSharedDeps_React_default.a.createElement("tr",{className:"eui-textLeft visTooltip__label"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{tagName:"th",scope:"col",id:"visTypeVislib.vislib.tooltip.fieldLabel",defaultMessage:"field"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{tagName:"th",scope:"col",id:"visTypeVislib.vislib.tooltip.valueLabel",defaultMessage:"value"}),external_kbnSharedDeps_React_default.a.createElement("th",{scope:"col"}))),external_kbnSharedDeps_React_default.a.createElement("tbody",null,rows.map((function(row,index){return external_kbnSharedDeps_React_default.a.createElement("tr",{className:"visTooltip__value",key:index},external_kbnSharedDeps_React_default.a.createElement("td",null,external_kbnSharedDeps_React_default.a.createElement("div",{className:"visTooltip__labelContainer"},external_kbnSharedDeps_React_default.a.createElement("span",{"ng-bind-html":"row.spacer"}),row.field)),external_kbnSharedDeps_React_default.a.createElement("td",null,external_kbnSharedDeps_React_default.a.createElement("div",{className:"visTooltip__labelContainer"},row.bucket)),external_kbnSharedDeps_React_default.a.createElement("td",null,row.metric))}))))))}}function pointSeriesTooltipFormatter(){return function tooltipFormatter(_ref){var datum=_ref.datum,data=_ref.data;if(!datum)return"";var details=[];var currentSeries=data.series&&data.series.find((function(serie){return serie.rawId===datum.seriesId}));var addDetail=function addDetail(label,value){return details.push({label:label,value:value})};if(datum.extraMetrics){datum.extraMetrics.forEach((function(metric){addDetail(metric.label,metric.value)}))}if(datum.x!==null&&datum.x!==undefined){addDetail(data.xAxisLabel,data.xAxisFormatter(datum.x))}if(datum.y!==null&&datum.y!==undefined){var value=datum.yScale?datum.yScale*datum.y:datum.y;addDetail(currentSeries.label,currentSeries.yAxisFormatter(value))}if(datum.z!==null&&datum.z!==undefined){addDetail(currentSeries.zLabel,currentSeries.zAxisFormatter(datum.z))}if(datum.series&&datum.parent){var dimension=datum.parent;addDetail(dimension.title,datum.series)}if(datum.tableRaw){addDetail(datum.tableRaw.title,datum.tableRaw.value)}return Object(external_kbnSharedDeps_ReactDomServer_["renderToStaticMarkup"])(external_kbnSharedDeps_React_default.a.createElement("table",null,external_kbnSharedDeps_React_default.a.createElement("tbody",null,details.map((function(detail,index){return external_kbnSharedDeps_React_default.a.createElement("tr",{key:index},external_kbnSharedDeps_React_default.a.createElement("td",{className:"visTooltip__label"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"visTooltip__labelContainer"},detail.label)),external_kbnSharedDeps_React_default.a.createElement("td",{className:"visTooltip__value"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"visTooltip__valueContainer"},detail.value,detail.percent&&external_kbnSharedDeps_React_default.a.createElement("span",null," (",detail.percent,")"))))})))))}}function chart_title_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function chart_title_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function chart_title_createClass(Constructor,protoProps,staticProps){if(protoProps)chart_title_defineProperties(Constructor.prototype,protoProps);if(staticProps)chart_title_defineProperties(Constructor,staticProps);return Constructor}function chart_title_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)chart_title_setPrototypeOf(subClass,superClass)}function chart_title_setPrototypeOf(o,p){chart_title_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return chart_title_setPrototypeOf(o,p)}function chart_title_createSuper(Derived){var hasNativeReflectConstruct=chart_title_isNativeReflectConstruct();return function _createSuperInternal(){var Super=chart_title_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=chart_title_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return chart_title_possibleConstructorReturn(this,result)}}function chart_title_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return chart_title_assertThisInitialized(self)}function chart_title_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function chart_title_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function chart_title_getPrototypeOf(o){chart_title_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return chart_title_getPrototypeOf(o)}var chart_title_ChartTitle=function(_ErrorHandler){chart_title_inherits(ChartTitle,_ErrorHandler);var _super=chart_title_createSuper(ChartTitle);function ChartTitle(visConfig){var _this;chart_title_classCallCheck(this,ChartTitle);_this=_super.call(this);_this.el=visConfig.get("el");_this.tooltip=new Tooltip("chart-title",_this.el,(function(d){return"<p>"+external_kbnSharedDeps_Lodash_default.a.escape(d.label)+"</p>"}));return _this}chart_title_createClass(ChartTitle,[{key:"render",value:function render(){var el=d3_default.a.select(this.el).select(".chart-title").node();var width=el?el.clientWidth:0;var height=el?el.clientHeight:0;return d3_default.a.select(this.el).selectAll(".chart-title").call(this.draw(width,height))}},{key:"truncate",value:function truncate(size){var self=this;return function(selection){selection.each((function(){var text=d3_default.a.select(this);var n=text[0].length;var maxWidth=size/n*.9;var length=this.getComputedTextLength();var str;var avg;var end;if(length>maxWidth){str=text.text();avg=length/str.length;end=Math.floor(maxWidth/avg)-5;str=str.substr(0,end)+"...";self.addMouseEvents(text);return text.text(str)}return text.text()}))}}},{key:"addMouseEvents",value:function addMouseEvents(target){if(this.tooltip){return target.call(this.tooltip.render())}}},{key:"draw",value:function draw(width,height){var self=this;return function(selection){selection.each((function(){var div=d3_default.a.select(this);var dataType=this.parentNode.__data__.rows?"rows":"columns";var size=dataType==="rows"?height:width;var txtHtOffset=11;self.validateWidthandHeight(width,height);div.append("svg").attr("focusable","false").attr("width",width).attr("height",height).append("text").attr("transform",(function(){if(dataType==="rows"){return"translate("+txtHtOffset+","+height/2+")rotate(270)"}return"translate("+width/2+","+txtHtOffset+")"})).attr("text-anchor","middle").text((function(d){return d.label}));div.selectAll("text").call(self.truncate(size))}))}}}]);return ChartTitle}(_error_handler_ErrorHandler);function layout_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function layout_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function layout_createClass(Constructor,protoProps,staticProps){if(protoProps)layout_defineProperties(Constructor.prototype,protoProps);if(staticProps)layout_defineProperties(Constructor,staticProps);return Constructor}var layout_Layout=function(){function Layout(config){layout_classCallCheck(this,Layout);this.el=config.get("el");this.data=config.data.data;this.opts=config;this.layoutType=layoutTypes[config.get("type")](this.el,this.data)}layout_createClass(Layout,[{key:"render",value:function render(){this.removeAll(this.el);this.createLayout(this.layoutType);if(this.opts.get("type")==="point_series"){this.updateCategoryAxisSize()}}},{key:"createLayout",value:function createLayout(arr){var _this=this;return external_kbnSharedDeps_Lodash_default.a.each(arr,(function(obj){_this.layout(obj)}))}},{key:"updateCategoryAxisSize",value:function updateCategoryAxisSize(){var visConfig=this.opts;var axisConfig=visConfig.get("categoryAxes[0]");var axis=new axis_Axis(visConfig,axisConfig);var position=axis.axisConfig.get("position");var chartTitle=new chart_title_ChartTitle(visConfig);var axisWrapperElement=external_kbnSharedDeps_Jquery_default()(this.el).find(".visAxis__column--".concat(position));axisWrapperElement.css("visibility","hidden");axis.render();chartTitle.render();var width=axisWrapperElement.width();var height=axisWrapperElement.height();axis.destroy();external_kbnSharedDeps_Jquery_default()(this.el).find(".chart-title svg").remove();axisWrapperElement.css("visibility","");if(axis.axisConfig.isHorizontal()){var spacerNodes=external_kbnSharedDeps_Jquery_default()(this.el).find(".visAxis__spacer--y-".concat(position));spacerNodes.height("".concat(height,"px"))}else{axisWrapperElement.find(".visAxis__splitAxes--y").width("".concat(width,"px"))}}},{key:"layout",value:function layout(obj){if(!obj.parent){throw new Error("No parent element provided")}if(!obj.type){throw new Error("No element type provided")}if(typeof obj.type!=="string"){throw new Error(obj.type+" must be a string")}if(typeof obj.parent==="string"&&obj.parent.charAt(0)!=="."){obj.parent="."+obj.parent}var childEl=this.appendElem(obj.parent,obj.type,obj.class);if(obj.datum){childEl.datum(obj.datum)}if(obj.splits){childEl.call(obj.splits,obj.parent,this.opts)}if(obj.children){var newParent=childEl[0][0];external_kbnSharedDeps_Lodash_default.a.forEach(obj.children,(function(obj){if(!obj.parent){obj.parent=newParent}}));this.createLayout(obj.children)}return childEl}},{key:"appendElem",value:function appendElem(el,type,className){if(!el||!type||!className){throw new Error("Function requires that an el, type, and class be provided")}if(typeof el==="string"){el=d3_default.a.select(this.el).select(el)[0][0]}return d3_default.a.select(el).append(type).attr("class",className)}},{key:"removeAll",value:function removeAll(el){return d3_default.a.select(el).selectAll("*").remove()}}]);return Layout}();function alerts_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function alerts_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function alerts_createClass(Constructor,protoProps,staticProps){if(protoProps)alerts_defineProperties(Constructor.prototype,protoProps);if(staticProps)alerts_defineProperties(Constructor,staticProps);return Constructor}var alerts_Alerts=function(){function Alerts(vis,alertDefs){var _this=this;alerts_classCallCheck(this,Alerts);this.vis=vis;this.data=vis.data;this.alertDefs=external_kbnSharedDeps_Lodash_default.a.cloneDeep(alertDefs);this.alerts=external_kbnSharedDeps_Lodash_default()(alertDefs).map((function(alertDef){if(!alertDef)return;if(alertDef.test&&!alertDef.test(vis,_this.data))return;return _this._addAlert(alertDef)})).compact()}alerts_createClass(Alerts,[{key:"_addAlert",value:function _addAlert(alertDef){var type=alertDef.type||"info";var icon=alertDef.icon||type;var msg=alertDef.msg;var $icon=external_kbnSharedDeps_Jquery_default()("<i>").addClass("visAlerts__icon fa fa-"+icon);var $text=external_kbnSharedDeps_Jquery_default()("<p>").addClass("visAlerts__text").text(msg);var $closeIcon=external_kbnSharedDeps_Jquery_default()("<i>").addClass("fa fa-close");var $closeDiv=external_kbnSharedDeps_Jquery_default()("<div>").addClass("visAlerts__close").append($closeIcon);var $alert=external_kbnSharedDeps_Jquery_default()("<div>").addClass("visAlert visAlert--"+type).append([$icon,$text,$closeDiv]);$closeDiv.on("click",(function(){$alert.remove()}));return $alert}},{key:"render",value:function render(){var alerts=this.alerts;var vis=this.vis;external_kbnSharedDeps_Jquery_default()(vis.element).find(".visWrapper__alerts").append(external_kbnSharedDeps_Jquery_default()("<div>").addClass("visAlerts__tray"));if(!alerts.size())return;external_kbnSharedDeps_Jquery_default()(vis.element).find(".visAlerts__tray").append(alerts.value())}},{key:"show",value:function show(msg,type){var vis=this.vis;var alert={msg:msg,type:type};if(this.alertDefs.find((function(alertDef){return alertDef.msg===alert.msg})))return;this.alertDefs.push(alert);external_kbnSharedDeps_Jquery_default()(vis.element).find(".visAlerts__tray").append(this._addAlert(alert))}},{key:"destroy",value:function destroy(){external_kbnSharedDeps_Jquery_default()(this.vis.element).find(".visWrapper__alerts").remove()}}]);return Alerts}();function chart_grid_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function chart_grid_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function chart_grid_createClass(Constructor,protoProps,staticProps){if(protoProps)chart_grid_defineProperties(Constructor.prototype,protoProps);if(staticProps)chart_grid_defineProperties(Constructor,staticProps);return Constructor}var chart_grid_defaults={style:{color:"rgba(105,112,125,0.2)"},categoryLines:false,valueAxis:undefined};var chart_grid_ChartGrid=function(){function ChartGrid(handler,gridConfig){chart_grid_classCallCheck(this,ChartGrid);if(!gridConfig)return;this._handler=handler;this._values=external_kbnSharedDeps_Lodash_default.a.defaultsDeep({},gridConfig,chart_grid_defaults)}chart_grid_createClass(ChartGrid,[{key:"drawLine",value:function drawLine(svg,tick,axis,width,height){var isHorizontal=axis.axisConfig.isHorizontal();var scale=axis.getScale();svg.append("path").attr("d",(function(){var x0=isHorizontal?tick:0;var x1=isHorizontal?tick:width;var y0=!isHorizontal?tick:0;var y1=!isHorizontal?tick:height;var d3Line=d3_default.a.svg.line().x((function(d){return isHorizontal?scale(d[0]):d[0]})).y((function(d){return!isHorizontal?scale(d[1]):d[1]}));return d3Line([[x0,y0],[x1,y1]])})).attr("fill","none").attr("stroke",this.get("style.color")).attr("stroke-width",1)}},{key:"drawCategoryLines",value:function drawCategoryLines(svg,width,height){var _this=this;var axis=this._handler.categoryAxes[0];if(!axis)return;var ticks=axis.getScale().ticks;if(!ticks)return;ticks().forEach((function(tick){_this.drawLine(svg,tick,axis,width,height)}))}},{key:"drawValueLines",value:function drawValueLines(svg,width,height){var _this2=this;var axis=this._handler.valueAxes.find((function(axis){return axis.axisConfig.get("id")===_this2.get("valueAxis")}));if(!axis)return;var ticks=axis.getScale().ticks;if(!ticks)return;ticks().forEach((function(tick){_this2.drawLine(svg,tick,axis,width,height)}))}},{key:"draw",value:function draw(width,height){var self=this;return function(selection){if(!self._values)return;selection.each((function(){if(self.get("categoryLines"))self.drawCategoryLines(d3_default.a.select(this),width,height);if(self.get("valueAxis",false))self.drawValueLines(d3_default.a.select(this),width,height)}))}}},{key:"get",value:function get(property,defaults){if(external_kbnSharedDeps_Lodash_default.a.has(this._values,property)||typeof defaults!=="undefined"){return external_kbnSharedDeps_Lodash_default.a.get(this._values,property,defaults)}else{throw new Error("Accessing invalid config property: ".concat(property));return defaults}}},{key:"set",value:function set(property,value){return Object(elastic_safer_lodash_set["set"])(this._values,property,value)}}]);return ChartGrid}();function dataLabel(selection,label){d3_default.a.select(selection).attr("data-label",label)}var DIMMING_OPACITY_SETTING="visualization:dimmingOpacity";var HEATMAP_MAX_BUCKETS_SETTING="visualization:heatmap:maxBuckets";function dispatch_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function dispatch_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function dispatch_createClass(Constructor,protoProps,staticProps){if(protoProps)dispatch_defineProperties(Constructor.prototype,protoProps);if(staticProps)dispatch_defineProperties(Constructor,staticProps);return Constructor}function dispatch_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var dispatch_Dispatch=function(){function Dispatch(handler,uiSettings){dispatch_classCallCheck(this,Dispatch);dispatch_defineProperty(this,"emit",Object(external_kbnSharedDeps_Lodash_["rest"])((function(name,args){if(!this._listeners[name]){return this}var listeners=this.listeners(name);var i=-1;while(++i<listeners.length){listeners[i].apply(this,args)}return this})));this.handler=handler;this.uiSettings=uiSettings;this._listeners={}}dispatch_createClass(Dispatch,[{key:"on",value:function on(name,handler){var handlers=this._listeners[name];if(!handlers){this._listeners[name]=[];handlers=this._listeners[name]}handlers.push(handler);return this}},{key:"off",value:function off(name,handler){if(!this._listeners[name]){return this}if(handler){Object(external_kbnSharedDeps_Lodash_["pull"])(this._listeners[name],handler)}else{this._listeners[name]=null}return this}},{key:"removeAllListeners",value:function removeAllListeners(){this._listeners={};return this}},{key:"listeners",value:function listeners(name){return this._listeners[name]?this._listeners[name].slice(0):[]}},{key:"listenerCount",value:function listenerCount(name){if(name){return Object(external_kbnSharedDeps_Lodash_["size"])(this._listeners[name])}return Object(external_kbnSharedDeps_Lodash_["reduce"])(this._listeners,(function(count,handlers){return count+Object(external_kbnSharedDeps_Lodash_["size"])(handlers)}),0)}},{key:"_pieClickResponse",value:function _pieClickResponse(data){var points=[];var dataPointer=data;while(dataPointer&&dataPointer.rawData){points.push(dataPointer.rawData);dataPointer=dataPointer.parent}if(Object(external_kbnSharedDeps_Lodash_["get"])(data,"rawData.table.$parent")){var _get=Object(external_kbnSharedDeps_Lodash_["get"])(data,"rawData.table.$parent"),table=_get.table,column=_get.column,row=_get.row,key=_get.key;points.push({table:table,column:column,row:row,value:key})}return points}},{key:"_seriesClickResponse",value:function _seriesClickResponse(data){var points=[];["xRaw","yRaw","zRaw","seriesRaw","rawData","tableRaw"].forEach((function(val){if(data[val]&&data[val].column!==undefined&&data[val].row!==undefined){points.push(data[val])}}));return points}},{key:"clickEventResponse",value:function clickEventResponse(d){var props=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var isSlices=props.isSlices;if(isSlices===undefined){var _data=d3_default.a.event.target.nearestViewportElement?d3_default.a.event.target.nearestViewportElement.__data__:d3_default.a.event.target.__data__;isSlices=!!(_data&&_data.slices)}var data=d.input||d;return{e:d3_default.a.event,data:isSlices?this._pieClickResponse(data):this._seriesClickResponse(data)}}},{key:"_isSeriesInPercentageMode",value:function _isSeriesInPercentageMode(rawId,series,visConfig){if(!rawId||!Array.isArray(series)||!visConfig){return false}var _series$find=series.find((function(series){return series.rawId===rawId})),id=_series$find.id;if(!id){return false}var seriesParams=visConfig.get("seriesParams",[]);var _ref=seriesParams.find((function(param){return param.data.id===id}))||{},valueAxisId=_ref.valueAxis;if(!valueAxisId){return false}var usedValueAxis=visConfig.get("valueAxes",[]).find((function(valueAxis){return valueAxis.id===valueAxisId}));return Object(external_kbnSharedDeps_Lodash_["get"])(usedValueAxis,"scale.mode")==="percentage"}},{key:"eventResponse",value:function eventResponse(d,i){var datum=d._input||d;var data=d3_default.a.event.target.nearestViewportElement?d3_default.a.event.target.nearestViewportElement.__data__:d3_default.a.event.target.__data__;var label=d.label?d.label:d.series||"Count";var isSeries=!!(data&&data.series);var isSlices=!!(data&&data.slices);var series=isSeries?data.series:undefined;var slices=isSlices?data.slices:undefined;var handler=this.handler;var color=Object(external_kbnSharedDeps_Lodash_["get"])(handler,"data.color");var config=handler&&handler.visConfig;var isPercentageMode=this._isSeriesInPercentageMode(d.seriesId,series,config);var eventData={value:d.y,point:datum,datum:datum,label:label,color:color?color(label):undefined,pointIndex:i,series:series,slices:slices,config:config,data:data,e:d3_default.a.event,handler:handler,isPercentageMode:isPercentageMode};return eventData}},{key:"addEvent",value:function addEvent(event,callback){return function(selection){selection.each((function(){var element=d3_default.a.select(this);if(typeof callback==="function"){return element.on(event,callback)}}))}}},{key:"addHoverEvent",value:function addHoverEvent(){var self=this;var isClickable=this.listenerCount("click")>0;var addEvent=this.addEvent;var $el=this.handler.el;if(!this.handler.highlight){this.handler.highlight=self.getHighlighter(self.uiSettings)}function hover(d,i){if(isClickable){self.addMousePointer.call(this,arguments)}self.handler.highlight.call(this,$el);self.emit("hover",self.eventResponse(d,i))}return addEvent("mouseover",hover)}},{key:"addMouseoutEvent",value:function addMouseoutEvent(){var self=this;var addEvent=this.addEvent;var $el=this.handler.el;if(!this.handler.unHighlight){this.handler.unHighlight=self.unHighlight}function mouseout(){self.handler.unHighlight.call(this,$el)}return addEvent("mouseout",mouseout)}},{key:"addClickEvent",value:function addClickEvent(){var _this=this;var onClick=function onClick(d){return _this.emit("click",_this.clickEventResponse(d))};return this.addEvent("click",onClick)}},{key:"allowBrushing",value:function allowBrushing(){var xAxis=this.handler.categoryAxes[0];return Boolean(xAxis.ordered)}},{key:"isBrushable",value:function isBrushable(){return this.allowBrushing()&&this.listenerCount("brush")>0}},{key:"addBrushEvent",value:function addBrushEvent(svg){if(!this.isBrushable())return;var xScale=this.handler.categoryAxes[0].getScale();this.createBrush(xScale,svg)}},{key:"addMousePointer",value:function addMousePointer(){return d3_default.a.select(this).style("cursor","pointer")}},{key:"getHighlighter",value:function getHighlighter(uiSettings){return function highlight(element){var label=this.getAttribute("data-label");if(!label)return;var dimming=uiSettings.get(DIMMING_OPACITY_SETTING);external_kbnSharedDeps_Jquery_default()(element).parent().find("[data-label]").css("opacity",1).not((function(els,el){return String(external_kbnSharedDeps_Jquery_default()(el).data("label"))===label})).css("opacity",justifyOpacity(dimming))}}},{key:"unHighlight",value:function unHighlight(element){external_kbnSharedDeps_Jquery_default()("[data-label]",element.parentNode).css("opacity",1)}},{key:"createBrush",value:function createBrush(xScale,svg){var self=this;var visConfig=self.handler.visConfig;var _svg$node$getBBox=svg.node().getBBox(),width=_svg$node$getBBox.width,height=_svg$node$getBBox.height;var isHorizontal=self.handler.categoryAxes[0].axisConfig.isHorizontal();var brush=d3_default.a.svg.brush();if(isHorizontal){brush.x(xScale)}else{brush.y(xScale)}brush.on("brushend",(function brushEnd(){var data=d3_default.a.select(this).data()[0];var isTimeSeries=data.ordered&&data.ordered.date;var selected=xScale.domain().filter((function(d){return brush.extent()[0]<=xScale(d)&&xScale(d)<=brush.extent()[1]}));var range=isTimeSeries?brush.extent():selected;return self.emit("brush",{range:range,config:visConfig,e:d3_default.a.event,data:data})}));if(self.listenerCount("brush")){var rect=svg.insert("g","g").attr("class","brush").call(brush).call((function(brushG){var brushHandler=brushG.on("mousedown.brush");if(!brushHandler)return;brushG.on("mousedown.brush",(function(){if(validBrushClick(d3_default.a.event))brushHandler.apply(this,arguments)}))})).selectAll("rect");if(isHorizontal){rect.attr("height",height)}else{rect.attr("width",width)}return brush}}}]);return Dispatch}();function validBrushClick(event){return event.button===0}function justifyOpacity(opacity){var decimalNumber=parseFloat(opacity,10);var fallbackOpacity=.5;return 0<=decimalNumber&&decimalNumber<=1?decimalNumber:fallbackOpacity}function _chart_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _chart_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _chart_createClass(Constructor,protoProps,staticProps){if(protoProps)_chart_defineProperties(Constructor.prototype,protoProps);if(staticProps)_chart_defineProperties(Constructor,staticProps);return Constructor}var _chart_Chart=function(){function Chart(handler,element,chartData,deps){_chart_classCallCheck(this,Chart);this.handler=handler;this.chartEl=element;this.chartData=chartData;this.tooltips=[];var events=this.events=new dispatch_Dispatch(handler,deps.uiSettings);var fieldFormatter=Object(services["b"])().deserialize(this.handler.data.get("tooltipFormatter"));var tooltipFormatterProvider=this.handler.visConfig.get("type")==="pie"?hierarchicalTooltipFormatter:pointSeriesTooltipFormatter;var tooltipFormatter=tooltipFormatterProvider(fieldFormatter);if(this.handler.visConfig&&this.handler.visConfig.get("addTooltip",false)){var _element=this.handler.el;this.tooltip=new Tooltip("chart",_element,tooltipFormatter,events);this.tooltips.push(this.tooltip)}this._addIdentifier=external_kbnSharedDeps_Lodash_default.a.bind(this._addIdentifier,this)}_chart_createClass(Chart,[{key:"render",value:function render(){var selection=d3_default.a.select(this.chartEl);selection.selectAll("*").remove();selection.call(this.draw())}},{key:"_addIdentifier",value:function _addIdentifier(selection,labelProp){labelProp=labelProp||"label";var labels=this.handler.data.labels;function resolveLabel(datum){if(labels.length===1)return labels[0];if(datum[0])return datum[0][labelProp];return datum[labelProp]}selection.each((function(datum){var label=resolveLabel(datum);if(label!=null)dataLabel(this,label)}))}},{key:"destroy",value:function destroy(){var selection=d3_default.a.select(this.chartEl);this.events.removeAllListeners();this.tooltips.forEach((function(tooltip){tooltip.destroy()}));selection.remove()}}]);return Chart}();var elastic_datemath=__webpack_require__(164);var elastic_datemath_default=__webpack_require__.n(elastic_datemath);function time_marker_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function time_marker_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function time_marker_createClass(Constructor,protoProps,staticProps){if(protoProps)time_marker_defineProperties(Constructor.prototype,protoProps);if(staticProps)time_marker_defineProperties(Constructor,staticProps);return Constructor}var time_marker_TimeMarker=function(){function TimeMarker(times,xScale,height){time_marker_classCallCheck(this,TimeMarker);var currentTimeArr=[{time:(new Date).getTime(),class:"time-marker",color:"#c80000",opacity:.3,width:2}];this.xScale=xScale;this.height=height;this.times=times.length?times.map((function(d){return{time:elastic_datemath_default.a.parse(d.time),class:d.class||"time-marker",color:d.color||"#c80000",opacity:d.opacity||.3,width:d.width||2}})):currentTimeArr}time_marker_createClass(TimeMarker,[{key:"_isTimeBasedChart",value:function _isTimeBasedChart(selection){var data=selection.data();return data.every((function(datum){return datum.ordered&&datum.ordered.date}))}},{key:"render",value:function render(selection){var self=this;if(!self._isTimeBasedChart(selection))return;selection.each((function(){d3_default.a.select(this).selectAll("time-marker").data(self.times).enter().append("line").attr("class",(function(d){return d.class})).attr("pointer-events","none").attr("stroke",(function(d){return d.color})).attr("stroke-width",(function(d){return d.width})).attr("stroke-opacity",(function(d){return d.opacity})).attr("x1",(function(d){return self.xScale(d.time)})).attr("x2",(function(d){return self.xScale(d.time)})).attr("y1",self.height).attr("y2",self.xScale.range()[0])}))}}]);return TimeMarker}();var external_kbnSharedDeps_ElasticEuiLibServices_=__webpack_require__(10);function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_point_series_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function _point_series_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _point_series_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _point_series_arrayLikeToArray(o,minLen)}function _point_series_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _point_series_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _point_series_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _point_series_createClass(Constructor,protoProps,staticProps){if(protoProps)_point_series_defineProperties(Constructor.prototype,protoProps);if(staticProps)_point_series_defineProperties(Constructor,staticProps);return Constructor}var thresholdLineDefaults={show:false,value:10,width:1,style:"full",color:Object(external_kbnSharedDeps_ElasticEuiLibServices_["euiPaletteColorBlind"])()[9]};var _point_series_PointSeries=function(){function PointSeries(handler,seriesEl,seriesData,seriesConfig){_point_series_classCallCheck(this,PointSeries);this.handler=handler;this.baseChart=handler.pointSeries;this.chartEl=seriesEl;this.chartData=seriesData;this.seriesConfig=seriesConfig;this.thresholdLineOptions=external_kbnSharedDeps_Lodash_default.a.defaults(handler.visConfig.get("thresholdLine",{}),thresholdLineDefaults)}_point_series_createClass(PointSeries,[{key:"getGroupedCount",value:function getGroupedCount(){var _this=this;var stacks=[];return this.baseChart.chartConfig.series.reduce((function(sum,series){var valueAxis=series.valueAxis||_this.baseChart.handler.valueAxes[0].id;var isStacked=series.mode==="stacked";var isHistogram=series.type==="histogram";if(!isHistogram)return sum;if(isStacked&&stacks.includes(valueAxis))return sum;if(isStacked)stacks.push(valueAxis);return sum+1}),0)}},{key:"getGroupedNum",value:function getGroupedNum(seriesId){var i=0;var stacks=[];var _iterator=_createForOfIteratorHelper(this.baseChart.chartConfig.series),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var seri=_step.value;var valueAxis=seri.valueAxis||this.baseChart.handler.valueAxes[0].id;var isStacked=seri.mode==="stacked";if(!isStacked){if(seri.data.rawId===seriesId)return i;i++}else{if(!(valueAxis in stacks))stacks[valueAxis]=i++;if(seri.data.rawId===seriesId)return stacks[valueAxis]}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return 0}},{key:"getValueAxis",value:function getValueAxis(){var _this2=this;return external_kbnSharedDeps_Lodash_default.a.find(this.handler.valueAxes,(function(axis){return axis.axisConfig.get("id")===_this2.seriesConfig.valueAxis}))||this.handler.valueAxes[0]}},{key:"getCategoryAxis",value:function getCategoryAxis(){var _this3=this;return external_kbnSharedDeps_Lodash_default.a.find(this.handler.categoryAxes,(function(axis){return axis.axisConfig.get("id")===_this3.seriesConfig.categoryAxis}))||this.handler.categoryAxes[0]}},{key:"addCircleEvents",value:function addCircleEvents(element){var events=this.events;if(this.handler.visConfig.get("enableHover")){var hover=events.addHoverEvent();var mouseout=events.addMouseoutEvent();element.call(hover).call(mouseout)}var click=events.addClickEvent();return element.call(click)}},{key:"addThresholdLine",value:function addThresholdLine(svgElem){var chartData=this.chartData;var isHorizontal=this.getCategoryAxis().axisConfig.isHorizontal();var valueAxisDomain=this.getValueAxis().axisScale.getDomain(chartData.values.length);var yScale=this.getValueAxis().getScale();var svgParentWidth=svgElem[0][0].attributes.width.value;var svgParentHeight=svgElem[0][0].attributes.height.value;var thresholdLineWidth=this.thresholdLineOptions.width;var thresholdLineStyle="0";if(this.thresholdLineOptions.style==="dashed"){thresholdLineStyle="10,5"}else if(this.thresholdLineOptions.style==="dot-dashed"){thresholdLineStyle="20,5,5,5"}var thresholdValue=this.thresholdLineOptions.value;var lineColor=this.thresholdLineOptions.color;function y(y){return yScale(y)}if(valueAxisDomain&&valueAxisDomain[0]<=thresholdValue&&valueAxisDomain[1]>=thresholdValue){svgElem.append("line").attr("x1",isHorizontal?0:y(thresholdValue)).attr("y1",isHorizontal?y(thresholdValue):0).attr("x2",isHorizontal?svgParentWidth:y(thresholdValue)).attr("y2",isHorizontal?y(thresholdValue):svgParentHeight).attr("stroke-width",thresholdLineWidth).attr("stroke-dasharray",thresholdLineStyle).attr("stroke",lineColor)}}}]);return PointSeries}();function column_chart_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function column_chart_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function column_chart_createClass(Constructor,protoProps,staticProps){if(protoProps)column_chart_defineProperties(Constructor.prototype,protoProps);if(staticProps)column_chart_defineProperties(Constructor,staticProps);return Constructor}function column_chart_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)column_chart_setPrototypeOf(subClass,superClass)}function column_chart_setPrototypeOf(o,p){column_chart_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return column_chart_setPrototypeOf(o,p)}function column_chart_createSuper(Derived){var hasNativeReflectConstruct=column_chart_isNativeReflectConstruct();return function _createSuperInternal(){var Super=column_chart_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=column_chart_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return column_chart_possibleConstructorReturn(this,result)}}function column_chart_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return column_chart_assertThisInitialized(self)}function column_chart_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function column_chart_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function column_chart_getPrototypeOf(o){column_chart_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return column_chart_getPrototypeOf(o)}var column_chart_defaults={mode:"normal",showTooltip:true,color:undefined,fillColor:undefined,showLabel:true};function datumWidth(defaultWidth,datum,nextDatum,scale,gutterWidth){var groupCount=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;var datumWidth=defaultWidth;if(nextDatum){datumWidth=(scale(nextDatum.x)-scale(datum.x)-gutterWidth)/groupCount;if(datumWidth>defaultWidth){datumWidth=defaultWidth}}return datumWidth}var column_chart_ColumnChart=function(_PointSeries){column_chart_inherits(ColumnChart,_PointSeries);var _super=column_chart_createSuper(ColumnChart);function ColumnChart(handler,chartEl,chartData,seriesConfigArgs,deps){var _this;column_chart_classCallCheck(this,ColumnChart);_this=_super.call(this,handler,chartEl,chartData,seriesConfigArgs,deps);_this.seriesConfig=external_kbnSharedDeps_Lodash_default.a.defaults(seriesConfigArgs||{},column_chart_defaults);_this.labelOptions=external_kbnSharedDeps_Lodash_default.a.defaults(handler.visConfig.get("labels",{}),column_chart_defaults.showLabel);return _this}column_chart_createClass(ColumnChart,[{key:"addBars",value:function addBars(svg,data){var self=this;var color=this.handler.data.getColorFunc();var tooltip=this.baseChart.tooltip;var isTooltip=this.handler.visConfig.get("tooltip.show");var layer=svg.append("g").attr("class","series histogram").attr("clip-path","url(#"+this.baseChart.clipPathId+")");var bars=layer.selectAll("rect").data(data.values.filter((function(d){return!external_kbnSharedDeps_Lodash_default.a.isNull(d.y)})));bars.exit().remove();bars.enter().append("rect").attr("data-label",data.label).attr("fill",(function(){return color(data.label)})).attr("stroke",(function(){return color(data.label)}));self.updateBars(bars);if(isTooltip){bars.call(tooltip.render())}return bars}},{key:"updateBars",value:function updateBars(bars){if(this.seriesConfig.mode==="stacked"){return this.addStackedBars(bars)}return this.addGroupedBars(bars)}},{key:"addStackedBars",value:function addStackedBars(bars){var xScale=this.getCategoryAxis().getScale();var yScale=this.getValueAxis().getScale();var isHorizontal=this.getCategoryAxis().axisConfig.isHorizontal();var isTimeScale=this.getCategoryAxis().axisConfig.isTimeDomain();var isLabels=this.labelOptions.show;var yMin=yScale.domain()[0];var gutterSpacingPercentage=.15;var chartData=this.chartData;var getGroupedNum=this.getGroupedNum.bind(this);var groupCount=this.getGroupedCount();var barWidth;var gutterWidth;if(isTimeScale){var _this$handler$data$ge=this.handler.data.get("ordered"),min=_this$handler$data$ge.min,interval=_this$handler$data$ge.interval;var intervalWidth=xScale(min+interval)-xScale(min);intervalWidth=Math.abs(intervalWidth);gutterWidth=intervalWidth*gutterSpacingPercentage;barWidth=(intervalWidth-gutterWidth)/groupCount}function x(d,i){var groupNum=getGroupedNum(d.seriesId);if(isTimeScale){return xScale(d.x)+datumWidth(barWidth,d,bars.data()[i+1],xScale,gutterWidth,groupCount)*groupNum}return xScale(d.x)+xScale.rangeBand()/groupCount*groupNum}function y(d){if(isHorizontal&&d.y<0||!isHorizontal&&d.y>0){return yScale(d.y0)}return yScale(d.y0+d.y)}function labelX(d,i){return x(d,i)+widthFunc(d,i)/2}function labelY(d){return y(d)+heightFunc(d)/2}function labelDisplay(d,i){if(isHorizontal&&this.getBBox().width>widthFunc(d,i))return"none";if(!isHorizontal&&this.getBBox().width>heightFunc(d))return"none";if(isHorizontal&&this.getBBox().height>heightFunc(d))return"none";if(!isHorizontal&&this.getBBox().height>widthFunc(d,i))return"none";return"block"}function widthFunc(d,i){if(isTimeScale){return datumWidth(barWidth,d,bars.data()[i+1],xScale,gutterWidth,groupCount)}return xScale.rangeBand()/groupCount}function heightFunc(d){if(d.y0===0&&yMin>0){return yScale(yMin)-yScale(d.y)}return Math.abs(yScale(d.y0)-yScale(d.y0+d.y))}function formatValue(d){return chartData.yAxisFormatter(d.y)}bars.attr("x",isHorizontal?x:y).attr("width",isHorizontal?widthFunc:heightFunc).attr("y",isHorizontal?y:x).attr("height",isHorizontal?heightFunc:widthFunc);var layer=d3_default.a.select(bars[0].parentNode);var barLabels=layer.selectAll("text").data(chartData.values.filter((function(d){return!external_kbnSharedDeps_Lodash_default.a.isNull(d.y)})));if(isLabels){var colorFunc=this.handler.data.getColorFunc();var d3Color=d3_default.a.rgb(colorFunc(chartData.label));var labelClass;if(Object(external_kbnSharedDeps_ElasticEuiLibServices_["isColorDark"])(d3Color.r,d3Color.g,d3Color.b)){labelClass="visColumnChart__bar-label--light"}else{labelClass="visColumnChart__bar-label--dark"}barLabels.enter().append("text").text(formatValue).attr("class","visColumnChart__barLabel visColumnChart__barLabel--stack ".concat(labelClass)).attr("x",isHorizontal?labelX:labelY).attr("y",isHorizontal?labelY:labelX).attr("display",labelDisplay)}return bars}},{key:"addGroupedBars",value:function addGroupedBars(bars){var xScale=this.getCategoryAxis().getScale();var yScale=this.getValueAxis().getScale();var chartData=this.chartData;var groupCount=this.getGroupedCount();var gutterSpacingPercentage=.15;var isTimeScale=this.getCategoryAxis().axisConfig.isTimeDomain();var isHorizontal=this.getCategoryAxis().axisConfig.isHorizontal();var isLogScale=this.getValueAxis().axisConfig.isLogScale();var isLabels=this.labelOptions.show;var getGroupedNum=this.getGroupedNum.bind(this);var barWidth;var gutterWidth;if(isTimeScale){var _this$handler$data$ge2=this.handler.data.get("ordered"),min=_this$handler$data$ge2.min,interval=_this$handler$data$ge2.interval;var intervalWidth=xScale(min+interval)-xScale(min);intervalWidth=Math.abs(intervalWidth);gutterWidth=intervalWidth*gutterSpacingPercentage;barWidth=(intervalWidth-gutterWidth)/groupCount}function x(d,i){var groupNum=getGroupedNum(d.seriesId);if(isTimeScale){return xScale(d.x)+datumWidth(barWidth,d,bars.data()[i+1],xScale,gutterWidth,groupCount)*groupNum}return xScale(d.x)+xScale.rangeBand()/groupCount*groupNum}function y(d){if(isHorizontal&&d.y<0||!isHorizontal&&d.y>0){return yScale(0)}return yScale(d.y)}function labelX(d,i){return x(d,i)+widthFunc(d,i)/2}function labelY(d){if(isHorizontal){return d.y>=0?y(d)-4:y(d)+heightFunc(d)+this.getBBox().height}return d.y>=0?y(d)+heightFunc(d)+4:y(d)-this.getBBox().width-4}function labelDisplay(d,i){if(isHorizontal&&this.getBBox().width>widthFunc(d,i)){return"none"}if(!isHorizontal&&this.getBBox().height>widthFunc(d)){return"none"}return"block"}function widthFunc(d,i){if(isTimeScale){return datumWidth(barWidth,d,bars.data()[i+1],xScale,gutterWidth,groupCount)}return xScale.rangeBand()/groupCount}function heightFunc(d){var baseValue=isLogScale?1:0;return Math.abs(yScale(baseValue)-yScale(d.y))}function formatValue(d){return chartData.yAxisFormatter(d.y)}bars.attr("x",isHorizontal?x:y).attr("width",isHorizontal?widthFunc:heightFunc).attr("y",isHorizontal?y:x).attr("height",isHorizontal?heightFunc:widthFunc);var layer=d3_default.a.select(bars[0].parentNode);var barLabels=layer.selectAll("text").data(chartData.values.filter((function(d){return!external_kbnSharedDeps_Lodash_default.a.isNull(d.y)})));barLabels.exit().remove();if(isLabels){var labelColor=this.handler.data.getColorFunc()(chartData.label);barLabels.enter().append("text").text(formatValue).attr("class","visColumnChart__barLabel").attr("x",isHorizontal?labelX:labelY).attr("y",isHorizontal?labelY:labelX).attr("dominant-baseline",isHorizontal?"auto":"central").attr("text-anchor",isHorizontal?"middle":"start").attr("fill",labelColor).attr("display",labelDisplay)}return bars}},{key:"draw",value:function draw(){var self=this;return function(selection){selection.each((function(){var svg=self.chartEl.append("g");svg.data([self.chartData]);var bars=self.addBars(svg,self.chartData);self.addCircleEvents(bars);if(self.thresholdLineOptions.show){self.addThresholdLine(self.chartEl)}self.events.emit("rendered",{chart:self.chartData});return svg}))}}}]);return ColumnChart}(_point_series_PointSeries);function line_chart_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function line_chart_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function line_chart_createClass(Constructor,protoProps,staticProps){if(protoProps)line_chart_defineProperties(Constructor.prototype,protoProps);if(staticProps)line_chart_defineProperties(Constructor,staticProps);return Constructor}function line_chart_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)line_chart_setPrototypeOf(subClass,superClass)}function line_chart_setPrototypeOf(o,p){line_chart_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return line_chart_setPrototypeOf(o,p)}function line_chart_createSuper(Derived){var hasNativeReflectConstruct=line_chart_isNativeReflectConstruct();return function _createSuperInternal(){var Super=line_chart_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=line_chart_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return line_chart_possibleConstructorReturn(this,result)}}function line_chart_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return line_chart_assertThisInitialized(self)}function line_chart_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function line_chart_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function line_chart_getPrototypeOf(o){line_chart_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return line_chart_getPrototypeOf(o)}var line_chart_defaults={mode:"normal",showCircles:true,radiusRatio:9,showLines:true,interpolate:"linear",lineWidth:2,color:undefined,fillColor:undefined};var line_chart_LineChart=function(_PointSeries){line_chart_inherits(LineChart,_PointSeries);var _super=line_chart_createSuper(LineChart);function LineChart(handler,chartEl,chartData,seriesConfigArgs,deps){var _this;line_chart_classCallCheck(this,LineChart);_this=_super.call(this,handler,chartEl,chartData,seriesConfigArgs,deps);_this.seriesConfig=external_kbnSharedDeps_Lodash_default.a.defaults(seriesConfigArgs||{},line_chart_defaults);return _this}line_chart_createClass(LineChart,[{key:"addCircles",value:function addCircles(svg,data){var self=this;var showCircles=this.seriesConfig.showCircles;var color=this.handler.data.getColorFunc();var xScale=this.getCategoryAxis().getScale();var yScale=this.getValueAxis().getScale();var ordered=this.handler.data.get("ordered");var tooltip=this.baseChart.tooltip;var isTooltip=this.handler.visConfig.get("tooltip.show");var isHorizontal=this.getCategoryAxis().axisConfig.isHorizontal();var lineWidth=this.seriesConfig.lineWidth;var radii=this.baseChart.radii;var radiusStep=(radii.max-radii.min||radii.max*100)/Math.pow(this.seriesConfig.radiusRatio,2);var layer=svg.append("g").attr("class","points line").attr("clip-path","url(#"+this.baseChart.clipPathId+")");var circles=layer.selectAll("circle").data((function appendData(){return data.values.filter((function(d){return!external_kbnSharedDeps_Lodash_default.a.isNull(d.y)&&(d.y||!d.y0)}))}));circles.exit().remove();function cx(d){if(ordered&&ordered.date){return xScale(d.x)}return xScale(d.x)+xScale.rangeBand()/2}function cy(d){var y0=d.y0||0;var y=d.y||0;return yScale(y0+y)}function cColor(){return color(data.label)}function colorCircle(){var parent=d3_default.a.select(this).node().parentNode;var lengthOfParent=d3_default.a.select(parent).data()[0].length;var isVisible=lengthOfParent===1;if(!showCircles&&!isVisible)return"none";return cColor()}function getCircleRadiusFn(modifier){return function getCircleRadius(d){var width=self.baseChart.chartConfig.width;var height=self.baseChart.chartConfig.height;var circleRadius=(d.z-radii.min)/radiusStep;var baseMagicNumber=2;var base=circleRadius?Math.sqrt(circleRadius+baseMagicNumber)+lineWidth:lineWidth;return external_kbnSharedDeps_Lodash_default.a.min([base,width,height])+(modifier||0)}}circles.enter().append("circle").attr("r",getCircleRadiusFn()).attr("fill-opacity",this.seriesConfig.drawLinesBetweenPoints?1:.7).attr("cx",isHorizontal?cx:cy).attr("cy",isHorizontal?cy:cx).attr("class","circle-decoration").attr("data-label",data.label).attr("fill",colorCircle);circles.enter().append("circle").attr("r",getCircleRadiusFn(10)).attr("cx",isHorizontal?cx:cy).attr("cy",isHorizontal?cy:cx).attr("fill","transparent").attr("class","circle").attr("data-label",data.label).attr("stroke",cColor).attr("stroke-width",0);if(isTooltip){circles.call(tooltip.render())}return circles}},{key:"addLine",value:function addLine(svg,data){var xScale=this.getCategoryAxis().getScale();var yScale=this.getValueAxis().getScale();var color=this.handler.data.getColorFunc();var ordered=this.handler.data.get("ordered");var lineWidth=this.seriesConfig.lineWidth;var interpolate=this.seriesConfig.interpolate;var isHorizontal=this.getCategoryAxis().axisConfig.isHorizontal();var line=svg.append("g").attr("class","pathgroup lines").attr("clip-path","url(#"+this.baseChart.clipPathId+")");function cx(d){if(ordered&&ordered.date){return xScale(d.x)}return xScale(d.x)+xScale.rangeBand()/2}function cy(d){var y=d.y||0;var y0=d.y0||0;return yScale(y0+y)}line.append("path").attr("data-label",data.label).attr("d",(function(){var d3Line=d3_default.a.svg.line().defined((function(d){return!external_kbnSharedDeps_Lodash_default.a.isNull(d.y)})).interpolate(interpolate).x(isHorizontal?cx:cy).y(isHorizontal?cy:cx);return d3Line(data.values)})).attr("fill","none").attr("stroke",(function(){return color(data.label)})).attr("stroke-width",lineWidth);return line}},{key:"draw",value:function draw(){var self=this;return function(selection){selection.each((function(){var svg=self.chartEl.append("g");svg.data([self.chartData]);if(self.seriesConfig.drawLinesBetweenPoints){self.addLine(svg,self.chartData)}var circles=self.addCircles(svg,self.chartData);self.addCircleEvents(circles);if(self.thresholdLineOptions.show){self.addThresholdLine(self.chartEl)}self.events.emit("rendered",{chart:self.chartData});return svg}))}}}]);return LineChart}(_point_series_PointSeries);function area_chart_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function area_chart_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function area_chart_createClass(Constructor,protoProps,staticProps){if(protoProps)area_chart_defineProperties(Constructor.prototype,protoProps);if(staticProps)area_chart_defineProperties(Constructor,staticProps);return Constructor}function area_chart_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)area_chart_setPrototypeOf(subClass,superClass)}function area_chart_setPrototypeOf(o,p){area_chart_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return area_chart_setPrototypeOf(o,p)}function area_chart_createSuper(Derived){var hasNativeReflectConstruct=area_chart_isNativeReflectConstruct();return function _createSuperInternal(){var Super=area_chart_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=area_chart_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return area_chart_possibleConstructorReturn(this,result)}}function area_chart_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return area_chart_assertThisInitialized(self)}function area_chart_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function area_chart_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function area_chart_getPrototypeOf(o){area_chart_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return area_chart_getPrototypeOf(o)}var area_chart_defaults={mode:"normal",showCircles:true,radiusRatio:9,showLines:true,interpolate:"linear",color:undefined,fillColor:undefined};var area_chart_AreaChart=function(_PointSeries){area_chart_inherits(AreaChart,_PointSeries);var _super=area_chart_createSuper(AreaChart);function AreaChart(handler,chartEl,chartData,seriesConfigArgs,deps){var _this;area_chart_classCallCheck(this,AreaChart);_this=_super.call(this,handler,chartEl,chartData,seriesConfigArgs,deps);_this.seriesConfig=external_kbnSharedDeps_Lodash_default.a.defaults(seriesConfigArgs||{},area_chart_defaults);_this.isOverlapping=_this.seriesConfig.mode!=="stacked";if(_this.isOverlapping){var defaultOpacity=.6;_this.seriesConfig.defaultOpacity=defaultOpacity;handler.highlight=function(element){var label=this.getAttribute("data-label");if(!label)return;var highlightOpacity=.8;var highlightElements=external_kbnSharedDeps_Jquery_default()("[data-label]",element.parentNode).filter((function(els,el){return"".concat(external_kbnSharedDeps_Jquery_default()(el).data("label"))===label}));external_kbnSharedDeps_Jquery_default()("[data-label]",element.parentNode).not(highlightElements).css("opacity",defaultOpacity/2);highlightElements.css("opacity",highlightOpacity)};handler.unHighlight=function(element){external_kbnSharedDeps_Jquery_default()("[data-label]",element).css("opacity",defaultOpacity);external_kbnSharedDeps_Jquery_default()("[data-label]",external_kbnSharedDeps_Jquery_default()(element).siblings()).css("opacity",1)}}return _this}area_chart_createClass(AreaChart,[{key:"addPath",value:function addPath(svg,data){var ordered=this.handler.data.get("ordered");var isTimeSeries=ordered&&ordered.date;var isOverlapping=this.isOverlapping;var color=this.handler.data.getColorFunc();var xScale=this.getCategoryAxis().getScale();var yScale=this.getValueAxis().getScale();var interpolate=this.seriesConfig.interpolate;var isHorizontal=this.getCategoryAxis().axisConfig.isHorizontal();var layer=svg.append("g").attr("class",(function(d,i){return"series series-"+i}));var path=layer.append("path").attr("data-label",data.label).style("fill",(function(){return color(data.label)})).style("stroke",(function(){return color(data.label)})).classed("visAreaChart__overlapArea",(function(){return isOverlapping})).attr("clip-path","url(#"+this.baseChart.clipPathId+")");function x(d){if(isTimeSeries){return xScale(d.x)}return xScale(d.x)+xScale.rangeBand()/2}function y1(d){var y0=d.y0||0;var y=d.y||0;return yScale(y0+y)}function y0(d){var y0=d.y0||0;return yScale(y0)}function getArea(){if(isHorizontal){return d3_default.a.svg.area().x(x).y0(y0).y1(y1)}else{return d3_default.a.svg.area().y(x).x0(y0).x1(y1)}}path.attr("d",(function(){var area=getArea().defined((function(d){return!external_kbnSharedDeps_Lodash_default.a.isNull(d.y)})).interpolate(interpolate);return area(data.values)})).style("stroke-width","1px");return path}},{key:"addCircles",value:function addCircles(svg,data){var color=this.handler.data.getColorFunc();var xScale=this.getCategoryAxis().getScale();var yScale=this.getValueAxis().getScale();var ordered=this.handler.data.get("ordered");var circleRadius=12;var circleStrokeWidth=0;var tooltip=this.baseChart.tooltip;var isTooltip=this.handler.visConfig.get("tooltip.show");var isOverlapping=this.isOverlapping;var isHorizontal=this.getCategoryAxis().axisConfig.isHorizontal();var layer=svg.append("g").attr("class","points area").attr("clip-path","url(#"+this.baseChart.clipPathId+")");var circles=layer.selectAll("circles").data((function appendData(){return data.values.filter((function isZeroOrNull(d){return d.y!==0&&!external_kbnSharedDeps_Lodash_default.a.isNull(d.y)}))}));circles.exit().remove();circles.enter().append("circle").attr("data-label",data.label).attr("stroke",(function(){return color(data.label)})).attr("fill","transparent").attr("stroke-width",circleStrokeWidth);function cx(d){if(ordered&&ordered.date){return xScale(d.x)}return xScale(d.x)+xScale.rangeBand()/2}function cy(d){var y=d.y||0;if(isOverlapping){return yScale(y)}return yScale(d.y0+y)}circles.attr("cx",isHorizontal?cx:cy).attr("cy",isHorizontal?cy:cx).attr("r",circleRadius);if(isTooltip){circles.call(tooltip.render())}return circles}},{key:"addPathEvents",value:function addPathEvents(path){var events=this.events;if(this.handler.visConfig.get("enableHover")){var hover=events.addHoverEvent();var mouseout=events.addMouseoutEvent();path.call(hover).call(mouseout)}}},{key:"draw",value:function draw(){var self=this;return function(selection){selection.each((function(){var svg=self.chartEl.append("g");svg.data([self.chartData]);var path=self.addPath(svg,self.chartData);self.addPathEvents(path);var circles=self.addCircles(svg,self.chartData);self.addCircleEvents(circles);if(self.thresholdLineOptions.show){self.addThresholdLine(self.chartEl)}self.events.emit("rendered",{chart:self.chartData});return svg}))}}}]);return AreaChart}(_point_series_PointSeries);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(2);var charts_public_=__webpack_require__(3);function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||heatmap_chart_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function heatmap_chart_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return heatmap_chart_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return heatmap_chart_arrayLikeToArray(o,minLen)}function heatmap_chart_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function heatmap_chart_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function heatmap_chart_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function heatmap_chart_createClass(Constructor,protoProps,staticProps){if(protoProps)heatmap_chart_defineProperties(Constructor.prototype,protoProps);if(staticProps)heatmap_chart_defineProperties(Constructor,staticProps);return Constructor}function heatmap_chart_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)heatmap_chart_setPrototypeOf(subClass,superClass)}function heatmap_chart_setPrototypeOf(o,p){heatmap_chart_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return heatmap_chart_setPrototypeOf(o,p)}function heatmap_chart_createSuper(Derived){var hasNativeReflectConstruct=heatmap_chart_isNativeReflectConstruct();return function _createSuperInternal(){var Super=heatmap_chart_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=heatmap_chart_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return heatmap_chart_possibleConstructorReturn(this,result)}}function heatmap_chart_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return heatmap_chart_assertThisInitialized(self)}function heatmap_chart_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function heatmap_chart_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function heatmap_chart_getPrototypeOf(o){heatmap_chart_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return heatmap_chart_getPrototypeOf(o)}var heatmap_chart_defaults={color:undefined,fillColor:undefined};var heatmap_chart_HeatmapChart=function(_PointSeries){heatmap_chart_inherits(HeatmapChart,_PointSeries);var _super=heatmap_chart_createSuper(HeatmapChart);function HeatmapChart(handler,chartEl,chartData,seriesConfigArgs,deps){var _this;heatmap_chart_classCallCheck(this,HeatmapChart);_this=_super.call(this,handler,chartEl,chartData,seriesConfigArgs,deps);_this.seriesConfig=external_kbnSharedDeps_Lodash_default.a.defaults(seriesConfigArgs||{},heatmap_chart_defaults);_this.handler.visConfig.set("legend",{labels:_this.getHeatmapLabels(_this.handler.visConfig),colors:_this.getHeatmapColors(_this.handler.visConfig)});var colors=_this.handler.visConfig.get("legend.colors",null);if(colors){_this.handler.vis.uiState.setSilent("vis.defaultColors",null);_this.handler.vis.uiState.setSilent("vis.defaultColors",colors)}return _this}heatmap_chart_createClass(HeatmapChart,[{key:"getHeatmapLabels",value:function getHeatmapLabels(cfg){var percentageMode=cfg.get("percentageMode");var colorsNumber=cfg.get("colorsNumber");var colorsRange=cfg.get("colorsRange");var zAxisConfig=this.getValueAxis().axisConfig;var zAxisFormatter=zAxisConfig.get("labels.axisFormatter");var zScale=this.getValueAxis().getScale();var _zScale$domain=zScale.domain(),_zScale$domain2=_slicedToArray(_zScale$domain,2),min=_zScale$domain2[0],max=_zScale$domain2[1];var labels=[];var maxColorCnt=10;if(cfg.get("setColorRange")){colorsRange.forEach((function(range){var from=isFinite(range.from)?zAxisFormatter(range.from):range.from;var to=isFinite(range.to)?zAxisFormatter(range.to):range.to;labels.push("".concat(from," - ").concat(to))}))}else{if(max===min){return[min.toString()]}for(var i=0;i<colorsNumber;i++){var label=void 0;var val=i/colorsNumber;var nextVal=(i+1)/colorsNumber;if(percentageMode){val=Math.ceil(val*100);nextVal=Math.ceil(nextVal*100);label="".concat(val,"% - ").concat(nextVal,"%")}else{val=val*(max-min)+min;nextVal=nextVal*(max-min)+min;if(max-min>maxColorCnt){var valInt=Math.ceil(val);if(i===0){val=valInt===val?val:valInt-1}else{val=valInt}nextVal=Math.ceil(nextVal)}if(isFinite(val))val=zAxisFormatter(val);if(isFinite(nextVal))nextVal=zAxisFormatter(nextVal);label="".concat(val," - ").concat(nextVal)}labels.push(label)}}return labels}},{key:"getHeatmapColors",value:function getHeatmapColors(cfg){var invertColors=cfg.get("invertColors");var colorSchema=cfg.get("colorSchema");var labels=this.getHeatmapLabels(cfg);var colors={};for(var i in labels){if(labels[i]){var val=invertColors?1-i/labels.length:i/labels.length;colors[labels[i]]=Object(charts_public_["getHeatmapColors"])(val,colorSchema)}}return colors}},{key:"addSquares",value:function addSquares(svg,data){var xScale=this.getCategoryAxis().getScale();var yScale=this.handler.categoryAxes[1].getScale();var zScale=this.getValueAxis().getScale();var tooltip=this.baseChart.tooltip;var isTooltip=this.handler.visConfig.get("tooltip.show");var isHorizontal=this.getCategoryAxis().axisConfig.isHorizontal();var colorsNumber=this.handler.visConfig.get("colorsNumber");var setColorRange=this.handler.visConfig.get("setColorRange");var colorsRange=this.handler.visConfig.get("colorsRange");var color=this.handler.data.getColorFunc();var labels=this.handler.visConfig.get("legend.labels");var zAxisConfig=this.getValueAxis().axisConfig;var zAxisFormatter=zAxisConfig.get("labels.axisFormatter");var showLabels=zAxisConfig.get("labels.show");var overwriteLabelColor=zAxisConfig.get("labels.overwriteColor",false);var layer=svg.append("g").attr("class","series");var squares=layer.selectAll("g.square").data(data.values);squares.exit().remove();var barWidth;if(this.getCategoryAxis().axisConfig.isTimeDomain()){var _this$handler$data$ge=this.handler.data.get("ordered"),_min=_this$handler$data$ge.min,interval=_this$handler$data$ge.interval;var start=_min;var end=external_kbnSharedDeps_Moment_default()(_min).add(interval).valueOf();barWidth=xScale(end)-xScale(start);if(!isHorizontal)barWidth*=-1}function x(d){return xScale(d.x)}function y(d){return yScale(d.series)}var _zScale$domain3=zScale.domain(),_zScale$domain4=_slicedToArray(_zScale$domain3,2),min=_zScale$domain4[0],max=_zScale$domain4[1];function getColorBucket(d){var val=0;if(setColorRange&&colorsRange.length){var bucket=external_kbnSharedDeps_Lodash_default.a.find(colorsRange,(function(range){return range.from<=d.y&&range.to>d.y}));return bucket?colorsRange.indexOf(bucket):-1}else{if(isNaN(min)||isNaN(max)){val=colorsNumber-1}else if(min===max){val=0}else{val=(d.y-min)/(max-min);val=Math.min(colorsNumber-1,Math.floor(val*colorsNumber))}}if(d.y==null){return-1}return!isNaN(val)?val:-1}function label(d){var colorBucket=getColorBucket(d);if(colorBucket<0)d.hide=true;return labels[colorBucket]}function z(d){if(label(d)==="")return"transparent";return color(label(d))}var squareWidth=barWidth||xScale.rangeBand();var squareHeight=yScale.rangeBand();squares.enter().append("g").attr("class","square");squares.append("rect").attr("x",x).attr("width",squareWidth).attr("y",y).attr("height",squareHeight).attr("data-label",label).attr("fill",z).attr("style","cursor: pointer; stroke: black; stroke-width: 0.1px").style("display",(function(d){return d.hide?"none":"initial"}));if(showLabels){var rotate=zAxisConfig.get("labels.rotate");var rotateRad=rotate*Math.PI/180;var cellPadding=5;var maxLength=Math.min(Math.abs(squareWidth/Math.cos(rotateRad)),Math.abs(squareHeight/Math.sin(rotateRad)))-cellPadding;var maxHeight=Math.min(Math.abs(squareWidth/Math.sin(rotateRad)),Math.abs(squareHeight/Math.cos(rotateRad)))-cellPadding;var labelColor;if(overwriteLabelColor){labelColor=zAxisConfig.get("labels.color")}else{labelColor=function labelColor(d){var bgColor=z(d);var color=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(bgColor);return color&&Object(external_kbnSharedDeps_ElasticEui_["isColorDark"])(parseInt(color[1]),parseInt(color[2]),parseInt(color[3]))?"#FFF":"#222"}}var hiddenLabels=false;squares.append("text").text((function(d){return zAxisFormatter(d.y)})).style("display",(function(d){var textLength=this.getBBox().width;var textHeight=this.getBBox().height;var textTooLong=textLength>maxLength;var textTooWide=textHeight>maxHeight;if(!d.hide&&(textTooLong||textTooWide)){hiddenLabels=true}return d.hide||textTooLong||textTooWide?"none":"initial"})).style("dominant-baseline","central").style("text-anchor","middle").style("fill",labelColor).attr("x",(function(d){var center=x(d)+squareWidth/2;return center})).attr("y",(function(d){var center=y(d)+squareHeight/2;return center})).attr("transform",(function(d){var horizontalCenter=x(d)+squareWidth/2;var verticalCenter=y(d)+squareHeight/2;return"rotate(".concat(rotate,",").concat(horizontalCenter,",").concat(verticalCenter,")")}));if(hiddenLabels){this.baseChart.handler.alerts.show("Some labels were hidden due to size constraints")}}if(isTooltip){squares.call(tooltip.render())}return squares.selectAll("rect")}},{key:"draw",value:function draw(){var self=this;return function(selection){selection.each((function(){var svg=self.chartEl.append("g");svg.data([self.chartData]);var squares=self.addSquares(svg,self.chartData);self.addCircleEvents(squares);self.events.emit("rendered",{chart:self.chartData});return svg}))}}}]);return HeatmapChart}(_point_series_PointSeries);var seriesTypes={histogram:column_chart_ColumnChart,line:line_chart_LineChart,area:area_chart_AreaChart,heatmap:heatmap_chart_HeatmapChart};var touchdown_tmpl='<p class="visTooltip__header">\n  <i class="fa fa-info-circle visTooltip__headerIcon"></i>\n  <span class="visTooltip__headerText">\n    <%= wholeBucket ? \'Part of this bucket\' : \'This area\' %>\n    may contain partial data. The selected time range does not fully cover it.\n  </span>\n</p>\n';function point_series_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function point_series_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function point_series_createClass(Constructor,protoProps,staticProps){if(protoProps)point_series_defineProperties(Constructor.prototype,protoProps);if(staticProps)point_series_defineProperties(Constructor,staticProps);return Constructor}function point_series_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)point_series_setPrototypeOf(subClass,superClass)}function point_series_setPrototypeOf(o,p){point_series_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return point_series_setPrototypeOf(o,p)}function point_series_createSuper(Derived){var hasNativeReflectConstruct=point_series_isNativeReflectConstruct();return function _createSuperInternal(){var Super=point_series_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=point_series_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return point_series_possibleConstructorReturn(this,result)}}function point_series_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return point_series_assertThisInitialized(self)}function point_series_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function point_series_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function point_series_getPrototypeOf(o){point_series_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return point_series_getPrototypeOf(o)}var seriTypes=seriesTypes;var touchdownTmpl=external_kbnSharedDeps_Lodash_default.a.template(touchdown_tmpl);var point_series_PointSeries=function(_Chart){point_series_inherits(PointSeries,_Chart);var _super=point_series_createSuper(PointSeries);function PointSeries(handler,chartEl,chartData,deps){var _this;point_series_classCallCheck(this,PointSeries);_this=_super.call(this,handler,chartEl,chartData,deps);_this.deps=deps;_this.handler=handler;_this.chartData=chartData;_this.chartEl=chartEl;_this.chartConfig=_this.findChartConfig();_this.handler.pointSeries=point_series_assertThisInitialized(_this);return _this}point_series_createClass(PointSeries,[{key:"findChartConfig",value:function findChartConfig(){var charts=this.handler.visConfig.get("charts");var chartIndex=this.handler.data.chartData().indexOf(this.chartData);return charts[chartIndex]}},{key:"getSeries",value:function getSeries(seriesId){return this.series.find((function(series){return series.chartData.aggId===seriesId}))}},{key:"addBackground",value:function addBackground(svg,width,height){var startX=0;var startY=0;return svg.append("rect").attr("x",startX).attr("y",startY).attr("width",width).attr("height",height).attr("fill","transparent").attr("class","background")}},{key:"addGrid",value:function addGrid(svg){var _svg$node$getBBox=svg.node().getBBox(),width=_svg$node$getBBox.width,height=_svg$node$getBBox.height;return svg.append("g").attr("class","grid").call(this.handler.grid.draw(width,height))}},{key:"addClipPath",value:function addClipPath(svg){var _svg$node$getBBox2=svg.node().getBBox(),width=_svg$node$getBBox2.width,height=_svg$node$getBBox2.height;var startX=0;var startY=0;this.clipPathId="chart-area"+external_kbnSharedDeps_Lodash_default.a.uniqueId();return svg.append("clipPath").attr("id",this.clipPathId).append("rect").attr("x",startX).attr("y",startY).attr("width",width).attr("height",height)}},{key:"addEvents",value:function addEvents(svg){var isBrushable=this.events.isBrushable();if(isBrushable){this.events.addBrushEvent(svg)}}},{key:"createEndZones",value:function createEndZones(svg){var self=this;var xAxis=this.handler.categoryAxes[0];var xScale=xAxis.getScale();var ordered=xAxis.ordered;var isHorizontal=xAxis.axisConfig.isHorizontal();var missingMinMax=!ordered||external_kbnSharedDeps_Lodash_default.a.isUndefined(ordered.min)||external_kbnSharedDeps_Lodash_default.a.isUndefined(ordered.max);if(missingMinMax||ordered.endzones===false)return;var _svg$node$getBBox3=svg.node().getBBox(),width=_svg$node$getBBox3.width,height=_svg$node$getBBox3.height;var oneUnit=(ordered.units||external_kbnSharedDeps_Lodash_default.a.identity)(1);var drawInverted=isHorizontal||xAxis.axisConfig.get("scale.inverted",false);var size=isHorizontal?width:height;var leftEndzone={x:drawInverted?0:Math.max(xScale(ordered.min),0),w:drawInverted?Math.max(xScale(ordered.min),0):height-Math.max(xScale(ordered.min),0)};var expandLastBucket=xAxis.axisConfig.get("scale.expandLastBucket");var rightLastVal=expandLastBucket?ordered.max:Math.min(ordered.max,external_kbnSharedDeps_Lodash_default.a.last(xAxis.values));var rightStart=rightLastVal+oneUnit;var rightEndzone={x:drawInverted?xScale(rightStart):0,w:drawInverted?Math.max(size-xScale(rightStart),0):xScale(rightStart)};this.endzones=svg.selectAll(".layer").data([leftEndzone,rightEndzone]).enter().insert("g",".brush").attr("class","endzone").append("rect").attr("class","zone").attr("x",(function(d){return isHorizontal?d.x:0})).attr("y",(function(d){return isHorizontal?0:d.x})).attr("height",(function(d){return isHorizontal?height:d.w})).attr("width",(function(d){return isHorizontal?d.w:width}));function callPlay(event){var boundData=event.target.__data__;var mouseChartXCoord=event.clientX-self.chartEl.getBoundingClientRect().left;var mouseChartYCoord=event.clientY-self.chartEl.getBoundingClientRect().top;var wholeBucket=boundData&&boundData.x!=null;var min=drawInverted?leftEndzone.w:rightEndzone.w;var max=drawInverted?rightEndzone.x:leftEndzone.x;var xLeft=isHorizontal?mouseChartXCoord:mouseChartYCoord;var xRight=isHorizontal?mouseChartXCoord:mouseChartYCoord;if(wholeBucket){xLeft=xScale(boundData.x);xRight=xScale(xAxis.addInterval(boundData.x))}return{wholeBucket:wholeBucket,touchdown:min>xLeft||max<xRight}}function textFormatter(){return touchdownTmpl(callPlay(d3_default.a.event))}var endzoneTT=new Tooltip("endzones",this.handler.el,textFormatter,null);this.tooltips.push(endzoneTT);endzoneTT.order=0;endzoneTT.showCondition=function inEndzone(){return callPlay(d3_default.a.event).touchdown};endzoneTT.render()(svg)}},{key:"calculateRadiusLimits",value:function calculateRadiusLimits(data){this.radii=external_kbnSharedDeps_Lodash_default()(data.series).map((function(series){return external_kbnSharedDeps_Lodash_default.a.map(series.values,"z")})).flattenDeep().reduce((function(result,val){if(result.min>val)result.min=val;if(result.max<val)result.max=val;return result}),{min:Infinity,max:-Infinity})}},{key:"draw",value:function draw(){var self=this;var $elem=external_kbnSharedDeps_Jquery_default()(this.chartEl);var width=this.chartConfig.width=$elem.width();var height=this.chartConfig.height=$elem.height();var xScale=this.handler.categoryAxes[0].getScale();var addTimeMarker=this.chartConfig.addTimeMarker;var times=this.chartConfig.times||[];var div;var svg;return function(selection){selection.each((function(data){var el=this;div=d3_default.a.select(el);svg=div.append("svg").attr("focusable","false").attr("width",width).attr("height",height);self.addBackground(svg,width,height);self.addGrid(svg);self.addClipPath(svg);self.addEvents(svg);self.createEndZones(svg);self.calculateRadiusLimits(data);self.series=[];external_kbnSharedDeps_Lodash_default.a.each(self.chartConfig.series,(function(seriArgs,i){if(!seriArgs.show)return;var SeriClass=seriTypes[seriArgs.type||self.handler.visConfig.get("chart.type")]||seriTypes.line;var series=new SeriClass(self.handler,svg,data.series[i],seriArgs,self.deps);series.events=self.events;svg.call(series.draw());self.series.push(series)}));if(addTimeMarker){var toTime=new Date(xScale.domain()[1].getTime()+6e4);var currentTime=new Date;if(toTime>currentTime){new time_marker_TimeMarker(times,xScale,height).render(svg)}}return svg}))}}}]);return PointSeries}(_chart_Chart);function pie_chart_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function pie_chart_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function pie_chart_createClass(Constructor,protoProps,staticProps){if(protoProps)pie_chart_defineProperties(Constructor.prototype,protoProps);if(staticProps)pie_chart_defineProperties(Constructor,staticProps);return Constructor}function pie_chart_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)pie_chart_setPrototypeOf(subClass,superClass)}function pie_chart_setPrototypeOf(o,p){pie_chart_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return pie_chart_setPrototypeOf(o,p)}function pie_chart_createSuper(Derived){var hasNativeReflectConstruct=pie_chart_isNativeReflectConstruct();return function _createSuperInternal(){var Super=pie_chart_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=pie_chart_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return pie_chart_possibleConstructorReturn(this,result)}}function pie_chart_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return pie_chart_assertThisInitialized(self)}function pie_chart_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function pie_chart_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function pie_chart_getPrototypeOf(o){pie_chart_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return pie_chart_getPrototypeOf(o)}var pie_chart_defaults={isDonut:false,showTooltip:true,color:undefined,fillColor:undefined};var pie_chart_PieChart=function(_Chart){pie_chart_inherits(PieChart,_Chart);var _super=pie_chart_createSuper(PieChart);function PieChart(handler,chartEl,chartData,deps){var _this;pie_chart_classCallCheck(this,PieChart);_this=_super.call(this,handler,chartEl,chartData,deps);var charts=_this.handler.data.getVisData();_this._validatePieData(charts);_this._attr=external_kbnSharedDeps_Lodash_default.a.defaults(handler.visConfig.get("chart",{}),pie_chart_defaults);return _this}pie_chart_createClass(PieChart,[{key:"_validatePieData",value:function _validatePieData(charts){var isAllZeros=charts.every((function(chart){return chart.slices.children.length===0}));if(isAllZeros){throw new PieContainsAllZeros}}},{key:"addPathEvents",value:function addPathEvents(element){var events=this.events;return element.call(events.addHoverEvent()).call(events.addMouseoutEvent()).call(events.addClickEvent())}},{key:"convertToPercentage",value:function convertToPercentage(slices){(function assignPercentages(slices){if(slices.sumOfChildren!=null)return;var parent=slices;var children=parent.children;var parentPercent=parent.percentOfParent;var sum=parent.sumOfChildren=Math.abs(children.reduce((function(sum,child){return sum+Math.abs(child.size)}),0));children.forEach((function(child){child.percentOfGroup=Math.abs(child.size)/sum;child.percentOfParent=child.percentOfGroup;if(parentPercent!=null){child.percentOfParent*=parentPercent}if(child.children){assignPercentages(child)}}))})(slices)}},{key:"addPath",value:function addPath(width,height,svg,slices){var self=this;var marginFactor=.95;var isDonut=self._attr.isDonut;var radius=Math.min(width,height)/2*marginFactor;var color=self.handler.data.getPieColorFunc();var tooltip=self.tooltip;var isTooltip=self._attr.addTooltip;var arcs=svg.append("g").attr("class","arcs");var labels=svg.append("g").attr("class","labels");var showLabels=self._attr.labels.show;var showValues=self._attr.labels.values;var truncateLabelLength=self._attr.labels.truncate;var showOnlyOnLastLevel=self._attr.labels.last_level;var partition=d3_default.a.layout.partition().sort(null).value((function(d){return d.percentOfParent*100}));var x=d3_default.a.scale.linear().range([0,2*Math.PI]);var y=d3_default.a.scale.sqrt().range([0,showLabels?radius*.7:radius]);var startAngle=function startAngle(d){return Math.max(0,Math.min(2*Math.PI,x(d.x)))};var endAngle=function endAngle(d){if(d.dx<1e-8)return x(d.x);return Math.max(0,Math.min(2*Math.PI,x(d.x+d.dx)))};var arc=d3_default.a.svg.arc().startAngle(startAngle).endAngle(endAngle).innerRadius((function(d){if(d.depth===1&&!isDonut){return 0}return Math.max(0,y(d.y))})).outerRadius((function(d){return Math.max(0,y(d.y+d.dy))}));var outerArc=d3_default.a.svg.arc().startAngle(startAngle).endAngle(endAngle).innerRadius(radius*.8).outerRadius(radius*.8);var maxDepth=0;var path=arcs.datum(slices).selectAll("path").data(partition.nodes).enter().append("path").attr("d",arc).attr("class",(function(d){if(d.depth===0){return}if(d.depth>maxDepth)maxDepth=d.depth;return"slice"})).attr("data-test-subj",(function(d){if(d.name){return"pieSlice-".concat(d.name.split(" ").join("-"))}})).call(self._addIdentifier,"name").style("fill",(function(d){if(d.depth===0){return"none"}return color(d.name)}));if(showLabels){var labelGroups=labels.datum(slices).selectAll(".label").data(partition.nodes);var svgParentNode=svg.node().parentNode.parentNode;var svgBBox={width:svgParentNode.clientWidth,height:svgParentNode.clientHeight};var labelLayout=d3_default.a.geom.quadtree().extent([[-svgBBox.width,-svgBBox.height],[svgBBox.width,svgBBox.height]]).x((function(d){return d.position.x})).y((function(d){return d.position.y}))([]);labelGroups.enter().append("g").attr("class","label").append("text").text((function(d){if(d.depth===0){d3_default.a.select(this.parentNode).remove();return}if(showValues){var value=external_kbnSharedDeps_ElasticNumeral_default()(d.value/100).format("0.[00]%");return"".concat(d.name," (").concat(value,")")}return d.name})).text((function(){return truncate_labels_truncateLabel(this,truncateLabelLength)})).attr("text-anchor",(function(d){var midAngle=startAngle(d)+(endAngle(d)-startAngle(d))/2;return midAngle<Math.PI?"start":"end"})).attr("class","label-text").each((function resolveConflicts(d){if(d.depth===0)return;var parentNode=this.parentNode;if(showOnlyOnLastLevel&&maxDepth!==d.depth){d3_default.a.select(parentNode).remove();return}var bbox=this.getBBox();var pos=outerArc.centroid(d);var midAngle=startAngle(d)+(endAngle(d)-startAngle(d))/2;pos[1]+=4;pos[0]=(.7+d.depth/10)*radius*(midAngle<Math.PI?1:-1);d.position={x:pos[0],y:pos[1],left:midAngle<Math.PI?pos[0]:pos[0]-bbox.width,right:midAngle>Math.PI?pos[0]+bbox.width:pos[0],bottom:pos[1]+5,top:pos[1]-bbox.height-5};var conflicts=[];labelLayout.visit((function(node){if(!node.point)return;if(conflicts.length)return true;var point=node.point.position;var current=d.position;if(point){var horizontalConflict=point.left<0&&current.left<0||point.left>0&&current.left>0;var verticalConflict=point.top>=current.top&&point.top<=current.bottom||point.top<=current.top&&point.bottom>=current.top;if(horizontalConflict&&verticalConflict){point.point=node.point;conflicts.push(point)}return true}}));if(conflicts.length){d3_default.a.select(parentNode).remove();return}labelLayout.add(d)})).attr("x",(function(d){if(d.depth===0||!d.position){return}return d.position.x})).attr("y",(function(d){if(d.depth===0||!d.position){return}return d.position.y}));labelGroups.append("polyline").attr("points",(function(d){if(d.depth===0||!d.position){return}var pos1=outerArc.centroid(d);var x2=d.position.x>0?d.position.x-10:d.position.x+10;var pos2=[x2,d.position.y-4];pos1[1]=pos2[1];return[arc.centroid(d),pos1,pos2]})).attr("class","label-line")}if(isTooltip){path.call(tooltip.render())}return path}},{key:"_validateContainerSize",value:function _validateContainerSize(width,height){var minWidth=20;var minHeight=20;if(width<=minWidth||height<=minHeight){throw new ContainerTooSmall}}},{key:"draw",value:function draw(){var self=this;return function(selection){selection.each((function(data){var slices=data.slices;var div=d3_default.a.select(this);var width=external_kbnSharedDeps_Jquery_default()(this).width();var height=external_kbnSharedDeps_Jquery_default()(this).height();if(!slices.children.length)return;self.convertToPercentage(slices);self._validateContainerSize(width,height);var svg=div.append("svg").attr("width",width).attr("height",height).attr("focusable","false").append("g").attr("transform","translate("+width/2+","+height/2+")");var path=self.addPath(width,height,svg,slices);self.addPathEvents(path);self.events.emit("rendered",{chart:data});return svg}))}}}]);return PieChart}(_chart_Chart);function meter_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function meter_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function meter_createClass(Constructor,protoProps,staticProps){if(protoProps)meter_defineProperties(Constructor.prototype,protoProps);if(staticProps)meter_defineProperties(Constructor,staticProps);return Constructor}var arcAngles={angleFactor:.75,maxAngle:2*Math.PI*1.3,minAngle:2*Math.PI*.7};var circleAngles={angleFactor:1,maxAngle:2*Math.PI,minAngle:0};var defaultConfig={showTooltip:true,percentageMode:true,innerSpace:5,extents:[0,1e4],outline:false,scale:{show:true,color:"#666",width:2,ticks:10,tickLength:8},labels:{show:true,color:"#666"},style:{bgWidth:.5,width:.9}};var meter_MeterGauge=function(){function MeterGauge(gaugeChart){meter_classCallCheck(this,MeterGauge);this.gaugeChart=gaugeChart;this.gaugeConfig=gaugeChart.gaugeConfig;this.gaugeConfig=external_kbnSharedDeps_Lodash_default.a.defaultsDeep(this.gaugeConfig,defaultConfig);this.gaugeChart.handler.visConfig.set("legend",{labels:this.getLabels(),colors:this.getColors()});var colors=this.gaugeChart.handler.visConfig.get("legend.colors",null);if(colors){this.gaugeChart.handler.vis.uiState.setSilent("vis.defaultColors",null);this.gaugeChart.handler.vis.uiState.setSilent("vis.defaultColors",colors)}this.colorFunc=this.gaugeChart.handler.data.getColorFunc()}meter_createClass(MeterGauge,[{key:"getLabels",value:function getLabels(){var isPercentageMode=this.gaugeConfig.percentageMode;var colorsRange=this.gaugeConfig.colorsRange;var max=external_kbnSharedDeps_Lodash_default.a.last(colorsRange).to;var labels=[];colorsRange.forEach((function(range){var from=isPercentageMode?Math.round(100*range.from/max):range.from;var to=isPercentageMode?Math.round(100*range.to/max):range.to;labels.push("".concat(from," - ").concat(to))}));return labels}},{key:"getColors",value:function getColors(){var invertColors=this.gaugeConfig.invertColors;var colorSchema=this.gaugeConfig.colorSchema;var colorsRange=this.gaugeConfig.colorsRange;var labels=this.getLabels();var colors={};for(var i=0;i<labels.length;i+=1){var divider=Math.max(colorsRange.length-1,1);var val=invertColors?1-i/divider:i/divider;colors[labels[i]]=Object(charts_public_["getHeatmapColors"])(val,colorSchema)}return colors}},{key:"getBucket",value:function getBucket(val){var bucket=external_kbnSharedDeps_Lodash_default.a.findIndex(this.gaugeConfig.colorsRange,(function(range){return range.from<=val&&range.to>val}));if(bucket===-1){if(val<this.gaugeConfig.colorsRange[0].from)bucket=0;else bucket=this.gaugeConfig.colorsRange.length-1}return bucket}},{key:"getLabel",value:function getLabel(val){var bucket=this.getBucket(val);var labels=this.gaugeChart.handler.visConfig.get("legend.labels");return labels[bucket]}},{key:"getColorBucket",value:function getColorBucket(val){var bucket=this.getBucket(val);var labels=this.gaugeChart.handler.visConfig.get("legend.labels");return this.colorFunc(labels[bucket])}},{key:"drawScale",value:function drawScale(svg,radius,angle){var _this=this;var scaleWidth=this.gaugeConfig.scale.width;var tickLength=this.gaugeConfig.scale.tickLength;var scaleTicks=this.gaugeConfig.scale.ticks;var scale=svg.append("g");this.gaugeConfig.colorsRange.forEach((function(range){var color=_this.getColorBucket(range.from);var scaleArc=d3_default.a.svg.arc().startAngle(angle(range.from)).endAngle(angle(range.to)).innerRadius(radius).outerRadius(radius+scaleWidth);scale.append("path").attr("d",scaleArc).style("stroke",color).style("fill",color)}));var extents=angle.domain();for(var i=0;i<=scaleTicks;i++){var val=i*(extents[1]-extents[0])/scaleTicks;var tickAngle=angle(val)-Math.PI/2;var x0=Math.cos(tickAngle)*radius;var x1=Math.cos(tickAngle)*(radius-tickLength);var y0=Math.sin(tickAngle)*radius;var y1=Math.sin(tickAngle)*(radius-tickLength);var color=this.getColorBucket(val);scale.append("line").attr("x1",x0).attr("x2",x1).attr("y1",y0).attr("y2",y1).style("stroke-width",scaleWidth).style("stroke",color)}return scale}},{key:"drawGauge",value:function drawGauge(svg,data,width,height){var _this2=this;var marginFactor=.95;var tooltip=this.gaugeChart.tooltip;var isTooltip=this.gaugeChart.handler.visConfig.get("addTooltip");var isDisplayWarning=this.gaugeChart.handler.visConfig.get("isDisplayWarning",false);var _ref=this.gaugeConfig.gaugeType==="Circle"?circleAngles:arcAngles,angleFactor=_ref.angleFactor,maxAngle=_ref.maxAngle,minAngle=_ref.minAngle;var maxRadius=Math.min(width,height/angleFactor)/2*marginFactor;var extendRange=this.gaugeConfig.extendRange;var maxY=external_kbnSharedDeps_Lodash_default.a.max(data.values,"y").y;var min=this.gaugeConfig.colorsRange[0].from;var max=external_kbnSharedDeps_Lodash_default.a.last(this.gaugeConfig.colorsRange).to;var angle=d3_default.a.scale.linear().range([minAngle,maxAngle]).domain([min,extendRange&&max<maxY?maxY:max]);var radius=d3_default.a.scale.linear().range([0,maxRadius]).domain([this.gaugeConfig.innerSpace+1,0]);var totalWidth=Math.abs(radius(0)-radius(1));var bgPadding=totalWidth*(1-this.gaugeConfig.style.bgWidth)/2;var gaugePadding=totalWidth*(1-this.gaugeConfig.style.width)/2;var getInnerFreeSpace=function getInnerFreeSpace(){return radius(1)*2-(_this2.gaugeConfig.scale.show?_this2.gaugeConfig.scale.tickLength*2:-Math.max(bgPadding,gaugePadding)*2)};var arc=d3_default.a.svg.arc().startAngle(minAngle).endAngle((function(d){return Math.max(0,Math.min(maxAngle,angle(Math.max(min,d.y))))})).innerRadius((function(d,i,j){return Math.max(0,radius(j+1)+gaugePadding)})).outerRadius((function(d,i,j){return Math.max(0,radius(j)-gaugePadding)}));var bgArc=d3_default.a.svg.arc().startAngle(minAngle).endAngle(maxAngle).innerRadius((function(d,i,j){return Math.max(0,radius(j+1)+bgPadding)})).outerRadius((function(d,i,j){return Math.max(0,radius(j)-bgPadding)}));var gaugeHolders=svg.selectAll("path").data([data]).enter().append("g").attr("data-label",(function(d){return _this2.getLabel(d.values[0].y)}));var gauges=gaugeHolders.selectAll("g").data((function(d){return d.values})).enter();gauges.append("path").attr("d",bgArc).attr("class",this.gaugeConfig.outline?"visGauge__meter--outline":undefined).style("fill",this.gaugeConfig.style.bgFill);var series=gauges.append("path").attr("d",arc).attr("class",this.gaugeConfig.outline?"visGauge__meter--outline":undefined).style("fill",(function(d){return _this2.getColorBucket(Math.max(min,d.y))}));var smallContainer=svg.node().getBBox().height<70;var hiddenLabels=smallContainer;var valueLabelHidden=false;gauges.append("text").attr("class","chart-label").attr("y",-5).text((function(d){if(_this2.gaugeConfig.percentageMode){var percentage=(d.y-min)/(max-min);return data.yAxisFormatter(percentage)}return data.yAxisFormatter(d.y)})).attr("style","dominant-baseline: central;").style("text-anchor","middle").style("font-size","2em").style("display",(function(){var textLength=this.getBBox().width;var textTooLong=textLength>=getInnerFreeSpace()-6;if(textTooLong){hiddenLabels=true;valueLabelHidden=true}return textTooLong?"none":"initial"}));if(this.gaugeConfig.labels.show){svg.append("text").attr("class","chart-label").text(data.label).attr("y",-30).attr("style","dominant-baseline: central; text-anchor: middle;").style("display",(function(){var textLength=this.getBBox().width;var textTooLong=textLength>maxRadius;if(textTooLong){hiddenLabels=true}return smallContainer||textTooLong?"none":"initial"}));svg.append("text").attr("class","chart-label").text(this.gaugeConfig.style.subText).attr("y",20).attr("style","dominant-baseline: central; text-anchor: middle;").style("display",(function(){var textLength=this.getBBox().width;var textTooLong=textLength>maxRadius;if(textTooLong){hiddenLabels=true}return valueLabelHidden||smallContainer||textTooLong?"none":"initial"}))}if(this.gaugeConfig.scale.show){this.drawScale(svg,radius(1),angle)}if(isTooltip){series.each((function(){var gauge=d3_default.a.select(this);gauge.call(tooltip.render())}))}if(hiddenLabels&&isDisplayWarning){this.gaugeChart.handler.alerts.show("Some labels were hidden due to size constraints")}var transformX=width/2;var transformY=height/2>maxRadius?height/2:maxRadius;svg.attr("transform","translate(".concat(transformX,", ").concat(transformY,")"));return series}}]);return MeterGauge}();var gaugeTypes={meter:meter_MeterGauge};function gauge_chart_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function gauge_chart_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function gauge_chart_createClass(Constructor,protoProps,staticProps){if(protoProps)gauge_chart_defineProperties(Constructor.prototype,protoProps);if(staticProps)gauge_chart_defineProperties(Constructor,staticProps);return Constructor}function gauge_chart_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)gauge_chart_setPrototypeOf(subClass,superClass)}function gauge_chart_setPrototypeOf(o,p){gauge_chart_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return gauge_chart_setPrototypeOf(o,p)}function gauge_chart_createSuper(Derived){var hasNativeReflectConstruct=gauge_chart_isNativeReflectConstruct();return function _createSuperInternal(){var Super=gauge_chart_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=gauge_chart_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return gauge_chart_possibleConstructorReturn(this,result)}}function gauge_chart_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return gauge_chart_assertThisInitialized(self)}function gauge_chart_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function gauge_chart_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function gauge_chart_getPrototypeOf(o){gauge_chart_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return gauge_chart_getPrototypeOf(o)}var gauge_chart_GaugeChart=function(_Chart){gauge_chart_inherits(GaugeChart,_Chart);var _super=gauge_chart_createSuper(GaugeChart);function GaugeChart(handler,chartEl,chartData,deps){var _this;gauge_chart_classCallCheck(this,GaugeChart);_this=_super.call(this,handler,chartEl,chartData,deps);_this.gaugeConfig=handler.visConfig.get("gauge",{});_this.gauge=new gaugeTypes[_this.gaugeConfig.type](gauge_chart_assertThisInitialized(_this));return _this}gauge_chart_createClass(GaugeChart,[{key:"addEvents",value:function addEvents(element){var events=this.events;return element.call(events.addHoverEvent()).call(events.addMouseoutEvent())}},{key:"calcGaugeDim",value:function calcGaugeDim(alignment,containerDom,nrOfItems){var containerWidth=containerDom.clientWidth;var containerHeight=containerDom.clientHeight;var containerMargin=25;var gaugeBottomMargin=Math.ceil(25/nrOfItems);var availableWidth=containerWidth-containerMargin;var availableHeight=containerHeight-containerMargin;var adaptedWidth=Math.floor(availableWidth/nrOfItems);var adaptedHeight=Math.floor(availableHeight/nrOfItems)-gaugeBottomMargin;switch(alignment){case"vertical":return{width:containerWidth,height:adaptedHeight,alignment:alignment};case"horizontal":return{width:adaptedWidth,height:availableHeight,alignment:alignment};default:return{width:availableWidth<availableHeight?containerWidth:adaptedWidth,height:availableWidth<availableHeight?adaptedHeight:availableHeight,alignment:availableWidth<availableHeight?"vertical":"horizontal"}}}},{key:"draw",value:function draw(){var self=this;var gaugeConfig=this.gaugeConfig;return function(selection){selection.each((function(data){var div=d3_default.a.select(this);var _self$calcGaugeDim=self.calcGaugeDim(gaugeConfig.alignment,this,data.series.length),width=_self$calcGaugeDim.width,height=_self$calcGaugeDim.height;if(height<0||width<0)return;div.style("text-align","center").style("overflow-y","auto");data.series.forEach((function(series){var svg=div.append("svg").style("display","inline-block").style("overflow","hidden").attr("focusable","false").attr("width",width);var g=svg.append("g");var gauges=self.gauge.drawGauge(g,series,width,height);svg.attr("height",height);self.addEvents(gauges)}));div.append("div").attr("class","chart-title").style("text-align","center").text(data.label||data.yAxisLabel);self.events.emit("rendered",{chart:data});return div}))}}}]);return GaugeChart}(_chart_Chart);var visTypes={pie:pie_chart_PieChart,point_series:point_series_PointSeries,gauge:gauge_chart_GaugeChart,goal:gauge_chart_GaugeChart,metric:gauge_chart_GaugeChart};function handler_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function handler_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function handler_createClass(Constructor,protoProps,staticProps){if(protoProps)handler_defineProperties(Constructor.prototype,protoProps);if(staticProps)handler_defineProperties(Constructor,staticProps);return Constructor}var markdownIt=new markdown_it_default.a({html:false,linkify:true});var handler_Handler=function(){function Handler(vis,visConfig,deps){handler_classCallCheck(this,Handler);this.el=visConfig.get("el");this.ChartClass=visTypes[visConfig.get("type")];this.deps=deps;this.charts=[];this.vis=vis;this.visConfig=visConfig;this.data=visConfig.data;this.categoryAxes=visConfig.get("categoryAxes").map((function(axisArgs){return new axis_Axis(visConfig,axisArgs)}));this.valueAxes=visConfig.get("valueAxes").map((function(axisArgs){return new axis_Axis(visConfig,axisArgs)}));this.chartTitle=new chart_title_ChartTitle(visConfig);this.alerts=new alerts_Alerts(this,visConfig.get("alerts"));this.grid=new chart_grid_ChartGrid(this,visConfig.get("grid"));if(visConfig.get("type")==="point_series"){this.data.stackData(this)}if(visConfig.get("resize",false)){this.resize=visConfig.get("resize")}this.layout=new layout_Layout(visConfig);this.binder=new binder_Binder;this.renderArray=external_kbnSharedDeps_Lodash_default.a.filter([this.layout,this.chartTitle,this.alerts],Boolean);this.renderArray=this.renderArray.concat(this.valueAxes).concat(this.categoryAxes.slice().reverse());this.getProxyHandler=external_kbnSharedDeps_Lodash_default.a.memoize((function(eventType){var self=this;return function(eventPayload){switch(eventType){case"brush":var xRaw=external_kbnSharedDeps_Lodash_default.a.get(eventPayload.data,"series[0].values[0].xRaw");if(!xRaw)return;return self.vis.emit(eventType,{table:xRaw.table,range:eventPayload.range,column:xRaw.column});case"click":return self.vis.emit(eventType,eventPayload)}}}));this.enable=this.chartEventProxyToggle("on");this.disable=this.chartEventProxyToggle("off")}handler_createClass(Handler,[{key:"_validateData",value:function _validateData(){var dataType=this.data.type;if(!dataType){throw new errors_NoResults}}},{key:"render",value:function render(){if(this.visConfig.get("error",null))return this.error(this.visConfig.get("error"));var self=this;var binder=this.binder,_this$charts=this.charts,charts=_this$charts===void 0?[]:_this$charts;var selection=d3_default.a.select(this.el);selection.selectAll("*").remove();this._validateData();this.renderArray.forEach((function(property){if(typeof property.render==="function"){property.render()}}));var loadedCount=0;var chartSelection=selection.selectAll(".chart");chartSelection.each((function(chartData){var chart=new self.ChartClass(self,this,chartData,self.deps);self.vis.eventNames().forEach((function(event){self.enable(event,chart)}));binder.on(chart.events,"rendered",(function(){loadedCount++;if(loadedCount===chartSelection.length){self.vis.emit("renderComplete")}}));charts.push(chart);chart.render()}))}},{key:"chartEventProxyToggle",value:function chartEventProxyToggle(method){return function(event,chart){var proxyHandler=this.getProxyHandler(event);external_kbnSharedDeps_Lodash_default.a.each(chart?[chart]:this.charts,(function(chart){chart.events[method](event,proxyHandler)}))}}},{key:"removeAll",value:function removeAll(el){return d3_default.a.select(el).selectAll("*").remove()}},{key:"error",value:function error(message){this.removeAll(this.el);var div=d3_default.a.select(this.el).append("div").attr("class","visError chart error").attr("data-test-subj","visLibVisualizeError");div.append("h4").text(markdownIt.renderInline(message));Object(public_["dispatchRenderComplete"])(this.el);return div}},{key:"destroy",value:function destroy(){this.binder.destroy();this.renderArray.forEach((function(renderable){if(external_kbnSharedDeps_Lodash_default.a.isFunction(renderable.destroy)){renderable.destroy()}}));this.charts.splice(0).forEach((function(chart){if(external_kbnSharedDeps_Lodash_default.a.isFunction(chart.destroy)){chart.destroy()}}))}}]);return Handler}();function vis_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function vis_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function vis_createClass(Constructor,protoProps,staticProps){if(protoProps)vis_defineProperties(Constructor.prototype,protoProps);if(staticProps)vis_defineProperties(Constructor,staticProps);return Constructor}function vis_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)vis_setPrototypeOf(subClass,superClass)}function vis_setPrototypeOf(o,p){vis_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return vis_setPrototypeOf(o,p)}function vis_createSuper(Derived){var hasNativeReflectConstruct=vis_isNativeReflectConstruct();return function _createSuperInternal(){var Super=vis_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=vis_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return vis_possibleConstructorReturn(this,result)}}function vis_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return vis_assertThisInitialized(self)}function vis_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function vis_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function vis_getPrototypeOf(o){vis_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return vis_getPrototypeOf(o)}var vis_Vis=function(_EventEmitter){vis_inherits(Vis,_EventEmitter);var _super=vis_createSuper(Vis);function Vis(element,visConfigArgs,deps){var _this;vis_classCallCheck(this,Vis);_this=_super.call(this);_this.element=element.get?element.get(0):element;_this.visConfigArgs=external_kbnSharedDeps_Lodash_default.a.cloneDeep(visConfigArgs);_this.visConfigArgs.dimmingOpacity=deps.uiSettings.get(DIMMING_OPACITY_SETTING);_this.visConfigArgs.heatmapMaxBuckets=deps.uiSettings.get(HEATMAP_MAX_BUCKETS_SETTING);_this.deps=deps;return _this}vis_createClass(Vis,[{key:"hasLegend",value:function hasLegend(){return this.visConfigArgs.addLegend}},{key:"initVisConfig",value:function initVisConfig(data,uiState){this.data=data;this.uiState=uiState;this.visConfig=new vis_config_VisConfig(this.visConfigArgs,this.data,this.uiState,this.element,this.deps.charts.colors.createColorLookupFunction.bind(this.deps.charts.colors))}},{key:"render",value:function render(data,uiState){if(!data){throw new Error("No valid data!")}if(this.handler){this.data=null;this._runOnHandler("destroy")}this.initVisConfig(data,uiState);this.handler=new handler_Handler(this,this.visConfig,this.deps);this._runOnHandler("render")}},{key:"getLegendLabels",value:function getLegendLabels(){return this.visConfig?this.visConfig.get("legend.labels",null):null}},{key:"getLegendColors",value:function getLegendColors(){return this.visConfig?this.visConfig.get("legend.colors",null):null}},{key:"_runOnHandler",value:function _runOnHandler(method){try{this.handler[method]()}catch(error){if(error instanceof VislibError){error.displayToScreen(this.handler)}else{throw error}}}},{key:"destroy",value:function destroy(){var selection=d3_default.a.select(this.element).select(".visWrapper");if(this.handler)this._runOnHandler("destroy");selection.remove()}},{key:"set",value:function set(name,val){this.visConfigArgs[name]=val;this.render(this.data,this.uiState)}},{key:"get",value:function get(name){return this.visConfig.get(name)}},{key:"on",value:function on(event,listener){var first=this.listenerCount(event)===0;var ret=events_events["EventEmitter"].prototype.on.call(this,event,listener);var added=this.listenerCount(event)>0;if(first&&added&&this.handler)this.handler.enable(event);return ret}},{key:"off",value:function off(event,listener){var last=this.listenerCount(event)===1;var ret=events_events["EventEmitter"].prototype.off.call(this,event,listener);var removed=this.listenerCount(event)===0;if(last&&removed&&this.handler)this.handler.disable(event);return ret}},{key:"removeAllListeners",value:function removeAllListeners(event){var ret=events_events["EventEmitter"].prototype.removeAllListeners.call(this,event);this.handler.disable(event);return ret}}]);return Vis}(events_events["EventEmitter"])},40:function(module,exports,__webpack_require__){exports.set=__webpack_require__(64);exports.setWith=__webpack_require__(107)},50:function(module,exports,__webpack_require__){var assignValue=__webpack_require__(65),castPath=__webpack_require__(76),isFunction=__webpack_require__(51),isIndex=__webpack_require__(105),isObject=__webpack_require__(44),toKey=__webpack_require__(106);function baseSet(object,path,value,customizer){if(!isObject(object)){return object}path=castPath(path,object);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=toKey(path[index]),newValue=value;if(key=="prototype"&&isFunction(nested)){throw new Error("Illegal access of function prototype")}if(index!=lastIndex){var objValue=hasOwnProperty.call(nested,key)?nested[key]:undefined;newValue=customizer?customizer(objValue,key,nested):undefined;if(newValue===undefined){newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{}}}assignValue(nested,key,newValue);nested=nested[key]}return object}module.exports=baseSet},64:function(module,exports,__webpack_require__){var baseSet=__webpack_require__(50);function set(object,path,value){return object==null?object:baseSet(object,path,value)}module.exports=set}}]);